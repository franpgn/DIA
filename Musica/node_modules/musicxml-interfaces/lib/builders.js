// Auto-generated by writeBuilders.js. Modification is unwise.
"use strict";
function makePatch(original, updates, childBuilders, explicitPatches, modifiedKeys) {
    if (!original)
        return [{ p: [], oi: updates }].concat(explicitPatches);
    var patches = Object.keys(modifiedKeys).map(function (key) {
        if (childBuilders[key] !== undefined)
            return;
        if (updates[key] === original[key] || updates[key] !== updates[key] && original[key] !== original[key])
            return;
        if (updates[key] === undefined)
            return { p: [key], od: original[key] };
        if (original[key] === undefined)
            return { p: [key], oi: updates[key] };
        return { p: [key], od: original[key], oi: updates[key] };
    }).filter(function (p) { return Boolean(p); });
    Object.keys(childBuilders).map(function (key) {
        if (original[key] === undefined) {
            patches.push({ p: [key], oi: childBuilders[key].build() });
        }
        else {
            var subpatches = childBuilders[key].patch().map(function (patch) {
                patch.p = [key].concat(patch.p);
                return patch;
            });
            patches = patches.concat(subpatches);
        }
    });
    return patches.concat(explicitPatches);
}
var TextSegmentBuilder = (function () {
    function TextSegmentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TextSegment";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.acc = function (build) {
            if (typeof build === 'function') {
                delete updates["acc"];
                var builder = build(new AccidentalTextBuilder(original && original["acc"]));
                if (!original)
                    updates["acc"] = builder.build();
                else
                    childBuilders["acc"] = builder;
            }
            else {
                updates.acc = build;
                delete childBuilders["acc;"];
            }
            modifiedKeys["acc"] = true;
            return _this;
        };
        this.text = function (build) {
            if (typeof build === 'function') {
                delete updates["text"];
                var builder = build(new DisplayTextBuilder(original && original["text"]));
                if (!original)
                    updates["text"] = builder.build();
                else
                    childBuilders["text"] = builder;
            }
            else {
                updates.text = build;
                delete childBuilders["text;"];
            }
            modifiedKeys["text"] = true;
            return _this;
        };
    }
    return TextSegmentBuilder;
}());
function patchTextSegment(base, builder) { return builder(new TextSegmentBuilder(base)).patch(); }
exports.patchTextSegment = patchTextSegment;
function buildTextSegment(builder) { return builder(new TextSegmentBuilder()).build(); }
exports.buildTextSegment = buildTextSegment;
var EncodingDateBuilder = (function () {
    function EncodingDateBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["month"]) ||
                childBuilders["month"] !== undefined ||
                updates.month !== undefined, "month is a required field");
            console.assert((original && !modifiedKeys["day"]) ||
                childBuilders["day"] !== undefined ||
                updates.day !== undefined, "day is a required field");
            console.assert((original && !modifiedKeys["year"]) ||
                childBuilders["year"] !== undefined ||
                updates.year !== undefined, "year is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "EncodingDate";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.month = function (spec) {
            updates["month"] = spec;
            delete childBuilders["month;"];
            modifiedKeys["month"] = true;
            return _this;
        };
        this.day = function (spec) {
            updates["day"] = spec;
            delete childBuilders["day;"];
            modifiedKeys["day"] = true;
            return _this;
        };
        this.year = function (spec) {
            updates["year"] = spec;
            delete childBuilders["year;"];
            modifiedKeys["year"] = true;
            return _this;
        };
    }
    return EncodingDateBuilder;
}());
function patchEncodingDate(base, builder) { return builder(new EncodingDateBuilder(base)).patch(); }
exports.patchEncodingDate = patchEncodingDate;
function buildEncodingDate(builder) { return builder(new EncodingDateBuilder()).build(); }
exports.buildEncodingDate = buildEncodingDate;
var CalendarDateBuilder = (function () {
    function CalendarDateBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["month"]) ||
                childBuilders["month"] !== undefined ||
                updates.month !== undefined, "month is a required field");
            console.assert((original && !modifiedKeys["day"]) ||
                childBuilders["day"] !== undefined ||
                updates.day !== undefined, "day is a required field");
            console.assert((original && !modifiedKeys["year"]) ||
                childBuilders["year"] !== undefined ||
                updates.year !== undefined, "year is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "CalendarDate";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.month = function (spec) {
            updates["month"] = spec;
            delete childBuilders["month;"];
            modifiedKeys["month"] = true;
            return _this;
        };
        this.day = function (spec) {
            updates["day"] = spec;
            delete childBuilders["day;"];
            modifiedKeys["day"] = true;
            return _this;
        };
        this.year = function (spec) {
            updates["year"] = spec;
            delete childBuilders["year;"];
            modifiedKeys["year"] = true;
            return _this;
        };
    }
    return CalendarDateBuilder;
}());
function patchCalendarDate(base, builder) { return builder(new CalendarDateBuilder(base)).patch(); }
exports.patchCalendarDate = patchCalendarDate;
function buildCalendarDate(builder) { return builder(new CalendarDateBuilder()).build(); }
exports.buildCalendarDate = buildCalendarDate;
var PositionBuilder = (function () {
    function PositionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Position";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
    }
    return PositionBuilder;
}());
function patchPosition(base, builder) { return builder(new PositionBuilder(base)).patch(); }
exports.patchPosition = patchPosition;
function buildPosition(builder) { return builder(new PositionBuilder()).build(); }
exports.buildPosition = buildPosition;
var PlacementBuilder = (function () {
    function PlacementBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Placement";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return PlacementBuilder;
}());
function patchPlacement(base, builder) { return builder(new PlacementBuilder(base)).patch(); }
exports.patchPlacement = patchPlacement;
function buildPlacement(builder) { return builder(new PlacementBuilder()).build(); }
exports.buildPlacement = buildPlacement;
var OrientationBuilder = (function () {
    function OrientationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Orientation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.orientation = function (spec) {
            updates["orientation"] = spec;
            delete childBuilders["orientation;"];
            modifiedKeys["orientation"] = true;
            return _this;
        };
    }
    return OrientationBuilder;
}());
function patchOrientation(base, builder) { return builder(new OrientationBuilder(base)).patch(); }
exports.patchOrientation = patchOrientation;
function buildOrientation(builder) { return builder(new OrientationBuilder()).build(); }
exports.buildOrientation = buildOrientation;
var DirectiveEntityBuilder = (function () {
    function DirectiveEntityBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DirectiveEntity";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.directive = function (spec) {
            updates["directive"] = spec;
            delete childBuilders["directive;"];
            modifiedKeys["directive"] = true;
            return _this;
        };
    }
    return DirectiveEntityBuilder;
}());
function patchDirectiveEntity(base, builder) { return builder(new DirectiveEntityBuilder(base)).patch(); }
exports.patchDirectiveEntity = patchDirectiveEntity;
function buildDirectiveEntity(builder) { return builder(new DirectiveEntityBuilder()).build(); }
exports.buildDirectiveEntity = buildDirectiveEntity;
var BezierBuilder = (function () {
    function BezierBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Bezier";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.bezierX2 = function (spec) {
            updates["bezierX2"] = spec;
            delete childBuilders["bezierX2;"];
            modifiedKeys["bezierX2"] = true;
            return _this;
        };
        this.bezierOffset = function (spec) {
            updates["bezierOffset"] = spec;
            delete childBuilders["bezierOffset;"];
            modifiedKeys["bezierOffset"] = true;
            return _this;
        };
        this.bezierOffset2 = function (spec) {
            updates["bezierOffset2"] = spec;
            delete childBuilders["bezierOffset2;"];
            modifiedKeys["bezierOffset2"] = true;
            return _this;
        };
        this.bezierX = function (spec) {
            updates["bezierX"] = spec;
            delete childBuilders["bezierX;"];
            modifiedKeys["bezierX"] = true;
            return _this;
        };
        this.bezierY = function (spec) {
            updates["bezierY"] = spec;
            delete childBuilders["bezierY;"];
            modifiedKeys["bezierY"] = true;
            return _this;
        };
        this.bezierY2 = function (spec) {
            updates["bezierY2"] = spec;
            delete childBuilders["bezierY2;"];
            modifiedKeys["bezierY2"] = true;
            return _this;
        };
    }
    return BezierBuilder;
}());
function patchBezier(base, builder) { return builder(new BezierBuilder(base)).patch(); }
exports.patchBezier = patchBezier;
function buildBezier(builder) { return builder(new BezierBuilder()).build(); }
exports.buildBezier = buildBezier;
var FontBuilder = (function () {
    function FontBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Font";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
    }
    return FontBuilder;
}());
function patchFont(base, builder) { return builder(new FontBuilder(base)).patch(); }
exports.patchFont = patchFont;
function buildFont(builder) { return builder(new FontBuilder()).build(); }
exports.buildFont = buildFont;
var ColorBuilder = (function () {
    function ColorBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Color";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return ColorBuilder;
}());
function patchColor(base, builder) { return builder(new ColorBuilder(base)).patch(); }
exports.patchColor = patchColor;
function buildColor(builder) { return builder(new ColorBuilder()).build(); }
exports.buildColor = buildColor;
var TextDecorationBuilder = (function () {
    function TextDecorationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TextDecoration";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
    }
    return TextDecorationBuilder;
}());
function patchTextDecoration(base, builder) { return builder(new TextDecorationBuilder(base)).patch(); }
exports.patchTextDecoration = patchTextDecoration;
function buildTextDecoration(builder) { return builder(new TextDecorationBuilder()).build(); }
exports.buildTextDecoration = buildTextDecoration;
var JustifyBuilder = (function () {
    function JustifyBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Justify";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
    }
    return JustifyBuilder;
}());
function patchJustify(base, builder) { return builder(new JustifyBuilder(base)).patch(); }
exports.patchJustify = patchJustify;
function buildJustify(builder) { return builder(new JustifyBuilder()).build(); }
exports.buildJustify = buildJustify;
var HalignBuilder = (function () {
    function HalignBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Halign";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
    }
    return HalignBuilder;
}());
function patchHalign(base, builder) { return builder(new HalignBuilder(base)).patch(); }
exports.patchHalign = patchHalign;
function buildHalign(builder) { return builder(new HalignBuilder()).build(); }
exports.buildHalign = buildHalign;
var ValignBuilder = (function () {
    function ValignBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Valign";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return ValignBuilder;
}());
function patchValign(base, builder) { return builder(new ValignBuilder(base)).patch(); }
exports.patchValign = patchValign;
function buildValign(builder) { return builder(new ValignBuilder()).build(); }
exports.buildValign = buildValign;
var ValignImageBuilder = (function () {
    function ValignImageBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "ValignImage";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.valignImage = function (spec) {
            updates["valignImage"] = spec;
            delete childBuilders["valignImage;"];
            modifiedKeys["valignImage"] = true;
            return _this;
        };
    }
    return ValignImageBuilder;
}());
function patchValignImage(base, builder) { return builder(new ValignImageBuilder(base)).patch(); }
exports.patchValignImage = patchValignImage;
function buildValignImage(builder) { return builder(new ValignImageBuilder()).build(); }
exports.buildValignImage = buildValignImage;
var LetterSpacingBuilder = (function () {
    function LetterSpacingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LetterSpacing";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
    }
    return LetterSpacingBuilder;
}());
function patchLetterSpacing(base, builder) { return builder(new LetterSpacingBuilder(base)).patch(); }
exports.patchLetterSpacing = patchLetterSpacing;
function buildLetterSpacing(builder) { return builder(new LetterSpacingBuilder()).build(); }
exports.buildLetterSpacing = buildLetterSpacing;
var LineHeightBuilder = (function () {
    function LineHeightBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LineHeight";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
    }
    return LineHeightBuilder;
}());
function patchLineHeight(base, builder) { return builder(new LineHeightBuilder(base)).patch(); }
exports.patchLineHeight = patchLineHeight;
function buildLineHeight(builder) { return builder(new LineHeightBuilder()).build(); }
exports.buildLineHeight = buildLineHeight;
var TextDirectionBuilder = (function () {
    function TextDirectionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TextDirection";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
    }
    return TextDirectionBuilder;
}());
function patchTextDirection(base, builder) { return builder(new TextDirectionBuilder(base)).patch(); }
exports.patchTextDirection = patchTextDirection;
function buildTextDirection(builder) { return builder(new TextDirectionBuilder()).build(); }
exports.buildTextDirection = buildTextDirection;
var TextRotationBuilder = (function () {
    function TextRotationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TextRotation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
    }
    return TextRotationBuilder;
}());
function patchTextRotation(base, builder) { return builder(new TextRotationBuilder(base)).patch(); }
exports.patchTextRotation = patchTextRotation;
function buildTextRotation(builder) { return builder(new TextRotationBuilder()).build(); }
exports.buildTextRotation = buildTextRotation;
var EnclosureBuilder = (function () {
    function EnclosureBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Enclosure";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return EnclosureBuilder;
}());
function patchEnclosure(base, builder) { return builder(new EnclosureBuilder(base)).patch(); }
exports.patchEnclosure = patchEnclosure;
function buildEnclosure(builder) { return builder(new EnclosureBuilder()).build(); }
exports.buildEnclosure = buildEnclosure;
var PrintStyleBuilder = (function () {
    function PrintStyleBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PrintStyle";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return PrintStyleBuilder;
}());
function patchPrintStyle(base, builder) { return builder(new PrintStyleBuilder(base)).patch(); }
exports.patchPrintStyle = patchPrintStyle;
function buildPrintStyle(builder) { return builder(new PrintStyleBuilder()).build(); }
exports.buildPrintStyle = buildPrintStyle;
var PrintStyleAlignBuilder = (function () {
    function PrintStyleAlignBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PrintStyleAlign";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return PrintStyleAlignBuilder;
}());
function patchPrintStyleAlign(base, builder) { return builder(new PrintStyleAlignBuilder(base)).patch(); }
exports.patchPrintStyleAlign = patchPrintStyleAlign;
function buildPrintStyleAlign(builder) { return builder(new PrintStyleAlignBuilder()).build(); }
exports.buildPrintStyleAlign = buildPrintStyleAlign;
var LineShapeBuilder = (function () {
    function LineShapeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LineShape";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return LineShapeBuilder;
}());
function patchLineShape(base, builder) { return builder(new LineShapeBuilder(base)).patch(); }
exports.patchLineShape = patchLineShape;
function buildLineShape(builder) { return builder(new LineShapeBuilder()).build(); }
exports.buildLineShape = buildLineShape;
var LineTypeBuilder = (function () {
    function LineTypeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LineType";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
    }
    return LineTypeBuilder;
}());
function patchLineType(base, builder) { return builder(new LineTypeBuilder(base)).patch(); }
exports.patchLineType = patchLineType;
function buildLineType(builder) { return builder(new LineTypeBuilder()).build(); }
exports.buildLineType = buildLineType;
var DashedFormattingBuilder = (function () {
    function DashedFormattingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DashedFormatting";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
    }
    return DashedFormattingBuilder;
}());
function patchDashedFormatting(base, builder) { return builder(new DashedFormattingBuilder(base)).patch(); }
exports.patchDashedFormatting = patchDashedFormatting;
function buildDashedFormatting(builder) { return builder(new DashedFormattingBuilder()).build(); }
exports.buildDashedFormatting = buildDashedFormatting;
var PrintObjectBuilder = (function () {
    function PrintObjectBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PrintObject";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return PrintObjectBuilder;
}());
function patchPrintObject(base, builder) { return builder(new PrintObjectBuilder(base)).patch(); }
exports.patchPrintObject = patchPrintObject;
function buildPrintObject(builder) { return builder(new PrintObjectBuilder()).build(); }
exports.buildPrintObject = buildPrintObject;
var PrintSpacingBuilder = (function () {
    function PrintSpacingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PrintSpacing";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.printSpacing = function (spec) {
            updates["printSpacing"] = spec;
            delete childBuilders["printSpacing;"];
            modifiedKeys["printSpacing"] = true;
            return _this;
        };
    }
    return PrintSpacingBuilder;
}());
function patchPrintSpacing(base, builder) { return builder(new PrintSpacingBuilder(base)).patch(); }
exports.patchPrintSpacing = patchPrintSpacing;
function buildPrintSpacing(builder) { return builder(new PrintSpacingBuilder()).build(); }
exports.buildPrintSpacing = buildPrintSpacing;
var PrintoutBuilder = (function () {
    function PrintoutBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Printout";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.printDot = function (spec) {
            updates["printDot"] = spec;
            delete childBuilders["printDot;"];
            modifiedKeys["printDot"] = true;
            return _this;
        };
        this.printLyric = function (spec) {
            updates["printLyric"] = spec;
            delete childBuilders["printLyric;"];
            modifiedKeys["printLyric"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.printSpacing = function (spec) {
            updates["printSpacing"] = spec;
            delete childBuilders["printSpacing;"];
            modifiedKeys["printSpacing"] = true;
            return _this;
        };
    }
    return PrintoutBuilder;
}());
function patchPrintout(base, builder) { return builder(new PrintoutBuilder(base)).patch(); }
exports.patchPrintout = patchPrintout;
function buildPrintout(builder) { return builder(new PrintoutBuilder()).build(); }
exports.buildPrintout = buildPrintout;
var TextFormattingBuilder = (function () {
    function TextFormattingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TextFormatting";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return TextFormattingBuilder;
}());
function patchTextFormatting(base, builder) { return builder(new TextFormattingBuilder(base)).patch(); }
exports.patchTextFormatting = patchTextFormatting;
function buildTextFormatting(builder) { return builder(new TextFormattingBuilder()).build(); }
exports.buildTextFormatting = buildTextFormatting;
var LevelDisplayBuilder = (function () {
    function LevelDisplayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LevelDisplay";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.bracket = function (spec) {
            updates["bracket"] = spec;
            delete childBuilders["bracket;"];
            modifiedKeys["bracket"] = true;
            return _this;
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
        this.parentheses = function (spec) {
            updates["parentheses"] = spec;
            delete childBuilders["parentheses;"];
            modifiedKeys["parentheses"] = true;
            return _this;
        };
    }
    return LevelDisplayBuilder;
}());
function patchLevelDisplay(base, builder) { return builder(new LevelDisplayBuilder(base)).patch(); }
exports.patchLevelDisplay = patchLevelDisplay;
function buildLevelDisplay(builder) { return builder(new LevelDisplayBuilder()).build(); }
exports.buildLevelDisplay = buildLevelDisplay;
var TrillSoundBuilder = (function () {
    function TrillSoundBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TrillSound";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return TrillSoundBuilder;
}());
function patchTrillSound(base, builder) { return builder(new TrillSoundBuilder(base)).patch(); }
exports.patchTrillSound = patchTrillSound;
function buildTrillSound(builder) { return builder(new TrillSoundBuilder()).build(); }
exports.buildTrillSound = buildTrillSound;
var BendSoundBuilder = (function () {
    function BendSoundBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BendSound";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.firstBeat = function (spec) {
            updates["firstBeat"] = spec;
            delete childBuilders["firstBeat;"];
            modifiedKeys["firstBeat"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
    }
    return BendSoundBuilder;
}());
function patchBendSound(base, builder) { return builder(new BendSoundBuilder(base)).patch(); }
exports.patchBendSound = patchBendSound;
function buildBendSound(builder) { return builder(new BendSoundBuilder()).build(); }
exports.buildBendSound = buildBendSound;
var TimeOnlyBuilder = (function () {
    function TimeOnlyBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TimeOnly";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.timeOnly = function (spec) {
            updates["timeOnly"] = spec;
            delete childBuilders["timeOnly;"];
            modifiedKeys["timeOnly"] = true;
            return _this;
        };
    }
    return TimeOnlyBuilder;
}());
function patchTimeOnly(base, builder) { return builder(new TimeOnlyBuilder(base)).patch(); }
exports.patchTimeOnly = patchTimeOnly;
function buildTimeOnly(builder) { return builder(new TimeOnlyBuilder()).build(); }
exports.buildTimeOnly = buildTimeOnly;
var DocumentAttributesBuilder = (function () {
    function DocumentAttributesBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["version"]) ||
                childBuilders["version"] !== undefined ||
                updates.version !== undefined, "version is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DocumentAttributes";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.version = function (spec) {
            updates["version"] = spec;
            delete childBuilders["version;"];
            modifiedKeys["version"] = true;
            return _this;
        };
    }
    return DocumentAttributesBuilder;
}());
function patchDocumentAttributes(base, builder) { return builder(new DocumentAttributesBuilder(base)).patch(); }
exports.patchDocumentAttributes = patchDocumentAttributes;
function buildDocumentAttributes(builder) { return builder(new DocumentAttributesBuilder()).build(); }
exports.buildDocumentAttributes = buildDocumentAttributes;
var EditorialBuilder = (function () {
    function EditorialBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Editorial";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return EditorialBuilder;
}());
function patchEditorial(base, builder) { return builder(new EditorialBuilder(base)).patch(); }
exports.patchEditorial = patchEditorial;
function buildEditorial(builder) { return builder(new EditorialBuilder()).build(); }
exports.buildEditorial = buildEditorial;
var EditorialVoiceBuilder = (function () {
    function EditorialVoiceBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "EditorialVoice";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.voice = function (spec) {
            updates["voice"] = spec;
            delete childBuilders["voice;"];
            modifiedKeys["voice"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return EditorialVoiceBuilder;
}());
function patchEditorialVoice(base, builder) { return builder(new EditorialVoiceBuilder(base)).patch(); }
exports.patchEditorialVoice = patchEditorialVoice;
function buildEditorialVoice(builder) { return builder(new EditorialVoiceBuilder()).build(); }
exports.buildEditorialVoice = buildEditorialVoice;
var FootnoteBuilder = (function () {
    function FootnoteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Footnote";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return FootnoteBuilder;
}());
function patchFootnote(base, builder) { return builder(new FootnoteBuilder(base)).patch(); }
exports.patchFootnote = patchFootnote;
function buildFootnote(builder) { return builder(new FootnoteBuilder()).build(); }
exports.buildFootnote = buildFootnote;
var LevelBuilder = (function () {
    function LevelBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Level";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.reference = function (spec) {
            updates["reference"] = spec;
            delete childBuilders["reference;"];
            modifiedKeys["reference"] = true;
            return _this;
        };
        this.bracket = function (spec) {
            updates["bracket"] = spec;
            delete childBuilders["bracket;"];
            modifiedKeys["bracket"] = true;
            return _this;
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
        this.parentheses = function (spec) {
            updates["parentheses"] = spec;
            delete childBuilders["parentheses;"];
            modifiedKeys["parentheses"] = true;
            return _this;
        };
    }
    return LevelBuilder;
}());
function patchLevel(base, builder) { return builder(new LevelBuilder(base)).patch(); }
exports.patchLevel = patchLevel;
function buildLevel(builder) { return builder(new LevelBuilder()).build(); }
exports.buildLevel = buildLevel;
var FermataBuilder = (function () {
    function FermataBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["shape"]) ||
                childBuilders["shape"] !== undefined ||
                updates.shape !== undefined, "shape is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Fermata";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.shape = function (spec) {
            updates["shape"] = spec;
            delete childBuilders["shape;"];
            modifiedKeys["shape"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return FermataBuilder;
}());
function patchFermata(base, builder) { return builder(new FermataBuilder(base)).patch(); }
exports.patchFermata = patchFermata;
function buildFermata(builder) { return builder(new FermataBuilder()).build(); }
exports.buildFermata = buildFermata;
var WavyLineBuilder = (function () {
    function WavyLineBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "WavyLine";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return WavyLineBuilder;
}());
function patchWavyLine(base, builder) { return builder(new WavyLineBuilder(base)).patch(); }
exports.patchWavyLine = patchWavyLine;
function buildWavyLine(builder) { return builder(new WavyLineBuilder()).build(); }
exports.buildWavyLine = buildWavyLine;
var SegnoBuilder = (function () {
    function SegnoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Segno";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return SegnoBuilder;
}());
function patchSegno(base, builder) { return builder(new SegnoBuilder(base)).patch(); }
exports.patchSegno = patchSegno;
function buildSegno(builder) { return builder(new SegnoBuilder()).build(); }
exports.buildSegno = buildSegno;
var CodaBuilder = (function () {
    function CodaBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Coda";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return CodaBuilder;
}());
function patchCoda(base, builder) { return builder(new CodaBuilder(base)).patch(); }
exports.patchCoda = patchCoda;
function buildCoda(builder) { return builder(new CodaBuilder()).build(); }
exports.buildCoda = buildCoda;
var NormalDotBuilder = (function () {
    function NormalDotBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "NormalDot";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return NormalDotBuilder;
}());
function patchNormalDot(base, builder) { return builder(new NormalDotBuilder(base)).patch(); }
exports.patchNormalDot = patchNormalDot;
function buildNormalDot(builder) { return builder(new NormalDotBuilder()).build(); }
exports.buildNormalDot = buildNormalDot;
var DynamicsBuilder = (function () {
    function DynamicsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Dynamics";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.f = function (spec) {
            updates["f"] = spec;
            delete childBuilders["f;"];
            modifiedKeys["f"] = true;
            return _this;
        };
        this.ff = function (spec) {
            updates["ff"] = spec;
            delete childBuilders["ff;"];
            modifiedKeys["ff"] = true;
            return _this;
        };
        this.fff = function (spec) {
            updates["fff"] = spec;
            delete childBuilders["fff;"];
            modifiedKeys["fff"] = true;
            return _this;
        };
        this.ffff = function (spec) {
            updates["ffff"] = spec;
            delete childBuilders["ffff;"];
            modifiedKeys["ffff"] = true;
            return _this;
        };
        this.fffff = function (spec) {
            updates["fffff"] = spec;
            delete childBuilders["fffff;"];
            modifiedKeys["fffff"] = true;
            return _this;
        };
        this.ffffff = function (spec) {
            updates["ffffff"] = spec;
            delete childBuilders["ffffff;"];
            modifiedKeys["ffffff"] = true;
            return _this;
        };
        this.fp = function (spec) {
            updates["fp"] = spec;
            delete childBuilders["fp;"];
            modifiedKeys["fp"] = true;
            return _this;
        };
        this.fz = function (spec) {
            updates["fz"] = spec;
            delete childBuilders["fz;"];
            modifiedKeys["fz"] = true;
            return _this;
        };
        this.mf = function (spec) {
            updates["mf"] = spec;
            delete childBuilders["mf;"];
            modifiedKeys["mf"] = true;
            return _this;
        };
        this.mp = function (spec) {
            updates["mp"] = spec;
            delete childBuilders["mp;"];
            modifiedKeys["mp"] = true;
            return _this;
        };
        this.otherDynamics = function (spec) {
            updates["otherDynamics"] = spec;
            delete childBuilders["otherDynamics;"];
            modifiedKeys["otherDynamics"] = true;
            return _this;
        };
        this.p = function (spec) {
            updates["p"] = spec;
            delete childBuilders["p;"];
            modifiedKeys["p"] = true;
            return _this;
        };
        this.pp = function (spec) {
            updates["pp"] = spec;
            delete childBuilders["pp;"];
            modifiedKeys["pp"] = true;
            return _this;
        };
        this.ppp = function (spec) {
            updates["ppp"] = spec;
            delete childBuilders["ppp;"];
            modifiedKeys["ppp"] = true;
            return _this;
        };
        this.pppp = function (spec) {
            updates["pppp"] = spec;
            delete childBuilders["pppp;"];
            modifiedKeys["pppp"] = true;
            return _this;
        };
        this.ppppp = function (spec) {
            updates["ppppp"] = spec;
            delete childBuilders["ppppp;"];
            modifiedKeys["ppppp"] = true;
            return _this;
        };
        this.pppppp = function (spec) {
            updates["pppppp"] = spec;
            delete childBuilders["pppppp;"];
            modifiedKeys["pppppp"] = true;
            return _this;
        };
        this.rf = function (spec) {
            updates["rf"] = spec;
            delete childBuilders["rf;"];
            modifiedKeys["rf"] = true;
            return _this;
        };
        this.rfz = function (spec) {
            updates["rfz"] = spec;
            delete childBuilders["rfz;"];
            modifiedKeys["rfz"] = true;
            return _this;
        };
        this.sf = function (spec) {
            updates["sf"] = spec;
            delete childBuilders["sf;"];
            modifiedKeys["sf"] = true;
            return _this;
        };
        this.sffz = function (spec) {
            updates["sffz"] = spec;
            delete childBuilders["sffz;"];
            modifiedKeys["sffz"] = true;
            return _this;
        };
        this.sfp = function (spec) {
            updates["sfp"] = spec;
            delete childBuilders["sfp;"];
            modifiedKeys["sfp"] = true;
            return _this;
        };
        this.sfpp = function (spec) {
            updates["sfpp"] = spec;
            delete childBuilders["sfpp;"];
            modifiedKeys["sfpp"] = true;
            return _this;
        };
        this.sfz = function (spec) {
            updates["sfz"] = spec;
            delete childBuilders["sfz;"];
            modifiedKeys["sfz"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return DynamicsBuilder;
}());
function patchDynamics(base, builder) { return builder(new DynamicsBuilder(base)).patch(); }
exports.patchDynamics = patchDynamics;
function buildDynamics(builder) { return builder(new DynamicsBuilder()).build(); }
exports.buildDynamics = buildDynamics;
var FingeringBuilder = (function () {
    function FingeringBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Fingering";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.substitution = function (spec) {
            updates["substitution"] = spec;
            delete childBuilders["substitution;"];
            modifiedKeys["substitution"] = true;
            return _this;
        };
        this.finger = function (spec) {
            updates["finger"] = spec;
            delete childBuilders["finger;"];
            modifiedKeys["finger"] = true;
            return _this;
        };
        this.alternate = function (spec) {
            updates["alternate"] = spec;
            delete childBuilders["alternate;"];
            modifiedKeys["alternate"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return FingeringBuilder;
}());
function patchFingering(base, builder) { return builder(new FingeringBuilder(base)).patch(); }
exports.patchFingering = patchFingering;
function buildFingering(builder) { return builder(new FingeringBuilder()).build(); }
exports.buildFingering = buildFingering;
var FretBuilder = (function () {
    function FretBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["fret"]) ||
                childBuilders["fret"] !== undefined ||
                updates.fret !== undefined, "fret is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Fret";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.fret = function (spec) {
            updates["fret"] = spec;
            delete childBuilders["fret;"];
            modifiedKeys["fret"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return FretBuilder;
}());
function patchFret(base, builder) { return builder(new FretBuilder(base)).patch(); }
exports.patchFret = patchFret;
function buildFret(builder) { return builder(new FretBuilder()).build(); }
exports.buildFret = buildFret;
var StringBuilder = (function () {
    function StringBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["stringNum"]) ||
                childBuilders["stringNum"] !== undefined ||
                updates.stringNum !== undefined, "stringNum is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "String";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.stringNum = function (spec) {
            updates["stringNum"] = spec;
            delete childBuilders["stringNum;"];
            modifiedKeys["stringNum"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return StringBuilder;
}());
function patchString(base, builder) { return builder(new StringBuilder(base)).patch(); }
exports.patchString = patchString;
function buildString(builder) { return builder(new StringBuilder()).build(); }
exports.buildString = buildString;
var DisplayTextBuilder = (function () {
    function DisplayTextBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DisplayText";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return DisplayTextBuilder;
}());
function patchDisplayText(base, builder) { return builder(new DisplayTextBuilder(base)).patch(); }
exports.patchDisplayText = patchDisplayText;
function buildDisplayText(builder) { return builder(new DisplayTextBuilder()).build(); }
exports.buildDisplayText = buildDisplayText;
var AccidentalTextBuilder = (function () {
    function AccidentalTextBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "AccidentalText";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return AccidentalTextBuilder;
}());
function patchAccidentalText(base, builder) { return builder(new AccidentalTextBuilder(base)).patch(); }
exports.patchAccidentalText = patchAccidentalText;
function buildAccidentalText(builder) { return builder(new AccidentalTextBuilder()).build(); }
exports.buildAccidentalText = buildAccidentalText;
var PartNameDisplayBuilder = (function () {
    function PartNameDisplayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PartNameDisplay";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.nameAt = function (idx, build) {
            makeReference("name");
            if (frozen["name"][idx]) {
                throw new Error("Patching name." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["name"] && !original["name"]) {
                // Clone snapshot.
                patches.push({ p: ["name", idx], li: original._snapshot["name"] });
            }
            if (typeof build === 'function' && reference["name"][idx]) {
                var patch = build(new TextSegmentBuilder(reference["name"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["name", idx].concat(patch.p);
                    return patch;
                }));
                frozen["name"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TextSegmentBuilder(reference["name"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["name", idx], li: update });
            }
            else {
                updates["name"] = reference["name"]; // TODO: Merge?
            }
            reference["name"][idx] = update;
            frozen["name"][idx] = true;
            return _this;
        };
        this.nameSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("name");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Replacing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld, li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Removing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["name", idx], li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
            }
            (_a = reference["name"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["name"] = reference["name"];
            (_b = frozen["name"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return PartNameDisplayBuilder;
}());
function patchPartNameDisplay(base, builder) { return builder(new PartNameDisplayBuilder(base)).patch(); }
exports.patchPartNameDisplay = patchPartNameDisplay;
function buildPartNameDisplay(builder) { return builder(new PartNameDisplayBuilder()).build(); }
exports.buildPartNameDisplay = buildPartNameDisplay;
var PartAbbreviationDisplayBuilder = (function () {
    function PartAbbreviationDisplayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PartAbbreviationDisplay";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.nameAt = function (idx, build) {
            makeReference("name");
            if (frozen["name"][idx]) {
                throw new Error("Patching name." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["name"] && !original["name"]) {
                // Clone snapshot.
                patches.push({ p: ["name", idx], li: original._snapshot["name"] });
            }
            if (typeof build === 'function' && reference["name"][idx]) {
                var patch = build(new TextSegmentBuilder(reference["name"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["name", idx].concat(patch.p);
                    return patch;
                }));
                frozen["name"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TextSegmentBuilder(reference["name"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["name", idx], li: update });
            }
            else {
                updates["name"] = reference["name"]; // TODO: Merge?
            }
            reference["name"][idx] = update;
            frozen["name"][idx] = true;
            return _this;
        };
        this.nameSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("name");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Replacing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld, li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Removing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["name", idx], li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
            }
            (_a = reference["name"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["name"] = reference["name"];
            (_b = frozen["name"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return PartAbbreviationDisplayBuilder;
}());
function patchPartAbbreviationDisplay(base, builder) { return builder(new PartAbbreviationDisplayBuilder(base)).patch(); }
exports.patchPartAbbreviationDisplay = patchPartAbbreviationDisplay;
function buildPartAbbreviationDisplay(builder) { return builder(new PartAbbreviationDisplayBuilder()).build(); }
exports.buildPartAbbreviationDisplay = buildPartAbbreviationDisplay;
var MidiDeviceBuilder = (function () {
    function MidiDeviceBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["deviceName"]) ||
                childBuilders["deviceName"] !== undefined ||
                updates.deviceName !== undefined, "deviceName is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MidiDevice";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.port = function (spec) {
            updates["port"] = spec;
            delete childBuilders["port;"];
            modifiedKeys["port"] = true;
            return _this;
        };
        this.deviceName = function (spec) {
            updates["deviceName"] = spec;
            delete childBuilders["deviceName;"];
            modifiedKeys["deviceName"] = true;
            return _this;
        };
        this.id = function (spec) {
            updates["id"] = spec;
            delete childBuilders["id;"];
            modifiedKeys["id"] = true;
            return _this;
        };
    }
    return MidiDeviceBuilder;
}());
function patchMidiDevice(base, builder) { return builder(new MidiDeviceBuilder(base)).patch(); }
exports.patchMidiDevice = patchMidiDevice;
function buildMidiDevice(builder) { return builder(new MidiDeviceBuilder()).build(); }
exports.buildMidiDevice = buildMidiDevice;
var MidiInstrumentBuilder = (function () {
    function MidiInstrumentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["id"]) ||
                childBuilders["id"] !== undefined ||
                updates.id !== undefined, "id is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MidiInstrument";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.midiUnpitched = function (spec) {
            updates["midiUnpitched"] = spec;
            delete childBuilders["midiUnpitched;"];
            modifiedKeys["midiUnpitched"] = true;
            return _this;
        };
        this.volume = function (spec) {
            updates["volume"] = spec;
            delete childBuilders["volume;"];
            modifiedKeys["volume"] = true;
            return _this;
        };
        this.pan = function (spec) {
            updates["pan"] = spec;
            delete childBuilders["pan;"];
            modifiedKeys["pan"] = true;
            return _this;
        };
        this.elevation = function (spec) {
            updates["elevation"] = spec;
            delete childBuilders["elevation;"];
            modifiedKeys["elevation"] = true;
            return _this;
        };
        this.midiBank = function (spec) {
            updates["midiBank"] = spec;
            delete childBuilders["midiBank;"];
            modifiedKeys["midiBank"] = true;
            return _this;
        };
        this.midiProgram = function (spec) {
            updates["midiProgram"] = spec;
            delete childBuilders["midiProgram;"];
            modifiedKeys["midiProgram"] = true;
            return _this;
        };
        this.id = function (spec) {
            updates["id"] = spec;
            delete childBuilders["id;"];
            modifiedKeys["id"] = true;
            return _this;
        };
        this.midiChannel = function (spec) {
            updates["midiChannel"] = spec;
            delete childBuilders["midiChannel;"];
            modifiedKeys["midiChannel"] = true;
            return _this;
        };
        this.midiName = function (spec) {
            updates["midiName"] = spec;
            delete childBuilders["midiName;"];
            modifiedKeys["midiName"] = true;
            return _this;
        };
    }
    return MidiInstrumentBuilder;
}());
function patchMidiInstrument(base, builder) { return builder(new MidiInstrumentBuilder(base)).patch(); }
exports.patchMidiInstrument = patchMidiInstrument;
function buildMidiInstrument(builder) { return builder(new MidiInstrumentBuilder()).build(); }
exports.buildMidiInstrument = buildMidiInstrument;
var PlayBuilder = (function () {
    function PlayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["id"]) ||
                childBuilders["id"] !== undefined ||
                updates.id !== undefined, "id is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Play";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.ipa = function (spec) {
            updates["ipa"] = spec;
            delete childBuilders["ipa;"];
            modifiedKeys["ipa"] = true;
            return _this;
        };
        this.mute = function (spec) {
            updates["mute"] = spec;
            delete childBuilders["mute;"];
            modifiedKeys["mute"] = true;
            return _this;
        };
        this.otherPlay = function (build) {
            if (typeof build === 'function') {
                delete updates["otherPlay"];
                var builder = build(new OtherPlayBuilder(original && original["otherPlay"]));
                if (!original)
                    updates["otherPlay"] = builder.build();
                else
                    childBuilders["otherPlay"] = builder;
            }
            else {
                updates.otherPlay = build;
                delete childBuilders["otherPlay;"];
            }
            modifiedKeys["otherPlay"] = true;
            return _this;
        };
        this.semiPitched = function (spec) {
            updates["semiPitched"] = spec;
            delete childBuilders["semiPitched;"];
            modifiedKeys["semiPitched"] = true;
            return _this;
        };
        this.id = function (spec) {
            updates["id"] = spec;
            delete childBuilders["id;"];
            modifiedKeys["id"] = true;
            return _this;
        };
    }
    return PlayBuilder;
}());
function patchPlay(base, builder) { return builder(new PlayBuilder(base)).patch(); }
exports.patchPlay = patchPlay;
function buildPlay(builder) { return builder(new PlayBuilder()).build(); }
exports.buildPlay = buildPlay;
var OtherPlayBuilder = (function () {
    function OtherPlayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OtherPlay";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return OtherPlayBuilder;
}());
function patchOtherPlay(base, builder) { return builder(new OtherPlayBuilder(base)).patch(); }
exports.patchOtherPlay = patchOtherPlay;
function buildOtherPlay(builder) { return builder(new OtherPlayBuilder()).build(); }
exports.buildOtherPlay = buildOtherPlay;
var ScalingBuilder = (function () {
    function ScalingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Scaling";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tenths = function (spec) {
            updates["tenths"] = spec;
            delete childBuilders["tenths;"];
            modifiedKeys["tenths"] = true;
            return _this;
        };
        this.millimeters = function (spec) {
            updates["millimeters"] = spec;
            delete childBuilders["millimeters;"];
            modifiedKeys["millimeters"] = true;
            return _this;
        };
    }
    return ScalingBuilder;
}());
function patchScaling(base, builder) { return builder(new ScalingBuilder(base)).patch(); }
exports.patchScaling = patchScaling;
function buildScaling(builder) { return builder(new ScalingBuilder()).build(); }
exports.buildScaling = buildScaling;
var PageMarginsBuilder = (function () {
    function PageMarginsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["topMargin"]) ||
                childBuilders["topMargin"] !== undefined ||
                updates.topMargin !== undefined, "topMargin is a required field");
            console.assert((original && !modifiedKeys["leftMargin"]) ||
                childBuilders["leftMargin"] !== undefined ||
                updates.leftMargin !== undefined, "leftMargin is a required field");
            console.assert((original && !modifiedKeys["bottomMargin"]) ||
                childBuilders["bottomMargin"] !== undefined ||
                updates.bottomMargin !== undefined, "bottomMargin is a required field");
            console.assert((original && !modifiedKeys["rightMargin"]) ||
                childBuilders["rightMargin"] !== undefined ||
                updates.rightMargin !== undefined, "rightMargin is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PageMargins";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.topMargin = function (spec) {
            updates["topMargin"] = spec;
            delete childBuilders["topMargin;"];
            modifiedKeys["topMargin"] = true;
            return _this;
        };
        this.leftMargin = function (spec) {
            updates["leftMargin"] = spec;
            delete childBuilders["leftMargin;"];
            modifiedKeys["leftMargin"] = true;
            return _this;
        };
        this.bottomMargin = function (spec) {
            updates["bottomMargin"] = spec;
            delete childBuilders["bottomMargin;"];
            modifiedKeys["bottomMargin"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.rightMargin = function (spec) {
            updates["rightMargin"] = spec;
            delete childBuilders["rightMargin;"];
            modifiedKeys["rightMargin"] = true;
            return _this;
        };
    }
    return PageMarginsBuilder;
}());
function patchPageMargins(base, builder) { return builder(new PageMarginsBuilder(base)).patch(); }
exports.patchPageMargins = patchPageMargins;
function buildPageMargins(builder) { return builder(new PageMarginsBuilder()).build(); }
exports.buildPageMargins = buildPageMargins;
var PageLayoutBuilder = (function () {
    function PageLayoutBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PageLayout";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.pageHeight = function (spec) {
            updates["pageHeight"] = spec;
            delete childBuilders["pageHeight;"];
            modifiedKeys["pageHeight"] = true;
            return _this;
        };
        this.pageWidth = function (spec) {
            updates["pageWidth"] = spec;
            delete childBuilders["pageWidth;"];
            modifiedKeys["pageWidth"] = true;
            return _this;
        };
        this.pageMargins = function (spec) {
            updates["pageMargins"] = spec;
            delete childBuilders["pageMargins;"];
            modifiedKeys["pageMargins"] = true;
            return _this;
        };
        this.pageMarginsAt = function (idx, build) {
            makeReference("pageMargins");
            if (frozen["pageMargins"][idx]) {
                throw new Error("Patching pageMargins." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["pageMargins"] && !original["pageMargins"]) {
                // Clone snapshot.
                patches.push({ p: ["pageMargins", idx], li: original._snapshot["pageMargins"] });
            }
            if (typeof build === 'function' && reference["pageMargins"][idx]) {
                var patch = build(new PageMarginsBuilder(reference["pageMargins"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["pageMargins", idx].concat(patch.p);
                    return patch;
                }));
                frozen["pageMargins"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new PageMarginsBuilder(reference["pageMargins"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["pageMargins", idx], li: update });
            }
            else {
                updates["pageMargins"] = reference["pageMargins"]; // TODO: Merge?
            }
            reference["pageMargins"][idx] = update;
            frozen["pageMargins"][idx] = true;
            return _this;
        };
        this.pageMarginsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("pageMargins");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["pageMargins"][idx]) {
                        throw new Error("Replacing pageMargins." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["pageMargins"][idx];
                    patches.push({ p: ["pageMargins", idx], ld: ld, li: items[idx - start] });
                    frozen["pageMargins"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["pageMargins"][idx]) {
                        throw new Error("Removing pageMargins." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["pageMargins"][idx];
                    patches.push({ p: ["pageMargins", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["pageMargins", idx], li: items[idx - start] });
                    frozen["pageMargins"][idx] = true;
                }
            }
            (_a = reference["pageMargins"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["pageMargins"] = reference["pageMargins"];
            (_b = frozen["pageMargins"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return PageLayoutBuilder;
}());
function patchPageLayout(base, builder) { return builder(new PageLayoutBuilder(base)).patch(); }
exports.patchPageLayout = patchPageLayout;
function buildPageLayout(builder) { return builder(new PageLayoutBuilder()).build(); }
exports.buildPageLayout = buildPageLayout;
var SystemLayoutBuilder = (function () {
    function SystemLayoutBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "SystemLayout";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.systemDividers = function (build) {
            if (typeof build === 'function') {
                delete updates["systemDividers"];
                var builder = build(new SystemDividersBuilder(original && original["systemDividers"]));
                if (!original)
                    updates["systemDividers"] = builder.build();
                else
                    childBuilders["systemDividers"] = builder;
            }
            else {
                updates.systemDividers = build;
                delete childBuilders["systemDividers;"];
            }
            modifiedKeys["systemDividers"] = true;
            return _this;
        };
        this.systemMargins = function (build) {
            if (typeof build === 'function') {
                delete updates["systemMargins"];
                var builder = build(new SystemMarginsBuilder(original && original["systemMargins"]));
                if (!original)
                    updates["systemMargins"] = builder.build();
                else
                    childBuilders["systemMargins"] = builder;
            }
            else {
                updates.systemMargins = build;
                delete childBuilders["systemMargins;"];
            }
            modifiedKeys["systemMargins"] = true;
            return _this;
        };
        this.systemDistance = function (spec) {
            updates["systemDistance"] = spec;
            delete childBuilders["systemDistance;"];
            modifiedKeys["systemDistance"] = true;
            return _this;
        };
        this.topSystemDistance = function (spec) {
            updates["topSystemDistance"] = spec;
            delete childBuilders["topSystemDistance;"];
            modifiedKeys["topSystemDistance"] = true;
            return _this;
        };
    }
    return SystemLayoutBuilder;
}());
function patchSystemLayout(base, builder) { return builder(new SystemLayoutBuilder(base)).patch(); }
exports.patchSystemLayout = patchSystemLayout;
function buildSystemLayout(builder) { return builder(new SystemLayoutBuilder()).build(); }
exports.buildSystemLayout = buildSystemLayout;
var SystemMarginsBuilder = (function () {
    function SystemMarginsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["leftMargin"]) ||
                childBuilders["leftMargin"] !== undefined ||
                updates.leftMargin !== undefined, "leftMargin is a required field");
            console.assert((original && !modifiedKeys["rightMargin"]) ||
                childBuilders["rightMargin"] !== undefined ||
                updates.rightMargin !== undefined, "rightMargin is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "SystemMargins";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.leftMargin = function (spec) {
            updates["leftMargin"] = spec;
            delete childBuilders["leftMargin;"];
            modifiedKeys["leftMargin"] = true;
            return _this;
        };
        this.rightMargin = function (spec) {
            updates["rightMargin"] = spec;
            delete childBuilders["rightMargin;"];
            modifiedKeys["rightMargin"] = true;
            return _this;
        };
    }
    return SystemMarginsBuilder;
}());
function patchSystemMargins(base, builder) { return builder(new SystemMarginsBuilder(base)).patch(); }
exports.patchSystemMargins = patchSystemMargins;
function buildSystemMargins(builder) { return builder(new SystemMarginsBuilder()).build(); }
exports.buildSystemMargins = buildSystemMargins;
var SystemDividersBuilder = (function () {
    function SystemDividersBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["rightDivider"]) ||
                childBuilders["rightDivider"] !== undefined ||
                updates.rightDivider !== undefined, "rightDivider is a required field");
            console.assert((original && !modifiedKeys["leftDivider"]) ||
                childBuilders["leftDivider"] !== undefined ||
                updates.leftDivider !== undefined, "leftDivider is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "SystemDividers";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.rightDivider = function (build) {
            if (typeof build === 'function') {
                delete updates["rightDivider"];
                var builder = build(new RightDividerBuilder(original && original["rightDivider"]));
                if (!original)
                    updates["rightDivider"] = builder.build();
                else
                    childBuilders["rightDivider"] = builder;
            }
            else {
                updates.rightDivider = build;
                delete childBuilders["rightDivider;"];
            }
            modifiedKeys["rightDivider"] = true;
            return _this;
        };
        this.leftDivider = function (build) {
            if (typeof build === 'function') {
                delete updates["leftDivider"];
                var builder = build(new LeftDividerBuilder(original && original["leftDivider"]));
                if (!original)
                    updates["leftDivider"] = builder.build();
                else
                    childBuilders["leftDivider"] = builder;
            }
            else {
                updates.leftDivider = build;
                delete childBuilders["leftDivider;"];
            }
            modifiedKeys["leftDivider"] = true;
            return _this;
        };
    }
    return SystemDividersBuilder;
}());
function patchSystemDividers(base, builder) { return builder(new SystemDividersBuilder(base)).patch(); }
exports.patchSystemDividers = patchSystemDividers;
function buildSystemDividers(builder) { return builder(new SystemDividersBuilder()).build(); }
exports.buildSystemDividers = buildSystemDividers;
var LeftDividerBuilder = (function () {
    function LeftDividerBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LeftDivider";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return LeftDividerBuilder;
}());
function patchLeftDivider(base, builder) { return builder(new LeftDividerBuilder(base)).patch(); }
exports.patchLeftDivider = patchLeftDivider;
function buildLeftDivider(builder) { return builder(new LeftDividerBuilder()).build(); }
exports.buildLeftDivider = buildLeftDivider;
var RightDividerBuilder = (function () {
    function RightDividerBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "RightDivider";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return RightDividerBuilder;
}());
function patchRightDivider(base, builder) { return builder(new RightDividerBuilder(base)).patch(); }
exports.patchRightDivider = patchRightDivider;
function buildRightDivider(builder) { return builder(new RightDividerBuilder()).build(); }
exports.buildRightDivider = buildRightDivider;
var StaffLayoutBuilder = (function () {
    function StaffLayoutBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["num"]) ||
                childBuilders["num"] !== undefined ||
                updates.num !== undefined, "num is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "StaffLayout";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.staffDistance = function (spec) {
            updates["staffDistance"] = spec;
            delete childBuilders["staffDistance;"];
            modifiedKeys["staffDistance"] = true;
            return _this;
        };
        this.num = function (spec) {
            updates["num"] = spec;
            delete childBuilders["num;"];
            modifiedKeys["num"] = true;
            return _this;
        };
    }
    return StaffLayoutBuilder;
}());
function patchStaffLayout(base, builder) { return builder(new StaffLayoutBuilder(base)).patch(); }
exports.patchStaffLayout = patchStaffLayout;
function buildStaffLayout(builder) { return builder(new StaffLayoutBuilder()).build(); }
exports.buildStaffLayout = buildStaffLayout;
var MeasureLayoutBuilder = (function () {
    function MeasureLayoutBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MeasureLayout";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.measureDistance = function (spec) {
            updates["measureDistance"] = spec;
            delete childBuilders["measureDistance;"];
            modifiedKeys["measureDistance"] = true;
            return _this;
        };
    }
    return MeasureLayoutBuilder;
}());
function patchMeasureLayout(base, builder) { return builder(new MeasureLayoutBuilder(base)).patch(); }
exports.patchMeasureLayout = patchMeasureLayout;
function buildMeasureLayout(builder) { return builder(new MeasureLayoutBuilder()).build(); }
exports.buildMeasureLayout = buildMeasureLayout;
var LineWidthBuilder = (function () {
    function LineWidthBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["tenths"]) ||
                childBuilders["tenths"] !== undefined ||
                updates.tenths !== undefined, "tenths is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LineWidth";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tenths = function (spec) {
            updates["tenths"] = spec;
            delete childBuilders["tenths;"];
            modifiedKeys["tenths"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return LineWidthBuilder;
}());
function patchLineWidth(base, builder) { return builder(new LineWidthBuilder(base)).patch(); }
exports.patchLineWidth = patchLineWidth;
function buildLineWidth(builder) { return builder(new LineWidthBuilder()).build(); }
exports.buildLineWidth = buildLineWidth;
var NoteSizeBuilder = (function () {
    function NoteSizeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["size"]) ||
                childBuilders["size"] !== undefined ||
                updates.size !== undefined, "size is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "NoteSize";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return NoteSizeBuilder;
}());
function patchNoteSize(base, builder) { return builder(new NoteSizeBuilder(base)).patch(); }
exports.patchNoteSize = patchNoteSize;
function buildNoteSize(builder) { return builder(new NoteSizeBuilder()).build(); }
exports.buildNoteSize = buildNoteSize;
var DistanceBuilder = (function () {
    function DistanceBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["tenths"]) ||
                childBuilders["tenths"] !== undefined ||
                updates.tenths !== undefined, "tenths is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Distance";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tenths = function (spec) {
            updates["tenths"] = spec;
            delete childBuilders["tenths;"];
            modifiedKeys["tenths"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return DistanceBuilder;
}());
function patchDistance(base, builder) { return builder(new DistanceBuilder(base)).patch(); }
exports.patchDistance = patchDistance;
function buildDistance(builder) { return builder(new DistanceBuilder()).build(); }
exports.buildDistance = buildDistance;
var AppearanceBuilder = (function () {
    function AppearanceBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Appearance";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.set = function (key, val) {
            updates[key] = val;
            modifiedKeys[key] = true;
            return _this;
        };
        this.otherAppearances = function (spec) {
            updates["otherAppearances"] = spec;
            delete childBuilders["otherAppearances;"];
            modifiedKeys["otherAppearances"] = true;
            return _this;
        };
    }
    return AppearanceBuilder;
}());
function patchAppearance(base, builder) { return builder(new AppearanceBuilder(base)).patch(); }
exports.patchAppearance = patchAppearance;
function buildAppearance(builder) { return builder(new AppearanceBuilder()).build(); }
exports.buildAppearance = buildAppearance;
var CreatorBuilder = (function () {
    function CreatorBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["creator"]) ||
                childBuilders["creator"] !== undefined ||
                updates.creator !== undefined, "creator is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Creator";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.creator = function (spec) {
            updates["creator"] = spec;
            delete childBuilders["creator;"];
            modifiedKeys["creator"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return CreatorBuilder;
}());
function patchCreator(base, builder) { return builder(new CreatorBuilder(base)).patch(); }
exports.patchCreator = patchCreator;
function buildCreator(builder) { return builder(new CreatorBuilder()).build(); }
exports.buildCreator = buildCreator;
var RightsBuilder = (function () {
    function RightsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["rights"]) ||
                childBuilders["rights"] !== undefined ||
                updates.rights !== undefined, "rights is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Rights";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.rights = function (spec) {
            updates["rights"] = spec;
            delete childBuilders["rights;"];
            modifiedKeys["rights"] = true;
            return _this;
        };
    }
    return RightsBuilder;
}());
function patchRights(base, builder) { return builder(new RightsBuilder(base)).patch(); }
exports.patchRights = patchRights;
function buildRights(builder) { return builder(new RightsBuilder()).build(); }
exports.buildRights = buildRights;
var EncoderBuilder = (function () {
    function EncoderBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["encoder"]) ||
                childBuilders["encoder"] !== undefined ||
                updates.encoder !== undefined, "encoder is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Encoder";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.encoder = function (spec) {
            updates["encoder"] = spec;
            delete childBuilders["encoder;"];
            modifiedKeys["encoder"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return EncoderBuilder;
}());
function patchEncoder(base, builder) { return builder(new EncoderBuilder(base)).patch(); }
exports.patchEncoder = patchEncoder;
function buildEncoder(builder) { return builder(new EncoderBuilder()).build(); }
exports.buildEncoder = buildEncoder;
var RelationBuilder = (function () {
    function RelationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Relation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
    }
    return RelationBuilder;
}());
function patchRelation(base, builder) { return builder(new RelationBuilder(base)).patch(); }
exports.patchRelation = patchRelation;
function buildRelation(builder) { return builder(new RelationBuilder()).build(); }
exports.buildRelation = buildRelation;
var MiscellaneousFieldBuilder = (function () {
    function MiscellaneousFieldBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MiscellaneousField";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
    }
    return MiscellaneousFieldBuilder;
}());
function patchMiscellaneousField(base, builder) { return builder(new MiscellaneousFieldBuilder(base)).patch(); }
exports.patchMiscellaneousField = patchMiscellaneousField;
function buildMiscellaneousField(builder) { return builder(new MiscellaneousFieldBuilder()).build(); }
exports.buildMiscellaneousField = buildMiscellaneousField;
var MiscellaneousBuilder = (function () {
    function MiscellaneousBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Miscellaneous";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.miscellaneousFields = function (spec) {
            updates["miscellaneousFields"] = spec;
            delete childBuilders["miscellaneousFields;"];
            modifiedKeys["miscellaneousFields"] = true;
            return _this;
        };
        this.miscellaneousFieldsAt = function (idx, build) {
            makeReference("miscellaneousFields");
            if (frozen["miscellaneousFields"][idx]) {
                throw new Error("Patching miscellaneousFields." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["miscellaneousFields"] && !original["miscellaneousFields"]) {
                // Clone snapshot.
                patches.push({ p: ["miscellaneousFields", idx], li: original._snapshot["miscellaneousFields"] });
            }
            if (typeof build === 'function' && reference["miscellaneousFields"][idx]) {
                var patch = build(new MiscellaneousFieldBuilder(reference["miscellaneousFields"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["miscellaneousFields", idx].concat(patch.p);
                    return patch;
                }));
                frozen["miscellaneousFields"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MiscellaneousFieldBuilder(reference["miscellaneousFields"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["miscellaneousFields", idx], li: update });
            }
            else {
                updates["miscellaneousFields"] = reference["miscellaneousFields"]; // TODO: Merge?
            }
            reference["miscellaneousFields"][idx] = update;
            frozen["miscellaneousFields"][idx] = true;
            return _this;
        };
        this.miscellaneousFieldsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("miscellaneousFields");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["miscellaneousFields"][idx]) {
                        throw new Error("Replacing miscellaneousFields." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["miscellaneousFields"][idx];
                    patches.push({ p: ["miscellaneousFields", idx], ld: ld, li: items[idx - start] });
                    frozen["miscellaneousFields"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["miscellaneousFields"][idx]) {
                        throw new Error("Removing miscellaneousFields." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["miscellaneousFields"][idx];
                    patches.push({ p: ["miscellaneousFields", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["miscellaneousFields", idx], li: items[idx - start] });
                    frozen["miscellaneousFields"][idx] = true;
                }
            }
            (_a = reference["miscellaneousFields"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["miscellaneousFields"] = reference["miscellaneousFields"];
            (_b = frozen["miscellaneousFields"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return MiscellaneousBuilder;
}());
function patchMiscellaneous(base, builder) { return builder(new MiscellaneousBuilder(base)).patch(); }
exports.patchMiscellaneous = patchMiscellaneous;
function buildMiscellaneous(builder) { return builder(new MiscellaneousBuilder()).build(); }
exports.buildMiscellaneous = buildMiscellaneous;
var IdentificationBuilder = (function () {
    function IdentificationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Identification";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.miscellaneous = function (build) {
            if (typeof build === 'function') {
                delete updates["miscellaneous"];
                var builder = build(new MiscellaneousBuilder(original && original["miscellaneous"]));
                if (!original)
                    updates["miscellaneous"] = builder.build();
                else
                    childBuilders["miscellaneous"] = builder;
            }
            else {
                updates.miscellaneous = build;
                delete childBuilders["miscellaneous;"];
            }
            modifiedKeys["miscellaneous"] = true;
            return _this;
        };
        this.creators = function (spec) {
            updates["creators"] = spec;
            delete childBuilders["creators;"];
            modifiedKeys["creators"] = true;
            return _this;
        };
        this.creatorsAt = function (idx, build) {
            makeReference("creators");
            if (frozen["creators"][idx]) {
                throw new Error("Patching creators." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["creators"] && !original["creators"]) {
                // Clone snapshot.
                patches.push({ p: ["creators", idx], li: original._snapshot["creators"] });
            }
            if (typeof build === 'function' && reference["creators"][idx]) {
                var patch = build(new CreatorBuilder(reference["creators"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["creators", idx].concat(patch.p);
                    return patch;
                }));
                frozen["creators"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new CreatorBuilder(reference["creators"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["creators", idx], li: update });
            }
            else {
                updates["creators"] = reference["creators"]; // TODO: Merge?
            }
            reference["creators"][idx] = update;
            frozen["creators"][idx] = true;
            return _this;
        };
        this.creatorsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("creators");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["creators"][idx]) {
                        throw new Error("Replacing creators." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["creators"][idx];
                    patches.push({ p: ["creators", idx], ld: ld, li: items[idx - start] });
                    frozen["creators"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["creators"][idx]) {
                        throw new Error("Removing creators." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["creators"][idx];
                    patches.push({ p: ["creators", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["creators", idx], li: items[idx - start] });
                    frozen["creators"][idx] = true;
                }
            }
            (_a = reference["creators"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["creators"] = reference["creators"];
            (_b = frozen["creators"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.relations = function (spec) {
            updates["relations"] = spec;
            delete childBuilders["relations;"];
            modifiedKeys["relations"] = true;
            return _this;
        };
        this.relationsAt = function (idx, build) {
            makeReference("relations");
            if (frozen["relations"][idx]) {
                throw new Error("Patching relations." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["relations"] && !original["relations"]) {
                // Clone snapshot.
                patches.push({ p: ["relations", idx], li: original._snapshot["relations"] });
            }
            if (typeof build === 'function' && reference["relations"][idx]) {
                var patch = build(new RelationBuilder(reference["relations"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["relations", idx].concat(patch.p);
                    return patch;
                }));
                frozen["relations"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new RelationBuilder(reference["relations"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["relations", idx], li: update });
            }
            else {
                updates["relations"] = reference["relations"]; // TODO: Merge?
            }
            reference["relations"][idx] = update;
            frozen["relations"][idx] = true;
            return _this;
        };
        this.relationsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("relations");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["relations"][idx]) {
                        throw new Error("Replacing relations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["relations"][idx];
                    patches.push({ p: ["relations", idx], ld: ld, li: items[idx - start] });
                    frozen["relations"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["relations"][idx]) {
                        throw new Error("Removing relations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["relations"][idx];
                    patches.push({ p: ["relations", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["relations", idx], li: items[idx - start] });
                    frozen["relations"][idx] = true;
                }
            }
            (_a = reference["relations"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["relations"] = reference["relations"];
            (_b = frozen["relations"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.rights = function (spec) {
            updates["rights"] = spec;
            delete childBuilders["rights;"];
            modifiedKeys["rights"] = true;
            return _this;
        };
        this.rightsAt = function (idx, build) {
            makeReference("rights");
            if (frozen["rights"][idx]) {
                throw new Error("Patching rights." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["rights"] && !original["rights"]) {
                // Clone snapshot.
                patches.push({ p: ["rights", idx], li: original._snapshot["rights"] });
            }
            if (typeof build === 'function' && reference["rights"][idx]) {
                var patch = build(new RightsBuilder(reference["rights"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["rights", idx].concat(patch.p);
                    return patch;
                }));
                frozen["rights"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new RightsBuilder(reference["rights"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["rights", idx], li: update });
            }
            else {
                updates["rights"] = reference["rights"]; // TODO: Merge?
            }
            reference["rights"][idx] = update;
            frozen["rights"][idx] = true;
            return _this;
        };
        this.rightsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("rights");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["rights"][idx]) {
                        throw new Error("Replacing rights." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["rights"][idx];
                    patches.push({ p: ["rights", idx], ld: ld, li: items[idx - start] });
                    frozen["rights"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["rights"][idx]) {
                        throw new Error("Removing rights." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["rights"][idx];
                    patches.push({ p: ["rights", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["rights", idx], li: items[idx - start] });
                    frozen["rights"][idx] = true;
                }
            }
            (_a = reference["rights"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["rights"] = reference["rights"];
            (_b = frozen["rights"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.encoding = function (build) {
            if (typeof build === 'function') {
                delete updates["encoding"];
                var builder = build(new EncodingBuilder(original && original["encoding"]));
                if (!original)
                    updates["encoding"] = builder.build();
                else
                    childBuilders["encoding"] = builder;
            }
            else {
                updates.encoding = build;
                delete childBuilders["encoding;"];
            }
            modifiedKeys["encoding"] = true;
            return _this;
        };
        this.source = function (spec) {
            updates["source"] = spec;
            delete childBuilders["source;"];
            modifiedKeys["source"] = true;
            return _this;
        };
    }
    return IdentificationBuilder;
}());
function patchIdentification(base, builder) { return builder(new IdentificationBuilder(base)).patch(); }
exports.patchIdentification = patchIdentification;
function buildIdentification(builder) { return builder(new IdentificationBuilder()).build(); }
exports.buildIdentification = buildIdentification;
var SupportsBuilder = (function () {
    function SupportsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["element"]) ||
                childBuilders["element"] !== undefined ||
                updates.element !== undefined, "element is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Supports";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.element = function (spec) {
            updates["element"] = spec;
            delete childBuilders["element;"];
            modifiedKeys["element"] = true;
            return _this;
        };
        this.attribute = function (spec) {
            updates["attribute"] = spec;
            delete childBuilders["attribute;"];
            modifiedKeys["attribute"] = true;
            return _this;
        };
        this.value = function (spec) {
            updates["value"] = spec;
            delete childBuilders["value;"];
            modifiedKeys["value"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return SupportsBuilder;
}());
function patchSupports(base, builder) { return builder(new SupportsBuilder(base)).patch(); }
exports.patchSupports = patchSupports;
function buildSupports(builder) { return builder(new SupportsBuilder()).build(); }
exports.buildSupports = buildSupports;
var EncodingBuilder = (function () {
    function EncodingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Encoding";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.encodingDescriptions = function (spec) {
            updates["encodingDescriptions"] = spec;
            delete childBuilders["encodingDescriptions;"];
            modifiedKeys["encodingDescriptions"] = true;
            return _this;
        };
        this.encodingDate = function (build) {
            if (typeof build === 'function') {
                delete updates["encodingDate"];
                var builder = build(new EncodingDateBuilder(original && original["encodingDate"]));
                if (!original)
                    updates["encodingDate"] = builder.build();
                else
                    childBuilders["encodingDate"] = builder;
            }
            else {
                updates.encodingDate = build;
                delete childBuilders["encodingDate;"];
            }
            modifiedKeys["encodingDate"] = true;
            return _this;
        };
        this.set = function (key, val) {
            updates[key] = val;
            modifiedKeys[key] = true;
            return _this;
        };
        this.encoders = function (spec) {
            updates["encoders"] = spec;
            delete childBuilders["encoders;"];
            modifiedKeys["encoders"] = true;
            return _this;
        };
        this.encodersAt = function (idx, build) {
            makeReference("encoders");
            if (frozen["encoders"][idx]) {
                throw new Error("Patching encoders." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["encoders"] && !original["encoders"]) {
                // Clone snapshot.
                patches.push({ p: ["encoders", idx], li: original._snapshot["encoders"] });
            }
            if (typeof build === 'function' && reference["encoders"][idx]) {
                var patch = build(new EncoderBuilder(reference["encoders"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["encoders", idx].concat(patch.p);
                    return patch;
                }));
                frozen["encoders"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new EncoderBuilder(reference["encoders"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["encoders", idx], li: update });
            }
            else {
                updates["encoders"] = reference["encoders"]; // TODO: Merge?
            }
            reference["encoders"][idx] = update;
            frozen["encoders"][idx] = true;
            return _this;
        };
        this.encodersSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("encoders");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["encoders"][idx]) {
                        throw new Error("Replacing encoders." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["encoders"][idx];
                    patches.push({ p: ["encoders", idx], ld: ld, li: items[idx - start] });
                    frozen["encoders"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["encoders"][idx]) {
                        throw new Error("Removing encoders." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["encoders"][idx];
                    patches.push({ p: ["encoders", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["encoders", idx], li: items[idx - start] });
                    frozen["encoders"][idx] = true;
                }
            }
            (_a = reference["encoders"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["encoders"] = reference["encoders"];
            (_b = frozen["encoders"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.softwares = function (spec) {
            updates["softwares"] = spec;
            delete childBuilders["softwares;"];
            modifiedKeys["softwares"] = true;
            return _this;
        };
    }
    return EncodingBuilder;
}());
function patchEncoding(base, builder) { return builder(new EncodingBuilder(base)).patch(); }
exports.patchEncoding = patchEncoding;
function buildEncoding(builder) { return builder(new EncodingBuilder()).build(); }
exports.buildEncoding = buildEncoding;
var TimeSeparatorBuilder = (function () {
    function TimeSeparatorBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TimeSeparator";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.separator = function (spec) {
            updates["separator"] = spec;
            delete childBuilders["separator;"];
            modifiedKeys["separator"] = true;
            return _this;
        };
    }
    return TimeSeparatorBuilder;
}());
function patchTimeSeparator(base, builder) { return builder(new TimeSeparatorBuilder(base)).patch(); }
exports.patchTimeSeparator = patchTimeSeparator;
function buildTimeSeparator(builder) { return builder(new TimeSeparatorBuilder()).build(); }
exports.buildTimeSeparator = buildTimeSeparator;
var TimeSymbolBuilder = (function () {
    function TimeSymbolBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TimeSymbol";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.symbol = function (spec) {
            updates["symbol"] = spec;
            delete childBuilders["symbol;"];
            modifiedKeys["symbol"] = true;
            return _this;
        };
    }
    return TimeSymbolBuilder;
}());
function patchTimeSymbol(base, builder) { return builder(new TimeSymbolBuilder(base)).patch(); }
exports.patchTimeSymbol = patchTimeSymbol;
function buildTimeSymbol(builder) { return builder(new TimeSymbolBuilder()).build(); }
exports.buildTimeSymbol = buildTimeSymbol;
var CancelBuilder = (function () {
    function CancelBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["fifths"]) ||
                childBuilders["fifths"] !== undefined ||
                updates.fifths !== undefined, "fifths is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Cancel";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.fifths = function (spec) {
            updates["fifths"] = spec;
            delete childBuilders["fifths;"];
            modifiedKeys["fifths"] = true;
            return _this;
        };
        this.location = function (spec) {
            updates["location"] = spec;
            delete childBuilders["location;"];
            modifiedKeys["location"] = true;
            return _this;
        };
    }
    return CancelBuilder;
}());
function patchCancel(base, builder) { return builder(new CancelBuilder(base)).patch(); }
exports.patchCancel = patchCancel;
function buildCancel(builder) { return builder(new CancelBuilder()).build(); }
exports.buildCancel = buildCancel;
var KeyOctaveBuilder = (function () {
    function KeyOctaveBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["octave"]) ||
                childBuilders["octave"] !== undefined ||
                updates.octave !== undefined, "octave is a required field");
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "KeyOctave";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.octave = function (spec) {
            updates["octave"] = spec;
            delete childBuilders["octave;"];
            modifiedKeys["octave"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.cancel = function (spec) {
            updates["cancel"] = spec;
            delete childBuilders["cancel;"];
            modifiedKeys["cancel"] = true;
            return _this;
        };
    }
    return KeyOctaveBuilder;
}());
function patchKeyOctave(base, builder) { return builder(new KeyOctaveBuilder(base)).patch(); }
exports.patchKeyOctave = patchKeyOctave;
function buildKeyOctave(builder) { return builder(new KeyOctaveBuilder()).build(); }
exports.buildKeyOctave = buildKeyOctave;
var KeyBuilder = (function () {
    function KeyBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Key";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.cancel = function (build) {
            if (typeof build === 'function') {
                delete updates["cancel"];
                var builder = build(new CancelBuilder(original && original["cancel"]));
                if (!original)
                    updates["cancel"] = builder.build();
                else
                    childBuilders["cancel"] = builder;
            }
            else {
                updates.cancel = build;
                delete childBuilders["cancel;"];
            }
            modifiedKeys["cancel"] = true;
            return _this;
        };
        this.keySteps = function (spec) {
            updates["keySteps"] = spec;
            delete childBuilders["keySteps;"];
            modifiedKeys["keySteps"] = true;
            return _this;
        };
        this.keyOctaves = function (spec) {
            updates["keyOctaves"] = spec;
            delete childBuilders["keyOctaves;"];
            modifiedKeys["keyOctaves"] = true;
            return _this;
        };
        this.keyOctavesAt = function (idx, build) {
            makeReference("keyOctaves");
            if (frozen["keyOctaves"][idx]) {
                throw new Error("Patching keyOctaves." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["keyOctaves"] && !original["keyOctaves"]) {
                // Clone snapshot.
                patches.push({ p: ["keyOctaves", idx], li: original._snapshot["keyOctaves"] });
            }
            if (typeof build === 'function' && reference["keyOctaves"][idx]) {
                var patch = build(new KeyOctaveBuilder(reference["keyOctaves"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["keyOctaves", idx].concat(patch.p);
                    return patch;
                }));
                frozen["keyOctaves"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new KeyOctaveBuilder(reference["keyOctaves"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["keyOctaves", idx], li: update });
            }
            else {
                updates["keyOctaves"] = reference["keyOctaves"]; // TODO: Merge?
            }
            reference["keyOctaves"][idx] = update;
            frozen["keyOctaves"][idx] = true;
            return _this;
        };
        this.keyOctavesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("keyOctaves");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["keyOctaves"][idx]) {
                        throw new Error("Replacing keyOctaves." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["keyOctaves"][idx];
                    patches.push({ p: ["keyOctaves", idx], ld: ld, li: items[idx - start] });
                    frozen["keyOctaves"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["keyOctaves"][idx]) {
                        throw new Error("Removing keyOctaves." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["keyOctaves"][idx];
                    patches.push({ p: ["keyOctaves", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["keyOctaves", idx], li: items[idx - start] });
                    frozen["keyOctaves"][idx] = true;
                }
            }
            (_a = reference["keyOctaves"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["keyOctaves"] = reference["keyOctaves"];
            (_b = frozen["keyOctaves"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.fifths = function (spec) {
            updates["fifths"] = spec;
            delete childBuilders["fifths;"];
            modifiedKeys["fifths"] = true;
            return _this;
        };
        this.keyAlters = function (spec) {
            updates["keyAlters"] = spec;
            delete childBuilders["keyAlters;"];
            modifiedKeys["keyAlters"] = true;
            return _this;
        };
        this.keyAccidentals = function (spec) {
            updates["keyAccidentals"] = spec;
            delete childBuilders["keyAccidentals;"];
            modifiedKeys["keyAccidentals"] = true;
            return _this;
        };
        this.mode = function (spec) {
            updates["mode"] = spec;
            delete childBuilders["mode;"];
            modifiedKeys["mode"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return KeyBuilder;
}());
function patchKey(base, builder) { return builder(new KeyBuilder(base)).patch(); }
exports.patchKey = patchKey;
function buildKey(builder) { return builder(new KeyBuilder()).build(); }
exports.buildKey = buildKey;
var TimeBuilder = (function () {
    function TimeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["beats"]) ||
                childBuilders["beats"] !== undefined ||
                updates.beats !== undefined, "beats is a required field");
            console.assert((original && !modifiedKeys["beatTypes"]) ||
                childBuilders["beatTypes"] !== undefined ||
                updates.beatTypes !== undefined, "beatTypes is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Time";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.interchangeable = function (build) {
            if (typeof build === 'function') {
                delete updates["interchangeable"];
                var builder = build(new InterchangeableBuilder(original && original["interchangeable"]));
                if (!original)
                    updates["interchangeable"] = builder.build();
                else
                    childBuilders["interchangeable"] = builder;
            }
            else {
                updates.interchangeable = build;
                delete childBuilders["interchangeable;"];
            }
            modifiedKeys["interchangeable"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.beatTypes = function (spec) {
            updates["beatTypes"] = spec;
            delete childBuilders["beatTypes;"];
            modifiedKeys["beatTypes"] = true;
            return _this;
        };
        this.senzaMisura = function (spec) {
            updates["senzaMisura"] = spec;
            delete childBuilders["senzaMisura;"];
            modifiedKeys["senzaMisura"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.symbol = function (spec) {
            updates["symbol"] = spec;
            delete childBuilders["symbol;"];
            modifiedKeys["symbol"] = true;
            return _this;
        };
        this.separator = function (spec) {
            updates["separator"] = spec;
            delete childBuilders["separator;"];
            modifiedKeys["separator"] = true;
            return _this;
        };
    }
    return TimeBuilder;
}());
function patchTime(base, builder) { return builder(new TimeBuilder(base)).patch(); }
exports.patchTime = patchTime;
function buildTime(builder) { return builder(new TimeBuilder()).build(); }
exports.buildTime = buildTime;
var InterchangeableBuilder = (function () {
    function InterchangeableBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["beats"]) ||
                childBuilders["beats"] !== undefined ||
                updates.beats !== undefined, "beats is a required field");
            console.assert((original && !modifiedKeys["beatTypes"]) ||
                childBuilders["beatTypes"] !== undefined ||
                updates.beatTypes !== undefined, "beatTypes is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Interchangeable";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.beatTypes = function (spec) {
            updates["beatTypes"] = spec;
            delete childBuilders["beatTypes;"];
            modifiedKeys["beatTypes"] = true;
            return _this;
        };
        this.timeRelation = function (spec) {
            updates["timeRelation"] = spec;
            delete childBuilders["timeRelation;"];
            modifiedKeys["timeRelation"] = true;
            return _this;
        };
        this.symbol = function (spec) {
            updates["symbol"] = spec;
            delete childBuilders["symbol;"];
            modifiedKeys["symbol"] = true;
            return _this;
        };
        this.separator = function (spec) {
            updates["separator"] = spec;
            delete childBuilders["separator;"];
            modifiedKeys["separator"] = true;
            return _this;
        };
    }
    return InterchangeableBuilder;
}());
function patchInterchangeable(base, builder) { return builder(new InterchangeableBuilder(base)).patch(); }
exports.patchInterchangeable = patchInterchangeable;
function buildInterchangeable(builder) { return builder(new InterchangeableBuilder()).build(); }
exports.buildInterchangeable = buildInterchangeable;
var PartSymbolBuilder = (function () {
    function PartSymbolBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PartSymbol";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.topStaff = function (spec) {
            updates["topStaff"] = spec;
            delete childBuilders["topStaff;"];
            modifiedKeys["topStaff"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.bottomStaff = function (spec) {
            updates["bottomStaff"] = spec;
            delete childBuilders["bottomStaff;"];
            modifiedKeys["bottomStaff"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return PartSymbolBuilder;
}());
function patchPartSymbol(base, builder) { return builder(new PartSymbolBuilder(base)).patch(); }
exports.patchPartSymbol = patchPartSymbol;
function buildPartSymbol(builder) { return builder(new PartSymbolBuilder()).build(); }
exports.buildPartSymbol = buildPartSymbol;
var ClefBuilder = (function () {
    function ClefBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["sign"]) ||
                childBuilders["sign"] !== undefined ||
                updates.sign !== undefined, "sign is a required field");
            console.assert((original && !modifiedKeys["line"]) ||
                childBuilders["line"] !== undefined ||
                updates.line !== undefined, "line is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Clef";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.clefOctaveChange = function (spec) {
            updates["clefOctaveChange"] = spec;
            delete childBuilders["clefOctaveChange;"];
            modifiedKeys["clefOctaveChange"] = true;
            return _this;
        };
        this.sign = function (spec) {
            updates["sign"] = spec;
            delete childBuilders["sign;"];
            modifiedKeys["sign"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
        this.line = function (spec) {
            updates["line"] = spec;
            delete childBuilders["line;"];
            modifiedKeys["line"] = true;
            return _this;
        };
        this.afterBarline = function (spec) {
            updates["afterBarline"] = spec;
            delete childBuilders["afterBarline;"];
            modifiedKeys["afterBarline"] = true;
            return _this;
        };
        this.additional = function (spec) {
            updates["additional"] = spec;
            delete childBuilders["additional;"];
            modifiedKeys["additional"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return ClefBuilder;
}());
function patchClef(base, builder) { return builder(new ClefBuilder(base)).patch(); }
exports.patchClef = patchClef;
function buildClef(builder) { return builder(new ClefBuilder()).build(); }
exports.buildClef = buildClef;
var StaffTuningBuilder = (function () {
    function StaffTuningBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["line"]) ||
                childBuilders["line"] !== undefined ||
                updates.line !== undefined, "line is a required field");
            console.assert((original && !modifiedKeys["tuningStep"]) ||
                childBuilders["tuningStep"] !== undefined ||
                updates.tuningStep !== undefined, "tuningStep is a required field");
            console.assert((original && !modifiedKeys["tuningOctave"]) ||
                childBuilders["tuningOctave"] !== undefined ||
                updates.tuningOctave !== undefined, "tuningOctave is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "StaffTuning";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tuningAlter = function (spec) {
            updates["tuningAlter"] = spec;
            delete childBuilders["tuningAlter;"];
            modifiedKeys["tuningAlter"] = true;
            return _this;
        };
        this.line = function (spec) {
            updates["line"] = spec;
            delete childBuilders["line;"];
            modifiedKeys["line"] = true;
            return _this;
        };
        this.tuningStep = function (spec) {
            updates["tuningStep"] = spec;
            delete childBuilders["tuningStep;"];
            modifiedKeys["tuningStep"] = true;
            return _this;
        };
        this.tuningOctave = function (spec) {
            updates["tuningOctave"] = spec;
            delete childBuilders["tuningOctave;"];
            modifiedKeys["tuningOctave"] = true;
            return _this;
        };
    }
    return StaffTuningBuilder;
}());
function patchStaffTuning(base, builder) { return builder(new StaffTuningBuilder(base)).patch(); }
exports.patchStaffTuning = patchStaffTuning;
function buildStaffTuning(builder) { return builder(new StaffTuningBuilder()).build(); }
exports.buildStaffTuning = buildStaffTuning;
var StaffDetailsBuilder = (function () {
    function StaffDetailsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "StaffDetails";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.staffLines = function (spec) {
            updates["staffLines"] = spec;
            delete childBuilders["staffLines;"];
            modifiedKeys["staffLines"] = true;
            return _this;
        };
        this.staffTunings = function (spec) {
            updates["staffTunings"] = spec;
            delete childBuilders["staffTunings;"];
            modifiedKeys["staffTunings"] = true;
            return _this;
        };
        this.staffTuningsAt = function (idx, build) {
            makeReference("staffTunings");
            if (frozen["staffTunings"][idx]) {
                throw new Error("Patching staffTunings." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["staffTunings"] && !original["staffTunings"]) {
                // Clone snapshot.
                patches.push({ p: ["staffTunings", idx], li: original._snapshot["staffTunings"] });
            }
            if (typeof build === 'function' && reference["staffTunings"][idx]) {
                var patch = build(new StaffTuningBuilder(reference["staffTunings"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["staffTunings", idx].concat(patch.p);
                    return patch;
                }));
                frozen["staffTunings"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new StaffTuningBuilder(reference["staffTunings"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["staffTunings", idx], li: update });
            }
            else {
                updates["staffTunings"] = reference["staffTunings"]; // TODO: Merge?
            }
            reference["staffTunings"][idx] = update;
            frozen["staffTunings"][idx] = true;
            return _this;
        };
        this.staffTuningsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("staffTunings");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["staffTunings"][idx]) {
                        throw new Error("Replacing staffTunings." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffTunings"][idx];
                    patches.push({ p: ["staffTunings", idx], ld: ld, li: items[idx - start] });
                    frozen["staffTunings"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["staffTunings"][idx]) {
                        throw new Error("Removing staffTunings." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffTunings"][idx];
                    patches.push({ p: ["staffTunings", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["staffTunings", idx], li: items[idx - start] });
                    frozen["staffTunings"][idx] = true;
                }
            }
            (_a = reference["staffTunings"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["staffTunings"] = reference["staffTunings"];
            (_b = frozen["staffTunings"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.staffSize = function (spec) {
            updates["staffSize"] = spec;
            delete childBuilders["staffSize;"];
            modifiedKeys["staffSize"] = true;
            return _this;
        };
        this.showFrets = function (spec) {
            updates["showFrets"] = spec;
            delete childBuilders["showFrets;"];
            modifiedKeys["showFrets"] = true;
            return _this;
        };
        this.capo = function (spec) {
            updates["capo"] = spec;
            delete childBuilders["capo;"];
            modifiedKeys["capo"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.staffType = function (spec) {
            updates["staffType"] = spec;
            delete childBuilders["staffType;"];
            modifiedKeys["staffType"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.printSpacing = function (spec) {
            updates["printSpacing"] = spec;
            delete childBuilders["printSpacing;"];
            modifiedKeys["printSpacing"] = true;
            return _this;
        };
    }
    return StaffDetailsBuilder;
}());
function patchStaffDetails(base, builder) { return builder(new StaffDetailsBuilder(base)).patch(); }
exports.patchStaffDetails = patchStaffDetails;
function buildStaffDetails(builder) { return builder(new StaffDetailsBuilder()).build(); }
exports.buildStaffDetails = buildStaffDetails;
var DoubleBuilder = (function () {
    function DoubleBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Double";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return DoubleBuilder;
}());
function patchDouble(base, builder) { return builder(new DoubleBuilder(base)).patch(); }
exports.patchDouble = patchDouble;
function buildDouble(builder) { return builder(new DoubleBuilder()).build(); }
exports.buildDouble = buildDouble;
var TransposeBuilder = (function () {
    function TransposeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["chromatic"]) ||
                childBuilders["chromatic"] !== undefined ||
                updates.chromatic !== undefined, "chromatic is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Transpose";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.diatonic = function (spec) {
            updates["diatonic"] = spec;
            delete childBuilders["diatonic;"];
            modifiedKeys["diatonic"] = true;
            return _this;
        };
        this.octaveChange = function (spec) {
            updates["octaveChange"] = spec;
            delete childBuilders["octaveChange;"];
            modifiedKeys["octaveChange"] = true;
            return _this;
        };
        this.double = function (build) {
            if (typeof build === 'function') {
                delete updates["double"];
                var builder = build(new DoubleBuilder(original && original["double"]));
                if (!original)
                    updates["double"] = builder.build();
                else
                    childBuilders["double"] = builder;
            }
            else {
                updates.double = build;
                delete childBuilders["double;"];
            }
            modifiedKeys["double"] = true;
            return _this;
        };
        this.chromatic = function (spec) {
            updates["chromatic"] = spec;
            delete childBuilders["chromatic;"];
            modifiedKeys["chromatic"] = true;
            return _this;
        };
    }
    return TransposeBuilder;
}());
function patchTranspose(base, builder) { return builder(new TransposeBuilder(base)).patch(); }
exports.patchTranspose = patchTranspose;
function buildTranspose(builder) { return builder(new TransposeBuilder()).build(); }
exports.buildTranspose = buildTranspose;
var DirectiveBuilder = (function () {
    function DirectiveBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Directive";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return DirectiveBuilder;
}());
function patchDirective(base, builder) { return builder(new DirectiveBuilder(base)).patch(); }
exports.patchDirective = patchDirective;
function buildDirective(builder) { return builder(new DirectiveBuilder()).build(); }
exports.buildDirective = buildDirective;
var SlashDotBuilder = (function () {
    function SlashDotBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "SlashDot";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return SlashDotBuilder;
}());
function patchSlashDot(base, builder) { return builder(new SlashDotBuilder(base)).patch(); }
exports.patchSlashDot = patchSlashDot;
function buildSlashDot(builder) { return builder(new SlashDotBuilder()).build(); }
exports.buildSlashDot = buildSlashDot;
var MultipleRestBuilder = (function () {
    function MultipleRestBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["count"]) ||
                childBuilders["count"] !== undefined ||
                updates.count !== undefined, "count is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MultipleRest";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.useSymbols = function (spec) {
            updates["useSymbols"] = spec;
            delete childBuilders["useSymbols;"];
            modifiedKeys["useSymbols"] = true;
            return _this;
        };
        this.count = function (spec) {
            updates["count"] = spec;
            delete childBuilders["count;"];
            modifiedKeys["count"] = true;
            return _this;
        };
    }
    return MultipleRestBuilder;
}());
function patchMultipleRest(base, builder) { return builder(new MultipleRestBuilder(base)).patch(); }
exports.patchMultipleRest = patchMultipleRest;
function buildMultipleRest(builder) { return builder(new MultipleRestBuilder()).build(); }
exports.buildMultipleRest = buildMultipleRest;
var MeasureRepeatBuilder = (function () {
    function MeasureRepeatBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MeasureRepeat";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.slashes = function (spec) {
            updates["slashes"] = spec;
            delete childBuilders["slashes;"];
            modifiedKeys["slashes"] = true;
            return _this;
        };
    }
    return MeasureRepeatBuilder;
}());
function patchMeasureRepeat(base, builder) { return builder(new MeasureRepeatBuilder(base)).patch(); }
exports.patchMeasureRepeat = patchMeasureRepeat;
function buildMeasureRepeat(builder) { return builder(new MeasureRepeatBuilder()).build(); }
exports.buildMeasureRepeat = buildMeasureRepeat;
var BeatRepeatBuilder = (function () {
    function BeatRepeatBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BeatRepeat";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slashType = function (spec) {
            updates["slashType"] = spec;
            delete childBuilders["slashType;"];
            modifiedKeys["slashType"] = true;
            return _this;
        };
        this.useDots = function (spec) {
            updates["useDots"] = spec;
            delete childBuilders["useDots;"];
            modifiedKeys["useDots"] = true;
            return _this;
        };
        this.slashDots = function (spec) {
            updates["slashDots"] = spec;
            delete childBuilders["slashDots;"];
            modifiedKeys["slashDots"] = true;
            return _this;
        };
        this.slashDotsAt = function (idx, build) {
            makeReference("slashDots");
            if (frozen["slashDots"][idx]) {
                throw new Error("Patching slashDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["slashDots"] && !original["slashDots"]) {
                // Clone snapshot.
                patches.push({ p: ["slashDots", idx], li: original._snapshot["slashDots"] });
            }
            if (typeof build === 'function' && reference["slashDots"][idx]) {
                var patch = build(new SlashDotBuilder(reference["slashDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["slashDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["slashDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new SlashDotBuilder(reference["slashDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["slashDots", idx], li: update });
            }
            else {
                updates["slashDots"] = reference["slashDots"]; // TODO: Merge?
            }
            reference["slashDots"][idx] = update;
            frozen["slashDots"][idx] = true;
            return _this;
        };
        this.slashDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("slashDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["slashDots"][idx]) {
                        throw new Error("Replacing slashDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slashDots"][idx];
                    patches.push({ p: ["slashDots", idx], ld: ld, li: items[idx - start] });
                    frozen["slashDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["slashDots"][idx]) {
                        throw new Error("Removing slashDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slashDots"][idx];
                    patches.push({ p: ["slashDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["slashDots", idx], li: items[idx - start] });
                    frozen["slashDots"][idx] = true;
                }
            }
            (_a = reference["slashDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["slashDots"] = reference["slashDots"];
            (_b = frozen["slashDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.slases = function (spec) {
            updates["slases"] = spec;
            delete childBuilders["slases;"];
            modifiedKeys["slases"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return BeatRepeatBuilder;
}());
function patchBeatRepeat(base, builder) { return builder(new BeatRepeatBuilder(base)).patch(); }
exports.patchBeatRepeat = patchBeatRepeat;
function buildBeatRepeat(builder) { return builder(new BeatRepeatBuilder()).build(); }
exports.buildBeatRepeat = buildBeatRepeat;
var SlashBuilder = (function () {
    function SlashBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Slash";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slashType = function (spec) {
            updates["slashType"] = spec;
            delete childBuilders["slashType;"];
            modifiedKeys["slashType"] = true;
            return _this;
        };
        this.useDots = function (spec) {
            updates["useDots"] = spec;
            delete childBuilders["useDots;"];
            modifiedKeys["useDots"] = true;
            return _this;
        };
        this.useStems = function (spec) {
            updates["useStems"] = spec;
            delete childBuilders["useStems;"];
            modifiedKeys["useStems"] = true;
            return _this;
        };
        this.slashDots = function (spec) {
            updates["slashDots"] = spec;
            delete childBuilders["slashDots;"];
            modifiedKeys["slashDots"] = true;
            return _this;
        };
        this.slashDotsAt = function (idx, build) {
            makeReference("slashDots");
            if (frozen["slashDots"][idx]) {
                throw new Error("Patching slashDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["slashDots"] && !original["slashDots"]) {
                // Clone snapshot.
                patches.push({ p: ["slashDots", idx], li: original._snapshot["slashDots"] });
            }
            if (typeof build === 'function' && reference["slashDots"][idx]) {
                var patch = build(new SlashDotBuilder(reference["slashDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["slashDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["slashDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new SlashDotBuilder(reference["slashDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["slashDots", idx], li: update });
            }
            else {
                updates["slashDots"] = reference["slashDots"]; // TODO: Merge?
            }
            reference["slashDots"][idx] = update;
            frozen["slashDots"][idx] = true;
            return _this;
        };
        this.slashDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("slashDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["slashDots"][idx]) {
                        throw new Error("Replacing slashDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slashDots"][idx];
                    patches.push({ p: ["slashDots", idx], ld: ld, li: items[idx - start] });
                    frozen["slashDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["slashDots"][idx]) {
                        throw new Error("Removing slashDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slashDots"][idx];
                    patches.push({ p: ["slashDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["slashDots", idx], li: items[idx - start] });
                    frozen["slashDots"][idx] = true;
                }
            }
            (_a = reference["slashDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["slashDots"] = reference["slashDots"];
            (_b = frozen["slashDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return SlashBuilder;
}());
function patchSlash(base, builder) { return builder(new SlashBuilder(base)).patch(); }
exports.patchSlash = patchSlash;
function buildSlash(builder) { return builder(new SlashBuilder()).build(); }
exports.buildSlash = buildSlash;
var MeasureStyleBuilder = (function () {
    function MeasureStyleBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MeasureStyle";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.measureRepeat = function (build) {
            if (typeof build === 'function') {
                delete updates["measureRepeat"];
                var builder = build(new MeasureRepeatBuilder(original && original["measureRepeat"]));
                if (!original)
                    updates["measureRepeat"] = builder.build();
                else
                    childBuilders["measureRepeat"] = builder;
            }
            else {
                updates.measureRepeat = build;
                delete childBuilders["measureRepeat;"];
            }
            modifiedKeys["measureRepeat"] = true;
            return _this;
        };
        this.beatRepeat = function (build) {
            if (typeof build === 'function') {
                delete updates["beatRepeat"];
                var builder = build(new BeatRepeatBuilder(original && original["beatRepeat"]));
                if (!original)
                    updates["beatRepeat"] = builder.build();
                else
                    childBuilders["beatRepeat"] = builder;
            }
            else {
                updates.beatRepeat = build;
                delete childBuilders["beatRepeat;"];
            }
            modifiedKeys["beatRepeat"] = true;
            return _this;
        };
        this.multipleRest = function (build) {
            if (typeof build === 'function') {
                delete updates["multipleRest"];
                var builder = build(new MultipleRestBuilder(original && original["multipleRest"]));
                if (!original)
                    updates["multipleRest"] = builder.build();
                else
                    childBuilders["multipleRest"] = builder;
            }
            else {
                updates.multipleRest = build;
                delete childBuilders["multipleRest;"];
            }
            modifiedKeys["multipleRest"] = true;
            return _this;
        };
        this.slash = function (build) {
            if (typeof build === 'function') {
                delete updates["slash"];
                var builder = build(new SlashBuilder(original && original["slash"]));
                if (!original)
                    updates["slash"] = builder.build();
                else
                    childBuilders["slash"] = builder;
            }
            else {
                updates.slash = build;
                delete childBuilders["slash;"];
            }
            modifiedKeys["slash"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return MeasureStyleBuilder;
}());
function patchMeasureStyle(base, builder) { return builder(new MeasureStyleBuilder(base)).patch(); }
exports.patchMeasureStyle = patchMeasureStyle;
function buildMeasureStyle(builder) { return builder(new MeasureStyleBuilder()).build(); }
exports.buildMeasureStyle = buildMeasureStyle;
var AttributesBuilder = (function () {
    function AttributesBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Attributes";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.divisions = function (spec) {
            updates["divisions"] = spec;
            delete childBuilders["divisions;"];
            modifiedKeys["divisions"] = true;
            return _this;
        };
        this.partSymbol = function (build) {
            if (typeof build === 'function') {
                delete updates["partSymbol"];
                var builder = build(new PartSymbolBuilder(original && original["partSymbol"]));
                if (!original)
                    updates["partSymbol"] = builder.build();
                else
                    childBuilders["partSymbol"] = builder;
            }
            else {
                updates.partSymbol = build;
                delete childBuilders["partSymbol;"];
            }
            modifiedKeys["partSymbol"] = true;
            return _this;
        };
        this.clefs = function (spec) {
            updates["clefs"] = spec;
            delete childBuilders["clefs;"];
            modifiedKeys["clefs"] = true;
            return _this;
        };
        this.clefsAt = function (idx, build) {
            makeReference("clefs");
            if (frozen["clefs"][idx]) {
                throw new Error("Patching clefs." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["clefs"] && !original["clefs"]) {
                // Clone snapshot.
                patches.push({ p: ["clefs", idx], li: original._snapshot["clefs"] });
            }
            if (typeof build === 'function' && reference["clefs"][idx]) {
                var patch = build(new ClefBuilder(reference["clefs"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["clefs", idx].concat(patch.p);
                    return patch;
                }));
                frozen["clefs"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new ClefBuilder(reference["clefs"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["clefs", idx], li: update });
            }
            else {
                updates["clefs"] = reference["clefs"]; // TODO: Merge?
            }
            reference["clefs"][idx] = update;
            frozen["clefs"][idx] = true;
            return _this;
        };
        this.clefsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("clefs");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["clefs"][idx]) {
                        throw new Error("Replacing clefs." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["clefs"][idx];
                    patches.push({ p: ["clefs", idx], ld: ld, li: items[idx - start] });
                    frozen["clefs"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["clefs"][idx]) {
                        throw new Error("Removing clefs." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["clefs"][idx];
                    patches.push({ p: ["clefs", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["clefs", idx], li: items[idx - start] });
                    frozen["clefs"][idx] = true;
                }
            }
            (_a = reference["clefs"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["clefs"] = reference["clefs"];
            (_b = frozen["clefs"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.measureStyles = function (spec) {
            updates["measureStyles"] = spec;
            delete childBuilders["measureStyles;"];
            modifiedKeys["measureStyles"] = true;
            return _this;
        };
        this.measureStylesAt = function (idx, build) {
            makeReference("measureStyles");
            if (frozen["measureStyles"][idx]) {
                throw new Error("Patching measureStyles." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["measureStyles"] && !original["measureStyles"]) {
                // Clone snapshot.
                patches.push({ p: ["measureStyles", idx], li: original._snapshot["measureStyles"] });
            }
            if (typeof build === 'function' && reference["measureStyles"][idx]) {
                var patch = build(new MeasureStyleBuilder(reference["measureStyles"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["measureStyles", idx].concat(patch.p);
                    return patch;
                }));
                frozen["measureStyles"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MeasureStyleBuilder(reference["measureStyles"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["measureStyles", idx], li: update });
            }
            else {
                updates["measureStyles"] = reference["measureStyles"]; // TODO: Merge?
            }
            reference["measureStyles"][idx] = update;
            frozen["measureStyles"][idx] = true;
            return _this;
        };
        this.measureStylesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("measureStyles");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["measureStyles"][idx]) {
                        throw new Error("Replacing measureStyles." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["measureStyles"][idx];
                    patches.push({ p: ["measureStyles", idx], ld: ld, li: items[idx - start] });
                    frozen["measureStyles"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["measureStyles"][idx]) {
                        throw new Error("Removing measureStyles." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["measureStyles"][idx];
                    patches.push({ p: ["measureStyles", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["measureStyles", idx], li: items[idx - start] });
                    frozen["measureStyles"][idx] = true;
                }
            }
            (_a = reference["measureStyles"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["measureStyles"] = reference["measureStyles"];
            (_b = frozen["measureStyles"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.times = function (spec) {
            updates["times"] = spec;
            delete childBuilders["times;"];
            modifiedKeys["times"] = true;
            return _this;
        };
        this.timesAt = function (idx, build) {
            makeReference("times");
            if (frozen["times"][idx]) {
                throw new Error("Patching times." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["times"] && !original["times"]) {
                // Clone snapshot.
                patches.push({ p: ["times", idx], li: original._snapshot["times"] });
            }
            if (typeof build === 'function' && reference["times"][idx]) {
                var patch = build(new TimeBuilder(reference["times"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["times", idx].concat(patch.p);
                    return patch;
                }));
                frozen["times"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TimeBuilder(reference["times"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["times", idx], li: update });
            }
            else {
                updates["times"] = reference["times"]; // TODO: Merge?
            }
            reference["times"][idx] = update;
            frozen["times"][idx] = true;
            return _this;
        };
        this.timesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("times");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["times"][idx]) {
                        throw new Error("Replacing times." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["times"][idx];
                    patches.push({ p: ["times", idx], ld: ld, li: items[idx - start] });
                    frozen["times"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["times"][idx]) {
                        throw new Error("Removing times." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["times"][idx];
                    patches.push({ p: ["times", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["times", idx], li: items[idx - start] });
                    frozen["times"][idx] = true;
                }
            }
            (_a = reference["times"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["times"] = reference["times"];
            (_b = frozen["times"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.staffDetails = function (spec) {
            updates["staffDetails"] = spec;
            delete childBuilders["staffDetails;"];
            modifiedKeys["staffDetails"] = true;
            return _this;
        };
        this.staffDetailsAt = function (idx, build) {
            makeReference("staffDetails");
            if (frozen["staffDetails"][idx]) {
                throw new Error("Patching staffDetails." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["staffDetails"] && !original["staffDetails"]) {
                // Clone snapshot.
                patches.push({ p: ["staffDetails", idx], li: original._snapshot["staffDetails"] });
            }
            if (typeof build === 'function' && reference["staffDetails"][idx]) {
                var patch = build(new StaffDetailsBuilder(reference["staffDetails"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["staffDetails", idx].concat(patch.p);
                    return patch;
                }));
                frozen["staffDetails"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new StaffDetailsBuilder(reference["staffDetails"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["staffDetails", idx], li: update });
            }
            else {
                updates["staffDetails"] = reference["staffDetails"]; // TODO: Merge?
            }
            reference["staffDetails"][idx] = update;
            frozen["staffDetails"][idx] = true;
            return _this;
        };
        this.staffDetailsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("staffDetails");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["staffDetails"][idx]) {
                        throw new Error("Replacing staffDetails." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffDetails"][idx];
                    patches.push({ p: ["staffDetails", idx], ld: ld, li: items[idx - start] });
                    frozen["staffDetails"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["staffDetails"][idx]) {
                        throw new Error("Removing staffDetails." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffDetails"][idx];
                    patches.push({ p: ["staffDetails", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["staffDetails", idx], li: items[idx - start] });
                    frozen["staffDetails"][idx] = true;
                }
            }
            (_a = reference["staffDetails"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["staffDetails"] = reference["staffDetails"];
            (_b = frozen["staffDetails"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.transposes = function (spec) {
            updates["transposes"] = spec;
            delete childBuilders["transposes;"];
            modifiedKeys["transposes"] = true;
            return _this;
        };
        this.transposesAt = function (idx, build) {
            makeReference("transposes");
            if (frozen["transposes"][idx]) {
                throw new Error("Patching transposes." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["transposes"] && !original["transposes"]) {
                // Clone snapshot.
                patches.push({ p: ["transposes", idx], li: original._snapshot["transposes"] });
            }
            if (typeof build === 'function' && reference["transposes"][idx]) {
                var patch = build(new TransposeBuilder(reference["transposes"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["transposes", idx].concat(patch.p);
                    return patch;
                }));
                frozen["transposes"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TransposeBuilder(reference["transposes"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["transposes", idx], li: update });
            }
            else {
                updates["transposes"] = reference["transposes"]; // TODO: Merge?
            }
            reference["transposes"][idx] = update;
            frozen["transposes"][idx] = true;
            return _this;
        };
        this.transposesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("transposes");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["transposes"][idx]) {
                        throw new Error("Replacing transposes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["transposes"][idx];
                    patches.push({ p: ["transposes", idx], ld: ld, li: items[idx - start] });
                    frozen["transposes"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["transposes"][idx]) {
                        throw new Error("Removing transposes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["transposes"][idx];
                    patches.push({ p: ["transposes", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["transposes", idx], li: items[idx - start] });
                    frozen["transposes"][idx] = true;
                }
            }
            (_a = reference["transposes"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["transposes"] = reference["transposes"];
            (_b = frozen["transposes"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.staves = function (spec) {
            updates["staves"] = spec;
            delete childBuilders["staves;"];
            modifiedKeys["staves"] = true;
            return _this;
        };
        this.instruments = function (spec) {
            updates["instruments"] = spec;
            delete childBuilders["instruments;"];
            modifiedKeys["instruments"] = true;
            return _this;
        };
        this.keySignatures = function (spec) {
            updates["keySignatures"] = spec;
            delete childBuilders["keySignatures;"];
            modifiedKeys["keySignatures"] = true;
            return _this;
        };
        this.keySignaturesAt = function (idx, build) {
            makeReference("keySignatures");
            if (frozen["keySignatures"][idx]) {
                throw new Error("Patching keySignatures." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["keySignatures"] && !original["keySignatures"]) {
                // Clone snapshot.
                patches.push({ p: ["keySignatures", idx], li: original._snapshot["keySignatures"] });
            }
            if (typeof build === 'function' && reference["keySignatures"][idx]) {
                var patch = build(new KeyBuilder(reference["keySignatures"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["keySignatures", idx].concat(patch.p);
                    return patch;
                }));
                frozen["keySignatures"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new KeyBuilder(reference["keySignatures"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["keySignatures", idx], li: update });
            }
            else {
                updates["keySignatures"] = reference["keySignatures"]; // TODO: Merge?
            }
            reference["keySignatures"][idx] = update;
            frozen["keySignatures"][idx] = true;
            return _this;
        };
        this.keySignaturesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("keySignatures");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["keySignatures"][idx]) {
                        throw new Error("Replacing keySignatures." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["keySignatures"][idx];
                    patches.push({ p: ["keySignatures", idx], ld: ld, li: items[idx - start] });
                    frozen["keySignatures"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["keySignatures"][idx]) {
                        throw new Error("Removing keySignatures." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["keySignatures"][idx];
                    patches.push({ p: ["keySignatures", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["keySignatures", idx], li: items[idx - start] });
                    frozen["keySignatures"][idx] = true;
                }
            }
            (_a = reference["keySignatures"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["keySignatures"] = reference["keySignatures"];
            (_b = frozen["keySignatures"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.directives = function (spec) {
            updates["directives"] = spec;
            delete childBuilders["directives;"];
            modifiedKeys["directives"] = true;
            return _this;
        };
        this.directivesAt = function (idx, build) {
            makeReference("directives");
            if (frozen["directives"][idx]) {
                throw new Error("Patching directives." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["directives"] && !original["directives"]) {
                // Clone snapshot.
                patches.push({ p: ["directives", idx], li: original._snapshot["directives"] });
            }
            if (typeof build === 'function' && reference["directives"][idx]) {
                var patch = build(new DirectiveBuilder(reference["directives"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["directives", idx].concat(patch.p);
                    return patch;
                }));
                frozen["directives"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new DirectiveBuilder(reference["directives"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["directives", idx], li: update });
            }
            else {
                updates["directives"] = reference["directives"]; // TODO: Merge?
            }
            reference["directives"][idx] = update;
            frozen["directives"][idx] = true;
            return _this;
        };
        this.directivesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("directives");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["directives"][idx]) {
                        throw new Error("Replacing directives." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["directives"][idx];
                    patches.push({ p: ["directives", idx], ld: ld, li: items[idx - start] });
                    frozen["directives"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["directives"][idx]) {
                        throw new Error("Removing directives." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["directives"][idx];
                    patches.push({ p: ["directives", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["directives", idx], li: items[idx - start] });
                    frozen["directives"][idx] = true;
                }
            }
            (_a = reference["directives"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["directives"] = reference["directives"];
            (_b = frozen["directives"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return AttributesBuilder;
}());
function patchAttributes(base, builder) { return builder(new AttributesBuilder(base)).patch(); }
exports.patchAttributes = patchAttributes;
function buildAttributes(builder) { return builder(new AttributesBuilder()).build(); }
exports.buildAttributes = buildAttributes;
var CueBuilder = (function () {
    function CueBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Cue";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return CueBuilder;
}());
function patchCue(base, builder) { return builder(new CueBuilder(base)).patch(); }
exports.patchCue = patchCue;
function buildCue(builder) { return builder(new CueBuilder()).build(); }
exports.buildCue = buildCue;
var GraceBuilder = (function () {
    function GraceBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Grace";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.makeTime = function (spec) {
            updates["makeTime"] = spec;
            delete childBuilders["makeTime;"];
            modifiedKeys["makeTime"] = true;
            return _this;
        };
        this.stealTimePrevious = function (spec) {
            updates["stealTimePrevious"] = spec;
            delete childBuilders["stealTimePrevious;"];
            modifiedKeys["stealTimePrevious"] = true;
            return _this;
        };
        this.slash = function (spec) {
            updates["slash"] = spec;
            delete childBuilders["slash;"];
            modifiedKeys["slash"] = true;
            return _this;
        };
        this.stealTimeFollowing = function (spec) {
            updates["stealTimeFollowing"] = spec;
            delete childBuilders["stealTimeFollowing;"];
            modifiedKeys["stealTimeFollowing"] = true;
            return _this;
        };
    }
    return GraceBuilder;
}());
function patchGrace(base, builder) { return builder(new GraceBuilder(base)).patch(); }
exports.patchGrace = patchGrace;
function buildGrace(builder) { return builder(new GraceBuilder()).build(); }
exports.buildGrace = buildGrace;
var ChordBuilder = (function () {
    function ChordBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Chord";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return ChordBuilder;
}());
function patchChord(base, builder) { return builder(new ChordBuilder(base)).patch(); }
exports.patchChord = patchChord;
function buildChord(builder) { return builder(new ChordBuilder()).build(); }
exports.buildChord = buildChord;
var UnpitchedBuilder = (function () {
    function UnpitchedBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Unpitched";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.displayStep = function (spec) {
            updates["displayStep"] = spec;
            delete childBuilders["displayStep;"];
            modifiedKeys["displayStep"] = true;
            return _this;
        };
        this.displayOctave = function (spec) {
            updates["displayOctave"] = spec;
            delete childBuilders["displayOctave;"];
            modifiedKeys["displayOctave"] = true;
            return _this;
        };
    }
    return UnpitchedBuilder;
}());
function patchUnpitched(base, builder) { return builder(new UnpitchedBuilder(base)).patch(); }
exports.patchUnpitched = patchUnpitched;
function buildUnpitched(builder) { return builder(new UnpitchedBuilder()).build(); }
exports.buildUnpitched = buildUnpitched;
var PitchBuilder = (function () {
    function PitchBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["octave"]) ||
                childBuilders["octave"] !== undefined ||
                updates.octave !== undefined, "octave is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Pitch";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.alter = function (spec) {
            updates["alter"] = spec;
            delete childBuilders["alter;"];
            modifiedKeys["alter"] = true;
            return _this;
        };
        this.step = function (spec) {
            updates["step"] = spec;
            delete childBuilders["step;"];
            modifiedKeys["step"] = true;
            return _this;
        };
        this.octave = function (spec) {
            updates["octave"] = spec;
            delete childBuilders["octave;"];
            modifiedKeys["octave"] = true;
            return _this;
        };
    }
    return PitchBuilder;
}());
function patchPitch(base, builder) { return builder(new PitchBuilder(base)).patch(); }
exports.patchPitch = patchPitch;
function buildPitch(builder) { return builder(new PitchBuilder()).build(); }
exports.buildPitch = buildPitch;
var FullNoteBuilder = (function () {
    function FullNoteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "FullNote";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.unpitched = function (build) {
            if (typeof build === 'function') {
                delete updates["unpitched"];
                var builder = build(new UnpitchedBuilder(original && original["unpitched"]));
                if (!original)
                    updates["unpitched"] = builder.build();
                else
                    childBuilders["unpitched"] = builder;
            }
            else {
                updates.unpitched = build;
                delete childBuilders["unpitched;"];
            }
            modifiedKeys["unpitched"] = true;
            return _this;
        };
        this.chord = function (build) {
            if (typeof build === 'function') {
                delete updates["chord"];
                var builder = build(new ChordBuilder(original && original["chord"]));
                if (!original)
                    updates["chord"] = builder.build();
                else
                    childBuilders["chord"] = builder;
            }
            else {
                updates.chord = build;
                delete childBuilders["chord;"];
            }
            modifiedKeys["chord"] = true;
            return _this;
        };
        this.pitch = function (build) {
            if (typeof build === 'function') {
                delete updates["pitch"];
                var builder = build(new PitchBuilder(original && original["pitch"]));
                if (!original)
                    updates["pitch"] = builder.build();
                else
                    childBuilders["pitch"] = builder;
            }
            else {
                updates.pitch = build;
                delete childBuilders["pitch;"];
            }
            modifiedKeys["pitch"] = true;
            return _this;
        };
        this.rest = function (build) {
            if (typeof build === 'function') {
                delete updates["rest"];
                var builder = build(new RestBuilder(original && original["rest"]));
                if (!original)
                    updates["rest"] = builder.build();
                else
                    childBuilders["rest"] = builder;
            }
            else {
                updates.rest = build;
                delete childBuilders["rest;"];
            }
            modifiedKeys["rest"] = true;
            return _this;
        };
    }
    return FullNoteBuilder;
}());
function patchFullNote(base, builder) { return builder(new FullNoteBuilder(base)).patch(); }
exports.patchFullNote = patchFullNote;
function buildFullNote(builder) { return builder(new FullNoteBuilder()).build(); }
exports.buildFullNote = buildFullNote;
var RestBuilder = (function () {
    function RestBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Rest";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.measure = function (spec) {
            updates["measure"] = spec;
            delete childBuilders["measure;"];
            modifiedKeys["measure"] = true;
            return _this;
        };
        this.displayStep = function (spec) {
            updates["displayStep"] = spec;
            delete childBuilders["displayStep;"];
            modifiedKeys["displayStep"] = true;
            return _this;
        };
        this.displayOctave = function (spec) {
            updates["displayOctave"] = spec;
            delete childBuilders["displayOctave;"];
            modifiedKeys["displayOctave"] = true;
            return _this;
        };
    }
    return RestBuilder;
}());
function patchRest(base, builder) { return builder(new RestBuilder(base)).patch(); }
exports.patchRest = patchRest;
function buildRest(builder) { return builder(new RestBuilder()).build(); }
exports.buildRest = buildRest;
var TieBuilder = (function () {
    function TieBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Tie";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.timeOnly = function (spec) {
            updates["timeOnly"] = spec;
            delete childBuilders["timeOnly;"];
            modifiedKeys["timeOnly"] = true;
            return _this;
        };
    }
    return TieBuilder;
}());
function patchTie(base, builder) { return builder(new TieBuilder(base)).patch(); }
exports.patchTie = patchTie;
function buildTie(builder) { return builder(new TieBuilder()).build(); }
exports.buildTie = buildTie;
var InstrumentBuilder = (function () {
    function InstrumentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["id"]) ||
                childBuilders["id"] !== undefined ||
                updates.id !== undefined, "id is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Instrument";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.id = function (spec) {
            updates["id"] = spec;
            delete childBuilders["id;"];
            modifiedKeys["id"] = true;
            return _this;
        };
    }
    return InstrumentBuilder;
}());
function patchInstrument(base, builder) { return builder(new InstrumentBuilder(base)).patch(); }
exports.patchInstrument = patchInstrument;
function buildInstrument(builder) { return builder(new InstrumentBuilder()).build(); }
exports.buildInstrument = buildInstrument;
var NoteBuilder = (function () {
    function NoteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Note";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.noteheadText = function (build) {
            if (typeof build === 'function') {
                delete updates["noteheadText"];
                var builder = build(new NoteheadTextBuilder(original && original["noteheadText"]));
                if (!original)
                    updates["noteheadText"] = builder.build();
                else
                    childBuilders["noteheadText"] = builder;
            }
            else {
                updates.noteheadText = build;
                delete childBuilders["noteheadText;"];
            }
            modifiedKeys["noteheadText"] = true;
            return _this;
        };
        this.timeModification = function (build) {
            if (typeof build === 'function') {
                delete updates["timeModification"];
                var builder = build(new TimeModificationBuilder(original && original["timeModification"]));
                if (!original)
                    updates["timeModification"] = builder.build();
                else
                    childBuilders["timeModification"] = builder;
            }
            else {
                updates.timeModification = build;
                delete childBuilders["timeModification;"];
            }
            modifiedKeys["timeModification"] = true;
            return _this;
        };
        this.accidental = function (build) {
            if (typeof build === 'function') {
                delete updates["accidental"];
                var builder = build(new AccidentalBuilder(original && original["accidental"]));
                if (!original)
                    updates["accidental"] = builder.build();
                else
                    childBuilders["accidental"] = builder;
            }
            else {
                updates.accidental = build;
                delete childBuilders["accidental;"];
            }
            modifiedKeys["accidental"] = true;
            return _this;
        };
        this.instrument = function (build) {
            if (typeof build === 'function') {
                delete updates["instrument"];
                var builder = build(new InstrumentBuilder(original && original["instrument"]));
                if (!original)
                    updates["instrument"] = builder.build();
                else
                    childBuilders["instrument"] = builder;
            }
            else {
                updates.instrument = build;
                delete childBuilders["instrument;"];
            }
            modifiedKeys["instrument"] = true;
            return _this;
        };
        this.attack = function (spec) {
            updates["attack"] = spec;
            delete childBuilders["attack;"];
            modifiedKeys["attack"] = true;
            return _this;
        };
        this.endDynamics = function (spec) {
            updates["endDynamics"] = spec;
            delete childBuilders["endDynamics;"];
            modifiedKeys["endDynamics"] = true;
            return _this;
        };
        this.lyrics = function (spec) {
            updates["lyrics"] = spec;
            delete childBuilders["lyrics;"];
            modifiedKeys["lyrics"] = true;
            return _this;
        };
        this.lyricsAt = function (idx, build) {
            makeReference("lyrics");
            if (frozen["lyrics"][idx]) {
                throw new Error("Patching lyrics." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["lyrics"] && !original["lyrics"]) {
                // Clone snapshot.
                patches.push({ p: ["lyrics", idx], li: original._snapshot["lyrics"] });
            }
            if (typeof build === 'function' && reference["lyrics"][idx]) {
                var patch = build(new LyricBuilder(reference["lyrics"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["lyrics", idx].concat(patch.p);
                    return patch;
                }));
                frozen["lyrics"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new LyricBuilder(reference["lyrics"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["lyrics", idx], li: update });
            }
            else {
                updates["lyrics"] = reference["lyrics"]; // TODO: Merge?
            }
            reference["lyrics"][idx] = update;
            frozen["lyrics"][idx] = true;
            return _this;
        };
        this.lyricsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("lyrics");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["lyrics"][idx]) {
                        throw new Error("Replacing lyrics." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["lyrics"][idx];
                    patches.push({ p: ["lyrics", idx], ld: ld, li: items[idx - start] });
                    frozen["lyrics"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["lyrics"][idx]) {
                        throw new Error("Removing lyrics." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["lyrics"][idx];
                    patches.push({ p: ["lyrics", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["lyrics", idx], li: items[idx - start] });
                    frozen["lyrics"][idx] = true;
                }
            }
            (_a = reference["lyrics"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["lyrics"] = reference["lyrics"];
            (_b = frozen["lyrics"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.dots = function (spec) {
            updates["dots"] = spec;
            delete childBuilders["dots;"];
            modifiedKeys["dots"] = true;
            return _this;
        };
        this.dotsAt = function (idx, build) {
            makeReference("dots");
            if (frozen["dots"][idx]) {
                throw new Error("Patching dots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["dots"] && !original["dots"]) {
                // Clone snapshot.
                patches.push({ p: ["dots", idx], li: original._snapshot["dots"] });
            }
            if (typeof build === 'function' && reference["dots"][idx]) {
                var patch = build(new DotBuilder(reference["dots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["dots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["dots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new DotBuilder(reference["dots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["dots", idx], li: update });
            }
            else {
                updates["dots"] = reference["dots"]; // TODO: Merge?
            }
            reference["dots"][idx] = update;
            frozen["dots"][idx] = true;
            return _this;
        };
        this.dotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("dots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["dots"][idx]) {
                        throw new Error("Replacing dots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["dots"][idx];
                    patches.push({ p: ["dots", idx], ld: ld, li: items[idx - start] });
                    frozen["dots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["dots"][idx]) {
                        throw new Error("Removing dots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["dots"][idx];
                    patches.push({ p: ["dots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["dots", idx], li: items[idx - start] });
                    frozen["dots"][idx] = true;
                }
            }
            (_a = reference["dots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["dots"] = reference["dots"];
            (_b = frozen["dots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.notations = function (spec) {
            updates["notations"] = spec;
            delete childBuilders["notations;"];
            modifiedKeys["notations"] = true;
            return _this;
        };
        this.notationsAt = function (idx, build) {
            makeReference("notations");
            if (frozen["notations"][idx]) {
                throw new Error("Patching notations." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["notations"] && !original["notations"]) {
                // Clone snapshot.
                patches.push({ p: ["notations", idx], li: original._snapshot["notations"] });
            }
            if (typeof build === 'function' && reference["notations"][idx]) {
                var patch = build(new NotationsBuilder(reference["notations"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["notations", idx].concat(patch.p);
                    return patch;
                }));
                frozen["notations"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new NotationsBuilder(reference["notations"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["notations", idx], li: update });
            }
            else {
                updates["notations"] = reference["notations"]; // TODO: Merge?
            }
            reference["notations"][idx] = update;
            frozen["notations"][idx] = true;
            return _this;
        };
        this.notationsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("notations");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["notations"][idx]) {
                        throw new Error("Replacing notations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["notations"][idx];
                    patches.push({ p: ["notations", idx], ld: ld, li: items[idx - start] });
                    frozen["notations"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["notations"][idx]) {
                        throw new Error("Removing notations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["notations"][idx];
                    patches.push({ p: ["notations", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["notations", idx], li: items[idx - start] });
                    frozen["notations"][idx] = true;
                }
            }
            (_a = reference["notations"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["notations"] = reference["notations"];
            (_b = frozen["notations"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.stem = function (build) {
            if (typeof build === 'function') {
                delete updates["stem"];
                var builder = build(new StemBuilder(original && original["stem"]));
                if (!original)
                    updates["stem"] = builder.build();
                else
                    childBuilders["stem"] = builder;
            }
            else {
                updates.stem = build;
                delete childBuilders["stem;"];
            }
            modifiedKeys["stem"] = true;
            return _this;
        };
        this.noteType = function (build) {
            if (typeof build === 'function') {
                delete updates["noteType"];
                var builder = build(new TypeBuilder(original && original["noteType"]));
                if (!original)
                    updates["noteType"] = builder.build();
                else
                    childBuilders["noteType"] = builder;
            }
            else {
                updates.noteType = build;
                delete childBuilders["noteType;"];
            }
            modifiedKeys["noteType"] = true;
            return _this;
        };
        this.pizzicato = function (spec) {
            updates["pizzicato"] = spec;
            delete childBuilders["pizzicato;"];
            modifiedKeys["pizzicato"] = true;
            return _this;
        };
        this.cue = function (build) {
            if (typeof build === 'function') {
                delete updates["cue"];
                var builder = build(new CueBuilder(original && original["cue"]));
                if (!original)
                    updates["cue"] = builder.build();
                else
                    childBuilders["cue"] = builder;
            }
            else {
                updates.cue = build;
                delete childBuilders["cue;"];
            }
            modifiedKeys["cue"] = true;
            return _this;
        };
        this.duration = function (spec) {
            updates["duration"] = spec;
            delete childBuilders["duration;"];
            modifiedKeys["duration"] = true;
            return _this;
        };
        this.ties = function (spec) {
            updates["ties"] = spec;
            delete childBuilders["ties;"];
            modifiedKeys["ties"] = true;
            return _this;
        };
        this.tiesAt = function (idx, build) {
            makeReference("ties");
            if (frozen["ties"][idx]) {
                throw new Error("Patching ties." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["ties"] && !original["ties"]) {
                // Clone snapshot.
                patches.push({ p: ["ties", idx], li: original._snapshot["ties"] });
            }
            if (typeof build === 'function' && reference["ties"][idx]) {
                var patch = build(new TieBuilder(reference["ties"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["ties", idx].concat(patch.p);
                    return patch;
                }));
                frozen["ties"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TieBuilder(reference["ties"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["ties", idx], li: update });
            }
            else {
                updates["ties"] = reference["ties"]; // TODO: Merge?
            }
            reference["ties"][idx] = update;
            frozen["ties"][idx] = true;
            return _this;
        };
        this.tiesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("ties");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["ties"][idx]) {
                        throw new Error("Replacing ties." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["ties"][idx];
                    patches.push({ p: ["ties", idx], ld: ld, li: items[idx - start] });
                    frozen["ties"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["ties"][idx]) {
                        throw new Error("Removing ties." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["ties"][idx];
                    patches.push({ p: ["ties", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["ties", idx], li: items[idx - start] });
                    frozen["ties"][idx] = true;
                }
            }
            (_a = reference["ties"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["ties"] = reference["ties"];
            (_b = frozen["ties"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.dynamics = function (spec) {
            updates["dynamics"] = spec;
            delete childBuilders["dynamics;"];
            modifiedKeys["dynamics"] = true;
            return _this;
        };
        this.play = function (build) {
            if (typeof build === 'function') {
                delete updates["play"];
                var builder = build(new PlayBuilder(original && original["play"]));
                if (!original)
                    updates["play"] = builder.build();
                else
                    childBuilders["play"] = builder;
            }
            else {
                updates.play = build;
                delete childBuilders["play;"];
            }
            modifiedKeys["play"] = true;
            return _this;
        };
        this.staff = function (spec) {
            updates["staff"] = spec;
            delete childBuilders["staff;"];
            modifiedKeys["staff"] = true;
            return _this;
        };
        this.grace = function (build) {
            if (typeof build === 'function') {
                delete updates["grace"];
                var builder = build(new GraceBuilder(original && original["grace"]));
                if (!original)
                    updates["grace"] = builder.build();
                else
                    childBuilders["grace"] = builder;
            }
            else {
                updates.grace = build;
                delete childBuilders["grace;"];
            }
            modifiedKeys["grace"] = true;
            return _this;
        };
        this.notehead = function (build) {
            if (typeof build === 'function') {
                delete updates["notehead"];
                var builder = build(new NoteheadBuilder(original && original["notehead"]));
                if (!original)
                    updates["notehead"] = builder.build();
                else
                    childBuilders["notehead"] = builder;
            }
            else {
                updates.notehead = build;
                delete childBuilders["notehead;"];
            }
            modifiedKeys["notehead"] = true;
            return _this;
        };
        this.release = function (spec) {
            updates["release"] = spec;
            delete childBuilders["release;"];
            modifiedKeys["release"] = true;
            return _this;
        };
        this.beams = function (spec) {
            updates["beams"] = spec;
            delete childBuilders["beams;"];
            modifiedKeys["beams"] = true;
            return _this;
        };
        this.beamsAt = function (idx, build) {
            makeReference("beams");
            if (frozen["beams"][idx]) {
                throw new Error("Patching beams." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["beams"] && !original["beams"]) {
                // Clone snapshot.
                patches.push({ p: ["beams", idx], li: original._snapshot["beams"] });
            }
            if (typeof build === 'function' && reference["beams"][idx]) {
                var patch = build(new BeamBuilder(reference["beams"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["beams", idx].concat(patch.p);
                    return patch;
                }));
                frozen["beams"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new BeamBuilder(reference["beams"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["beams", idx], li: update });
            }
            else {
                updates["beams"] = reference["beams"]; // TODO: Merge?
            }
            reference["beams"][idx] = update;
            frozen["beams"][idx] = true;
            return _this;
        };
        this.beamsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("beams");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["beams"][idx]) {
                        throw new Error("Replacing beams." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["beams"][idx];
                    patches.push({ p: ["beams", idx], ld: ld, li: items[idx - start] });
                    frozen["beams"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["beams"][idx]) {
                        throw new Error("Removing beams." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["beams"][idx];
                    patches.push({ p: ["beams", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["beams", idx], li: items[idx - start] });
                    frozen["beams"][idx] = true;
                }
            }
            (_a = reference["beams"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["beams"] = reference["beams"];
            (_b = frozen["beams"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.timeOnly = function (spec) {
            updates["timeOnly"] = spec;
            delete childBuilders["timeOnly;"];
            modifiedKeys["timeOnly"] = true;
            return _this;
        };
        this.voice = function (spec) {
            updates["voice"] = spec;
            delete childBuilders["voice;"];
            modifiedKeys["voice"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
        this.printDot = function (spec) {
            updates["printDot"] = spec;
            delete childBuilders["printDot;"];
            modifiedKeys["printDot"] = true;
            return _this;
        };
        this.printLyric = function (spec) {
            updates["printLyric"] = spec;
            delete childBuilders["printLyric;"];
            modifiedKeys["printLyric"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.printSpacing = function (spec) {
            updates["printSpacing"] = spec;
            delete childBuilders["printSpacing;"];
            modifiedKeys["printSpacing"] = true;
            return _this;
        };
        this.unpitched = function (build) {
            if (typeof build === 'function') {
                delete updates["unpitched"];
                var builder = build(new UnpitchedBuilder(original && original["unpitched"]));
                if (!original)
                    updates["unpitched"] = builder.build();
                else
                    childBuilders["unpitched"] = builder;
            }
            else {
                updates.unpitched = build;
                delete childBuilders["unpitched;"];
            }
            modifiedKeys["unpitched"] = true;
            return _this;
        };
        this.chord = function (build) {
            if (typeof build === 'function') {
                delete updates["chord"];
                var builder = build(new ChordBuilder(original && original["chord"]));
                if (!original)
                    updates["chord"] = builder.build();
                else
                    childBuilders["chord"] = builder;
            }
            else {
                updates.chord = build;
                delete childBuilders["chord;"];
            }
            modifiedKeys["chord"] = true;
            return _this;
        };
        this.pitch = function (build) {
            if (typeof build === 'function') {
                delete updates["pitch"];
                var builder = build(new PitchBuilder(original && original["pitch"]));
                if (!original)
                    updates["pitch"] = builder.build();
                else
                    childBuilders["pitch"] = builder;
            }
            else {
                updates.pitch = build;
                delete childBuilders["pitch;"];
            }
            modifiedKeys["pitch"] = true;
            return _this;
        };
        this.rest = function (build) {
            if (typeof build === 'function') {
                delete updates["rest"];
                var builder = build(new RestBuilder(original && original["rest"]));
                if (!original)
                    updates["rest"] = builder.build();
                else
                    childBuilders["rest"] = builder;
            }
            else {
                updates.rest = build;
                delete childBuilders["rest;"];
            }
            modifiedKeys["rest"] = true;
            return _this;
        };
    }
    return NoteBuilder;
}());
function patchNote(base, builder) { return builder(new NoteBuilder(base)).patch(); }
exports.patchNote = patchNote;
function buildNote(builder) { return builder(new NoteBuilder()).build(); }
exports.buildNote = buildNote;
var TypeBuilder = (function () {
    function TypeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["duration"]) ||
                childBuilders["duration"] !== undefined ||
                updates.duration !== undefined, "duration is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Type";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.duration = function (spec) {
            updates["duration"] = spec;
            delete childBuilders["duration;"];
            modifiedKeys["duration"] = true;
            return _this;
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
    }
    return TypeBuilder;
}());
function patchType(base, builder) { return builder(new TypeBuilder(base)).patch(); }
exports.patchType = patchType;
function buildType(builder) { return builder(new TypeBuilder()).build(); }
exports.buildType = buildType;
var DotBuilder = (function () {
    function DotBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Dot";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return DotBuilder;
}());
function patchDot(base, builder) { return builder(new DotBuilder(base)).patch(); }
exports.patchDot = patchDot;
function buildDot(builder) { return builder(new DotBuilder()).build(); }
exports.buildDot = buildDot;
var AccidentalBuilder = (function () {
    function AccidentalBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["accidental"]) ||
                childBuilders["accidental"] !== undefined ||
                updates.accidental !== undefined, "accidental is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Accidental";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.cautionary = function (spec) {
            updates["cautionary"] = spec;
            delete childBuilders["cautionary;"];
            modifiedKeys["cautionary"] = true;
            return _this;
        };
        this.accidental = function (spec) {
            updates["accidental"] = spec;
            delete childBuilders["accidental;"];
            modifiedKeys["accidental"] = true;
            return _this;
        };
        this.editorial = function (spec) {
            updates["editorial"] = spec;
            delete childBuilders["editorial;"];
            modifiedKeys["editorial"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.bracket = function (spec) {
            updates["bracket"] = spec;
            delete childBuilders["bracket;"];
            modifiedKeys["bracket"] = true;
            return _this;
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
        this.parentheses = function (spec) {
            updates["parentheses"] = spec;
            delete childBuilders["parentheses;"];
            modifiedKeys["parentheses"] = true;
            return _this;
        };
    }
    return AccidentalBuilder;
}());
function patchAccidental(base, builder) { return builder(new AccidentalBuilder(base)).patch(); }
exports.patchAccidental = patchAccidental;
function buildAccidental(builder) { return builder(new AccidentalBuilder()).build(); }
exports.buildAccidental = buildAccidental;
var TimeModificationBuilder = (function () {
    function TimeModificationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["actualNotes"]) ||
                childBuilders["actualNotes"] !== undefined ||
                updates.actualNotes !== undefined, "actualNotes is a required field");
            console.assert((original && !modifiedKeys["normalNotes"]) ||
                childBuilders["normalNotes"] !== undefined ||
                updates.normalNotes !== undefined, "normalNotes is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TimeModification";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.actualNotes = function (spec) {
            updates["actualNotes"] = spec;
            delete childBuilders["actualNotes;"];
            modifiedKeys["actualNotes"] = true;
            return _this;
        };
        this.normalType = function (spec) {
            updates["normalType"] = spec;
            delete childBuilders["normalType;"];
            modifiedKeys["normalType"] = true;
            return _this;
        };
        this.normalNotes = function (spec) {
            updates["normalNotes"] = spec;
            delete childBuilders["normalNotes;"];
            modifiedKeys["normalNotes"] = true;
            return _this;
        };
        this.normalDots = function (spec) {
            updates["normalDots"] = spec;
            delete childBuilders["normalDots;"];
            modifiedKeys["normalDots"] = true;
            return _this;
        };
        this.normalDotsAt = function (idx, build) {
            makeReference("normalDots");
            if (frozen["normalDots"][idx]) {
                throw new Error("Patching normalDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["normalDots"] && !original["normalDots"]) {
                // Clone snapshot.
                patches.push({ p: ["normalDots", idx], li: original._snapshot["normalDots"] });
            }
            if (typeof build === 'function' && reference["normalDots"][idx]) {
                var patch = build(new NormalDotBuilder(reference["normalDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["normalDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["normalDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new NormalDotBuilder(reference["normalDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["normalDots", idx], li: update });
            }
            else {
                updates["normalDots"] = reference["normalDots"]; // TODO: Merge?
            }
            reference["normalDots"][idx] = update;
            frozen["normalDots"][idx] = true;
            return _this;
        };
        this.normalDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("normalDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["normalDots"][idx]) {
                        throw new Error("Replacing normalDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["normalDots"][idx];
                    patches.push({ p: ["normalDots", idx], ld: ld, li: items[idx - start] });
                    frozen["normalDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["normalDots"][idx]) {
                        throw new Error("Removing normalDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["normalDots"][idx];
                    patches.push({ p: ["normalDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["normalDots", idx], li: items[idx - start] });
                    frozen["normalDots"][idx] = true;
                }
            }
            (_a = reference["normalDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["normalDots"] = reference["normalDots"];
            (_b = frozen["normalDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return TimeModificationBuilder;
}());
function patchTimeModification(base, builder) { return builder(new TimeModificationBuilder(base)).patch(); }
exports.patchTimeModification = patchTimeModification;
function buildTimeModification(builder) { return builder(new TimeModificationBuilder()).build(); }
exports.buildTimeModification = buildTimeModification;
var StemBuilder = (function () {
    function StemBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Stem";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return StemBuilder;
}());
function patchStem(base, builder) { return builder(new StemBuilder(base)).patch(); }
exports.patchStem = patchStem;
function buildStem(builder) { return builder(new StemBuilder()).build(); }
exports.buildStem = buildStem;
var NoteheadBuilder = (function () {
    function NoteheadBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Notehead";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.filled = function (spec) {
            updates["filled"] = spec;
            delete childBuilders["filled;"];
            modifiedKeys["filled"] = true;
            return _this;
        };
        this.parentheses = function (spec) {
            updates["parentheses"] = spec;
            delete childBuilders["parentheses;"];
            modifiedKeys["parentheses"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return NoteheadBuilder;
}());
function patchNotehead(base, builder) { return builder(new NoteheadBuilder(base)).patch(); }
exports.patchNotehead = patchNotehead;
function buildNotehead(builder) { return builder(new NoteheadBuilder()).build(); }
exports.buildNotehead = buildNotehead;
var NoteheadTextBuilder = (function () {
    function NoteheadTextBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "NoteheadText";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.textAt = function (idx, build) {
            makeReference("text");
            if (frozen["text"][idx]) {
                throw new Error("Patching text." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["text"] && !original["text"]) {
                // Clone snapshot.
                patches.push({ p: ["text", idx], li: original._snapshot["text"] });
            }
            if (typeof build === 'function' && reference["text"][idx]) {
                var patch = build(new TextSegmentBuilder(reference["text"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["text", idx].concat(patch.p);
                    return patch;
                }));
                frozen["text"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TextSegmentBuilder(reference["text"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["text", idx], li: update });
            }
            else {
                updates["text"] = reference["text"]; // TODO: Merge?
            }
            reference["text"][idx] = update;
            frozen["text"][idx] = true;
            return _this;
        };
        this.textSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("text");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["text"][idx]) {
                        throw new Error("Replacing text." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["text"][idx];
                    patches.push({ p: ["text", idx], ld: ld, li: items[idx - start] });
                    frozen["text"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["text"][idx]) {
                        throw new Error("Removing text." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["text"][idx];
                    patches.push({ p: ["text", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["text", idx], li: items[idx - start] });
                    frozen["text"][idx] = true;
                }
            }
            (_a = reference["text"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["text"] = reference["text"];
            (_b = frozen["text"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return NoteheadTextBuilder;
}());
function patchNoteheadText(base, builder) { return builder(new NoteheadTextBuilder(base)).patch(); }
exports.patchNoteheadText = patchNoteheadText;
function buildNoteheadText(builder) { return builder(new NoteheadTextBuilder()).build(); }
exports.buildNoteheadText = buildNoteheadText;
var BeamBuilder = (function () {
    function BeamBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Beam";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.repeater = function (spec) {
            updates["repeater"] = spec;
            delete childBuilders["repeater;"];
            modifiedKeys["repeater"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.fan = function (spec) {
            updates["fan"] = spec;
            delete childBuilders["fan;"];
            modifiedKeys["fan"] = true;
            return _this;
        };
    }
    return BeamBuilder;
}());
function patchBeam(base, builder) { return builder(new BeamBuilder(base)).patch(); }
exports.patchBeam = patchBeam;
function buildBeam(builder) { return builder(new BeamBuilder()).build(); }
exports.buildBeam = buildBeam;
var NotationsBuilder = (function () {
    function NotationsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Notations";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slurs = function (spec) {
            updates["slurs"] = spec;
            delete childBuilders["slurs;"];
            modifiedKeys["slurs"] = true;
            return _this;
        };
        this.slursAt = function (idx, build) {
            makeReference("slurs");
            if (frozen["slurs"][idx]) {
                throw new Error("Patching slurs." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["slurs"] && !original["slurs"]) {
                // Clone snapshot.
                patches.push({ p: ["slurs", idx], li: original._snapshot["slurs"] });
            }
            if (typeof build === 'function' && reference["slurs"][idx]) {
                var patch = build(new SlurBuilder(reference["slurs"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["slurs", idx].concat(patch.p);
                    return patch;
                }));
                frozen["slurs"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new SlurBuilder(reference["slurs"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["slurs", idx], li: update });
            }
            else {
                updates["slurs"] = reference["slurs"]; // TODO: Merge?
            }
            reference["slurs"][idx] = update;
            frozen["slurs"][idx] = true;
            return _this;
        };
        this.slursSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("slurs");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["slurs"][idx]) {
                        throw new Error("Replacing slurs." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slurs"][idx];
                    patches.push({ p: ["slurs", idx], ld: ld, li: items[idx - start] });
                    frozen["slurs"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["slurs"][idx]) {
                        throw new Error("Removing slurs." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slurs"][idx];
                    patches.push({ p: ["slurs", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["slurs", idx], li: items[idx - start] });
                    frozen["slurs"][idx] = true;
                }
            }
            (_a = reference["slurs"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["slurs"] = reference["slurs"];
            (_b = frozen["slurs"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.articulations = function (spec) {
            updates["articulations"] = spec;
            delete childBuilders["articulations;"];
            modifiedKeys["articulations"] = true;
            return _this;
        };
        this.articulationsAt = function (idx, build) {
            makeReference("articulations");
            if (frozen["articulations"][idx]) {
                throw new Error("Patching articulations." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["articulations"] && !original["articulations"]) {
                // Clone snapshot.
                patches.push({ p: ["articulations", idx], li: original._snapshot["articulations"] });
            }
            if (typeof build === 'function' && reference["articulations"][idx]) {
                var patch = build(new ArticulationsBuilder(reference["articulations"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["articulations", idx].concat(patch.p);
                    return patch;
                }));
                frozen["articulations"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new ArticulationsBuilder(reference["articulations"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["articulations", idx], li: update });
            }
            else {
                updates["articulations"] = reference["articulations"]; // TODO: Merge?
            }
            reference["articulations"][idx] = update;
            frozen["articulations"][idx] = true;
            return _this;
        };
        this.articulationsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("articulations");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["articulations"][idx]) {
                        throw new Error("Replacing articulations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["articulations"][idx];
                    patches.push({ p: ["articulations", idx], ld: ld, li: items[idx - start] });
                    frozen["articulations"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["articulations"][idx]) {
                        throw new Error("Removing articulations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["articulations"][idx];
                    patches.push({ p: ["articulations", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["articulations", idx], li: items[idx - start] });
                    frozen["articulations"][idx] = true;
                }
            }
            (_a = reference["articulations"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["articulations"] = reference["articulations"];
            (_b = frozen["articulations"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.slides = function (spec) {
            updates["slides"] = spec;
            delete childBuilders["slides;"];
            modifiedKeys["slides"] = true;
            return _this;
        };
        this.slidesAt = function (idx, build) {
            makeReference("slides");
            if (frozen["slides"][idx]) {
                throw new Error("Patching slides." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["slides"] && !original["slides"]) {
                // Clone snapshot.
                patches.push({ p: ["slides", idx], li: original._snapshot["slides"] });
            }
            if (typeof build === 'function' && reference["slides"][idx]) {
                var patch = build(new SlideBuilder(reference["slides"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["slides", idx].concat(patch.p);
                    return patch;
                }));
                frozen["slides"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new SlideBuilder(reference["slides"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["slides", idx], li: update });
            }
            else {
                updates["slides"] = reference["slides"]; // TODO: Merge?
            }
            reference["slides"][idx] = update;
            frozen["slides"][idx] = true;
            return _this;
        };
        this.slidesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("slides");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["slides"][idx]) {
                        throw new Error("Replacing slides." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slides"][idx];
                    patches.push({ p: ["slides", idx], ld: ld, li: items[idx - start] });
                    frozen["slides"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["slides"][idx]) {
                        throw new Error("Removing slides." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["slides"][idx];
                    patches.push({ p: ["slides", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["slides", idx], li: items[idx - start] });
                    frozen["slides"][idx] = true;
                }
            }
            (_a = reference["slides"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["slides"] = reference["slides"];
            (_b = frozen["slides"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.technicals = function (spec) {
            updates["technicals"] = spec;
            delete childBuilders["technicals;"];
            modifiedKeys["technicals"] = true;
            return _this;
        };
        this.technicalsAt = function (idx, build) {
            makeReference("technicals");
            if (frozen["technicals"][idx]) {
                throw new Error("Patching technicals." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["technicals"] && !original["technicals"]) {
                // Clone snapshot.
                patches.push({ p: ["technicals", idx], li: original._snapshot["technicals"] });
            }
            if (typeof build === 'function' && reference["technicals"][idx]) {
                var patch = build(new TechnicalBuilder(reference["technicals"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["technicals", idx].concat(patch.p);
                    return patch;
                }));
                frozen["technicals"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TechnicalBuilder(reference["technicals"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["technicals", idx], li: update });
            }
            else {
                updates["technicals"] = reference["technicals"]; // TODO: Merge?
            }
            reference["technicals"][idx] = update;
            frozen["technicals"][idx] = true;
            return _this;
        };
        this.technicalsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("technicals");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["technicals"][idx]) {
                        throw new Error("Replacing technicals." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["technicals"][idx];
                    patches.push({ p: ["technicals", idx], ld: ld, li: items[idx - start] });
                    frozen["technicals"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["technicals"][idx]) {
                        throw new Error("Removing technicals." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["technicals"][idx];
                    patches.push({ p: ["technicals", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["technicals", idx], li: items[idx - start] });
                    frozen["technicals"][idx] = true;
                }
            }
            (_a = reference["technicals"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["technicals"] = reference["technicals"];
            (_b = frozen["technicals"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.tieds = function (spec) {
            updates["tieds"] = spec;
            delete childBuilders["tieds;"];
            modifiedKeys["tieds"] = true;
            return _this;
        };
        this.tiedsAt = function (idx, build) {
            makeReference("tieds");
            if (frozen["tieds"][idx]) {
                throw new Error("Patching tieds." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["tieds"] && !original["tieds"]) {
                // Clone snapshot.
                patches.push({ p: ["tieds", idx], li: original._snapshot["tieds"] });
            }
            if (typeof build === 'function' && reference["tieds"][idx]) {
                var patch = build(new TiedBuilder(reference["tieds"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["tieds", idx].concat(patch.p);
                    return patch;
                }));
                frozen["tieds"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TiedBuilder(reference["tieds"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["tieds", idx], li: update });
            }
            else {
                updates["tieds"] = reference["tieds"]; // TODO: Merge?
            }
            reference["tieds"][idx] = update;
            frozen["tieds"][idx] = true;
            return _this;
        };
        this.tiedsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("tieds");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["tieds"][idx]) {
                        throw new Error("Replacing tieds." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tieds"][idx];
                    patches.push({ p: ["tieds", idx], ld: ld, li: items[idx - start] });
                    frozen["tieds"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["tieds"][idx]) {
                        throw new Error("Removing tieds." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tieds"][idx];
                    patches.push({ p: ["tieds", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["tieds", idx], li: items[idx - start] });
                    frozen["tieds"][idx] = true;
                }
            }
            (_a = reference["tieds"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["tieds"] = reference["tieds"];
            (_b = frozen["tieds"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.tuplets = function (spec) {
            updates["tuplets"] = spec;
            delete childBuilders["tuplets;"];
            modifiedKeys["tuplets"] = true;
            return _this;
        };
        this.tupletsAt = function (idx, build) {
            makeReference("tuplets");
            if (frozen["tuplets"][idx]) {
                throw new Error("Patching tuplets." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["tuplets"] && !original["tuplets"]) {
                // Clone snapshot.
                patches.push({ p: ["tuplets", idx], li: original._snapshot["tuplets"] });
            }
            if (typeof build === 'function' && reference["tuplets"][idx]) {
                var patch = build(new TupletBuilder(reference["tuplets"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["tuplets", idx].concat(patch.p);
                    return patch;
                }));
                frozen["tuplets"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TupletBuilder(reference["tuplets"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["tuplets", idx], li: update });
            }
            else {
                updates["tuplets"] = reference["tuplets"]; // TODO: Merge?
            }
            reference["tuplets"][idx] = update;
            frozen["tuplets"][idx] = true;
            return _this;
        };
        this.tupletsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("tuplets");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["tuplets"][idx]) {
                        throw new Error("Replacing tuplets." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tuplets"][idx];
                    patches.push({ p: ["tuplets", idx], ld: ld, li: items[idx - start] });
                    frozen["tuplets"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["tuplets"][idx]) {
                        throw new Error("Removing tuplets." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tuplets"][idx];
                    patches.push({ p: ["tuplets", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["tuplets", idx], li: items[idx - start] });
                    frozen["tuplets"][idx] = true;
                }
            }
            (_a = reference["tuplets"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["tuplets"] = reference["tuplets"];
            (_b = frozen["tuplets"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.glissandos = function (spec) {
            updates["glissandos"] = spec;
            delete childBuilders["glissandos;"];
            modifiedKeys["glissandos"] = true;
            return _this;
        };
        this.glissandosAt = function (idx, build) {
            makeReference("glissandos");
            if (frozen["glissandos"][idx]) {
                throw new Error("Patching glissandos." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["glissandos"] && !original["glissandos"]) {
                // Clone snapshot.
                patches.push({ p: ["glissandos", idx], li: original._snapshot["glissandos"] });
            }
            if (typeof build === 'function' && reference["glissandos"][idx]) {
                var patch = build(new GlissandoBuilder(reference["glissandos"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["glissandos", idx].concat(patch.p);
                    return patch;
                }));
                frozen["glissandos"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new GlissandoBuilder(reference["glissandos"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["glissandos", idx], li: update });
            }
            else {
                updates["glissandos"] = reference["glissandos"]; // TODO: Merge?
            }
            reference["glissandos"][idx] = update;
            frozen["glissandos"][idx] = true;
            return _this;
        };
        this.glissandosSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("glissandos");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["glissandos"][idx]) {
                        throw new Error("Replacing glissandos." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["glissandos"][idx];
                    patches.push({ p: ["glissandos", idx], ld: ld, li: items[idx - start] });
                    frozen["glissandos"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["glissandos"][idx]) {
                        throw new Error("Removing glissandos." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["glissandos"][idx];
                    patches.push({ p: ["glissandos", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["glissandos", idx], li: items[idx - start] });
                    frozen["glissandos"][idx] = true;
                }
            }
            (_a = reference["glissandos"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["glissandos"] = reference["glissandos"];
            (_b = frozen["glissandos"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.dynamics = function (spec) {
            updates["dynamics"] = spec;
            delete childBuilders["dynamics;"];
            modifiedKeys["dynamics"] = true;
            return _this;
        };
        this.dynamicsAt = function (idx, build) {
            makeReference("dynamics");
            if (frozen["dynamics"][idx]) {
                throw new Error("Patching dynamics." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["dynamics"] && !original["dynamics"]) {
                // Clone snapshot.
                patches.push({ p: ["dynamics", idx], li: original._snapshot["dynamics"] });
            }
            if (typeof build === 'function' && reference["dynamics"][idx]) {
                var patch = build(new DynamicsBuilder(reference["dynamics"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["dynamics", idx].concat(patch.p);
                    return patch;
                }));
                frozen["dynamics"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new DynamicsBuilder(reference["dynamics"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["dynamics", idx], li: update });
            }
            else {
                updates["dynamics"] = reference["dynamics"]; // TODO: Merge?
            }
            reference["dynamics"][idx] = update;
            frozen["dynamics"][idx] = true;
            return _this;
        };
        this.dynamicsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("dynamics");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["dynamics"][idx]) {
                        throw new Error("Replacing dynamics." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["dynamics"][idx];
                    patches.push({ p: ["dynamics", idx], ld: ld, li: items[idx - start] });
                    frozen["dynamics"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["dynamics"][idx]) {
                        throw new Error("Removing dynamics." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["dynamics"][idx];
                    patches.push({ p: ["dynamics", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["dynamics", idx], li: items[idx - start] });
                    frozen["dynamics"][idx] = true;
                }
            }
            (_a = reference["dynamics"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["dynamics"] = reference["dynamics"];
            (_b = frozen["dynamics"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.fermatas = function (spec) {
            updates["fermatas"] = spec;
            delete childBuilders["fermatas;"];
            modifiedKeys["fermatas"] = true;
            return _this;
        };
        this.fermatasAt = function (idx, build) {
            makeReference("fermatas");
            if (frozen["fermatas"][idx]) {
                throw new Error("Patching fermatas." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["fermatas"] && !original["fermatas"]) {
                // Clone snapshot.
                patches.push({ p: ["fermatas", idx], li: original._snapshot["fermatas"] });
            }
            if (typeof build === 'function' && reference["fermatas"][idx]) {
                var patch = build(new FermataBuilder(reference["fermatas"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["fermatas", idx].concat(patch.p);
                    return patch;
                }));
                frozen["fermatas"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new FermataBuilder(reference["fermatas"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["fermatas", idx], li: update });
            }
            else {
                updates["fermatas"] = reference["fermatas"]; // TODO: Merge?
            }
            reference["fermatas"][idx] = update;
            frozen["fermatas"][idx] = true;
            return _this;
        };
        this.fermatasSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("fermatas");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["fermatas"][idx]) {
                        throw new Error("Replacing fermatas." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["fermatas"][idx];
                    patches.push({ p: ["fermatas", idx], ld: ld, li: items[idx - start] });
                    frozen["fermatas"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["fermatas"][idx]) {
                        throw new Error("Removing fermatas." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["fermatas"][idx];
                    patches.push({ p: ["fermatas", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["fermatas", idx], li: items[idx - start] });
                    frozen["fermatas"][idx] = true;
                }
            }
            (_a = reference["fermatas"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["fermatas"] = reference["fermatas"];
            (_b = frozen["fermatas"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.accidentalMarks = function (spec) {
            updates["accidentalMarks"] = spec;
            delete childBuilders["accidentalMarks;"];
            modifiedKeys["accidentalMarks"] = true;
            return _this;
        };
        this.accidentalMarksAt = function (idx, build) {
            makeReference("accidentalMarks");
            if (frozen["accidentalMarks"][idx]) {
                throw new Error("Patching accidentalMarks." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["accidentalMarks"] && !original["accidentalMarks"]) {
                // Clone snapshot.
                patches.push({ p: ["accidentalMarks", idx], li: original._snapshot["accidentalMarks"] });
            }
            if (typeof build === 'function' && reference["accidentalMarks"][idx]) {
                var patch = build(new AccidentalMarkBuilder(reference["accidentalMarks"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["accidentalMarks", idx].concat(patch.p);
                    return patch;
                }));
                frozen["accidentalMarks"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new AccidentalMarkBuilder(reference["accidentalMarks"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["accidentalMarks", idx], li: update });
            }
            else {
                updates["accidentalMarks"] = reference["accidentalMarks"]; // TODO: Merge?
            }
            reference["accidentalMarks"][idx] = update;
            frozen["accidentalMarks"][idx] = true;
            return _this;
        };
        this.accidentalMarksSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("accidentalMarks");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["accidentalMarks"][idx]) {
                        throw new Error("Replacing accidentalMarks." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["accidentalMarks"][idx];
                    patches.push({ p: ["accidentalMarks", idx], ld: ld, li: items[idx - start] });
                    frozen["accidentalMarks"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["accidentalMarks"][idx]) {
                        throw new Error("Removing accidentalMarks." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["accidentalMarks"][idx];
                    patches.push({ p: ["accidentalMarks", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["accidentalMarks", idx], li: items[idx - start] });
                    frozen["accidentalMarks"][idx] = true;
                }
            }
            (_a = reference["accidentalMarks"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["accidentalMarks"] = reference["accidentalMarks"];
            (_b = frozen["accidentalMarks"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.ornaments = function (spec) {
            updates["ornaments"] = spec;
            delete childBuilders["ornaments;"];
            modifiedKeys["ornaments"] = true;
            return _this;
        };
        this.ornamentsAt = function (idx, build) {
            makeReference("ornaments");
            if (frozen["ornaments"][idx]) {
                throw new Error("Patching ornaments." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["ornaments"] && !original["ornaments"]) {
                // Clone snapshot.
                patches.push({ p: ["ornaments", idx], li: original._snapshot["ornaments"] });
            }
            if (typeof build === 'function' && reference["ornaments"][idx]) {
                var patch = build(new OrnamentsBuilder(reference["ornaments"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["ornaments", idx].concat(patch.p);
                    return patch;
                }));
                frozen["ornaments"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new OrnamentsBuilder(reference["ornaments"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["ornaments", idx], li: update });
            }
            else {
                updates["ornaments"] = reference["ornaments"]; // TODO: Merge?
            }
            reference["ornaments"][idx] = update;
            frozen["ornaments"][idx] = true;
            return _this;
        };
        this.ornamentsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("ornaments");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["ornaments"][idx]) {
                        throw new Error("Replacing ornaments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["ornaments"][idx];
                    patches.push({ p: ["ornaments", idx], ld: ld, li: items[idx - start] });
                    frozen["ornaments"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["ornaments"][idx]) {
                        throw new Error("Removing ornaments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["ornaments"][idx];
                    patches.push({ p: ["ornaments", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["ornaments", idx], li: items[idx - start] });
                    frozen["ornaments"][idx] = true;
                }
            }
            (_a = reference["ornaments"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["ornaments"] = reference["ornaments"];
            (_b = frozen["ornaments"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.arpeggiates = function (spec) {
            updates["arpeggiates"] = spec;
            delete childBuilders["arpeggiates;"];
            modifiedKeys["arpeggiates"] = true;
            return _this;
        };
        this.arpeggiatesAt = function (idx, build) {
            makeReference("arpeggiates");
            if (frozen["arpeggiates"][idx]) {
                throw new Error("Patching arpeggiates." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["arpeggiates"] && !original["arpeggiates"]) {
                // Clone snapshot.
                patches.push({ p: ["arpeggiates", idx], li: original._snapshot["arpeggiates"] });
            }
            if (typeof build === 'function' && reference["arpeggiates"][idx]) {
                var patch = build(new ArpeggiateBuilder(reference["arpeggiates"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["arpeggiates", idx].concat(patch.p);
                    return patch;
                }));
                frozen["arpeggiates"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new ArpeggiateBuilder(reference["arpeggiates"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["arpeggiates", idx], li: update });
            }
            else {
                updates["arpeggiates"] = reference["arpeggiates"]; // TODO: Merge?
            }
            reference["arpeggiates"][idx] = update;
            frozen["arpeggiates"][idx] = true;
            return _this;
        };
        this.arpeggiatesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("arpeggiates");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["arpeggiates"][idx]) {
                        throw new Error("Replacing arpeggiates." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["arpeggiates"][idx];
                    patches.push({ p: ["arpeggiates", idx], ld: ld, li: items[idx - start] });
                    frozen["arpeggiates"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["arpeggiates"][idx]) {
                        throw new Error("Removing arpeggiates." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["arpeggiates"][idx];
                    patches.push({ p: ["arpeggiates", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["arpeggiates", idx], li: items[idx - start] });
                    frozen["arpeggiates"][idx] = true;
                }
            }
            (_a = reference["arpeggiates"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["arpeggiates"] = reference["arpeggiates"];
            (_b = frozen["arpeggiates"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.nonArpeggiates = function (spec) {
            updates["nonArpeggiates"] = spec;
            delete childBuilders["nonArpeggiates;"];
            modifiedKeys["nonArpeggiates"] = true;
            return _this;
        };
        this.nonArpeggiatesAt = function (idx, build) {
            makeReference("nonArpeggiates");
            if (frozen["nonArpeggiates"][idx]) {
                throw new Error("Patching nonArpeggiates." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["nonArpeggiates"] && !original["nonArpeggiates"]) {
                // Clone snapshot.
                patches.push({ p: ["nonArpeggiates", idx], li: original._snapshot["nonArpeggiates"] });
            }
            if (typeof build === 'function' && reference["nonArpeggiates"][idx]) {
                var patch = build(new NonArpeggiateBuilder(reference["nonArpeggiates"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["nonArpeggiates", idx].concat(patch.p);
                    return patch;
                }));
                frozen["nonArpeggiates"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new NonArpeggiateBuilder(reference["nonArpeggiates"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["nonArpeggiates", idx], li: update });
            }
            else {
                updates["nonArpeggiates"] = reference["nonArpeggiates"]; // TODO: Merge?
            }
            reference["nonArpeggiates"][idx] = update;
            frozen["nonArpeggiates"][idx] = true;
            return _this;
        };
        this.nonArpeggiatesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("nonArpeggiates");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["nonArpeggiates"][idx]) {
                        throw new Error("Replacing nonArpeggiates." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["nonArpeggiates"][idx];
                    patches.push({ p: ["nonArpeggiates", idx], ld: ld, li: items[idx - start] });
                    frozen["nonArpeggiates"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["nonArpeggiates"][idx]) {
                        throw new Error("Removing nonArpeggiates." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["nonArpeggiates"][idx];
                    patches.push({ p: ["nonArpeggiates", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["nonArpeggiates", idx], li: items[idx - start] });
                    frozen["nonArpeggiates"][idx] = true;
                }
            }
            (_a = reference["nonArpeggiates"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["nonArpeggiates"] = reference["nonArpeggiates"];
            (_b = frozen["nonArpeggiates"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.otherNotations = function (spec) {
            updates["otherNotations"] = spec;
            delete childBuilders["otherNotations;"];
            modifiedKeys["otherNotations"] = true;
            return _this;
        };
        this.otherNotationsAt = function (idx, build) {
            makeReference("otherNotations");
            if (frozen["otherNotations"][idx]) {
                throw new Error("Patching otherNotations." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["otherNotations"] && !original["otherNotations"]) {
                // Clone snapshot.
                patches.push({ p: ["otherNotations", idx], li: original._snapshot["otherNotations"] });
            }
            if (typeof build === 'function' && reference["otherNotations"][idx]) {
                var patch = build(new OtherNotationBuilder(reference["otherNotations"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["otherNotations", idx].concat(patch.p);
                    return patch;
                }));
                frozen["otherNotations"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new OtherNotationBuilder(reference["otherNotations"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["otherNotations", idx], li: update });
            }
            else {
                updates["otherNotations"] = reference["otherNotations"]; // TODO: Merge?
            }
            reference["otherNotations"][idx] = update;
            frozen["otherNotations"][idx] = true;
            return _this;
        };
        this.otherNotationsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("otherNotations");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["otherNotations"][idx]) {
                        throw new Error("Replacing otherNotations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["otherNotations"][idx];
                    patches.push({ p: ["otherNotations", idx], ld: ld, li: items[idx - start] });
                    frozen["otherNotations"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["otherNotations"][idx]) {
                        throw new Error("Removing otherNotations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["otherNotations"][idx];
                    patches.push({ p: ["otherNotations", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["otherNotations", idx], li: items[idx - start] });
                    frozen["otherNotations"][idx] = true;
                }
            }
            (_a = reference["otherNotations"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["otherNotations"] = reference["otherNotations"];
            (_b = frozen["otherNotations"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return NotationsBuilder;
}());
function patchNotations(base, builder) { return builder(new NotationsBuilder(base)).patch(); }
exports.patchNotations = patchNotations;
function buildNotations(builder) { return builder(new NotationsBuilder()).build(); }
exports.buildNotations = buildNotations;
var TiedBuilder = (function () {
    function TiedBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Tied";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.orientation = function (spec) {
            updates["orientation"] = spec;
            delete childBuilders["orientation;"];
            modifiedKeys["orientation"] = true;
            return _this;
        };
        this.bezierX2 = function (spec) {
            updates["bezierX2"] = spec;
            delete childBuilders["bezierX2;"];
            modifiedKeys["bezierX2"] = true;
            return _this;
        };
        this.bezierOffset = function (spec) {
            updates["bezierOffset"] = spec;
            delete childBuilders["bezierOffset;"];
            modifiedKeys["bezierOffset"] = true;
            return _this;
        };
        this.bezierOffset2 = function (spec) {
            updates["bezierOffset2"] = spec;
            delete childBuilders["bezierOffset2;"];
            modifiedKeys["bezierOffset2"] = true;
            return _this;
        };
        this.bezierX = function (spec) {
            updates["bezierX"] = spec;
            delete childBuilders["bezierX;"];
            modifiedKeys["bezierX"] = true;
            return _this;
        };
        this.bezierY = function (spec) {
            updates["bezierY"] = spec;
            delete childBuilders["bezierY;"];
            modifiedKeys["bezierY"] = true;
            return _this;
        };
        this.bezierY2 = function (spec) {
            updates["bezierY2"] = spec;
            delete childBuilders["bezierY2;"];
            modifiedKeys["bezierY2"] = true;
            return _this;
        };
    }
    return TiedBuilder;
}());
function patchTied(base, builder) { return builder(new TiedBuilder(base)).patch(); }
exports.patchTied = patchTied;
function buildTied(builder) { return builder(new TiedBuilder()).build(); }
exports.buildTied = buildTied;
var SlurBuilder = (function () {
    function SlurBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Slur";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.orientation = function (spec) {
            updates["orientation"] = spec;
            delete childBuilders["orientation;"];
            modifiedKeys["orientation"] = true;
            return _this;
        };
        this.bezierX2 = function (spec) {
            updates["bezierX2"] = spec;
            delete childBuilders["bezierX2;"];
            modifiedKeys["bezierX2"] = true;
            return _this;
        };
        this.bezierOffset = function (spec) {
            updates["bezierOffset"] = spec;
            delete childBuilders["bezierOffset;"];
            modifiedKeys["bezierOffset"] = true;
            return _this;
        };
        this.bezierOffset2 = function (spec) {
            updates["bezierOffset2"] = spec;
            delete childBuilders["bezierOffset2;"];
            modifiedKeys["bezierOffset2"] = true;
            return _this;
        };
        this.bezierX = function (spec) {
            updates["bezierX"] = spec;
            delete childBuilders["bezierX;"];
            modifiedKeys["bezierX"] = true;
            return _this;
        };
        this.bezierY = function (spec) {
            updates["bezierY"] = spec;
            delete childBuilders["bezierY;"];
            modifiedKeys["bezierY"] = true;
            return _this;
        };
        this.bezierY2 = function (spec) {
            updates["bezierY2"] = spec;
            delete childBuilders["bezierY2;"];
            modifiedKeys["bezierY2"] = true;
            return _this;
        };
    }
    return SlurBuilder;
}());
function patchSlur(base, builder) { return builder(new SlurBuilder(base)).patch(); }
exports.patchSlur = patchSlur;
function buildSlur(builder) { return builder(new SlurBuilder()).build(); }
exports.buildSlur = buildSlur;
var TupletBuilder = (function () {
    function TupletBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Tuplet";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.bracket = function (spec) {
            updates["bracket"] = spec;
            delete childBuilders["bracket;"];
            modifiedKeys["bracket"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.showNumber = function (spec) {
            updates["showNumber"] = spec;
            delete childBuilders["showNumber;"];
            modifiedKeys["showNumber"] = true;
            return _this;
        };
        this.tupletNormal = function (build) {
            if (typeof build === 'function') {
                delete updates["tupletNormal"];
                var builder = build(new TupletNormalBuilder(original && original["tupletNormal"]));
                if (!original)
                    updates["tupletNormal"] = builder.build();
                else
                    childBuilders["tupletNormal"] = builder;
            }
            else {
                updates.tupletNormal = build;
                delete childBuilders["tupletNormal;"];
            }
            modifiedKeys["tupletNormal"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.showType = function (spec) {
            updates["showType"] = spec;
            delete childBuilders["showType;"];
            modifiedKeys["showType"] = true;
            return _this;
        };
        this.tupletActual = function (build) {
            if (typeof build === 'function') {
                delete updates["tupletActual"];
                var builder = build(new TupletActualBuilder(original && original["tupletActual"]));
                if (!original)
                    updates["tupletActual"] = builder.build();
                else
                    childBuilders["tupletActual"] = builder;
            }
            else {
                updates.tupletActual = build;
                delete childBuilders["tupletActual;"];
            }
            modifiedKeys["tupletActual"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return TupletBuilder;
}());
function patchTuplet(base, builder) { return builder(new TupletBuilder(base)).patch(); }
exports.patchTuplet = patchTuplet;
function buildTuplet(builder) { return builder(new TupletBuilder()).build(); }
exports.buildTuplet = buildTuplet;
var TupletActualBuilder = (function () {
    function TupletActualBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TupletActual";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tupletNumber = function (build) {
            if (typeof build === 'function') {
                delete updates["tupletNumber"];
                var builder = build(new TupletNumberBuilder(original && original["tupletNumber"]));
                if (!original)
                    updates["tupletNumber"] = builder.build();
                else
                    childBuilders["tupletNumber"] = builder;
            }
            else {
                updates.tupletNumber = build;
                delete childBuilders["tupletNumber;"];
            }
            modifiedKeys["tupletNumber"] = true;
            return _this;
        };
        this.tupletDots = function (spec) {
            updates["tupletDots"] = spec;
            delete childBuilders["tupletDots;"];
            modifiedKeys["tupletDots"] = true;
            return _this;
        };
        this.tupletDotsAt = function (idx, build) {
            makeReference("tupletDots");
            if (frozen["tupletDots"][idx]) {
                throw new Error("Patching tupletDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["tupletDots"] && !original["tupletDots"]) {
                // Clone snapshot.
                patches.push({ p: ["tupletDots", idx], li: original._snapshot["tupletDots"] });
            }
            if (typeof build === 'function' && reference["tupletDots"][idx]) {
                var patch = build(new TupletDotBuilder(reference["tupletDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["tupletDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["tupletDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TupletDotBuilder(reference["tupletDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["tupletDots", idx], li: update });
            }
            else {
                updates["tupletDots"] = reference["tupletDots"]; // TODO: Merge?
            }
            reference["tupletDots"][idx] = update;
            frozen["tupletDots"][idx] = true;
            return _this;
        };
        this.tupletDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("tupletDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["tupletDots"][idx]) {
                        throw new Error("Replacing tupletDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tupletDots"][idx];
                    patches.push({ p: ["tupletDots", idx], ld: ld, li: items[idx - start] });
                    frozen["tupletDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["tupletDots"][idx]) {
                        throw new Error("Removing tupletDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tupletDots"][idx];
                    patches.push({ p: ["tupletDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["tupletDots", idx], li: items[idx - start] });
                    frozen["tupletDots"][idx] = true;
                }
            }
            (_a = reference["tupletDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["tupletDots"] = reference["tupletDots"];
            (_b = frozen["tupletDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.tupletType = function (build) {
            if (typeof build === 'function') {
                delete updates["tupletType"];
                var builder = build(new TupletTypeBuilder(original && original["tupletType"]));
                if (!original)
                    updates["tupletType"] = builder.build();
                else
                    childBuilders["tupletType"] = builder;
            }
            else {
                updates.tupletType = build;
                delete childBuilders["tupletType;"];
            }
            modifiedKeys["tupletType"] = true;
            return _this;
        };
    }
    return TupletActualBuilder;
}());
function patchTupletActual(base, builder) { return builder(new TupletActualBuilder(base)).patch(); }
exports.patchTupletActual = patchTupletActual;
function buildTupletActual(builder) { return builder(new TupletActualBuilder()).build(); }
exports.buildTupletActual = buildTupletActual;
var TupletNormalBuilder = (function () {
    function TupletNormalBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TupletNormal";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tupletNumber = function (build) {
            if (typeof build === 'function') {
                delete updates["tupletNumber"];
                var builder = build(new TupletNumberBuilder(original && original["tupletNumber"]));
                if (!original)
                    updates["tupletNumber"] = builder.build();
                else
                    childBuilders["tupletNumber"] = builder;
            }
            else {
                updates.tupletNumber = build;
                delete childBuilders["tupletNumber;"];
            }
            modifiedKeys["tupletNumber"] = true;
            return _this;
        };
        this.tupletDots = function (spec) {
            updates["tupletDots"] = spec;
            delete childBuilders["tupletDots;"];
            modifiedKeys["tupletDots"] = true;
            return _this;
        };
        this.tupletDotsAt = function (idx, build) {
            makeReference("tupletDots");
            if (frozen["tupletDots"][idx]) {
                throw new Error("Patching tupletDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["tupletDots"] && !original["tupletDots"]) {
                // Clone snapshot.
                patches.push({ p: ["tupletDots", idx], li: original._snapshot["tupletDots"] });
            }
            if (typeof build === 'function' && reference["tupletDots"][idx]) {
                var patch = build(new TupletDotBuilder(reference["tupletDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["tupletDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["tupletDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TupletDotBuilder(reference["tupletDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["tupletDots", idx], li: update });
            }
            else {
                updates["tupletDots"] = reference["tupletDots"]; // TODO: Merge?
            }
            reference["tupletDots"][idx] = update;
            frozen["tupletDots"][idx] = true;
            return _this;
        };
        this.tupletDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("tupletDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["tupletDots"][idx]) {
                        throw new Error("Replacing tupletDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tupletDots"][idx];
                    patches.push({ p: ["tupletDots", idx], ld: ld, li: items[idx - start] });
                    frozen["tupletDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["tupletDots"][idx]) {
                        throw new Error("Removing tupletDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["tupletDots"][idx];
                    patches.push({ p: ["tupletDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["tupletDots", idx], li: items[idx - start] });
                    frozen["tupletDots"][idx] = true;
                }
            }
            (_a = reference["tupletDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["tupletDots"] = reference["tupletDots"];
            (_b = frozen["tupletDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.tupletType = function (build) {
            if (typeof build === 'function') {
                delete updates["tupletType"];
                var builder = build(new TupletTypeBuilder(original && original["tupletType"]));
                if (!original)
                    updates["tupletType"] = builder.build();
                else
                    childBuilders["tupletType"] = builder;
            }
            else {
                updates.tupletType = build;
                delete childBuilders["tupletType;"];
            }
            modifiedKeys["tupletType"] = true;
            return _this;
        };
    }
    return TupletNormalBuilder;
}());
function patchTupletNormal(base, builder) { return builder(new TupletNormalBuilder(base)).patch(); }
exports.patchTupletNormal = patchTupletNormal;
function buildTupletNormal(builder) { return builder(new TupletNormalBuilder()).build(); }
exports.buildTupletNormal = buildTupletNormal;
var TupletNumberBuilder = (function () {
    function TupletNumberBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TupletNumber";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return TupletNumberBuilder;
}());
function patchTupletNumber(base, builder) { return builder(new TupletNumberBuilder(base)).patch(); }
exports.patchTupletNumber = patchTupletNumber;
function buildTupletNumber(builder) { return builder(new TupletNumberBuilder()).build(); }
exports.buildTupletNumber = buildTupletNumber;
var TupletTypeBuilder = (function () {
    function TupletTypeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TupletType";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return TupletTypeBuilder;
}());
function patchTupletType(base, builder) { return builder(new TupletTypeBuilder(base)).patch(); }
exports.patchTupletType = patchTupletType;
function buildTupletType(builder) { return builder(new TupletTypeBuilder()).build(); }
exports.buildTupletType = buildTupletType;
var TupletDotBuilder = (function () {
    function TupletDotBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TupletDot";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return TupletDotBuilder;
}());
function patchTupletDot(base, builder) { return builder(new TupletDotBuilder(base)).patch(); }
exports.patchTupletDot = patchTupletDot;
function buildTupletDot(builder) { return builder(new TupletDotBuilder()).build(); }
exports.buildTupletDot = buildTupletDot;
var GlissandoBuilder = (function () {
    function GlissandoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Glissando";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.normal = function (spec) {
            updates["normal"] = spec;
            delete childBuilders["normal;"];
            modifiedKeys["normal"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
    }
    return GlissandoBuilder;
}());
function patchGlissando(base, builder) { return builder(new GlissandoBuilder(base)).patch(); }
exports.patchGlissando = patchGlissando;
function buildGlissando(builder) { return builder(new GlissandoBuilder()).build(); }
exports.buildGlissando = buildGlissando;
var SlideBuilder = (function () {
    function SlideBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Slide";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.normal = function (spec) {
            updates["normal"] = spec;
            delete childBuilders["normal;"];
            modifiedKeys["normal"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.firstBeat = function (spec) {
            updates["firstBeat"] = spec;
            delete childBuilders["firstBeat;"];
            modifiedKeys["firstBeat"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
    }
    return SlideBuilder;
}());
function patchSlide(base, builder) { return builder(new SlideBuilder(base)).patch(); }
exports.patchSlide = patchSlide;
function buildSlide(builder) { return builder(new SlideBuilder()).build(); }
exports.buildSlide = buildSlide;
var OtherNotationBuilder = (function () {
    function OtherNotationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OtherNotation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return OtherNotationBuilder;
}());
function patchOtherNotation(base, builder) { return builder(new OtherNotationBuilder(base)).patch(); }
exports.patchOtherNotation = patchOtherNotation;
function buildOtherNotation(builder) { return builder(new OtherNotationBuilder()).build(); }
exports.buildOtherNotation = buildOtherNotation;
var OtherDirectionBuilder = (function () {
    function OtherDirectionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OtherDirection";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return OtherDirectionBuilder;
}());
function patchOtherDirection(base, builder) { return builder(new OtherDirectionBuilder(base)).patch(); }
exports.patchOtherDirection = patchOtherDirection;
function buildOtherDirection(builder) { return builder(new OtherDirectionBuilder()).build(); }
exports.buildOtherDirection = buildOtherDirection;
var OrnamentsBuilder = (function () {
    function OrnamentsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Ornaments";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.delayedInvertedTurn = function (build) {
            if (typeof build === 'function') {
                delete updates["delayedInvertedTurn"];
                var builder = build(new DelayedInvertedTurnBuilder(original && original["delayedInvertedTurn"]));
                if (!original)
                    updates["delayedInvertedTurn"] = builder.build();
                else
                    childBuilders["delayedInvertedTurn"] = builder;
            }
            else {
                updates.delayedInvertedTurn = build;
                delete childBuilders["delayedInvertedTurn;"];
            }
            modifiedKeys["delayedInvertedTurn"] = true;
            return _this;
        };
        this.shake = function (build) {
            if (typeof build === 'function') {
                delete updates["shake"];
                var builder = build(new ShakeBuilder(original && original["shake"]));
                if (!original)
                    updates["shake"] = builder.build();
                else
                    childBuilders["shake"] = builder;
            }
            else {
                updates.shake = build;
                delete childBuilders["shake;"];
            }
            modifiedKeys["shake"] = true;
            return _this;
        };
        this.turn = function (build) {
            if (typeof build === 'function') {
                delete updates["turn"];
                var builder = build(new TurnBuilder(original && original["turn"]));
                if (!original)
                    updates["turn"] = builder.build();
                else
                    childBuilders["turn"] = builder;
            }
            else {
                updates.turn = build;
                delete childBuilders["turn;"];
            }
            modifiedKeys["turn"] = true;
            return _this;
        };
        this.invertedTurn = function (build) {
            if (typeof build === 'function') {
                delete updates["invertedTurn"];
                var builder = build(new InvertedTurnBuilder(original && original["invertedTurn"]));
                if (!original)
                    updates["invertedTurn"] = builder.build();
                else
                    childBuilders["invertedTurn"] = builder;
            }
            else {
                updates.invertedTurn = build;
                delete childBuilders["invertedTurn;"];
            }
            modifiedKeys["invertedTurn"] = true;
            return _this;
        };
        this.otherOrnament = function (build) {
            if (typeof build === 'function') {
                delete updates["otherOrnament"];
                var builder = build(new OtherOrnamentBuilder(original && original["otherOrnament"]));
                if (!original)
                    updates["otherOrnament"] = builder.build();
                else
                    childBuilders["otherOrnament"] = builder;
            }
            else {
                updates.otherOrnament = build;
                delete childBuilders["otherOrnament;"];
            }
            modifiedKeys["otherOrnament"] = true;
            return _this;
        };
        this.delayedTurn = function (build) {
            if (typeof build === 'function') {
                delete updates["delayedTurn"];
                var builder = build(new DelayedTurnBuilder(original && original["delayedTurn"]));
                if (!original)
                    updates["delayedTurn"] = builder.build();
                else
                    childBuilders["delayedTurn"] = builder;
            }
            else {
                updates.delayedTurn = build;
                delete childBuilders["delayedTurn;"];
            }
            modifiedKeys["delayedTurn"] = true;
            return _this;
        };
        this.verticalTurn = function (build) {
            if (typeof build === 'function') {
                delete updates["verticalTurn"];
                var builder = build(new VerticalTurnBuilder(original && original["verticalTurn"]));
                if (!original)
                    updates["verticalTurn"] = builder.build();
                else
                    childBuilders["verticalTurn"] = builder;
            }
            else {
                updates.verticalTurn = build;
                delete childBuilders["verticalTurn;"];
            }
            modifiedKeys["verticalTurn"] = true;
            return _this;
        };
        this.wavyLine = function (build) {
            if (typeof build === 'function') {
                delete updates["wavyLine"];
                var builder = build(new WavyLineBuilder(original && original["wavyLine"]));
                if (!original)
                    updates["wavyLine"] = builder.build();
                else
                    childBuilders["wavyLine"] = builder;
            }
            else {
                updates.wavyLine = build;
                delete childBuilders["wavyLine;"];
            }
            modifiedKeys["wavyLine"] = true;
            return _this;
        };
        this.tremolo = function (build) {
            if (typeof build === 'function') {
                delete updates["tremolo"];
                var builder = build(new TremoloBuilder(original && original["tremolo"]));
                if (!original)
                    updates["tremolo"] = builder.build();
                else
                    childBuilders["tremolo"] = builder;
            }
            else {
                updates.tremolo = build;
                delete childBuilders["tremolo;"];
            }
            modifiedKeys["tremolo"] = true;
            return _this;
        };
        this.accidentalMarks = function (spec) {
            updates["accidentalMarks"] = spec;
            delete childBuilders["accidentalMarks;"];
            modifiedKeys["accidentalMarks"] = true;
            return _this;
        };
        this.accidentalMarksAt = function (idx, build) {
            makeReference("accidentalMarks");
            if (frozen["accidentalMarks"][idx]) {
                throw new Error("Patching accidentalMarks." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["accidentalMarks"] && !original["accidentalMarks"]) {
                // Clone snapshot.
                patches.push({ p: ["accidentalMarks", idx], li: original._snapshot["accidentalMarks"] });
            }
            if (typeof build === 'function' && reference["accidentalMarks"][idx]) {
                var patch = build(new AccidentalMarkBuilder(reference["accidentalMarks"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["accidentalMarks", idx].concat(patch.p);
                    return patch;
                }));
                frozen["accidentalMarks"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new AccidentalMarkBuilder(reference["accidentalMarks"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["accidentalMarks", idx], li: update });
            }
            else {
                updates["accidentalMarks"] = reference["accidentalMarks"]; // TODO: Merge?
            }
            reference["accidentalMarks"][idx] = update;
            frozen["accidentalMarks"][idx] = true;
            return _this;
        };
        this.accidentalMarksSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("accidentalMarks");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["accidentalMarks"][idx]) {
                        throw new Error("Replacing accidentalMarks." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["accidentalMarks"][idx];
                    patches.push({ p: ["accidentalMarks", idx], ld: ld, li: items[idx - start] });
                    frozen["accidentalMarks"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["accidentalMarks"][idx]) {
                        throw new Error("Removing accidentalMarks." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["accidentalMarks"][idx];
                    patches.push({ p: ["accidentalMarks", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["accidentalMarks", idx], li: items[idx - start] });
                    frozen["accidentalMarks"][idx] = true;
                }
            }
            (_a = reference["accidentalMarks"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["accidentalMarks"] = reference["accidentalMarks"];
            (_b = frozen["accidentalMarks"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.trillMark = function (build) {
            if (typeof build === 'function') {
                delete updates["trillMark"];
                var builder = build(new TrillMarkBuilder(original && original["trillMark"]));
                if (!original)
                    updates["trillMark"] = builder.build();
                else
                    childBuilders["trillMark"] = builder;
            }
            else {
                updates.trillMark = build;
                delete childBuilders["trillMark;"];
            }
            modifiedKeys["trillMark"] = true;
            return _this;
        };
        this.mordent = function (build) {
            if (typeof build === 'function') {
                delete updates["mordent"];
                var builder = build(new MordentBuilder(original && original["mordent"]));
                if (!original)
                    updates["mordent"] = builder.build();
                else
                    childBuilders["mordent"] = builder;
            }
            else {
                updates.mordent = build;
                delete childBuilders["mordent;"];
            }
            modifiedKeys["mordent"] = true;
            return _this;
        };
        this.invertedMordent = function (build) {
            if (typeof build === 'function') {
                delete updates["invertedMordent"];
                var builder = build(new InvertedMordentBuilder(original && original["invertedMordent"]));
                if (!original)
                    updates["invertedMordent"] = builder.build();
                else
                    childBuilders["invertedMordent"] = builder;
            }
            else {
                updates.invertedMordent = build;
                delete childBuilders["invertedMordent;"];
            }
            modifiedKeys["invertedMordent"] = true;
            return _this;
        };
        this.schleifer = function (build) {
            if (typeof build === 'function') {
                delete updates["schleifer"];
                var builder = build(new SchleiferBuilder(original && original["schleifer"]));
                if (!original)
                    updates["schleifer"] = builder.build();
                else
                    childBuilders["schleifer"] = builder;
            }
            else {
                updates.schleifer = build;
                delete childBuilders["schleifer;"];
            }
            modifiedKeys["schleifer"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return OrnamentsBuilder;
}());
function patchOrnaments(base, builder) { return builder(new OrnamentsBuilder(base)).patch(); }
exports.patchOrnaments = patchOrnaments;
function buildOrnaments(builder) { return builder(new OrnamentsBuilder()).build(); }
exports.buildOrnaments = buildOrnaments;
var TrillMarkBuilder = (function () {
    function TrillMarkBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TrillMark";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return TrillMarkBuilder;
}());
function patchTrillMark(base, builder) { return builder(new TrillMarkBuilder(base)).patch(); }
exports.patchTrillMark = patchTrillMark;
function buildTrillMark(builder) { return builder(new TrillMarkBuilder()).build(); }
exports.buildTrillMark = buildTrillMark;
var TurnBuilder = (function () {
    function TurnBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Turn";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slash = function (spec) {
            updates["slash"] = spec;
            delete childBuilders["slash;"];
            modifiedKeys["slash"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return TurnBuilder;
}());
function patchTurn(base, builder) { return builder(new TurnBuilder(base)).patch(); }
exports.patchTurn = patchTurn;
function buildTurn(builder) { return builder(new TurnBuilder()).build(); }
exports.buildTurn = buildTurn;
var DelayedTurnBuilder = (function () {
    function DelayedTurnBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DelayedTurn";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slash = function (spec) {
            updates["slash"] = spec;
            delete childBuilders["slash;"];
            modifiedKeys["slash"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return DelayedTurnBuilder;
}());
function patchDelayedTurn(base, builder) { return builder(new DelayedTurnBuilder(base)).patch(); }
exports.patchDelayedTurn = patchDelayedTurn;
function buildDelayedTurn(builder) { return builder(new DelayedTurnBuilder()).build(); }
exports.buildDelayedTurn = buildDelayedTurn;
var InvertedTurnBuilder = (function () {
    function InvertedTurnBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "InvertedTurn";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slash = function (spec) {
            updates["slash"] = spec;
            delete childBuilders["slash;"];
            modifiedKeys["slash"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return InvertedTurnBuilder;
}());
function patchInvertedTurn(base, builder) { return builder(new InvertedTurnBuilder(base)).patch(); }
exports.patchInvertedTurn = patchInvertedTurn;
function buildInvertedTurn(builder) { return builder(new InvertedTurnBuilder()).build(); }
exports.buildInvertedTurn = buildInvertedTurn;
var DelayedInvertedTurnBuilder = (function () {
    function DelayedInvertedTurnBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DelayedInvertedTurn";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.slash = function (spec) {
            updates["slash"] = spec;
            delete childBuilders["slash;"];
            modifiedKeys["slash"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return DelayedInvertedTurnBuilder;
}());
function patchDelayedInvertedTurn(base, builder) { return builder(new DelayedInvertedTurnBuilder(base)).patch(); }
exports.patchDelayedInvertedTurn = patchDelayedInvertedTurn;
function buildDelayedInvertedTurn(builder) { return builder(new DelayedInvertedTurnBuilder()).build(); }
exports.buildDelayedInvertedTurn = buildDelayedInvertedTurn;
var VerticalTurnBuilder = (function () {
    function VerticalTurnBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "VerticalTurn";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return VerticalTurnBuilder;
}());
function patchVerticalTurn(base, builder) { return builder(new VerticalTurnBuilder(base)).patch(); }
exports.patchVerticalTurn = patchVerticalTurn;
function buildVerticalTurn(builder) { return builder(new VerticalTurnBuilder()).build(); }
exports.buildVerticalTurn = buildVerticalTurn;
var ShakeBuilder = (function () {
    function ShakeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Shake";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return ShakeBuilder;
}());
function patchShake(base, builder) { return builder(new ShakeBuilder(base)).patch(); }
exports.patchShake = patchShake;
function buildShake(builder) { return builder(new ShakeBuilder()).build(); }
exports.buildShake = buildShake;
var MordentBuilder = (function () {
    function MordentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Mordent";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.long = function (spec) {
            updates["long"] = spec;
            delete childBuilders["long;"];
            modifiedKeys["long"] = true;
            return _this;
        };
        this.approach = function (spec) {
            updates["approach"] = spec;
            delete childBuilders["approach;"];
            modifiedKeys["approach"] = true;
            return _this;
        };
        this.departure = function (spec) {
            updates["departure"] = spec;
            delete childBuilders["departure;"];
            modifiedKeys["departure"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return MordentBuilder;
}());
function patchMordent(base, builder) { return builder(new MordentBuilder(base)).patch(); }
exports.patchMordent = patchMordent;
function buildMordent(builder) { return builder(new MordentBuilder()).build(); }
exports.buildMordent = buildMordent;
var InvertedMordentBuilder = (function () {
    function InvertedMordentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "InvertedMordent";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.long = function (spec) {
            updates["long"] = spec;
            delete childBuilders["long;"];
            modifiedKeys["long"] = true;
            return _this;
        };
        this.approach = function (spec) {
            updates["approach"] = spec;
            delete childBuilders["approach;"];
            modifiedKeys["approach"] = true;
            return _this;
        };
        this.departure = function (spec) {
            updates["departure"] = spec;
            delete childBuilders["departure;"];
            modifiedKeys["departure"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.startNote = function (spec) {
            updates["startNote"] = spec;
            delete childBuilders["startNote;"];
            modifiedKeys["startNote"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
        this.trillStep = function (spec) {
            updates["trillStep"] = spec;
            delete childBuilders["trillStep;"];
            modifiedKeys["trillStep"] = true;
            return _this;
        };
        this.twoNoteTurn = function (spec) {
            updates["twoNoteTurn"] = spec;
            delete childBuilders["twoNoteTurn;"];
            modifiedKeys["twoNoteTurn"] = true;
            return _this;
        };
        this.secondBeat = function (spec) {
            updates["secondBeat"] = spec;
            delete childBuilders["secondBeat;"];
            modifiedKeys["secondBeat"] = true;
            return _this;
        };
    }
    return InvertedMordentBuilder;
}());
function patchInvertedMordent(base, builder) { return builder(new InvertedMordentBuilder(base)).patch(); }
exports.patchInvertedMordent = patchInvertedMordent;
function buildInvertedMordent(builder) { return builder(new InvertedMordentBuilder()).build(); }
exports.buildInvertedMordent = buildInvertedMordent;
var SchleiferBuilder = (function () {
    function SchleiferBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Schleifer";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return SchleiferBuilder;
}());
function patchSchleifer(base, builder) { return builder(new SchleiferBuilder(base)).patch(); }
exports.patchSchleifer = patchSchleifer;
function buildSchleifer(builder) { return builder(new SchleiferBuilder()).build(); }
exports.buildSchleifer = buildSchleifer;
var TremoloBuilder = (function () {
    function TremoloBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Tremolo";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return TremoloBuilder;
}());
function patchTremolo(base, builder) { return builder(new TremoloBuilder(base)).patch(); }
exports.patchTremolo = patchTremolo;
function buildTremolo(builder) { return builder(new TremoloBuilder()).build(); }
exports.buildTremolo = buildTremolo;
var OtherOrnamentBuilder = (function () {
    function OtherOrnamentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OtherOrnament";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return OtherOrnamentBuilder;
}());
function patchOtherOrnament(base, builder) { return builder(new OtherOrnamentBuilder(base)).patch(); }
exports.patchOtherOrnament = patchOtherOrnament;
function buildOtherOrnament(builder) { return builder(new OtherOrnamentBuilder()).build(); }
exports.buildOtherOrnament = buildOtherOrnament;
var AccidentalMarkBuilder = (function () {
    function AccidentalMarkBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["mark"]) ||
                childBuilders["mark"] !== undefined ||
                updates.mark !== undefined, "mark is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "AccidentalMark";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.mark = function (spec) {
            updates["mark"] = spec;
            delete childBuilders["mark;"];
            modifiedKeys["mark"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return AccidentalMarkBuilder;
}());
function patchAccidentalMark(base, builder) { return builder(new AccidentalMarkBuilder(base)).patch(); }
exports.patchAccidentalMark = patchAccidentalMark;
function buildAccidentalMark(builder) { return builder(new AccidentalMarkBuilder()).build(); }
exports.buildAccidentalMark = buildAccidentalMark;
var TechnicalBuilder = (function () {
    function TechnicalBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Technical";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tripleTongue = function (build) {
            if (typeof build === 'function') {
                delete updates["tripleTongue"];
                var builder = build(new TripleTongueBuilder(original && original["tripleTongue"]));
                if (!original)
                    updates["tripleTongue"] = builder.build();
                else
                    childBuilders["tripleTongue"] = builder;
            }
            else {
                updates.tripleTongue = build;
                delete childBuilders["tripleTongue;"];
            }
            modifiedKeys["tripleTongue"] = true;
            return _this;
        };
        this.toe = function (build) {
            if (typeof build === 'function') {
                delete updates["toe"];
                var builder = build(new ToeBuilder(original && original["toe"]));
                if (!original)
                    updates["toe"] = builder.build();
                else
                    childBuilders["toe"] = builder;
            }
            else {
                updates.toe = build;
                delete childBuilders["toe;"];
            }
            modifiedKeys["toe"] = true;
            return _this;
        };
        this.hole = function (build) {
            if (typeof build === 'function') {
                delete updates["hole"];
                var builder = build(new HoleBuilder(original && original["hole"]));
                if (!original)
                    updates["hole"] = builder.build();
                else
                    childBuilders["hole"] = builder;
            }
            else {
                updates.hole = build;
                delete childBuilders["hole;"];
            }
            modifiedKeys["hole"] = true;
            return _this;
        };
        this.hammerOn = function (build) {
            if (typeof build === 'function') {
                delete updates["hammerOn"];
                var builder = build(new HammerOnBuilder(original && original["hammerOn"]));
                if (!original)
                    updates["hammerOn"] = builder.build();
                else
                    childBuilders["hammerOn"] = builder;
            }
            else {
                updates.hammerOn = build;
                delete childBuilders["hammerOn;"];
            }
            modifiedKeys["hammerOn"] = true;
            return _this;
        };
        this.upBow = function (build) {
            if (typeof build === 'function') {
                delete updates["upBow"];
                var builder = build(new UpBowBuilder(original && original["upBow"]));
                if (!original)
                    updates["upBow"] = builder.build();
                else
                    childBuilders["upBow"] = builder;
            }
            else {
                updates.upBow = build;
                delete childBuilders["upBow;"];
            }
            modifiedKeys["upBow"] = true;
            return _this;
        };
        this.downBow = function (build) {
            if (typeof build === 'function') {
                delete updates["downBow"];
                var builder = build(new DownBowBuilder(original && original["downBow"]));
                if (!original)
                    updates["downBow"] = builder.build();
                else
                    childBuilders["downBow"] = builder;
            }
            else {
                updates.downBow = build;
                delete childBuilders["downBow;"];
            }
            modifiedKeys["downBow"] = true;
            return _this;
        };
        this.fret = function (build) {
            if (typeof build === 'function') {
                delete updates["fret"];
                var builder = build(new FretBuilder(original && original["fret"]));
                if (!original)
                    updates["fret"] = builder.build();
                else
                    childBuilders["fret"] = builder;
            }
            else {
                updates.fret = build;
                delete childBuilders["fret;"];
            }
            modifiedKeys["fret"] = true;
            return _this;
        };
        this.tap = function (build) {
            if (typeof build === 'function') {
                delete updates["tap"];
                var builder = build(new TapBuilder(original && original["tap"]));
                if (!original)
                    updates["tap"] = builder.build();
                else
                    childBuilders["tap"] = builder;
            }
            else {
                updates.tap = build;
                delete childBuilders["tap;"];
            }
            modifiedKeys["tap"] = true;
            return _this;
        };
        this.pullOff = function (build) {
            if (typeof build === 'function') {
                delete updates["pullOff"];
                var builder = build(new PullOffBuilder(original && original["pullOff"]));
                if (!original)
                    updates["pullOff"] = builder.build();
                else
                    childBuilders["pullOff"] = builder;
            }
            else {
                updates.pullOff = build;
                delete childBuilders["pullOff;"];
            }
            modifiedKeys["pullOff"] = true;
            return _this;
        };
        this.handbell = function (build) {
            if (typeof build === 'function') {
                delete updates["handbell"];
                var builder = build(new HandbellBuilder(original && original["handbell"]));
                if (!original)
                    updates["handbell"] = builder.build();
                else
                    childBuilders["handbell"] = builder;
            }
            else {
                updates.handbell = build;
                delete childBuilders["handbell;"];
            }
            modifiedKeys["handbell"] = true;
            return _this;
        };
        this.bend = function (build) {
            if (typeof build === 'function') {
                delete updates["bend"];
                var builder = build(new BendBuilder(original && original["bend"]));
                if (!original)
                    updates["bend"] = builder.build();
                else
                    childBuilders["bend"] = builder;
            }
            else {
                updates.bend = build;
                delete childBuilders["bend;"];
            }
            modifiedKeys["bend"] = true;
            return _this;
        };
        this.thumbPosition = function (build) {
            if (typeof build === 'function') {
                delete updates["thumbPosition"];
                var builder = build(new ThumbPositionBuilder(original && original["thumbPosition"]));
                if (!original)
                    updates["thumbPosition"] = builder.build();
                else
                    childBuilders["thumbPosition"] = builder;
            }
            else {
                updates.thumbPosition = build;
                delete childBuilders["thumbPosition;"];
            }
            modifiedKeys["thumbPosition"] = true;
            return _this;
        };
        this.stopped = function (build) {
            if (typeof build === 'function') {
                delete updates["stopped"];
                var builder = build(new StoppedBuilder(original && original["stopped"]));
                if (!original)
                    updates["stopped"] = builder.build();
                else
                    childBuilders["stopped"] = builder;
            }
            else {
                updates.stopped = build;
                delete childBuilders["stopped;"];
            }
            modifiedKeys["stopped"] = true;
            return _this;
        };
        this.pluck = function (build) {
            if (typeof build === 'function') {
                delete updates["pluck"];
                var builder = build(new PluckBuilder(original && original["pluck"]));
                if (!original)
                    updates["pluck"] = builder.build();
                else
                    childBuilders["pluck"] = builder;
            }
            else {
                updates.pluck = build;
                delete childBuilders["pluck;"];
            }
            modifiedKeys["pluck"] = true;
            return _this;
        };
        this.doubleTongue = function (build) {
            if (typeof build === 'function') {
                delete updates["doubleTongue"];
                var builder = build(new DoubleTongueBuilder(original && original["doubleTongue"]));
                if (!original)
                    updates["doubleTongue"] = builder.build();
                else
                    childBuilders["doubleTongue"] = builder;
            }
            else {
                updates.doubleTongue = build;
                delete childBuilders["doubleTongue;"];
            }
            modifiedKeys["doubleTongue"] = true;
            return _this;
        };
        this.string = function (build) {
            if (typeof build === 'function') {
                delete updates["string"];
                var builder = build(new StringBuilder(original && original["string"]));
                if (!original)
                    updates["string"] = builder.build();
                else
                    childBuilders["string"] = builder;
            }
            else {
                updates.string = build;
                delete childBuilders["string;"];
            }
            modifiedKeys["string"] = true;
            return _this;
        };
        this.openString = function (build) {
            if (typeof build === 'function') {
                delete updates["openString"];
                var builder = build(new OpenStringBuilder(original && original["openString"]));
                if (!original)
                    updates["openString"] = builder.build();
                else
                    childBuilders["openString"] = builder;
            }
            else {
                updates.openString = build;
                delete childBuilders["openString;"];
            }
            modifiedKeys["openString"] = true;
            return _this;
        };
        this.fingernails = function (build) {
            if (typeof build === 'function') {
                delete updates["fingernails"];
                var builder = build(new FingernailsBuilder(original && original["fingernails"]));
                if (!original)
                    updates["fingernails"] = builder.build();
                else
                    childBuilders["fingernails"] = builder;
            }
            else {
                updates.fingernails = build;
                delete childBuilders["fingernails;"];
            }
            modifiedKeys["fingernails"] = true;
            return _this;
        };
        this.arrow = function (build) {
            if (typeof build === 'function') {
                delete updates["arrow"];
                var builder = build(new ArrowBuilder(original && original["arrow"]));
                if (!original)
                    updates["arrow"] = builder.build();
                else
                    childBuilders["arrow"] = builder;
            }
            else {
                updates.arrow = build;
                delete childBuilders["arrow;"];
            }
            modifiedKeys["arrow"] = true;
            return _this;
        };
        this.harmonic = function (build) {
            if (typeof build === 'function') {
                delete updates["harmonic"];
                var builder = build(new HarmonicBuilder(original && original["harmonic"]));
                if (!original)
                    updates["harmonic"] = builder.build();
                else
                    childBuilders["harmonic"] = builder;
            }
            else {
                updates.harmonic = build;
                delete childBuilders["harmonic;"];
            }
            modifiedKeys["harmonic"] = true;
            return _this;
        };
        this.heel = function (build) {
            if (typeof build === 'function') {
                delete updates["heel"];
                var builder = build(new HeelBuilder(original && original["heel"]));
                if (!original)
                    updates["heel"] = builder.build();
                else
                    childBuilders["heel"] = builder;
            }
            else {
                updates.heel = build;
                delete childBuilders["heel;"];
            }
            modifiedKeys["heel"] = true;
            return _this;
        };
        this.otherTechnical = function (build) {
            if (typeof build === 'function') {
                delete updates["otherTechnical"];
                var builder = build(new OtherTechnicalBuilder(original && original["otherTechnical"]));
                if (!original)
                    updates["otherTechnical"] = builder.build();
                else
                    childBuilders["otherTechnical"] = builder;
            }
            else {
                updates.otherTechnical = build;
                delete childBuilders["otherTechnical;"];
            }
            modifiedKeys["otherTechnical"] = true;
            return _this;
        };
        this.snapPizzicato = function (build) {
            if (typeof build === 'function') {
                delete updates["snapPizzicato"];
                var builder = build(new SnapPizzicatoBuilder(original && original["snapPizzicato"]));
                if (!original)
                    updates["snapPizzicato"] = builder.build();
                else
                    childBuilders["snapPizzicato"] = builder;
            }
            else {
                updates.snapPizzicato = build;
                delete childBuilders["snapPizzicato;"];
            }
            modifiedKeys["snapPizzicato"] = true;
            return _this;
        };
        this.fingering = function (build) {
            if (typeof build === 'function') {
                delete updates["fingering"];
                var builder = build(new FingeringBuilder(original && original["fingering"]));
                if (!original)
                    updates["fingering"] = builder.build();
                else
                    childBuilders["fingering"] = builder;
            }
            else {
                updates.fingering = build;
                delete childBuilders["fingering;"];
            }
            modifiedKeys["fingering"] = true;
            return _this;
        };
    }
    return TechnicalBuilder;
}());
function patchTechnical(base, builder) { return builder(new TechnicalBuilder(base)).patch(); }
exports.patchTechnical = patchTechnical;
function buildTechnical(builder) { return builder(new TechnicalBuilder()).build(); }
exports.buildTechnical = buildTechnical;
var UpBowBuilder = (function () {
    function UpBowBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "UpBow";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return UpBowBuilder;
}());
function patchUpBow(base, builder) { return builder(new UpBowBuilder(base)).patch(); }
exports.patchUpBow = patchUpBow;
function buildUpBow(builder) { return builder(new UpBowBuilder()).build(); }
exports.buildUpBow = buildUpBow;
var DownBowBuilder = (function () {
    function DownBowBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DownBow";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return DownBowBuilder;
}());
function patchDownBow(base, builder) { return builder(new DownBowBuilder(base)).patch(); }
exports.patchDownBow = patchDownBow;
function buildDownBow(builder) { return builder(new DownBowBuilder()).build(); }
exports.buildDownBow = buildDownBow;
var HarmonicBuilder = (function () {
    function HarmonicBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["artificial"]) ||
                childBuilders["artificial"] !== undefined ||
                updates.artificial !== undefined, "artificial is a required field");
            console.assert((original && !modifiedKeys["touchingPitch"]) ||
                childBuilders["touchingPitch"] !== undefined ||
                updates.touchingPitch !== undefined, "touchingPitch is a required field");
            console.assert((original && !modifiedKeys["soundingPitch"]) ||
                childBuilders["soundingPitch"] !== undefined ||
                updates.soundingPitch !== undefined, "soundingPitch is a required field");
            console.assert((original && !modifiedKeys["natural"]) ||
                childBuilders["natural"] !== undefined ||
                updates.natural !== undefined, "natural is a required field");
            console.assert((original && !modifiedKeys["basePitch"]) ||
                childBuilders["basePitch"] !== undefined ||
                updates.basePitch !== undefined, "basePitch is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Harmonic";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.artificial = function (spec) {
            updates["artificial"] = spec;
            delete childBuilders["artificial;"];
            modifiedKeys["artificial"] = true;
            return _this;
        };
        this.touchingPitch = function (spec) {
            updates["touchingPitch"] = spec;
            delete childBuilders["touchingPitch;"];
            modifiedKeys["touchingPitch"] = true;
            return _this;
        };
        this.soundingPitch = function (spec) {
            updates["soundingPitch"] = spec;
            delete childBuilders["soundingPitch;"];
            modifiedKeys["soundingPitch"] = true;
            return _this;
        };
        this.natural = function (spec) {
            updates["natural"] = spec;
            delete childBuilders["natural;"];
            modifiedKeys["natural"] = true;
            return _this;
        };
        this.basePitch = function (spec) {
            updates["basePitch"] = spec;
            delete childBuilders["basePitch;"];
            modifiedKeys["basePitch"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return HarmonicBuilder;
}());
function patchHarmonic(base, builder) { return builder(new HarmonicBuilder(base)).patch(); }
exports.patchHarmonic = patchHarmonic;
function buildHarmonic(builder) { return builder(new HarmonicBuilder()).build(); }
exports.buildHarmonic = buildHarmonic;
var OpenStringBuilder = (function () {
    function OpenStringBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OpenString";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return OpenStringBuilder;
}());
function patchOpenString(base, builder) { return builder(new OpenStringBuilder(base)).patch(); }
exports.patchOpenString = patchOpenString;
function buildOpenString(builder) { return builder(new OpenStringBuilder()).build(); }
exports.buildOpenString = buildOpenString;
var ThumbPositionBuilder = (function () {
    function ThumbPositionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "ThumbPosition";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return ThumbPositionBuilder;
}());
function patchThumbPosition(base, builder) { return builder(new ThumbPositionBuilder(base)).patch(); }
exports.patchThumbPosition = patchThumbPosition;
function buildThumbPosition(builder) { return builder(new ThumbPositionBuilder()).build(); }
exports.buildThumbPosition = buildThumbPosition;
var PluckBuilder = (function () {
    function PluckBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Pluck";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return PluckBuilder;
}());
function patchPluck(base, builder) { return builder(new PluckBuilder(base)).patch(); }
exports.patchPluck = patchPluck;
function buildPluck(builder) { return builder(new PluckBuilder()).build(); }
exports.buildPluck = buildPluck;
var DoubleTongueBuilder = (function () {
    function DoubleTongueBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DoubleTongue";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return DoubleTongueBuilder;
}());
function patchDoubleTongue(base, builder) { return builder(new DoubleTongueBuilder(base)).patch(); }
exports.patchDoubleTongue = patchDoubleTongue;
function buildDoubleTongue(builder) { return builder(new DoubleTongueBuilder()).build(); }
exports.buildDoubleTongue = buildDoubleTongue;
var TripleTongueBuilder = (function () {
    function TripleTongueBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "TripleTongue";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return TripleTongueBuilder;
}());
function patchTripleTongue(base, builder) { return builder(new TripleTongueBuilder(base)).patch(); }
exports.patchTripleTongue = patchTripleTongue;
function buildTripleTongue(builder) { return builder(new TripleTongueBuilder()).build(); }
exports.buildTripleTongue = buildTripleTongue;
var StoppedBuilder = (function () {
    function StoppedBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Stopped";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return StoppedBuilder;
}());
function patchStopped(base, builder) { return builder(new StoppedBuilder(base)).patch(); }
exports.patchStopped = patchStopped;
function buildStopped(builder) { return builder(new StoppedBuilder()).build(); }
exports.buildStopped = buildStopped;
var SnapPizzicatoBuilder = (function () {
    function SnapPizzicatoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "SnapPizzicato";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return SnapPizzicatoBuilder;
}());
function patchSnapPizzicato(base, builder) { return builder(new SnapPizzicatoBuilder(base)).patch(); }
exports.patchSnapPizzicato = patchSnapPizzicato;
function buildSnapPizzicato(builder) { return builder(new SnapPizzicatoBuilder()).build(); }
exports.buildSnapPizzicato = buildSnapPizzicato;
var HammerOnBuilder = (function () {
    function HammerOnBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "HammerOn";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return HammerOnBuilder;
}());
function patchHammerOn(base, builder) { return builder(new HammerOnBuilder(base)).patch(); }
exports.patchHammerOn = patchHammerOn;
function buildHammerOn(builder) { return builder(new HammerOnBuilder()).build(); }
exports.buildHammerOn = buildHammerOn;
var PullOffBuilder = (function () {
    function PullOffBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PullOff";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return PullOffBuilder;
}());
function patchPullOff(base, builder) { return builder(new PullOffBuilder(base)).patch(); }
exports.patchPullOff = patchPullOff;
function buildPullOff(builder) { return builder(new PullOffBuilder()).build(); }
exports.buildPullOff = buildPullOff;
var BendBuilder = (function () {
    function BendBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["bendAlter"]) ||
                childBuilders["bendAlter"] !== undefined ||
                updates.bendAlter !== undefined, "bendAlter is a required field");
            console.assert((original && !modifiedKeys["preBend"]) ||
                childBuilders["preBend"] !== undefined ||
                updates.preBend !== undefined, "preBend is a required field");
            console.assert((original && !modifiedKeys["release"]) ||
                childBuilders["release"] !== undefined ||
                updates.release !== undefined, "release is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Bend";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.bendAlter = function (spec) {
            updates["bendAlter"] = spec;
            delete childBuilders["bendAlter;"];
            modifiedKeys["bendAlter"] = true;
            return _this;
        };
        this.withBar = function (build) {
            if (typeof build === 'function') {
                delete updates["withBar"];
                var builder = build(new WithBarBuilder(original && original["withBar"]));
                if (!original)
                    updates["withBar"] = builder.build();
                else
                    childBuilders["withBar"] = builder;
            }
            else {
                updates.withBar = build;
                delete childBuilders["withBar;"];
            }
            modifiedKeys["withBar"] = true;
            return _this;
        };
        this.preBend = function (spec) {
            updates["preBend"] = spec;
            delete childBuilders["preBend;"];
            modifiedKeys["preBend"] = true;
            return _this;
        };
        this.release = function (spec) {
            updates["release"] = spec;
            delete childBuilders["release;"];
            modifiedKeys["release"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.accelerate = function (spec) {
            updates["accelerate"] = spec;
            delete childBuilders["accelerate;"];
            modifiedKeys["accelerate"] = true;
            return _this;
        };
        this.beats = function (spec) {
            updates["beats"] = spec;
            delete childBuilders["beats;"];
            modifiedKeys["beats"] = true;
            return _this;
        };
        this.firstBeat = function (spec) {
            updates["firstBeat"] = spec;
            delete childBuilders["firstBeat;"];
            modifiedKeys["firstBeat"] = true;
            return _this;
        };
        this.lastBeat = function (spec) {
            updates["lastBeat"] = spec;
            delete childBuilders["lastBeat;"];
            modifiedKeys["lastBeat"] = true;
            return _this;
        };
    }
    return BendBuilder;
}());
function patchBend(base, builder) { return builder(new BendBuilder(base)).patch(); }
exports.patchBend = patchBend;
function buildBend(builder) { return builder(new BendBuilder()).build(); }
exports.buildBend = buildBend;
var WithBarBuilder = (function () {
    function WithBarBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "WithBar";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return WithBarBuilder;
}());
function patchWithBar(base, builder) { return builder(new WithBarBuilder(base)).patch(); }
exports.patchWithBar = patchWithBar;
function buildWithBar(builder) { return builder(new WithBarBuilder()).build(); }
exports.buildWithBar = buildWithBar;
var TapBuilder = (function () {
    function TapBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Tap";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return TapBuilder;
}());
function patchTap(base, builder) { return builder(new TapBuilder(base)).patch(); }
exports.patchTap = patchTap;
function buildTap(builder) { return builder(new TapBuilder()).build(); }
exports.buildTap = buildTap;
var HeelBuilder = (function () {
    function HeelBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Heel";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.substitution = function (spec) {
            updates["substitution"] = spec;
            delete childBuilders["substitution;"];
            modifiedKeys["substitution"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return HeelBuilder;
}());
function patchHeel(base, builder) { return builder(new HeelBuilder(base)).patch(); }
exports.patchHeel = patchHeel;
function buildHeel(builder) { return builder(new HeelBuilder()).build(); }
exports.buildHeel = buildHeel;
var ToeBuilder = (function () {
    function ToeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Toe";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.substitution = function (spec) {
            updates["substitution"] = spec;
            delete childBuilders["substitution;"];
            modifiedKeys["substitution"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return ToeBuilder;
}());
function patchToe(base, builder) { return builder(new ToeBuilder(base)).patch(); }
exports.patchToe = patchToe;
function buildToe(builder) { return builder(new ToeBuilder()).build(); }
exports.buildToe = buildToe;
var FingernailsBuilder = (function () {
    function FingernailsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Fingernails";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return FingernailsBuilder;
}());
function patchFingernails(base, builder) { return builder(new FingernailsBuilder(base)).patch(); }
exports.patchFingernails = patchFingernails;
function buildFingernails(builder) { return builder(new FingernailsBuilder()).build(); }
exports.buildFingernails = buildFingernails;
var HoleBuilder = (function () {
    function HoleBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["holeClosed"]) ||
                childBuilders["holeClosed"] !== undefined ||
                updates.holeClosed !== undefined, "holeClosed is a required field");
            console.assert((original && !modifiedKeys["holeShape"]) ||
                childBuilders["holeShape"] !== undefined ||
                updates.holeShape !== undefined, "holeShape is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Hole";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.holeClosed = function (build) {
            if (typeof build === 'function') {
                delete updates["holeClosed"];
                var builder = build(new HoleClosedBuilder(original && original["holeClosed"]));
                if (!original)
                    updates["holeClosed"] = builder.build();
                else
                    childBuilders["holeClosed"] = builder;
            }
            else {
                updates.holeClosed = build;
                delete childBuilders["holeClosed;"];
            }
            modifiedKeys["holeClosed"] = true;
            return _this;
        };
        this.holeShape = function (spec) {
            updates["holeShape"] = spec;
            delete childBuilders["holeShape;"];
            modifiedKeys["holeShape"] = true;
            return _this;
        };
        this.holeType = function (spec) {
            updates["holeType"] = spec;
            delete childBuilders["holeType;"];
            modifiedKeys["holeType"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return HoleBuilder;
}());
function patchHole(base, builder) { return builder(new HoleBuilder(base)).patch(); }
exports.patchHole = patchHole;
function buildHole(builder) { return builder(new HoleBuilder()).build(); }
exports.buildHole = buildHole;
var HoleClosedBuilder = (function () {
    function HoleClosedBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "HoleClosed";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.location = function (spec) {
            updates["location"] = spec;
            delete childBuilders["location;"];
            modifiedKeys["location"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
    }
    return HoleClosedBuilder;
}());
function patchHoleClosed(base, builder) { return builder(new HoleClosedBuilder(base)).patch(); }
exports.patchHoleClosed = patchHoleClosed;
function buildHoleClosed(builder) { return builder(new HoleClosedBuilder()).build(); }
exports.buildHoleClosed = buildHoleClosed;
var ArrowBuilder = (function () {
    function ArrowBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Arrow";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.arrowStyle = function (spec) {
            updates["arrowStyle"] = spec;
            delete childBuilders["arrowStyle;"];
            modifiedKeys["arrowStyle"] = true;
            return _this;
        };
        this.arrowDirection = function (spec) {
            updates["arrowDirection"] = spec;
            delete childBuilders["arrowDirection;"];
            modifiedKeys["arrowDirection"] = true;
            return _this;
        };
        this.circularArrow = function (spec) {
            updates["circularArrow"] = spec;
            delete childBuilders["circularArrow;"];
            modifiedKeys["circularArrow"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return ArrowBuilder;
}());
function patchArrow(base, builder) { return builder(new ArrowBuilder(base)).patch(); }
exports.patchArrow = patchArrow;
function buildArrow(builder) { return builder(new ArrowBuilder()).build(); }
exports.buildArrow = buildArrow;
var HandbellBuilder = (function () {
    function HandbellBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Handbell";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return HandbellBuilder;
}());
function patchHandbell(base, builder) { return builder(new HandbellBuilder(base)).patch(); }
exports.patchHandbell = patchHandbell;
function buildHandbell(builder) { return builder(new HandbellBuilder()).build(); }
exports.buildHandbell = buildHandbell;
var OtherTechnicalBuilder = (function () {
    function OtherTechnicalBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OtherTechnical";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return OtherTechnicalBuilder;
}());
function patchOtherTechnical(base, builder) { return builder(new OtherTechnicalBuilder(base)).patch(); }
exports.patchOtherTechnical = patchOtherTechnical;
function buildOtherTechnical(builder) { return builder(new OtherTechnicalBuilder()).build(); }
exports.buildOtherTechnical = buildOtherTechnical;
var ArticulationsBuilder = (function () {
    function ArticulationsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Articulations";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.accent = function (build) {
            if (typeof build === 'function') {
                delete updates["accent"];
                var builder = build(new AccentBuilder(original && original["accent"]));
                if (!original)
                    updates["accent"] = builder.build();
                else
                    childBuilders["accent"] = builder;
            }
            else {
                updates.accent = build;
                delete childBuilders["accent;"];
            }
            modifiedKeys["accent"] = true;
            return _this;
        };
        this.doit = function (build) {
            if (typeof build === 'function') {
                delete updates["doit"];
                var builder = build(new DoitBuilder(original && original["doit"]));
                if (!original)
                    updates["doit"] = builder.build();
                else
                    childBuilders["doit"] = builder;
            }
            else {
                updates.doit = build;
                delete childBuilders["doit;"];
            }
            modifiedKeys["doit"] = true;
            return _this;
        };
        this.breathMark = function (build) {
            if (typeof build === 'function') {
                delete updates["breathMark"];
                var builder = build(new BreathMarkBuilder(original && original["breathMark"]));
                if (!original)
                    updates["breathMark"] = builder.build();
                else
                    childBuilders["breathMark"] = builder;
            }
            else {
                updates.breathMark = build;
                delete childBuilders["breathMark;"];
            }
            modifiedKeys["breathMark"] = true;
            return _this;
        };
        this.otherArticulations = function (spec) {
            updates["otherArticulations"] = spec;
            delete childBuilders["otherArticulations;"];
            modifiedKeys["otherArticulations"] = true;
            return _this;
        };
        this.otherArticulationsAt = function (idx, build) {
            makeReference("otherArticulations");
            if (frozen["otherArticulations"][idx]) {
                throw new Error("Patching otherArticulations." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["otherArticulations"] && !original["otherArticulations"]) {
                // Clone snapshot.
                patches.push({ p: ["otherArticulations", idx], li: original._snapshot["otherArticulations"] });
            }
            if (typeof build === 'function' && reference["otherArticulations"][idx]) {
                var patch = build(new OtherArticulationBuilder(reference["otherArticulations"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["otherArticulations", idx].concat(patch.p);
                    return patch;
                }));
                frozen["otherArticulations"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new OtherArticulationBuilder(reference["otherArticulations"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["otherArticulations", idx], li: update });
            }
            else {
                updates["otherArticulations"] = reference["otherArticulations"]; // TODO: Merge?
            }
            reference["otherArticulations"][idx] = update;
            frozen["otherArticulations"][idx] = true;
            return _this;
        };
        this.otherArticulationsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("otherArticulations");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["otherArticulations"][idx]) {
                        throw new Error("Replacing otherArticulations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["otherArticulations"][idx];
                    patches.push({ p: ["otherArticulations", idx], ld: ld, li: items[idx - start] });
                    frozen["otherArticulations"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["otherArticulations"][idx]) {
                        throw new Error("Removing otherArticulations." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["otherArticulations"][idx];
                    patches.push({ p: ["otherArticulations", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["otherArticulations", idx], li: items[idx - start] });
                    frozen["otherArticulations"][idx] = true;
                }
            }
            (_a = reference["otherArticulations"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["otherArticulations"] = reference["otherArticulations"];
            (_b = frozen["otherArticulations"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.detachedLegato = function (build) {
            if (typeof build === 'function') {
                delete updates["detachedLegato"];
                var builder = build(new DetachedLegatoBuilder(original && original["detachedLegato"]));
                if (!original)
                    updates["detachedLegato"] = builder.build();
                else
                    childBuilders["detachedLegato"] = builder;
            }
            else {
                updates.detachedLegato = build;
                delete childBuilders["detachedLegato;"];
            }
            modifiedKeys["detachedLegato"] = true;
            return _this;
        };
        this.staccatissimo = function (build) {
            if (typeof build === 'function') {
                delete updates["staccatissimo"];
                var builder = build(new StaccatissimoBuilder(original && original["staccatissimo"]));
                if (!original)
                    updates["staccatissimo"] = builder.build();
                else
                    childBuilders["staccatissimo"] = builder;
            }
            else {
                updates.staccatissimo = build;
                delete childBuilders["staccatissimo;"];
            }
            modifiedKeys["staccatissimo"] = true;
            return _this;
        };
        this.plop = function (build) {
            if (typeof build === 'function') {
                delete updates["plop"];
                var builder = build(new PlopBuilder(original && original["plop"]));
                if (!original)
                    updates["plop"] = builder.build();
                else
                    childBuilders["plop"] = builder;
            }
            else {
                updates.plop = build;
                delete childBuilders["plop;"];
            }
            modifiedKeys["plop"] = true;
            return _this;
        };
        this.unstress = function (build) {
            if (typeof build === 'function') {
                delete updates["unstress"];
                var builder = build(new UnstressBuilder(original && original["unstress"]));
                if (!original)
                    updates["unstress"] = builder.build();
                else
                    childBuilders["unstress"] = builder;
            }
            else {
                updates.unstress = build;
                delete childBuilders["unstress;"];
            }
            modifiedKeys["unstress"] = true;
            return _this;
        };
        this.strongAccent = function (build) {
            if (typeof build === 'function') {
                delete updates["strongAccent"];
                var builder = build(new StrongAccentBuilder(original && original["strongAccent"]));
                if (!original)
                    updates["strongAccent"] = builder.build();
                else
                    childBuilders["strongAccent"] = builder;
            }
            else {
                updates.strongAccent = build;
                delete childBuilders["strongAccent;"];
            }
            modifiedKeys["strongAccent"] = true;
            return _this;
        };
        this.staccato = function (build) {
            if (typeof build === 'function') {
                delete updates["staccato"];
                var builder = build(new StaccatoBuilder(original && original["staccato"]));
                if (!original)
                    updates["staccato"] = builder.build();
                else
                    childBuilders["staccato"] = builder;
            }
            else {
                updates.staccato = build;
                delete childBuilders["staccato;"];
            }
            modifiedKeys["staccato"] = true;
            return _this;
        };
        this.spiccato = function (build) {
            if (typeof build === 'function') {
                delete updates["spiccato"];
                var builder = build(new SpiccatoBuilder(original && original["spiccato"]));
                if (!original)
                    updates["spiccato"] = builder.build();
                else
                    childBuilders["spiccato"] = builder;
            }
            else {
                updates.spiccato = build;
                delete childBuilders["spiccato;"];
            }
            modifiedKeys["spiccato"] = true;
            return _this;
        };
        this.scoop = function (build) {
            if (typeof build === 'function') {
                delete updates["scoop"];
                var builder = build(new ScoopBuilder(original && original["scoop"]));
                if (!original)
                    updates["scoop"] = builder.build();
                else
                    childBuilders["scoop"] = builder;
            }
            else {
                updates.scoop = build;
                delete childBuilders["scoop;"];
            }
            modifiedKeys["scoop"] = true;
            return _this;
        };
        this.falloff = function (build) {
            if (typeof build === 'function') {
                delete updates["falloff"];
                var builder = build(new FalloffBuilder(original && original["falloff"]));
                if (!original)
                    updates["falloff"] = builder.build();
                else
                    childBuilders["falloff"] = builder;
            }
            else {
                updates.falloff = build;
                delete childBuilders["falloff;"];
            }
            modifiedKeys["falloff"] = true;
            return _this;
        };
        this.caesura = function (build) {
            if (typeof build === 'function') {
                delete updates["caesura"];
                var builder = build(new CaesuraBuilder(original && original["caesura"]));
                if (!original)
                    updates["caesura"] = builder.build();
                else
                    childBuilders["caesura"] = builder;
            }
            else {
                updates.caesura = build;
                delete childBuilders["caesura;"];
            }
            modifiedKeys["caesura"] = true;
            return _this;
        };
        this.stress = function (build) {
            if (typeof build === 'function') {
                delete updates["stress"];
                var builder = build(new StressBuilder(original && original["stress"]));
                if (!original)
                    updates["stress"] = builder.build();
                else
                    childBuilders["stress"] = builder;
            }
            else {
                updates.stress = build;
                delete childBuilders["stress;"];
            }
            modifiedKeys["stress"] = true;
            return _this;
        };
        this.tenuto = function (build) {
            if (typeof build === 'function') {
                delete updates["tenuto"];
                var builder = build(new TenutoBuilder(original && original["tenuto"]));
                if (!original)
                    updates["tenuto"] = builder.build();
                else
                    childBuilders["tenuto"] = builder;
            }
            else {
                updates.tenuto = build;
                delete childBuilders["tenuto;"];
            }
            modifiedKeys["tenuto"] = true;
            return _this;
        };
    }
    return ArticulationsBuilder;
}());
function patchArticulations(base, builder) { return builder(new ArticulationsBuilder(base)).patch(); }
exports.patchArticulations = patchArticulations;
function buildArticulations(builder) { return builder(new ArticulationsBuilder()).build(); }
exports.buildArticulations = buildArticulations;
var AccentBuilder = (function () {
    function AccentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Accent";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return AccentBuilder;
}());
function patchAccent(base, builder) { return builder(new AccentBuilder(base)).patch(); }
exports.patchAccent = patchAccent;
function buildAccent(builder) { return builder(new AccentBuilder()).build(); }
exports.buildAccent = buildAccent;
var StrongAccentBuilder = (function () {
    function StrongAccentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "StrongAccent";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return StrongAccentBuilder;
}());
function patchStrongAccent(base, builder) { return builder(new StrongAccentBuilder(base)).patch(); }
exports.patchStrongAccent = patchStrongAccent;
function buildStrongAccent(builder) { return builder(new StrongAccentBuilder()).build(); }
exports.buildStrongAccent = buildStrongAccent;
var StaccatoBuilder = (function () {
    function StaccatoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Staccato";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return StaccatoBuilder;
}());
function patchStaccato(base, builder) { return builder(new StaccatoBuilder(base)).patch(); }
exports.patchStaccato = patchStaccato;
function buildStaccato(builder) { return builder(new StaccatoBuilder()).build(); }
exports.buildStaccato = buildStaccato;
var TenutoBuilder = (function () {
    function TenutoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Tenuto";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return TenutoBuilder;
}());
function patchTenuto(base, builder) { return builder(new TenutoBuilder(base)).patch(); }
exports.patchTenuto = patchTenuto;
function buildTenuto(builder) { return builder(new TenutoBuilder()).build(); }
exports.buildTenuto = buildTenuto;
var DetachedLegatoBuilder = (function () {
    function DetachedLegatoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DetachedLegato";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return DetachedLegatoBuilder;
}());
function patchDetachedLegato(base, builder) { return builder(new DetachedLegatoBuilder(base)).patch(); }
exports.patchDetachedLegato = patchDetachedLegato;
function buildDetachedLegato(builder) { return builder(new DetachedLegatoBuilder()).build(); }
exports.buildDetachedLegato = buildDetachedLegato;
var StaccatissimoBuilder = (function () {
    function StaccatissimoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Staccatissimo";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return StaccatissimoBuilder;
}());
function patchStaccatissimo(base, builder) { return builder(new StaccatissimoBuilder(base)).patch(); }
exports.patchStaccatissimo = patchStaccatissimo;
function buildStaccatissimo(builder) { return builder(new StaccatissimoBuilder()).build(); }
exports.buildStaccatissimo = buildStaccatissimo;
var SpiccatoBuilder = (function () {
    function SpiccatoBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Spiccato";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return SpiccatoBuilder;
}());
function patchSpiccato(base, builder) { return builder(new SpiccatoBuilder(base)).patch(); }
exports.patchSpiccato = patchSpiccato;
function buildSpiccato(builder) { return builder(new SpiccatoBuilder()).build(); }
exports.buildSpiccato = buildSpiccato;
var ScoopBuilder = (function () {
    function ScoopBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Scoop";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return ScoopBuilder;
}());
function patchScoop(base, builder) { return builder(new ScoopBuilder(base)).patch(); }
exports.patchScoop = patchScoop;
function buildScoop(builder) { return builder(new ScoopBuilder()).build(); }
exports.buildScoop = buildScoop;
var PlopBuilder = (function () {
    function PlopBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Plop";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return PlopBuilder;
}());
function patchPlop(base, builder) { return builder(new PlopBuilder(base)).patch(); }
exports.patchPlop = patchPlop;
function buildPlop(builder) { return builder(new PlopBuilder()).build(); }
exports.buildPlop = buildPlop;
var DoitBuilder = (function () {
    function DoitBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Doit";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return DoitBuilder;
}());
function patchDoit(base, builder) { return builder(new DoitBuilder(base)).patch(); }
exports.patchDoit = patchDoit;
function buildDoit(builder) { return builder(new DoitBuilder()).build(); }
exports.buildDoit = buildDoit;
var FalloffBuilder = (function () {
    function FalloffBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Falloff";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return FalloffBuilder;
}());
function patchFalloff(base, builder) { return builder(new FalloffBuilder(base)).patch(); }
exports.patchFalloff = patchFalloff;
function buildFalloff(builder) { return builder(new FalloffBuilder()).build(); }
exports.buildFalloff = buildFalloff;
var BreathMarkBuilder = (function () {
    function BreathMarkBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BreathMark";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
        this.lineShape = function (spec) {
            updates["lineShape"] = spec;
            delete childBuilders["lineShape;"];
            modifiedKeys["lineShape"] = true;
            return _this;
        };
    }
    return BreathMarkBuilder;
}());
function patchBreathMark(base, builder) { return builder(new BreathMarkBuilder(base)).patch(); }
exports.patchBreathMark = patchBreathMark;
function buildBreathMark(builder) { return builder(new BreathMarkBuilder()).build(); }
exports.buildBreathMark = buildBreathMark;
var CaesuraBuilder = (function () {
    function CaesuraBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Caesura";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return CaesuraBuilder;
}());
function patchCaesura(base, builder) { return builder(new CaesuraBuilder(base)).patch(); }
exports.patchCaesura = patchCaesura;
function buildCaesura(builder) { return builder(new CaesuraBuilder()).build(); }
exports.buildCaesura = buildCaesura;
var StressBuilder = (function () {
    function StressBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Stress";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return StressBuilder;
}());
function patchStress(base, builder) { return builder(new StressBuilder(base)).patch(); }
exports.patchStress = patchStress;
function buildStress(builder) { return builder(new StressBuilder()).build(); }
exports.buildStress = buildStress;
var UnstressBuilder = (function () {
    function UnstressBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Unstress";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return UnstressBuilder;
}());
function patchUnstress(base, builder) { return builder(new UnstressBuilder(base)).patch(); }
exports.patchUnstress = patchUnstress;
function buildUnstress(builder) { return builder(new UnstressBuilder()).build(); }
exports.buildUnstress = buildUnstress;
var OtherArticulationBuilder = (function () {
    function OtherArticulationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OtherArticulation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return OtherArticulationBuilder;
}());
function patchOtherArticulation(base, builder) { return builder(new OtherArticulationBuilder(base)).patch(); }
exports.patchOtherArticulation = patchOtherArticulation;
function buildOtherArticulation(builder) { return builder(new OtherArticulationBuilder()).build(); }
exports.buildOtherArticulation = buildOtherArticulation;
var ArpeggiateBuilder = (function () {
    function ArpeggiateBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Arpeggiate";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.direction = function (spec) {
            updates["direction"] = spec;
            delete childBuilders["direction;"];
            modifiedKeys["direction"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return ArpeggiateBuilder;
}());
function patchArpeggiate(base, builder) { return builder(new ArpeggiateBuilder(base)).patch(); }
exports.patchArpeggiate = patchArpeggiate;
function buildArpeggiate(builder) { return builder(new ArpeggiateBuilder()).build(); }
exports.buildArpeggiate = buildArpeggiate;
var NonArpeggiateBuilder = (function () {
    function NonArpeggiateBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "NonArpeggiate";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
    }
    return NonArpeggiateBuilder;
}());
function patchNonArpeggiate(base, builder) { return builder(new NonArpeggiateBuilder(base)).patch(); }
exports.patchNonArpeggiate = patchNonArpeggiate;
function buildNonArpeggiate(builder) { return builder(new NonArpeggiateBuilder()).build(); }
exports.buildNonArpeggiate = buildNonArpeggiate;
var LaughingBuilder = (function () {
    function LaughingBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Laughing";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return LaughingBuilder;
}());
function patchLaughing(base, builder) { return builder(new LaughingBuilder(base)).patch(); }
exports.patchLaughing = patchLaughing;
function buildLaughing(builder) { return builder(new LaughingBuilder()).build(); }
exports.buildLaughing = buildLaughing;
var HummingBuilder = (function () {
    function HummingBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Humming";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return HummingBuilder;
}());
function patchHumming(base, builder) { return builder(new HummingBuilder(base)).patch(); }
exports.patchHumming = patchHumming;
function buildHumming(builder) { return builder(new HummingBuilder()).build(); }
exports.buildHumming = buildHumming;
var EndLineBuilder = (function () {
    function EndLineBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "EndLine";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return EndLineBuilder;
}());
function patchEndLine(base, builder) { return builder(new EndLineBuilder(base)).patch(); }
exports.patchEndLine = patchEndLine;
function buildEndLine(builder) { return builder(new EndLineBuilder()).build(); }
exports.buildEndLine = buildEndLine;
var EndParagraphBuilder = (function () {
    function EndParagraphBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "EndParagraph";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return EndParagraphBuilder;
}());
function patchEndParagraph(base, builder) { return builder(new EndParagraphBuilder(base)).patch(); }
exports.patchEndParagraph = patchEndParagraph;
function buildEndParagraph(builder) { return builder(new EndParagraphBuilder()).build(); }
exports.buildEndParagraph = buildEndParagraph;
var LyricPartsBuilder = (function () {
    function LyricPartsBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LyricParts";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return LyricPartsBuilder;
}());
function patchLyricParts(base, builder) { return builder(new LyricPartsBuilder(base)).patch(); }
exports.patchLyricParts = patchLyricParts;
function buildLyricParts(builder) { return builder(new LyricPartsBuilder()).build(); }
exports.buildLyricParts = buildLyricParts;
var LyricBuilder = (function () {
    function LyricBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["lyricParts"]) ||
                childBuilders["lyricParts"] !== undefined ||
                updates.lyricParts !== undefined, "lyricParts is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Lyric";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.lyricParts = function (spec) {
            updates["lyricParts"] = spec;
            delete childBuilders["lyricParts;"];
            modifiedKeys["lyricParts"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return LyricBuilder;
}());
function patchLyric(base, builder) { return builder(new LyricBuilder(base)).patch(); }
exports.patchLyric = patchLyric;
function buildLyric(builder) { return builder(new LyricBuilder()).build(); }
exports.buildLyric = buildLyric;
var TextBuilder = (function () {
    function TextBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Text";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
    }
    return TextBuilder;
}());
function patchText(base, builder) { return builder(new TextBuilder(base)).patch(); }
exports.patchText = patchText;
function buildText(builder) { return builder(new TextBuilder()).build(); }
exports.buildText = buildText;
var SyllabicBuilder = (function () {
    function SyllabicBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Syllabic";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return SyllabicBuilder;
}());
function patchSyllabic(base, builder) { return builder(new SyllabicBuilder(base)).patch(); }
exports.patchSyllabic = patchSyllabic;
function buildSyllabic(builder) { return builder(new SyllabicBuilder()).build(); }
exports.buildSyllabic = buildSyllabic;
var ElisionBuilder = (function () {
    function ElisionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Elision";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return ElisionBuilder;
}());
function patchElision(base, builder) { return builder(new ElisionBuilder(base)).patch(); }
exports.patchElision = patchElision;
function buildElision(builder) { return builder(new ElisionBuilder()).build(); }
exports.buildElision = buildElision;
var ExtendBuilder = (function () {
    function ExtendBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Extend";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return ExtendBuilder;
}());
function patchExtend(base, builder) { return builder(new ExtendBuilder(base)).patch(); }
exports.patchExtend = patchExtend;
function buildExtend(builder) { return builder(new ExtendBuilder()).build(); }
exports.buildExtend = buildExtend;
var FiguredBassBuilder = (function () {
    function FiguredBassBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["figures"]) ||
                childBuilders["figures"] !== undefined ||
                updates.figures !== undefined, "figures is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "FiguredBass";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.figures = function (spec) {
            updates["figures"] = spec;
            delete childBuilders["figures;"];
            modifiedKeys["figures"] = true;
            return _this;
        };
        this.figuresAt = function (idx, build) {
            makeReference("figures");
            if (frozen["figures"][idx]) {
                throw new Error("Patching figures." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["figures"] && !original["figures"]) {
                // Clone snapshot.
                patches.push({ p: ["figures", idx], li: original._snapshot["figures"] });
            }
            if (typeof build === 'function' && reference["figures"][idx]) {
                var patch = build(new FigureBuilder(reference["figures"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["figures", idx].concat(patch.p);
                    return patch;
                }));
                frozen["figures"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new FigureBuilder(reference["figures"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["figures", idx], li: update });
            }
            else {
                updates["figures"] = reference["figures"]; // TODO: Merge?
            }
            reference["figures"][idx] = update;
            frozen["figures"][idx] = true;
            return _this;
        };
        this.figuresSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("figures");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["figures"][idx]) {
                        throw new Error("Replacing figures." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["figures"][idx];
                    patches.push({ p: ["figures", idx], ld: ld, li: items[idx - start] });
                    frozen["figures"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["figures"][idx]) {
                        throw new Error("Removing figures." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["figures"][idx];
                    patches.push({ p: ["figures", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["figures", idx], li: items[idx - start] });
                    frozen["figures"][idx] = true;
                }
            }
            (_a = reference["figures"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["figures"] = reference["figures"];
            (_b = frozen["figures"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.duration = function (spec) {
            updates["duration"] = spec;
            delete childBuilders["duration;"];
            modifiedKeys["duration"] = true;
            return _this;
        };
        this.parentheses = function (spec) {
            updates["parentheses"] = spec;
            delete childBuilders["parentheses;"];
            modifiedKeys["parentheses"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
        this.printDot = function (spec) {
            updates["printDot"] = spec;
            delete childBuilders["printDot;"];
            modifiedKeys["printDot"] = true;
            return _this;
        };
        this.printLyric = function (spec) {
            updates["printLyric"] = spec;
            delete childBuilders["printLyric;"];
            modifiedKeys["printLyric"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.printSpacing = function (spec) {
            updates["printSpacing"] = spec;
            delete childBuilders["printSpacing;"];
            modifiedKeys["printSpacing"] = true;
            return _this;
        };
    }
    return FiguredBassBuilder;
}());
function patchFiguredBass(base, builder) { return builder(new FiguredBassBuilder(base)).patch(); }
exports.patchFiguredBass = patchFiguredBass;
function buildFiguredBass(builder) { return builder(new FiguredBassBuilder()).build(); }
exports.buildFiguredBass = buildFiguredBass;
var FigureBuilder = (function () {
    function FigureBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Figure";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.prefix = function (build) {
            if (typeof build === 'function') {
                delete updates["prefix"];
                var builder = build(new PrefixBuilder(original && original["prefix"]));
                if (!original)
                    updates["prefix"] = builder.build();
                else
                    childBuilders["prefix"] = builder;
            }
            else {
                updates.prefix = build;
                delete childBuilders["prefix;"];
            }
            modifiedKeys["prefix"] = true;
            return _this;
        };
        this.figureNumber = function (build) {
            if (typeof build === 'function') {
                delete updates["figureNumber"];
                var builder = build(new FigureNumberBuilder(original && original["figureNumber"]));
                if (!original)
                    updates["figureNumber"] = builder.build();
                else
                    childBuilders["figureNumber"] = builder;
            }
            else {
                updates.figureNumber = build;
                delete childBuilders["figureNumber;"];
            }
            modifiedKeys["figureNumber"] = true;
            return _this;
        };
        this.extend = function (build) {
            if (typeof build === 'function') {
                delete updates["extend"];
                var builder = build(new ExtendBuilder(original && original["extend"]));
                if (!original)
                    updates["extend"] = builder.build();
                else
                    childBuilders["extend"] = builder;
            }
            else {
                updates.extend = build;
                delete childBuilders["extend;"];
            }
            modifiedKeys["extend"] = true;
            return _this;
        };
        this.suffix = function (build) {
            if (typeof build === 'function') {
                delete updates["suffix"];
                var builder = build(new SuffixBuilder(original && original["suffix"]));
                if (!original)
                    updates["suffix"] = builder.build();
                else
                    childBuilders["suffix"] = builder;
            }
            else {
                updates.suffix = build;
                delete childBuilders["suffix;"];
            }
            modifiedKeys["suffix"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return FigureBuilder;
}());
function patchFigure(base, builder) { return builder(new FigureBuilder(base)).patch(); }
exports.patchFigure = patchFigure;
function buildFigure(builder) { return builder(new FigureBuilder()).build(); }
exports.buildFigure = buildFigure;
var PrefixBuilder = (function () {
    function PrefixBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Prefix";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return PrefixBuilder;
}());
function patchPrefix(base, builder) { return builder(new PrefixBuilder(base)).patch(); }
exports.patchPrefix = patchPrefix;
function buildPrefix(builder) { return builder(new PrefixBuilder()).build(); }
exports.buildPrefix = buildPrefix;
var FigureNumberBuilder = (function () {
    function FigureNumberBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "FigureNumber";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return FigureNumberBuilder;
}());
function patchFigureNumber(base, builder) { return builder(new FigureNumberBuilder(base)).patch(); }
exports.patchFigureNumber = patchFigureNumber;
function buildFigureNumber(builder) { return builder(new FigureNumberBuilder()).build(); }
exports.buildFigureNumber = buildFigureNumber;
var SuffixBuilder = (function () {
    function SuffixBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Suffix";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return SuffixBuilder;
}());
function patchSuffix(base, builder) { return builder(new SuffixBuilder(base)).patch(); }
exports.patchSuffix = patchSuffix;
function buildSuffix(builder) { return builder(new SuffixBuilder()).build(); }
exports.buildSuffix = buildSuffix;
var BackupBuilder = (function () {
    function BackupBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["duration"]) ||
                childBuilders["duration"] !== undefined ||
                updates.duration !== undefined, "duration is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Backup";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.duration = function (spec) {
            updates["duration"] = spec;
            delete childBuilders["duration;"];
            modifiedKeys["duration"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return BackupBuilder;
}());
function patchBackup(base, builder) { return builder(new BackupBuilder(base)).patch(); }
exports.patchBackup = patchBackup;
function buildBackup(builder) { return builder(new BackupBuilder()).build(); }
exports.buildBackup = buildBackup;
var ForwardBuilder = (function () {
    function ForwardBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["duration"]) ||
                childBuilders["duration"] !== undefined ||
                updates.duration !== undefined, "duration is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Forward";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.duration = function (spec) {
            updates["duration"] = spec;
            delete childBuilders["duration;"];
            modifiedKeys["duration"] = true;
            return _this;
        };
        this.staff = function (spec) {
            updates["staff"] = spec;
            delete childBuilders["staff;"];
            modifiedKeys["staff"] = true;
            return _this;
        };
        this.voice = function (spec) {
            updates["voice"] = spec;
            delete childBuilders["voice;"];
            modifiedKeys["voice"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return ForwardBuilder;
}());
function patchForward(base, builder) { return builder(new ForwardBuilder(base)).patch(); }
exports.patchForward = patchForward;
function buildForward(builder) { return builder(new ForwardBuilder()).build(); }
exports.buildForward = buildForward;
var BarlineBuilder = (function () {
    function BarlineBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Barline";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.segno = function (build) {
            if (typeof build === 'function') {
                delete updates["segno"];
                var builder = build(new SegnoBuilder(original && original["segno"]));
                if (!original)
                    updates["segno"] = builder.build();
                else
                    childBuilders["segno"] = builder;
            }
            else {
                updates.segno = build;
                delete childBuilders["segno;"];
            }
            modifiedKeys["segno"] = true;
            return _this;
        };
        this.coda = function (build) {
            if (typeof build === 'function') {
                delete updates["coda"];
                var builder = build(new CodaBuilder(original && original["coda"]));
                if (!original)
                    updates["coda"] = builder.build();
                else
                    childBuilders["coda"] = builder;
            }
            else {
                updates.coda = build;
                delete childBuilders["coda;"];
            }
            modifiedKeys["coda"] = true;
            return _this;
        };
        this.location = function (spec) {
            updates["location"] = spec;
            delete childBuilders["location;"];
            modifiedKeys["location"] = true;
            return _this;
        };
        this.codaAttrib = function (spec) {
            updates["codaAttrib"] = spec;
            delete childBuilders["codaAttrib;"];
            modifiedKeys["codaAttrib"] = true;
            return _this;
        };
        this.wavyLine = function (build) {
            if (typeof build === 'function') {
                delete updates["wavyLine"];
                var builder = build(new WavyLineBuilder(original && original["wavyLine"]));
                if (!original)
                    updates["wavyLine"] = builder.build();
                else
                    childBuilders["wavyLine"] = builder;
            }
            else {
                updates.wavyLine = build;
                delete childBuilders["wavyLine;"];
            }
            modifiedKeys["wavyLine"] = true;
            return _this;
        };
        this.fermatas = function (spec) {
            updates["fermatas"] = spec;
            delete childBuilders["fermatas;"];
            modifiedKeys["fermatas"] = true;
            return _this;
        };
        this.fermatasAt = function (idx, build) {
            makeReference("fermatas");
            if (frozen["fermatas"][idx]) {
                throw new Error("Patching fermatas." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["fermatas"] && !original["fermatas"]) {
                // Clone snapshot.
                patches.push({ p: ["fermatas", idx], li: original._snapshot["fermatas"] });
            }
            if (typeof build === 'function' && reference["fermatas"][idx]) {
                var patch = build(new FermataBuilder(reference["fermatas"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["fermatas", idx].concat(patch.p);
                    return patch;
                }));
                frozen["fermatas"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new FermataBuilder(reference["fermatas"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["fermatas", idx], li: update });
            }
            else {
                updates["fermatas"] = reference["fermatas"]; // TODO: Merge?
            }
            reference["fermatas"][idx] = update;
            frozen["fermatas"][idx] = true;
            return _this;
        };
        this.fermatasSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("fermatas");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["fermatas"][idx]) {
                        throw new Error("Replacing fermatas." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["fermatas"][idx];
                    patches.push({ p: ["fermatas", idx], ld: ld, li: items[idx - start] });
                    frozen["fermatas"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["fermatas"][idx]) {
                        throw new Error("Removing fermatas." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["fermatas"][idx];
                    patches.push({ p: ["fermatas", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["fermatas", idx], li: items[idx - start] });
                    frozen["fermatas"][idx] = true;
                }
            }
            (_a = reference["fermatas"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["fermatas"] = reference["fermatas"];
            (_b = frozen["fermatas"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.segnoAttrib = function (spec) {
            updates["segnoAttrib"] = spec;
            delete childBuilders["segnoAttrib;"];
            modifiedKeys["segnoAttrib"] = true;
            return _this;
        };
        this.divisions = function (spec) {
            updates["divisions"] = spec;
            delete childBuilders["divisions;"];
            modifiedKeys["divisions"] = true;
            return _this;
        };
        this.barStyle = function (build) {
            if (typeof build === 'function') {
                delete updates["barStyle"];
                var builder = build(new BarStyleBuilder(original && original["barStyle"]));
                if (!original)
                    updates["barStyle"] = builder.build();
                else
                    childBuilders["barStyle"] = builder;
            }
            else {
                updates.barStyle = build;
                delete childBuilders["barStyle;"];
            }
            modifiedKeys["barStyle"] = true;
            return _this;
        };
        this.ending = function (build) {
            if (typeof build === 'function') {
                delete updates["ending"];
                var builder = build(new EndingBuilder(original && original["ending"]));
                if (!original)
                    updates["ending"] = builder.build();
                else
                    childBuilders["ending"] = builder;
            }
            else {
                updates.ending = build;
                delete childBuilders["ending;"];
            }
            modifiedKeys["ending"] = true;
            return _this;
        };
        this.repeat = function (build) {
            if (typeof build === 'function') {
                delete updates["repeat"];
                var builder = build(new RepeatBuilder(original && original["repeat"]));
                if (!original)
                    updates["repeat"] = builder.build();
                else
                    childBuilders["repeat"] = builder;
            }
            else {
                updates.repeat = build;
                delete childBuilders["repeat;"];
            }
            modifiedKeys["repeat"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return BarlineBuilder;
}());
function patchBarline(base, builder) { return builder(new BarlineBuilder(base)).patch(); }
exports.patchBarline = patchBarline;
function buildBarline(builder) { return builder(new BarlineBuilder()).build(); }
exports.buildBarline = buildBarline;
var BarStyleBuilder = (function () {
    function BarStyleBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BarStyle";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return BarStyleBuilder;
}());
function patchBarStyle(base, builder) { return builder(new BarStyleBuilder(base)).patch(); }
exports.patchBarStyle = patchBarStyle;
function buildBarStyle(builder) { return builder(new BarStyleBuilder()).build(); }
exports.buildBarStyle = buildBarStyle;
var EndingBuilder = (function () {
    function EndingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["endLength"]) ||
                childBuilders["endLength"] !== undefined ||
                updates.endLength !== undefined, "endLength is a required field");
            console.assert((original && !modifiedKeys["textX"]) ||
                childBuilders["textX"] !== undefined ||
                updates.textX !== undefined, "textX is a required field");
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["textY"]) ||
                childBuilders["textY"] !== undefined ||
                updates.textY !== undefined, "textY is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Ending";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.endLength = function (spec) {
            updates["endLength"] = spec;
            delete childBuilders["endLength;"];
            modifiedKeys["endLength"] = true;
            return _this;
        };
        this.textX = function (spec) {
            updates["textX"] = spec;
            delete childBuilders["textX;"];
            modifiedKeys["textX"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.textY = function (spec) {
            updates["textY"] = spec;
            delete childBuilders["textY;"];
            modifiedKeys["textY"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.ending = function (spec) {
            updates["ending"] = spec;
            delete childBuilders["ending;"];
            modifiedKeys["ending"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return EndingBuilder;
}());
function patchEnding(base, builder) { return builder(new EndingBuilder(base)).patch(); }
exports.patchEnding = patchEnding;
function buildEnding(builder) { return builder(new EndingBuilder()).build(); }
exports.buildEnding = buildEnding;
var RepeatBuilder = (function () {
    function RepeatBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["times"]) ||
                childBuilders["times"] !== undefined ||
                updates.times !== undefined, "times is a required field");
            console.assert((original && !modifiedKeys["winged"]) ||
                childBuilders["winged"] !== undefined ||
                updates.winged !== undefined, "winged is a required field");
            console.assert((original && !modifiedKeys["direction"]) ||
                childBuilders["direction"] !== undefined ||
                updates.direction !== undefined, "direction is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Repeat";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.times = function (spec) {
            updates["times"] = spec;
            delete childBuilders["times;"];
            modifiedKeys["times"] = true;
            return _this;
        };
        this.winged = function (spec) {
            updates["winged"] = spec;
            delete childBuilders["winged;"];
            modifiedKeys["winged"] = true;
            return _this;
        };
        this.direction = function (spec) {
            updates["direction"] = spec;
            delete childBuilders["direction;"];
            modifiedKeys["direction"] = true;
            return _this;
        };
    }
    return RepeatBuilder;
}());
function patchRepeat(base, builder) { return builder(new RepeatBuilder(base)).patch(); }
exports.patchRepeat = patchRepeat;
function buildRepeat(builder) { return builder(new RepeatBuilder()).build(); }
exports.buildRepeat = buildRepeat;
var DirectionBuilder = (function () {
    function DirectionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["directionTypes"]) ||
                childBuilders["directionTypes"] !== undefined ||
                updates.directionTypes !== undefined, "directionTypes is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Direction";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.directionTypes = function (spec) {
            updates["directionTypes"] = spec;
            delete childBuilders["directionTypes;"];
            modifiedKeys["directionTypes"] = true;
            return _this;
        };
        this.directionTypesAt = function (idx, build) {
            makeReference("directionTypes");
            if (frozen["directionTypes"][idx]) {
                throw new Error("Patching directionTypes." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["directionTypes"] && !original["directionTypes"]) {
                // Clone snapshot.
                patches.push({ p: ["directionTypes", idx], li: original._snapshot["directionTypes"] });
            }
            if (typeof build === 'function' && reference["directionTypes"][idx]) {
                var patch = build(new DirectionTypeBuilder(reference["directionTypes"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["directionTypes", idx].concat(patch.p);
                    return patch;
                }));
                frozen["directionTypes"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new DirectionTypeBuilder(reference["directionTypes"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["directionTypes", idx], li: update });
            }
            else {
                updates["directionTypes"] = reference["directionTypes"]; // TODO: Merge?
            }
            reference["directionTypes"][idx] = update;
            frozen["directionTypes"][idx] = true;
            return _this;
        };
        this.directionTypesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("directionTypes");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["directionTypes"][idx]) {
                        throw new Error("Replacing directionTypes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["directionTypes"][idx];
                    patches.push({ p: ["directionTypes", idx], ld: ld, li: items[idx - start] });
                    frozen["directionTypes"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["directionTypes"][idx]) {
                        throw new Error("Removing directionTypes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["directionTypes"][idx];
                    patches.push({ p: ["directionTypes", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["directionTypes", idx], li: items[idx - start] });
                    frozen["directionTypes"][idx] = true;
                }
            }
            (_a = reference["directionTypes"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["directionTypes"] = reference["directionTypes"];
            (_b = frozen["directionTypes"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.staff = function (spec) {
            updates["staff"] = spec;
            delete childBuilders["staff;"];
            modifiedKeys["staff"] = true;
            return _this;
        };
        this.offset = function (build) {
            if (typeof build === 'function') {
                delete updates["offset"];
                var builder = build(new OffsetBuilder(original && original["offset"]));
                if (!original)
                    updates["offset"] = builder.build();
                else
                    childBuilders["offset"] = builder;
            }
            else {
                updates.offset = build;
                delete childBuilders["offset;"];
            }
            modifiedKeys["offset"] = true;
            return _this;
        };
        this.sound = function (build) {
            if (typeof build === 'function') {
                delete updates["sound"];
                var builder = build(new SoundBuilder(original && original["sound"]));
                if (!original)
                    updates["sound"] = builder.build();
                else
                    childBuilders["sound"] = builder;
            }
            else {
                updates.sound = build;
                delete childBuilders["sound;"];
            }
            modifiedKeys["sound"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.voice = function (spec) {
            updates["voice"] = spec;
            delete childBuilders["voice;"];
            modifiedKeys["voice"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
        this.directive = function (spec) {
            updates["directive"] = spec;
            delete childBuilders["directive;"];
            modifiedKeys["directive"] = true;
            return _this;
        };
    }
    return DirectionBuilder;
}());
function patchDirection(base, builder) { return builder(new DirectionBuilder(base)).patch(); }
exports.patchDirection = patchDirection;
function buildDirection(builder) { return builder(new DirectionBuilder()).build(); }
exports.buildDirection = buildDirection;
var DirectionTypeBuilder = (function () {
    function DirectionTypeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DirectionType";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.percussions = function (spec) {
            updates["percussions"] = spec;
            delete childBuilders["percussions;"];
            modifiedKeys["percussions"] = true;
            return _this;
        };
        this.percussionsAt = function (idx, build) {
            makeReference("percussions");
            if (frozen["percussions"][idx]) {
                throw new Error("Patching percussions." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["percussions"] && !original["percussions"]) {
                // Clone snapshot.
                patches.push({ p: ["percussions", idx], li: original._snapshot["percussions"] });
            }
            if (typeof build === 'function' && reference["percussions"][idx]) {
                var patch = build(new PercussionBuilder(reference["percussions"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["percussions", idx].concat(patch.p);
                    return patch;
                }));
                frozen["percussions"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new PercussionBuilder(reference["percussions"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["percussions", idx], li: update });
            }
            else {
                updates["percussions"] = reference["percussions"]; // TODO: Merge?
            }
            reference["percussions"][idx] = update;
            frozen["percussions"][idx] = true;
            return _this;
        };
        this.percussionsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("percussions");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["percussions"][idx]) {
                        throw new Error("Replacing percussions." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["percussions"][idx];
                    patches.push({ p: ["percussions", idx], ld: ld, li: items[idx - start] });
                    frozen["percussions"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["percussions"][idx]) {
                        throw new Error("Removing percussions." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["percussions"][idx];
                    patches.push({ p: ["percussions", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["percussions", idx], li: items[idx - start] });
                    frozen["percussions"][idx] = true;
                }
            }
            (_a = reference["percussions"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["percussions"] = reference["percussions"];
            (_b = frozen["percussions"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.rehearsals = function (spec) {
            updates["rehearsals"] = spec;
            delete childBuilders["rehearsals;"];
            modifiedKeys["rehearsals"] = true;
            return _this;
        };
        this.rehearsalsAt = function (idx, build) {
            makeReference("rehearsals");
            if (frozen["rehearsals"][idx]) {
                throw new Error("Patching rehearsals." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["rehearsals"] && !original["rehearsals"]) {
                // Clone snapshot.
                patches.push({ p: ["rehearsals", idx], li: original._snapshot["rehearsals"] });
            }
            if (typeof build === 'function' && reference["rehearsals"][idx]) {
                var patch = build(new RehearsalBuilder(reference["rehearsals"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["rehearsals", idx].concat(patch.p);
                    return patch;
                }));
                frozen["rehearsals"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new RehearsalBuilder(reference["rehearsals"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["rehearsals", idx], li: update });
            }
            else {
                updates["rehearsals"] = reference["rehearsals"]; // TODO: Merge?
            }
            reference["rehearsals"][idx] = update;
            frozen["rehearsals"][idx] = true;
            return _this;
        };
        this.rehearsalsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("rehearsals");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["rehearsals"][idx]) {
                        throw new Error("Replacing rehearsals." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["rehearsals"][idx];
                    patches.push({ p: ["rehearsals", idx], ld: ld, li: items[idx - start] });
                    frozen["rehearsals"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["rehearsals"][idx]) {
                        throw new Error("Removing rehearsals." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["rehearsals"][idx];
                    patches.push({ p: ["rehearsals", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["rehearsals", idx], li: items[idx - start] });
                    frozen["rehearsals"][idx] = true;
                }
            }
            (_a = reference["rehearsals"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["rehearsals"] = reference["rehearsals"];
            (_b = frozen["rehearsals"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.pedal = function (build) {
            if (typeof build === 'function') {
                delete updates["pedal"];
                var builder = build(new PedalBuilder(original && original["pedal"]));
                if (!original)
                    updates["pedal"] = builder.build();
                else
                    childBuilders["pedal"] = builder;
            }
            else {
                updates.pedal = build;
                delete childBuilders["pedal;"];
            }
            modifiedKeys["pedal"] = true;
            return _this;
        };
        this.principalVoice = function (build) {
            if (typeof build === 'function') {
                delete updates["principalVoice"];
                var builder = build(new PrincipalVoiceBuilder(original && original["principalVoice"]));
                if (!original)
                    updates["principalVoice"] = builder.build();
                else
                    childBuilders["principalVoice"] = builder;
            }
            else {
                updates.principalVoice = build;
                delete childBuilders["principalVoice;"];
            }
            modifiedKeys["principalVoice"] = true;
            return _this;
        };
        this.accordionRegistration = function (build) {
            if (typeof build === 'function') {
                delete updates["accordionRegistration"];
                var builder = build(new AccordionRegistrationBuilder(original && original["accordionRegistration"]));
                if (!original)
                    updates["accordionRegistration"] = builder.build();
                else
                    childBuilders["accordionRegistration"] = builder;
            }
            else {
                updates.accordionRegistration = build;
                delete childBuilders["accordionRegistration;"];
            }
            modifiedKeys["accordionRegistration"] = true;
            return _this;
        };
        this.eyeglasses = function (build) {
            if (typeof build === 'function') {
                delete updates["eyeglasses"];
                var builder = build(new EyeglassesBuilder(original && original["eyeglasses"]));
                if (!original)
                    updates["eyeglasses"] = builder.build();
                else
                    childBuilders["eyeglasses"] = builder;
            }
            else {
                updates.eyeglasses = build;
                delete childBuilders["eyeglasses;"];
            }
            modifiedKeys["eyeglasses"] = true;
            return _this;
        };
        this.image = function (build) {
            if (typeof build === 'function') {
                delete updates["image"];
                var builder = build(new ImageBuilder(original && original["image"]));
                if (!original)
                    updates["image"] = builder.build();
                else
                    childBuilders["image"] = builder;
            }
            else {
                updates.image = build;
                delete childBuilders["image;"];
            }
            modifiedKeys["image"] = true;
            return _this;
        };
        this.harpPedals = function (build) {
            if (typeof build === 'function') {
                delete updates["harpPedals"];
                var builder = build(new HarpPedalsBuilder(original && original["harpPedals"]));
                if (!original)
                    updates["harpPedals"] = builder.build();
                else
                    childBuilders["harpPedals"] = builder;
            }
            else {
                updates.harpPedals = build;
                delete childBuilders["harpPedals;"];
            }
            modifiedKeys["harpPedals"] = true;
            return _this;
        };
        this.metronome = function (build) {
            if (typeof build === 'function') {
                delete updates["metronome"];
                var builder = build(new MetronomeBuilder(original && original["metronome"]));
                if (!original)
                    updates["metronome"] = builder.build();
                else
                    childBuilders["metronome"] = builder;
            }
            else {
                updates.metronome = build;
                delete childBuilders["metronome;"];
            }
            modifiedKeys["metronome"] = true;
            return _this;
        };
        this.otherDirection = function (build) {
            if (typeof build === 'function') {
                delete updates["otherDirection"];
                var builder = build(new OtherDirectionBuilder(original && original["otherDirection"]));
                if (!original)
                    updates["otherDirection"] = builder.build();
                else
                    childBuilders["otherDirection"] = builder;
            }
            else {
                updates.otherDirection = build;
                delete childBuilders["otherDirection;"];
            }
            modifiedKeys["otherDirection"] = true;
            return _this;
        };
        this.segnos = function (spec) {
            updates["segnos"] = spec;
            delete childBuilders["segnos;"];
            modifiedKeys["segnos"] = true;
            return _this;
        };
        this.segnosAt = function (idx, build) {
            makeReference("segnos");
            if (frozen["segnos"][idx]) {
                throw new Error("Patching segnos." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["segnos"] && !original["segnos"]) {
                // Clone snapshot.
                patches.push({ p: ["segnos", idx], li: original._snapshot["segnos"] });
            }
            if (typeof build === 'function' && reference["segnos"][idx]) {
                var patch = build(new SegnoBuilder(reference["segnos"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["segnos", idx].concat(patch.p);
                    return patch;
                }));
                frozen["segnos"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new SegnoBuilder(reference["segnos"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["segnos", idx], li: update });
            }
            else {
                updates["segnos"] = reference["segnos"]; // TODO: Merge?
            }
            reference["segnos"][idx] = update;
            frozen["segnos"][idx] = true;
            return _this;
        };
        this.segnosSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("segnos");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["segnos"][idx]) {
                        throw new Error("Replacing segnos." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["segnos"][idx];
                    patches.push({ p: ["segnos", idx], ld: ld, li: items[idx - start] });
                    frozen["segnos"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["segnos"][idx]) {
                        throw new Error("Removing segnos." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["segnos"][idx];
                    patches.push({ p: ["segnos", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["segnos", idx], li: items[idx - start] });
                    frozen["segnos"][idx] = true;
                }
            }
            (_a = reference["segnos"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["segnos"] = reference["segnos"];
            (_b = frozen["segnos"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.scordatura = function (build) {
            if (typeof build === 'function') {
                delete updates["scordatura"];
                var builder = build(new ScordaturaBuilder(original && original["scordatura"]));
                if (!original)
                    updates["scordatura"] = builder.build();
                else
                    childBuilders["scordatura"] = builder;
            }
            else {
                updates.scordatura = build;
                delete childBuilders["scordatura;"];
            }
            modifiedKeys["scordatura"] = true;
            return _this;
        };
        this.stringMute = function (build) {
            if (typeof build === 'function') {
                delete updates["stringMute"];
                var builder = build(new StringMuteBuilder(original && original["stringMute"]));
                if (!original)
                    updates["stringMute"] = builder.build();
                else
                    childBuilders["stringMute"] = builder;
            }
            else {
                updates.stringMute = build;
                delete childBuilders["stringMute;"];
            }
            modifiedKeys["stringMute"] = true;
            return _this;
        };
        this.wedge = function (build) {
            if (typeof build === 'function') {
                delete updates["wedge"];
                var builder = build(new WedgeBuilder(original && original["wedge"]));
                if (!original)
                    updates["wedge"] = builder.build();
                else
                    childBuilders["wedge"] = builder;
            }
            else {
                updates.wedge = build;
                delete childBuilders["wedge;"];
            }
            modifiedKeys["wedge"] = true;
            return _this;
        };
        this.dashes = function (build) {
            if (typeof build === 'function') {
                delete updates["dashes"];
                var builder = build(new DashesBuilder(original && original["dashes"]));
                if (!original)
                    updates["dashes"] = builder.build();
                else
                    childBuilders["dashes"] = builder;
            }
            else {
                updates.dashes = build;
                delete childBuilders["dashes;"];
            }
            modifiedKeys["dashes"] = true;
            return _this;
        };
        this.damp = function (build) {
            if (typeof build === 'function') {
                delete updates["damp"];
                var builder = build(new DampBuilder(original && original["damp"]));
                if (!original)
                    updates["damp"] = builder.build();
                else
                    childBuilders["damp"] = builder;
            }
            else {
                updates.damp = build;
                delete childBuilders["damp;"];
            }
            modifiedKeys["damp"] = true;
            return _this;
        };
        this.bracket = function (build) {
            if (typeof build === 'function') {
                delete updates["bracket"];
                var builder = build(new BracketBuilder(original && original["bracket"]));
                if (!original)
                    updates["bracket"] = builder.build();
                else
                    childBuilders["bracket"] = builder;
            }
            else {
                updates.bracket = build;
                delete childBuilders["bracket;"];
            }
            modifiedKeys["bracket"] = true;
            return _this;
        };
        this.dynamics = function (build) {
            if (typeof build === 'function') {
                delete updates["dynamics"];
                var builder = build(new DynamicsBuilder(original && original["dynamics"]));
                if (!original)
                    updates["dynamics"] = builder.build();
                else
                    childBuilders["dynamics"] = builder;
            }
            else {
                updates.dynamics = build;
                delete childBuilders["dynamics;"];
            }
            modifiedKeys["dynamics"] = true;
            return _this;
        };
        this.octaveShift = function (build) {
            if (typeof build === 'function') {
                delete updates["octaveShift"];
                var builder = build(new OctaveShiftBuilder(original && original["octaveShift"]));
                if (!original)
                    updates["octaveShift"] = builder.build();
                else
                    childBuilders["octaveShift"] = builder;
            }
            else {
                updates.octaveShift = build;
                delete childBuilders["octaveShift;"];
            }
            modifiedKeys["octaveShift"] = true;
            return _this;
        };
        this.words = function (spec) {
            updates["words"] = spec;
            delete childBuilders["words;"];
            modifiedKeys["words"] = true;
            return _this;
        };
        this.wordsAt = function (idx, build) {
            makeReference("words");
            if (frozen["words"][idx]) {
                throw new Error("Patching words." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["words"] && !original["words"]) {
                // Clone snapshot.
                patches.push({ p: ["words", idx], li: original._snapshot["words"] });
            }
            if (typeof build === 'function' && reference["words"][idx]) {
                var patch = build(new WordsBuilder(reference["words"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["words", idx].concat(patch.p);
                    return patch;
                }));
                frozen["words"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new WordsBuilder(reference["words"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["words", idx], li: update });
            }
            else {
                updates["words"] = reference["words"]; // TODO: Merge?
            }
            reference["words"][idx] = update;
            frozen["words"][idx] = true;
            return _this;
        };
        this.wordsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("words");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["words"][idx]) {
                        throw new Error("Replacing words." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["words"][idx];
                    patches.push({ p: ["words", idx], ld: ld, li: items[idx - start] });
                    frozen["words"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["words"][idx]) {
                        throw new Error("Removing words." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["words"][idx];
                    patches.push({ p: ["words", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["words", idx], li: items[idx - start] });
                    frozen["words"][idx] = true;
                }
            }
            (_a = reference["words"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["words"] = reference["words"];
            (_b = frozen["words"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.dampAll = function (build) {
            if (typeof build === 'function') {
                delete updates["dampAll"];
                var builder = build(new DampAllBuilder(original && original["dampAll"]));
                if (!original)
                    updates["dampAll"] = builder.build();
                else
                    childBuilders["dampAll"] = builder;
            }
            else {
                updates.dampAll = build;
                delete childBuilders["dampAll;"];
            }
            modifiedKeys["dampAll"] = true;
            return _this;
        };
        this.codas = function (spec) {
            updates["codas"] = spec;
            delete childBuilders["codas;"];
            modifiedKeys["codas"] = true;
            return _this;
        };
        this.codasAt = function (idx, build) {
            makeReference("codas");
            if (frozen["codas"][idx]) {
                throw new Error("Patching codas." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["codas"] && !original["codas"]) {
                // Clone snapshot.
                patches.push({ p: ["codas", idx], li: original._snapshot["codas"] });
            }
            if (typeof build === 'function' && reference["codas"][idx]) {
                var patch = build(new CodaBuilder(reference["codas"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["codas", idx].concat(patch.p);
                    return patch;
                }));
                frozen["codas"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new CodaBuilder(reference["codas"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["codas", idx], li: update });
            }
            else {
                updates["codas"] = reference["codas"]; // TODO: Merge?
            }
            reference["codas"][idx] = update;
            frozen["codas"][idx] = true;
            return _this;
        };
        this.codasSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("codas");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["codas"][idx]) {
                        throw new Error("Replacing codas." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["codas"][idx];
                    patches.push({ p: ["codas", idx], ld: ld, li: items[idx - start] });
                    frozen["codas"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["codas"][idx]) {
                        throw new Error("Removing codas." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["codas"][idx];
                    patches.push({ p: ["codas", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["codas", idx], li: items[idx - start] });
                    frozen["codas"][idx] = true;
                }
            }
            (_a = reference["codas"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["codas"] = reference["codas"];
            (_b = frozen["codas"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return DirectionTypeBuilder;
}());
function patchDirectionType(base, builder) { return builder(new DirectionTypeBuilder(base)).patch(); }
exports.patchDirectionType = patchDirectionType;
function buildDirectionType(builder) { return builder(new DirectionTypeBuilder()).build(); }
exports.buildDirectionType = buildDirectionType;
var RehearsalBuilder = (function () {
    function RehearsalBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Rehearsal";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return RehearsalBuilder;
}());
function patchRehearsal(base, builder) { return builder(new RehearsalBuilder(base)).patch(); }
exports.patchRehearsal = patchRehearsal;
function buildRehearsal(builder) { return builder(new RehearsalBuilder()).build(); }
exports.buildRehearsal = buildRehearsal;
var WordsBuilder = (function () {
    function WordsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Words";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return WordsBuilder;
}());
function patchWords(base, builder) { return builder(new WordsBuilder(base)).patch(); }
exports.patchWords = patchWords;
function buildWords(builder) { return builder(new WordsBuilder()).build(); }
exports.buildWords = buildWords;
var WedgeBuilder = (function () {
    function WedgeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Wedge";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.niente = function (spec) {
            updates["niente"] = spec;
            delete childBuilders["niente;"];
            modifiedKeys["niente"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.spread = function (spec) {
            updates["spread"] = spec;
            delete childBuilders["spread;"];
            modifiedKeys["spread"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
    }
    return WedgeBuilder;
}());
function patchWedge(base, builder) { return builder(new WedgeBuilder(base)).patch(); }
exports.patchWedge = patchWedge;
function buildWedge(builder) { return builder(new WedgeBuilder()).build(); }
exports.buildWedge = buildWedge;
var DashesBuilder = (function () {
    function DashesBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Dashes";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
    }
    return DashesBuilder;
}());
function patchDashes(base, builder) { return builder(new DashesBuilder(base)).patch(); }
exports.patchDashes = patchDashes;
function buildDashes(builder) { return builder(new DashesBuilder()).build(); }
exports.buildDashes = buildDashes;
var BracketBuilder = (function () {
    function BracketBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["endLength"]) ||
                childBuilders["endLength"] !== undefined ||
                updates.endLength !== undefined, "endLength is a required field");
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["lineEnd"]) ||
                childBuilders["lineEnd"] !== undefined ||
                updates.lineEnd !== undefined, "lineEnd is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Bracket";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.endLength = function (spec) {
            updates["endLength"] = spec;
            delete childBuilders["endLength;"];
            modifiedKeys["endLength"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.lineEnd = function (spec) {
            updates["lineEnd"] = spec;
            delete childBuilders["lineEnd;"];
            modifiedKeys["lineEnd"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.lineType = function (spec) {
            updates["lineType"] = spec;
            delete childBuilders["lineType;"];
            modifiedKeys["lineType"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
    }
    return BracketBuilder;
}());
function patchBracket(base, builder) { return builder(new BracketBuilder(base)).patch(); }
exports.patchBracket = patchBracket;
function buildBracket(builder) { return builder(new BracketBuilder()).build(); }
exports.buildBracket = buildBracket;
var PedalBuilder = (function () {
    function PedalBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["line"]) ||
                childBuilders["line"] !== undefined ||
                updates.line !== undefined, "line is a required field");
            console.assert((original && !modifiedKeys["sign"]) ||
                childBuilders["sign"] !== undefined ||
                updates.sign !== undefined, "sign is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Pedal";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.line = function (spec) {
            updates["line"] = spec;
            delete childBuilders["line;"];
            modifiedKeys["line"] = true;
            return _this;
        };
        this.sign = function (spec) {
            updates["sign"] = spec;
            delete childBuilders["sign;"];
            modifiedKeys["sign"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return PedalBuilder;
}());
function patchPedal(base, builder) { return builder(new PedalBuilder(base)).patch(); }
exports.patchPedal = patchPedal;
function buildPedal(builder) { return builder(new PedalBuilder()).build(); }
exports.buildPedal = buildPedal;
var MetronomeBuilder = (function () {
    function MetronomeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["metronomeNotes"]) ||
                childBuilders["metronomeNotes"] !== undefined ||
                updates.metronomeNotes !== undefined, "metronomeNotes is a required field");
            console.assert((original && !modifiedKeys["perMinute"]) ||
                childBuilders["perMinute"] !== undefined ||
                updates.perMinute !== undefined, "perMinute is a required field");
            console.assert((original && !modifiedKeys["parentheses"]) ||
                childBuilders["parentheses"] !== undefined ||
                updates.parentheses !== undefined, "parentheses is a required field");
            console.assert((original && !modifiedKeys["beatUnit"]) ||
                childBuilders["beatUnit"] !== undefined ||
                updates.beatUnit !== undefined, "beatUnit is a required field");
            console.assert((original && !modifiedKeys["beatUnitDots"]) ||
                childBuilders["beatUnitDots"] !== undefined ||
                updates.beatUnitDots !== undefined, "beatUnitDots is a required field");
            console.assert((original && !modifiedKeys["beatUnitChange"]) ||
                childBuilders["beatUnitChange"] !== undefined ||
                updates.beatUnitChange !== undefined, "beatUnitChange is a required field");
            console.assert((original && !modifiedKeys["beatUnitDotsChange"]) ||
                childBuilders["beatUnitDotsChange"] !== undefined ||
                updates.beatUnitDotsChange !== undefined, "beatUnitDotsChange is a required field");
            console.assert((original && !modifiedKeys["metronomeRelation"]) ||
                childBuilders["metronomeRelation"] !== undefined ||
                updates.metronomeRelation !== undefined, "metronomeRelation is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Metronome";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.metronomeNotes = function (spec) {
            updates["metronomeNotes"] = spec;
            delete childBuilders["metronomeNotes;"];
            modifiedKeys["metronomeNotes"] = true;
            return _this;
        };
        this.metronomeNotesAt = function (idx, build) {
            makeReference("metronomeNotes");
            if (frozen["metronomeNotes"][idx]) {
                throw new Error("Patching metronomeNotes." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["metronomeNotes"] && !original["metronomeNotes"]) {
                // Clone snapshot.
                patches.push({ p: ["metronomeNotes", idx], li: original._snapshot["metronomeNotes"] });
            }
            if (typeof build === 'function' && reference["metronomeNotes"][idx]) {
                var patch = build(new MetronomeNoteBuilder(reference["metronomeNotes"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["metronomeNotes", idx].concat(patch.p);
                    return patch;
                }));
                frozen["metronomeNotes"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MetronomeNoteBuilder(reference["metronomeNotes"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["metronomeNotes", idx], li: update });
            }
            else {
                updates["metronomeNotes"] = reference["metronomeNotes"]; // TODO: Merge?
            }
            reference["metronomeNotes"][idx] = update;
            frozen["metronomeNotes"][idx] = true;
            return _this;
        };
        this.metronomeNotesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("metronomeNotes");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["metronomeNotes"][idx]) {
                        throw new Error("Replacing metronomeNotes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["metronomeNotes"][idx];
                    patches.push({ p: ["metronomeNotes", idx], ld: ld, li: items[idx - start] });
                    frozen["metronomeNotes"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["metronomeNotes"][idx]) {
                        throw new Error("Removing metronomeNotes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["metronomeNotes"][idx];
                    patches.push({ p: ["metronomeNotes", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["metronomeNotes", idx], li: items[idx - start] });
                    frozen["metronomeNotes"][idx] = true;
                }
            }
            (_a = reference["metronomeNotes"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["metronomeNotes"] = reference["metronomeNotes"];
            (_b = frozen["metronomeNotes"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.perMinute = function (build) {
            if (typeof build === 'function') {
                delete updates["perMinute"];
                var builder = build(new PerMinuteBuilder(original && original["perMinute"]));
                if (!original)
                    updates["perMinute"] = builder.build();
                else
                    childBuilders["perMinute"] = builder;
            }
            else {
                updates.perMinute = build;
                delete childBuilders["perMinute;"];
            }
            modifiedKeys["perMinute"] = true;
            return _this;
        };
        this.parentheses = function (spec) {
            updates["parentheses"] = spec;
            delete childBuilders["parentheses;"];
            modifiedKeys["parentheses"] = true;
            return _this;
        };
        this.beatUnit = function (spec) {
            updates["beatUnit"] = spec;
            delete childBuilders["beatUnit;"];
            modifiedKeys["beatUnit"] = true;
            return _this;
        };
        this.beatUnitDots = function (spec) {
            updates["beatUnitDots"] = spec;
            delete childBuilders["beatUnitDots;"];
            modifiedKeys["beatUnitDots"] = true;
            return _this;
        };
        this.beatUnitDotsAt = function (idx, build) {
            makeReference("beatUnitDots");
            if (frozen["beatUnitDots"][idx]) {
                throw new Error("Patching beatUnitDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["beatUnitDots"] && !original["beatUnitDots"]) {
                // Clone snapshot.
                patches.push({ p: ["beatUnitDots", idx], li: original._snapshot["beatUnitDots"] });
            }
            if (typeof build === 'function' && reference["beatUnitDots"][idx]) {
                var patch = build(new BeatUnitDotBuilder(reference["beatUnitDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["beatUnitDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["beatUnitDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new BeatUnitDotBuilder(reference["beatUnitDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["beatUnitDots", idx], li: update });
            }
            else {
                updates["beatUnitDots"] = reference["beatUnitDots"]; // TODO: Merge?
            }
            reference["beatUnitDots"][idx] = update;
            frozen["beatUnitDots"][idx] = true;
            return _this;
        };
        this.beatUnitDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("beatUnitDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["beatUnitDots"][idx]) {
                        throw new Error("Replacing beatUnitDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["beatUnitDots"][idx];
                    patches.push({ p: ["beatUnitDots", idx], ld: ld, li: items[idx - start] });
                    frozen["beatUnitDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["beatUnitDots"][idx]) {
                        throw new Error("Removing beatUnitDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["beatUnitDots"][idx];
                    patches.push({ p: ["beatUnitDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["beatUnitDots", idx], li: items[idx - start] });
                    frozen["beatUnitDots"][idx] = true;
                }
            }
            (_a = reference["beatUnitDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["beatUnitDots"] = reference["beatUnitDots"];
            (_b = frozen["beatUnitDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.beatUnitChange = function (spec) {
            updates["beatUnitChange"] = spec;
            delete childBuilders["beatUnitChange;"];
            modifiedKeys["beatUnitChange"] = true;
            return _this;
        };
        this.beatUnitDotsChange = function (spec) {
            updates["beatUnitDotsChange"] = spec;
            delete childBuilders["beatUnitDotsChange;"];
            modifiedKeys["beatUnitDotsChange"] = true;
            return _this;
        };
        this.beatUnitDotsChangeAt = function (idx, build) {
            makeReference("beatUnitDotsChange");
            if (frozen["beatUnitDotsChange"][idx]) {
                throw new Error("Patching beatUnitDotsChange." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["beatUnitDotsChange"] && !original["beatUnitDotsChange"]) {
                // Clone snapshot.
                patches.push({ p: ["beatUnitDotsChange", idx], li: original._snapshot["beatUnitDotsChange"] });
            }
            if (typeof build === 'function' && reference["beatUnitDotsChange"][idx]) {
                var patch = build(new BeatUnitDotBuilder(reference["beatUnitDotsChange"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["beatUnitDotsChange", idx].concat(patch.p);
                    return patch;
                }));
                frozen["beatUnitDotsChange"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new BeatUnitDotBuilder(reference["beatUnitDotsChange"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["beatUnitDotsChange", idx], li: update });
            }
            else {
                updates["beatUnitDotsChange"] = reference["beatUnitDotsChange"]; // TODO: Merge?
            }
            reference["beatUnitDotsChange"][idx] = update;
            frozen["beatUnitDotsChange"][idx] = true;
            return _this;
        };
        this.beatUnitDotsChangeSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("beatUnitDotsChange");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["beatUnitDotsChange"][idx]) {
                        throw new Error("Replacing beatUnitDotsChange." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["beatUnitDotsChange"][idx];
                    patches.push({ p: ["beatUnitDotsChange", idx], ld: ld, li: items[idx - start] });
                    frozen["beatUnitDotsChange"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["beatUnitDotsChange"][idx]) {
                        throw new Error("Removing beatUnitDotsChange." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["beatUnitDotsChange"][idx];
                    patches.push({ p: ["beatUnitDotsChange", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["beatUnitDotsChange", idx], li: items[idx - start] });
                    frozen["beatUnitDotsChange"][idx] = true;
                }
            }
            (_a = reference["beatUnitDotsChange"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["beatUnitDotsChange"] = reference["beatUnitDotsChange"];
            (_b = frozen["beatUnitDotsChange"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.metronomeRelation = function (spec) {
            updates["metronomeRelation"] = spec;
            delete childBuilders["metronomeRelation;"];
            modifiedKeys["metronomeRelation"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return MetronomeBuilder;
}());
function patchMetronome(base, builder) { return builder(new MetronomeBuilder(base)).patch(); }
exports.patchMetronome = patchMetronome;
function buildMetronome(builder) { return builder(new MetronomeBuilder()).build(); }
exports.buildMetronome = buildMetronome;
var BeatUnitDotBuilder = (function () {
    function BeatUnitDotBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BeatUnitDot";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return BeatUnitDotBuilder;
}());
function patchBeatUnitDot(base, builder) { return builder(new BeatUnitDotBuilder(base)).patch(); }
exports.patchBeatUnitDot = patchBeatUnitDot;
function buildBeatUnitDot(builder) { return builder(new BeatUnitDotBuilder()).build(); }
exports.buildBeatUnitDot = buildBeatUnitDot;
var PerMinuteBuilder = (function () {
    function PerMinuteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PerMinute";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
    }
    return PerMinuteBuilder;
}());
function patchPerMinute(base, builder) { return builder(new PerMinuteBuilder(base)).patch(); }
exports.patchPerMinute = patchPerMinute;
function buildPerMinute(builder) { return builder(new PerMinuteBuilder()).build(); }
exports.buildPerMinute = buildPerMinute;
var MetronomeNoteBuilder = (function () {
    function MetronomeNoteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["metronomeDots"]) ||
                childBuilders["metronomeDots"] !== undefined ||
                updates.metronomeDots !== undefined, "metronomeDots is a required field");
            console.assert((original && !modifiedKeys["metronomeBeams"]) ||
                childBuilders["metronomeBeams"] !== undefined ||
                updates.metronomeBeams !== undefined, "metronomeBeams is a required field");
            console.assert((original && !modifiedKeys["metronomeType"]) ||
                childBuilders["metronomeType"] !== undefined ||
                updates.metronomeType !== undefined, "metronomeType is a required field");
            console.assert((original && !modifiedKeys["metronomeTuplet"]) ||
                childBuilders["metronomeTuplet"] !== undefined ||
                updates.metronomeTuplet !== undefined, "metronomeTuplet is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MetronomeNote";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.metronomeDots = function (spec) {
            updates["metronomeDots"] = spec;
            delete childBuilders["metronomeDots;"];
            modifiedKeys["metronomeDots"] = true;
            return _this;
        };
        this.metronomeDotsAt = function (idx, build) {
            makeReference("metronomeDots");
            if (frozen["metronomeDots"][idx]) {
                throw new Error("Patching metronomeDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["metronomeDots"] && !original["metronomeDots"]) {
                // Clone snapshot.
                patches.push({ p: ["metronomeDots", idx], li: original._snapshot["metronomeDots"] });
            }
            if (typeof build === 'function' && reference["metronomeDots"][idx]) {
                var patch = build(new MetronomeDotBuilder(reference["metronomeDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["metronomeDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["metronomeDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MetronomeDotBuilder(reference["metronomeDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["metronomeDots", idx], li: update });
            }
            else {
                updates["metronomeDots"] = reference["metronomeDots"]; // TODO: Merge?
            }
            reference["metronomeDots"][idx] = update;
            frozen["metronomeDots"][idx] = true;
            return _this;
        };
        this.metronomeDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("metronomeDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["metronomeDots"][idx]) {
                        throw new Error("Replacing metronomeDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["metronomeDots"][idx];
                    patches.push({ p: ["metronomeDots", idx], ld: ld, li: items[idx - start] });
                    frozen["metronomeDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["metronomeDots"][idx]) {
                        throw new Error("Removing metronomeDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["metronomeDots"][idx];
                    patches.push({ p: ["metronomeDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["metronomeDots", idx], li: items[idx - start] });
                    frozen["metronomeDots"][idx] = true;
                }
            }
            (_a = reference["metronomeDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["metronomeDots"] = reference["metronomeDots"];
            (_b = frozen["metronomeDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.metronomeBeams = function (spec) {
            updates["metronomeBeams"] = spec;
            delete childBuilders["metronomeBeams;"];
            modifiedKeys["metronomeBeams"] = true;
            return _this;
        };
        this.metronomeBeamsAt = function (idx, build) {
            makeReference("metronomeBeams");
            if (frozen["metronomeBeams"][idx]) {
                throw new Error("Patching metronomeBeams." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["metronomeBeams"] && !original["metronomeBeams"]) {
                // Clone snapshot.
                patches.push({ p: ["metronomeBeams", idx], li: original._snapshot["metronomeBeams"] });
            }
            if (typeof build === 'function' && reference["metronomeBeams"][idx]) {
                var patch = build(new MetronomeBeamBuilder(reference["metronomeBeams"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["metronomeBeams", idx].concat(patch.p);
                    return patch;
                }));
                frozen["metronomeBeams"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MetronomeBeamBuilder(reference["metronomeBeams"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["metronomeBeams", idx], li: update });
            }
            else {
                updates["metronomeBeams"] = reference["metronomeBeams"]; // TODO: Merge?
            }
            reference["metronomeBeams"][idx] = update;
            frozen["metronomeBeams"][idx] = true;
            return _this;
        };
        this.metronomeBeamsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("metronomeBeams");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["metronomeBeams"][idx]) {
                        throw new Error("Replacing metronomeBeams." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["metronomeBeams"][idx];
                    patches.push({ p: ["metronomeBeams", idx], ld: ld, li: items[idx - start] });
                    frozen["metronomeBeams"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["metronomeBeams"][idx]) {
                        throw new Error("Removing metronomeBeams." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["metronomeBeams"][idx];
                    patches.push({ p: ["metronomeBeams", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["metronomeBeams", idx], li: items[idx - start] });
                    frozen["metronomeBeams"][idx] = true;
                }
            }
            (_a = reference["metronomeBeams"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["metronomeBeams"] = reference["metronomeBeams"];
            (_b = frozen["metronomeBeams"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.metronomeType = function (spec) {
            updates["metronomeType"] = spec;
            delete childBuilders["metronomeType;"];
            modifiedKeys["metronomeType"] = true;
            return _this;
        };
        this.metronomeTuplet = function (build) {
            if (typeof build === 'function') {
                delete updates["metronomeTuplet"];
                var builder = build(new MetronomeTupletBuilder(original && original["metronomeTuplet"]));
                if (!original)
                    updates["metronomeTuplet"] = builder.build();
                else
                    childBuilders["metronomeTuplet"] = builder;
            }
            else {
                updates.metronomeTuplet = build;
                delete childBuilders["metronomeTuplet;"];
            }
            modifiedKeys["metronomeTuplet"] = true;
            return _this;
        };
    }
    return MetronomeNoteBuilder;
}());
function patchMetronomeNote(base, builder) { return builder(new MetronomeNoteBuilder(base)).patch(); }
exports.patchMetronomeNote = patchMetronomeNote;
function buildMetronomeNote(builder) { return builder(new MetronomeNoteBuilder()).build(); }
exports.buildMetronomeNote = buildMetronomeNote;
var MetronomeDotBuilder = (function () {
    function MetronomeDotBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MetronomeDot";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return MetronomeDotBuilder;
}());
function patchMetronomeDot(base, builder) { return builder(new MetronomeDotBuilder(base)).patch(); }
exports.patchMetronomeDot = patchMetronomeDot;
function buildMetronomeDot(builder) { return builder(new MetronomeDotBuilder()).build(); }
exports.buildMetronomeDot = buildMetronomeDot;
var MetronomeBeamBuilder = (function () {
    function MetronomeBeamBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MetronomeBeam";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
    }
    return MetronomeBeamBuilder;
}());
function patchMetronomeBeam(base, builder) { return builder(new MetronomeBeamBuilder(base)).patch(); }
exports.patchMetronomeBeam = patchMetronomeBeam;
function buildMetronomeBeam(builder) { return builder(new MetronomeBeamBuilder()).build(); }
exports.buildMetronomeBeam = buildMetronomeBeam;
var MetronomeTupletBuilder = (function () {
    function MetronomeTupletBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["actualNotes"]) ||
                childBuilders["actualNotes"] !== undefined ||
                updates.actualNotes !== undefined, "actualNotes is a required field");
            console.assert((original && !modifiedKeys["bracket"]) ||
                childBuilders["bracket"] !== undefined ||
                updates.bracket !== undefined, "bracket is a required field");
            console.assert((original && !modifiedKeys["showNumber"]) ||
                childBuilders["showNumber"] !== undefined ||
                updates.showNumber !== undefined, "showNumber is a required field");
            console.assert((original && !modifiedKeys["normalType"]) ||
                childBuilders["normalType"] !== undefined ||
                updates.normalType !== undefined, "normalType is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["normalNotes"]) ||
                childBuilders["normalNotes"] !== undefined ||
                updates.normalNotes !== undefined, "normalNotes is a required field");
            console.assert((original && !modifiedKeys["normalDots"]) ||
                childBuilders["normalDots"] !== undefined ||
                updates.normalDots !== undefined, "normalDots is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MetronomeTuplet";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.actualNotes = function (spec) {
            updates["actualNotes"] = spec;
            delete childBuilders["actualNotes;"];
            modifiedKeys["actualNotes"] = true;
            return _this;
        };
        this.bracket = function (spec) {
            updates["bracket"] = spec;
            delete childBuilders["bracket;"];
            modifiedKeys["bracket"] = true;
            return _this;
        };
        this.showNumber = function (spec) {
            updates["showNumber"] = spec;
            delete childBuilders["showNumber;"];
            modifiedKeys["showNumber"] = true;
            return _this;
        };
        this.normalType = function (spec) {
            updates["normalType"] = spec;
            delete childBuilders["normalType;"];
            modifiedKeys["normalType"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.normalNotes = function (spec) {
            updates["normalNotes"] = spec;
            delete childBuilders["normalNotes;"];
            modifiedKeys["normalNotes"] = true;
            return _this;
        };
        this.normalDots = function (spec) {
            updates["normalDots"] = spec;
            delete childBuilders["normalDots;"];
            modifiedKeys["normalDots"] = true;
            return _this;
        };
        this.normalDotsAt = function (idx, build) {
            makeReference("normalDots");
            if (frozen["normalDots"][idx]) {
                throw new Error("Patching normalDots." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["normalDots"] && !original["normalDots"]) {
                // Clone snapshot.
                patches.push({ p: ["normalDots", idx], li: original._snapshot["normalDots"] });
            }
            if (typeof build === 'function' && reference["normalDots"][idx]) {
                var patch = build(new NormalDotBuilder(reference["normalDots"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["normalDots", idx].concat(patch.p);
                    return patch;
                }));
                frozen["normalDots"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new NormalDotBuilder(reference["normalDots"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["normalDots", idx], li: update });
            }
            else {
                updates["normalDots"] = reference["normalDots"]; // TODO: Merge?
            }
            reference["normalDots"][idx] = update;
            frozen["normalDots"][idx] = true;
            return _this;
        };
        this.normalDotsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("normalDots");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["normalDots"][idx]) {
                        throw new Error("Replacing normalDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["normalDots"][idx];
                    patches.push({ p: ["normalDots", idx], ld: ld, li: items[idx - start] });
                    frozen["normalDots"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["normalDots"][idx]) {
                        throw new Error("Removing normalDots." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["normalDots"][idx];
                    patches.push({ p: ["normalDots", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["normalDots", idx], li: items[idx - start] });
                    frozen["normalDots"][idx] = true;
                }
            }
            (_a = reference["normalDots"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["normalDots"] = reference["normalDots"];
            (_b = frozen["normalDots"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return MetronomeTupletBuilder;
}());
function patchMetronomeTuplet(base, builder) { return builder(new MetronomeTupletBuilder(base)).patch(); }
exports.patchMetronomeTuplet = patchMetronomeTuplet;
function buildMetronomeTuplet(builder) { return builder(new MetronomeTupletBuilder()).build(); }
exports.buildMetronomeTuplet = buildMetronomeTuplet;
var OctaveShiftBuilder = (function () {
    function OctaveShiftBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["size"]) ||
                childBuilders["size"] !== undefined ||
                updates.size !== undefined, "size is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "OctaveShift";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.size = function (spec) {
            updates["size"] = spec;
            delete childBuilders["size;"];
            modifiedKeys["size"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.dashLength = function (spec) {
            updates["dashLength"] = spec;
            delete childBuilders["dashLength;"];
            modifiedKeys["dashLength"] = true;
            return _this;
        };
        this.spaceLength = function (spec) {
            updates["spaceLength"] = spec;
            delete childBuilders["spaceLength;"];
            modifiedKeys["spaceLength"] = true;
            return _this;
        };
    }
    return OctaveShiftBuilder;
}());
function patchOctaveShift(base, builder) { return builder(new OctaveShiftBuilder(base)).patch(); }
exports.patchOctaveShift = patchOctaveShift;
function buildOctaveShift(builder) { return builder(new OctaveShiftBuilder()).build(); }
exports.buildOctaveShift = buildOctaveShift;
var HarpPedalsBuilder = (function () {
    function HarpPedalsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["pedalTunings"]) ||
                childBuilders["pedalTunings"] !== undefined ||
                updates.pedalTunings !== undefined, "pedalTunings is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "HarpPedals";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.pedalTunings = function (spec) {
            updates["pedalTunings"] = spec;
            delete childBuilders["pedalTunings;"];
            modifiedKeys["pedalTunings"] = true;
            return _this;
        };
        this.pedalTuningsAt = function (idx, build) {
            makeReference("pedalTunings");
            if (frozen["pedalTunings"][idx]) {
                throw new Error("Patching pedalTunings." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["pedalTunings"] && !original["pedalTunings"]) {
                // Clone snapshot.
                patches.push({ p: ["pedalTunings", idx], li: original._snapshot["pedalTunings"] });
            }
            if (typeof build === 'function' && reference["pedalTunings"][idx]) {
                var patch = build(new PedalTuningBuilder(reference["pedalTunings"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["pedalTunings", idx].concat(patch.p);
                    return patch;
                }));
                frozen["pedalTunings"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new PedalTuningBuilder(reference["pedalTunings"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["pedalTunings", idx], li: update });
            }
            else {
                updates["pedalTunings"] = reference["pedalTunings"]; // TODO: Merge?
            }
            reference["pedalTunings"][idx] = update;
            frozen["pedalTunings"][idx] = true;
            return _this;
        };
        this.pedalTuningsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("pedalTunings");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["pedalTunings"][idx]) {
                        throw new Error("Replacing pedalTunings." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["pedalTunings"][idx];
                    patches.push({ p: ["pedalTunings", idx], ld: ld, li: items[idx - start] });
                    frozen["pedalTunings"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["pedalTunings"][idx]) {
                        throw new Error("Removing pedalTunings." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["pedalTunings"][idx];
                    patches.push({ p: ["pedalTunings", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["pedalTunings", idx], li: items[idx - start] });
                    frozen["pedalTunings"][idx] = true;
                }
            }
            (_a = reference["pedalTunings"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["pedalTunings"] = reference["pedalTunings"];
            (_b = frozen["pedalTunings"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return HarpPedalsBuilder;
}());
function patchHarpPedals(base, builder) { return builder(new HarpPedalsBuilder(base)).patch(); }
exports.patchHarpPedals = patchHarpPedals;
function buildHarpPedals(builder) { return builder(new HarpPedalsBuilder()).build(); }
exports.buildHarpPedals = buildHarpPedals;
var PedalTuningBuilder = (function () {
    function PedalTuningBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["pedalStep"]) ||
                childBuilders["pedalStep"] !== undefined ||
                updates.pedalStep !== undefined, "pedalStep is a required field");
            console.assert((original && !modifiedKeys["pedalAlter"]) ||
                childBuilders["pedalAlter"] !== undefined ||
                updates.pedalAlter !== undefined, "pedalAlter is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PedalTuning";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.pedalStep = function (spec) {
            updates["pedalStep"] = spec;
            delete childBuilders["pedalStep;"];
            modifiedKeys["pedalStep"] = true;
            return _this;
        };
        this.pedalAlter = function (spec) {
            updates["pedalAlter"] = spec;
            delete childBuilders["pedalAlter;"];
            modifiedKeys["pedalAlter"] = true;
            return _this;
        };
    }
    return PedalTuningBuilder;
}());
function patchPedalTuning(base, builder) { return builder(new PedalTuningBuilder(base)).patch(); }
exports.patchPedalTuning = patchPedalTuning;
function buildPedalTuning(builder) { return builder(new PedalTuningBuilder()).build(); }
exports.buildPedalTuning = buildPedalTuning;
var DampBuilder = (function () {
    function DampBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Damp";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return DampBuilder;
}());
function patchDamp(base, builder) { return builder(new DampBuilder(base)).patch(); }
exports.patchDamp = patchDamp;
function buildDamp(builder) { return builder(new DampBuilder()).build(); }
exports.buildDamp = buildDamp;
var DampAllBuilder = (function () {
    function DampAllBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DampAll";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return DampAllBuilder;
}());
function patchDampAll(base, builder) { return builder(new DampAllBuilder(base)).patch(); }
exports.patchDampAll = patchDampAll;
function buildDampAll(builder) { return builder(new DampAllBuilder()).build(); }
exports.buildDampAll = buildDampAll;
var EyeglassesBuilder = (function () {
    function EyeglassesBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Eyeglasses";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return EyeglassesBuilder;
}());
function patchEyeglasses(base, builder) { return builder(new EyeglassesBuilder(base)).patch(); }
exports.patchEyeglasses = patchEyeglasses;
function buildEyeglasses(builder) { return builder(new EyeglassesBuilder()).build(); }
exports.buildEyeglasses = buildEyeglasses;
var StringMuteBuilder = (function () {
    function StringMuteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "StringMute";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return StringMuteBuilder;
}());
function patchStringMute(base, builder) { return builder(new StringMuteBuilder(base)).patch(); }
exports.patchStringMute = patchStringMute;
function buildStringMute(builder) { return builder(new StringMuteBuilder()).build(); }
exports.buildStringMute = buildStringMute;
var ScordaturaBuilder = (function () {
    function ScordaturaBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["accords"]) ||
                childBuilders["accords"] !== undefined ||
                updates.accords !== undefined, "accords is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Scordatura";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.accords = function (spec) {
            updates["accords"] = spec;
            delete childBuilders["accords;"];
            modifiedKeys["accords"] = true;
            return _this;
        };
        this.accordsAt = function (idx, build) {
            makeReference("accords");
            if (frozen["accords"][idx]) {
                throw new Error("Patching accords." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["accords"] && !original["accords"]) {
                // Clone snapshot.
                patches.push({ p: ["accords", idx], li: original._snapshot["accords"] });
            }
            if (typeof build === 'function' && reference["accords"][idx]) {
                var patch = build(new AccordBuilder(reference["accords"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["accords", idx].concat(patch.p);
                    return patch;
                }));
                frozen["accords"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new AccordBuilder(reference["accords"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["accords", idx], li: update });
            }
            else {
                updates["accords"] = reference["accords"]; // TODO: Merge?
            }
            reference["accords"][idx] = update;
            frozen["accords"][idx] = true;
            return _this;
        };
        this.accordsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("accords");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["accords"][idx]) {
                        throw new Error("Replacing accords." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["accords"][idx];
                    patches.push({ p: ["accords", idx], ld: ld, li: items[idx - start] });
                    frozen["accords"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["accords"][idx]) {
                        throw new Error("Removing accords." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["accords"][idx];
                    patches.push({ p: ["accords", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["accords", idx], li: items[idx - start] });
                    frozen["accords"][idx] = true;
                }
            }
            (_a = reference["accords"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["accords"] = reference["accords"];
            (_b = frozen["accords"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
    }
    return ScordaturaBuilder;
}());
function patchScordatura(base, builder) { return builder(new ScordaturaBuilder(base)).patch(); }
exports.patchScordatura = patchScordatura;
function buildScordatura(builder) { return builder(new ScordaturaBuilder()).build(); }
exports.buildScordatura = buildScordatura;
var AccordBuilder = (function () {
    function AccordBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["tuningAlter"]) ||
                childBuilders["tuningAlter"] !== undefined ||
                updates.tuningAlter !== undefined, "tuningAlter is a required field");
            console.assert((original && !modifiedKeys["string"]) ||
                childBuilders["string"] !== undefined ||
                updates.string !== undefined, "string is a required field");
            console.assert((original && !modifiedKeys["tuningStep"]) ||
                childBuilders["tuningStep"] !== undefined ||
                updates.tuningStep !== undefined, "tuningStep is a required field");
            console.assert((original && !modifiedKeys["tuningOctave"]) ||
                childBuilders["tuningOctave"] !== undefined ||
                updates.tuningOctave !== undefined, "tuningOctave is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Accord";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.tuningAlter = function (spec) {
            updates["tuningAlter"] = spec;
            delete childBuilders["tuningAlter;"];
            modifiedKeys["tuningAlter"] = true;
            return _this;
        };
        this.string = function (spec) {
            updates["string"] = spec;
            delete childBuilders["string;"];
            modifiedKeys["string"] = true;
            return _this;
        };
        this.tuningStep = function (spec) {
            updates["tuningStep"] = spec;
            delete childBuilders["tuningStep;"];
            modifiedKeys["tuningStep"] = true;
            return _this;
        };
        this.tuningOctave = function (spec) {
            updates["tuningOctave"] = spec;
            delete childBuilders["tuningOctave;"];
            modifiedKeys["tuningOctave"] = true;
            return _this;
        };
    }
    return AccordBuilder;
}());
function patchAccord(base, builder) { return builder(new AccordBuilder(base)).patch(); }
exports.patchAccord = patchAccord;
function buildAccord(builder) { return builder(new AccordBuilder()).build(); }
exports.buildAccord = buildAccord;
var ImageBuilder = (function () {
    function ImageBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["source"]) ||
                childBuilders["source"] !== undefined ||
                updates.source !== undefined, "source is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Image";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.source = function (spec) {
            updates["source"] = spec;
            delete childBuilders["source;"];
            modifiedKeys["source"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valignImage = function (spec) {
            updates["valignImage"] = spec;
            delete childBuilders["valignImage;"];
            modifiedKeys["valignImage"] = true;
            return _this;
        };
    }
    return ImageBuilder;
}());
function patchImage(base, builder) { return builder(new ImageBuilder(base)).patch(); }
exports.patchImage = patchImage;
function buildImage(builder) { return builder(new ImageBuilder()).build(); }
exports.buildImage = buildImage;
var PrincipalVoiceBuilder = (function () {
    function PrincipalVoiceBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["symbol"]) ||
                childBuilders["symbol"] !== undefined ||
                updates.symbol !== undefined, "symbol is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PrincipalVoice";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.symbol = function (spec) {
            updates["symbol"] = spec;
            delete childBuilders["symbol;"];
            modifiedKeys["symbol"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return PrincipalVoiceBuilder;
}());
function patchPrincipalVoice(base, builder) { return builder(new PrincipalVoiceBuilder(base)).patch(); }
exports.patchPrincipalVoice = patchPrincipalVoice;
function buildPrincipalVoice(builder) { return builder(new PrincipalVoiceBuilder()).build(); }
exports.buildPrincipalVoice = buildPrincipalVoice;
var AccordionRegistrationBuilder = (function () {
    function AccordionRegistrationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["accordionMiddle"]) ||
                childBuilders["accordionMiddle"] !== undefined ||
                updates.accordionMiddle !== undefined, "accordionMiddle is a required field");
            console.assert((original && !modifiedKeys["accordionHigh"]) ||
                childBuilders["accordionHigh"] !== undefined ||
                updates.accordionHigh !== undefined, "accordionHigh is a required field");
            console.assert((original && !modifiedKeys["accordionLow"]) ||
                childBuilders["accordionLow"] !== undefined ||
                updates.accordionLow !== undefined, "accordionLow is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "AccordionRegistration";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.accordionMiddle = function (spec) {
            updates["accordionMiddle"] = spec;
            delete childBuilders["accordionMiddle;"];
            modifiedKeys["accordionMiddle"] = true;
            return _this;
        };
        this.accordionHigh = function (spec) {
            updates["accordionHigh"] = spec;
            delete childBuilders["accordionHigh;"];
            modifiedKeys["accordionHigh"] = true;
            return _this;
        };
        this.accordionLow = function (spec) {
            updates["accordionLow"] = spec;
            delete childBuilders["accordionLow;"];
            modifiedKeys["accordionLow"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return AccordionRegistrationBuilder;
}());
function patchAccordionRegistration(base, builder) { return builder(new AccordionRegistrationBuilder(base)).patch(); }
exports.patchAccordionRegistration = patchAccordionRegistration;
function buildAccordionRegistration(builder) { return builder(new AccordionRegistrationBuilder()).build(); }
exports.buildAccordionRegistration = buildAccordionRegistration;
var PercussionBuilder = (function () {
    function PercussionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["stickLocation"]) ||
                childBuilders["stickLocation"] !== undefined ||
                updates.stickLocation !== undefined, "stickLocation is a required field");
            console.assert((original && !modifiedKeys["otherPercussion"]) ||
                childBuilders["otherPercussion"] !== undefined ||
                updates.otherPercussion !== undefined, "otherPercussion is a required field");
            console.assert((original && !modifiedKeys["wood"]) ||
                childBuilders["wood"] !== undefined ||
                updates.wood !== undefined, "wood is a required field");
            console.assert((original && !modifiedKeys["effect"]) ||
                childBuilders["effect"] !== undefined ||
                updates.effect !== undefined, "effect is a required field");
            console.assert((original && !modifiedKeys["glass"]) ||
                childBuilders["glass"] !== undefined ||
                updates.glass !== undefined, "glass is a required field");
            console.assert((original && !modifiedKeys["timpani"]) ||
                childBuilders["timpani"] !== undefined ||
                updates.timpani !== undefined, "timpani is a required field");
            console.assert((original && !modifiedKeys["stick"]) ||
                childBuilders["stick"] !== undefined ||
                updates.stick !== undefined, "stick is a required field");
            console.assert((original && !modifiedKeys["metal"]) ||
                childBuilders["metal"] !== undefined ||
                updates.metal !== undefined, "metal is a required field");
            console.assert((original && !modifiedKeys["pitched"]) ||
                childBuilders["pitched"] !== undefined ||
                updates.pitched !== undefined, "pitched is a required field");
            console.assert((original && !modifiedKeys["membrane"]) ||
                childBuilders["membrane"] !== undefined ||
                updates.membrane !== undefined, "membrane is a required field");
            console.assert((original && !modifiedKeys["beater"]) ||
                childBuilders["beater"] !== undefined ||
                updates.beater !== undefined, "beater is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Percussion";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.stickLocation = function (spec) {
            updates["stickLocation"] = spec;
            delete childBuilders["stickLocation;"];
            modifiedKeys["stickLocation"] = true;
            return _this;
        };
        this.otherPercussion = function (spec) {
            updates["otherPercussion"] = spec;
            delete childBuilders["otherPercussion;"];
            modifiedKeys["otherPercussion"] = true;
            return _this;
        };
        this.wood = function (spec) {
            updates["wood"] = spec;
            delete childBuilders["wood;"];
            modifiedKeys["wood"] = true;
            return _this;
        };
        this.effect = function (spec) {
            updates["effect"] = spec;
            delete childBuilders["effect;"];
            modifiedKeys["effect"] = true;
            return _this;
        };
        this.glass = function (spec) {
            updates["glass"] = spec;
            delete childBuilders["glass;"];
            modifiedKeys["glass"] = true;
            return _this;
        };
        this.timpani = function (build) {
            if (typeof build === 'function') {
                delete updates["timpani"];
                var builder = build(new TimpaniBuilder(original && original["timpani"]));
                if (!original)
                    updates["timpani"] = builder.build();
                else
                    childBuilders["timpani"] = builder;
            }
            else {
                updates.timpani = build;
                delete childBuilders["timpani;"];
            }
            modifiedKeys["timpani"] = true;
            return _this;
        };
        this.stick = function (build) {
            if (typeof build === 'function') {
                delete updates["stick"];
                var builder = build(new StickBuilder(original && original["stick"]));
                if (!original)
                    updates["stick"] = builder.build();
                else
                    childBuilders["stick"] = builder;
            }
            else {
                updates.stick = build;
                delete childBuilders["stick;"];
            }
            modifiedKeys["stick"] = true;
            return _this;
        };
        this.metal = function (spec) {
            updates["metal"] = spec;
            delete childBuilders["metal;"];
            modifiedKeys["metal"] = true;
            return _this;
        };
        this.pitched = function (spec) {
            updates["pitched"] = spec;
            delete childBuilders["pitched;"];
            modifiedKeys["pitched"] = true;
            return _this;
        };
        this.membrane = function (spec) {
            updates["membrane"] = spec;
            delete childBuilders["membrane;"];
            modifiedKeys["membrane"] = true;
            return _this;
        };
        this.beater = function (build) {
            if (typeof build === 'function') {
                delete updates["beater"];
                var builder = build(new BeaterBuilder(original && original["beater"]));
                if (!original)
                    updates["beater"] = builder.build();
                else
                    childBuilders["beater"] = builder;
            }
            else {
                updates.beater = build;
                delete childBuilders["beater;"];
            }
            modifiedKeys["beater"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return PercussionBuilder;
}());
function patchPercussion(base, builder) { return builder(new PercussionBuilder(base)).patch(); }
exports.patchPercussion = patchPercussion;
function buildPercussion(builder) { return builder(new PercussionBuilder()).build(); }
exports.buildPercussion = buildPercussion;
var TimpaniBuilder = (function () {
    function TimpaniBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Timpani";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return TimpaniBuilder;
}());
function patchTimpani(base, builder) { return builder(new TimpaniBuilder(base)).patch(); }
exports.patchTimpani = patchTimpani;
function buildTimpani(builder) { return builder(new TimpaniBuilder()).build(); }
exports.buildTimpani = buildTimpani;
var BeaterBuilder = (function () {
    function BeaterBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
            console.assert((original && !modifiedKeys["tip"]) ||
                childBuilders["tip"] !== undefined ||
                updates.tip !== undefined, "tip is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Beater";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.tip = function (spec) {
            updates["tip"] = spec;
            delete childBuilders["tip;"];
            modifiedKeys["tip"] = true;
            return _this;
        };
    }
    return BeaterBuilder;
}());
function patchBeater(base, builder) { return builder(new BeaterBuilder(base)).patch(); }
exports.patchBeater = patchBeater;
function buildBeater(builder) { return builder(new BeaterBuilder()).build(); }
exports.buildBeater = buildBeater;
var StickBuilder = (function () {
    function StickBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["stickMaterial"]) ||
                childBuilders["stickMaterial"] !== undefined ||
                updates.stickMaterial !== undefined, "stickMaterial is a required field");
            console.assert((original && !modifiedKeys["stickType"]) ||
                childBuilders["stickType"] !== undefined ||
                updates.stickType !== undefined, "stickType is a required field");
            console.assert((original && !modifiedKeys["tip"]) ||
                childBuilders["tip"] !== undefined ||
                updates.tip !== undefined, "tip is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Stick";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.stickMaterial = function (spec) {
            updates["stickMaterial"] = spec;
            delete childBuilders["stickMaterial;"];
            modifiedKeys["stickMaterial"] = true;
            return _this;
        };
        this.stickType = function (spec) {
            updates["stickType"] = spec;
            delete childBuilders["stickType;"];
            modifiedKeys["stickType"] = true;
            return _this;
        };
        this.tip = function (spec) {
            updates["tip"] = spec;
            delete childBuilders["tip;"];
            modifiedKeys["tip"] = true;
            return _this;
        };
    }
    return StickBuilder;
}());
function patchStick(base, builder) { return builder(new StickBuilder(base)).patch(); }
exports.patchStick = patchStick;
function buildStick(builder) { return builder(new StickBuilder()).build(); }
exports.buildStick = buildStick;
var OffsetBuilder = (function () {
    function OffsetBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
            console.assert((original && !modifiedKeys["sound"]) ||
                childBuilders["sound"] !== undefined ||
                updates.sound !== undefined, "sound is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Offset";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.sound = function (spec) {
            updates["sound"] = spec;
            delete childBuilders["sound;"];
            modifiedKeys["sound"] = true;
            return _this;
        };
    }
    return OffsetBuilder;
}());
function patchOffset(base, builder) { return builder(new OffsetBuilder(base)).patch(); }
exports.patchOffset = patchOffset;
function buildOffset(builder) { return builder(new OffsetBuilder()).build(); }
exports.buildOffset = buildOffset;
var HarmonyChordBuilder = (function () {
    function HarmonyChordBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["root"]) ||
                childBuilders["root"] !== undefined ||
                updates.root !== undefined, "root is a required field");
            console.assert((original && !modifiedKeys["function"]) ||
                childBuilders["function"] !== undefined ||
                updates.function !== undefined, "function is a required field");
            console.assert((original && !modifiedKeys["kind"]) ||
                childBuilders["kind"] !== undefined ||
                updates.kind !== undefined, "kind is a required field");
            console.assert((original && !modifiedKeys["degrees"]) ||
                childBuilders["degrees"] !== undefined ||
                updates.degrees !== undefined, "degrees is a required field");
            console.assert((original && !modifiedKeys["inversion"]) ||
                childBuilders["inversion"] !== undefined ||
                updates.inversion !== undefined, "inversion is a required field");
            console.assert((original && !modifiedKeys["bass"]) ||
                childBuilders["bass"] !== undefined ||
                updates.bass !== undefined, "bass is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "HarmonyChord";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.root = function (build) {
            if (typeof build === 'function') {
                delete updates["root"];
                var builder = build(new RootBuilder(original && original["root"]));
                if (!original)
                    updates["root"] = builder.build();
                else
                    childBuilders["root"] = builder;
            }
            else {
                updates.root = build;
                delete childBuilders["root;"];
            }
            modifiedKeys["root"] = true;
            return _this;
        };
        this.function = function (build) {
            if (typeof build === 'function') {
                delete updates["function"];
                var builder = build(new FunctionBuilder(original && original["function"]));
                if (!original)
                    updates["function"] = builder.build();
                else
                    childBuilders["function"] = builder;
            }
            else {
                updates.function = build;
                delete childBuilders["function;"];
            }
            modifiedKeys["function"] = true;
            return _this;
        };
        this.kind = function (build) {
            if (typeof build === 'function') {
                delete updates["kind"];
                var builder = build(new KindBuilder(original && original["kind"]));
                if (!original)
                    updates["kind"] = builder.build();
                else
                    childBuilders["kind"] = builder;
            }
            else {
                updates.kind = build;
                delete childBuilders["kind;"];
            }
            modifiedKeys["kind"] = true;
            return _this;
        };
        this.degrees = function (spec) {
            updates["degrees"] = spec;
            delete childBuilders["degrees;"];
            modifiedKeys["degrees"] = true;
            return _this;
        };
        this.degreesAt = function (idx, build) {
            makeReference("degrees");
            if (frozen["degrees"][idx]) {
                throw new Error("Patching degrees." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["degrees"] && !original["degrees"]) {
                // Clone snapshot.
                patches.push({ p: ["degrees", idx], li: original._snapshot["degrees"] });
            }
            if (typeof build === 'function' && reference["degrees"][idx]) {
                var patch = build(new DegreeBuilder(reference["degrees"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["degrees", idx].concat(patch.p);
                    return patch;
                }));
                frozen["degrees"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new DegreeBuilder(reference["degrees"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["degrees", idx], li: update });
            }
            else {
                updates["degrees"] = reference["degrees"]; // TODO: Merge?
            }
            reference["degrees"][idx] = update;
            frozen["degrees"][idx] = true;
            return _this;
        };
        this.degreesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("degrees");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["degrees"][idx]) {
                        throw new Error("Replacing degrees." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["degrees"][idx];
                    patches.push({ p: ["degrees", idx], ld: ld, li: items[idx - start] });
                    frozen["degrees"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["degrees"][idx]) {
                        throw new Error("Removing degrees." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["degrees"][idx];
                    patches.push({ p: ["degrees", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["degrees", idx], li: items[idx - start] });
                    frozen["degrees"][idx] = true;
                }
            }
            (_a = reference["degrees"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["degrees"] = reference["degrees"];
            (_b = frozen["degrees"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.inversion = function (build) {
            if (typeof build === 'function') {
                delete updates["inversion"];
                var builder = build(new InversionBuilder(original && original["inversion"]));
                if (!original)
                    updates["inversion"] = builder.build();
                else
                    childBuilders["inversion"] = builder;
            }
            else {
                updates.inversion = build;
                delete childBuilders["inversion;"];
            }
            modifiedKeys["inversion"] = true;
            return _this;
        };
        this.bass = function (build) {
            if (typeof build === 'function') {
                delete updates["bass"];
                var builder = build(new BassBuilder(original && original["bass"]));
                if (!original)
                    updates["bass"] = builder.build();
                else
                    childBuilders["bass"] = builder;
            }
            else {
                updates.bass = build;
                delete childBuilders["bass;"];
            }
            modifiedKeys["bass"] = true;
            return _this;
        };
    }
    return HarmonyChordBuilder;
}());
function patchHarmonyChord(base, builder) { return builder(new HarmonyChordBuilder(base)).patch(); }
exports.patchHarmonyChord = patchHarmonyChord;
function buildHarmonyChord(builder) { return builder(new HarmonyChordBuilder()).build(); }
exports.buildHarmonyChord = buildHarmonyChord;
var HarmonyBuilder = (function () {
    function HarmonyBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["frame"]) ||
                childBuilders["frame"] !== undefined ||
                updates.frame !== undefined, "frame is a required field");
            console.assert((original && !modifiedKeys["printFrame"]) ||
                childBuilders["printFrame"] !== undefined ||
                updates.printFrame !== undefined, "printFrame is a required field");
            console.assert((original && !modifiedKeys["staff"]) ||
                childBuilders["staff"] !== undefined ||
                updates.staff !== undefined, "staff is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["offset"]) ||
                childBuilders["offset"] !== undefined ||
                updates.offset !== undefined, "offset is a required field");
            console.assert((original && !modifiedKeys["root"]) ||
                childBuilders["root"] !== undefined ||
                updates.root !== undefined, "root is a required field");
            console.assert((original && !modifiedKeys["function"]) ||
                childBuilders["function"] !== undefined ||
                updates.function !== undefined, "function is a required field");
            console.assert((original && !modifiedKeys["kind"]) ||
                childBuilders["kind"] !== undefined ||
                updates.kind !== undefined, "kind is a required field");
            console.assert((original && !modifiedKeys["degrees"]) ||
                childBuilders["degrees"] !== undefined ||
                updates.degrees !== undefined, "degrees is a required field");
            console.assert((original && !modifiedKeys["inversion"]) ||
                childBuilders["inversion"] !== undefined ||
                updates.inversion !== undefined, "inversion is a required field");
            console.assert((original && !modifiedKeys["bass"]) ||
                childBuilders["bass"] !== undefined ||
                updates.bass !== undefined, "bass is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Harmony";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.frame = function (build) {
            if (typeof build === 'function') {
                delete updates["frame"];
                var builder = build(new FrameBuilder(original && original["frame"]));
                if (!original)
                    updates["frame"] = builder.build();
                else
                    childBuilders["frame"] = builder;
            }
            else {
                updates.frame = build;
                delete childBuilders["frame;"];
            }
            modifiedKeys["frame"] = true;
            return _this;
        };
        this.printFrame = function (spec) {
            updates["printFrame"] = spec;
            delete childBuilders["printFrame;"];
            modifiedKeys["printFrame"] = true;
            return _this;
        };
        this.staff = function (spec) {
            updates["staff"] = spec;
            delete childBuilders["staff;"];
            modifiedKeys["staff"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.offset = function (build) {
            if (typeof build === 'function') {
                delete updates["offset"];
                var builder = build(new OffsetBuilder(original && original["offset"]));
                if (!original)
                    updates["offset"] = builder.build();
                else
                    childBuilders["offset"] = builder;
            }
            else {
                updates.offset = build;
                delete childBuilders["offset;"];
            }
            modifiedKeys["offset"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.placement = function (spec) {
            updates["placement"] = spec;
            delete childBuilders["placement;"];
            modifiedKeys["placement"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
        this.root = function (build) {
            if (typeof build === 'function') {
                delete updates["root"];
                var builder = build(new RootBuilder(original && original["root"]));
                if (!original)
                    updates["root"] = builder.build();
                else
                    childBuilders["root"] = builder;
            }
            else {
                updates.root = build;
                delete childBuilders["root;"];
            }
            modifiedKeys["root"] = true;
            return _this;
        };
        this.function = function (build) {
            if (typeof build === 'function') {
                delete updates["function"];
                var builder = build(new FunctionBuilder(original && original["function"]));
                if (!original)
                    updates["function"] = builder.build();
                else
                    childBuilders["function"] = builder;
            }
            else {
                updates.function = build;
                delete childBuilders["function;"];
            }
            modifiedKeys["function"] = true;
            return _this;
        };
        this.kind = function (build) {
            if (typeof build === 'function') {
                delete updates["kind"];
                var builder = build(new KindBuilder(original && original["kind"]));
                if (!original)
                    updates["kind"] = builder.build();
                else
                    childBuilders["kind"] = builder;
            }
            else {
                updates.kind = build;
                delete childBuilders["kind;"];
            }
            modifiedKeys["kind"] = true;
            return _this;
        };
        this.degrees = function (spec) {
            updates["degrees"] = spec;
            delete childBuilders["degrees;"];
            modifiedKeys["degrees"] = true;
            return _this;
        };
        this.degreesAt = function (idx, build) {
            makeReference("degrees");
            if (frozen["degrees"][idx]) {
                throw new Error("Patching degrees." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["degrees"] && !original["degrees"]) {
                // Clone snapshot.
                patches.push({ p: ["degrees", idx], li: original._snapshot["degrees"] });
            }
            if (typeof build === 'function' && reference["degrees"][idx]) {
                var patch = build(new DegreeBuilder(reference["degrees"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["degrees", idx].concat(patch.p);
                    return patch;
                }));
                frozen["degrees"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new DegreeBuilder(reference["degrees"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["degrees", idx], li: update });
            }
            else {
                updates["degrees"] = reference["degrees"]; // TODO: Merge?
            }
            reference["degrees"][idx] = update;
            frozen["degrees"][idx] = true;
            return _this;
        };
        this.degreesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("degrees");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["degrees"][idx]) {
                        throw new Error("Replacing degrees." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["degrees"][idx];
                    patches.push({ p: ["degrees", idx], ld: ld, li: items[idx - start] });
                    frozen["degrees"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["degrees"][idx]) {
                        throw new Error("Removing degrees." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["degrees"][idx];
                    patches.push({ p: ["degrees", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["degrees", idx], li: items[idx - start] });
                    frozen["degrees"][idx] = true;
                }
            }
            (_a = reference["degrees"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["degrees"] = reference["degrees"];
            (_b = frozen["degrees"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.inversion = function (build) {
            if (typeof build === 'function') {
                delete updates["inversion"];
                var builder = build(new InversionBuilder(original && original["inversion"]));
                if (!original)
                    updates["inversion"] = builder.build();
                else
                    childBuilders["inversion"] = builder;
            }
            else {
                updates.inversion = build;
                delete childBuilders["inversion;"];
            }
            modifiedKeys["inversion"] = true;
            return _this;
        };
        this.bass = function (build) {
            if (typeof build === 'function') {
                delete updates["bass"];
                var builder = build(new BassBuilder(original && original["bass"]));
                if (!original)
                    updates["bass"] = builder.build();
                else
                    childBuilders["bass"] = builder;
            }
            else {
                updates.bass = build;
                delete childBuilders["bass;"];
            }
            modifiedKeys["bass"] = true;
            return _this;
        };
    }
    return HarmonyBuilder;
}());
function patchHarmony(base, builder) { return builder(new HarmonyBuilder(base)).patch(); }
exports.patchHarmony = patchHarmony;
function buildHarmony(builder) { return builder(new HarmonyBuilder()).build(); }
exports.buildHarmony = buildHarmony;
var RootBuilder = (function () {
    function RootBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["rootStep"]) ||
                childBuilders["rootStep"] !== undefined ||
                updates.rootStep !== undefined, "rootStep is a required field");
            console.assert((original && !modifiedKeys["rootAlter"]) ||
                childBuilders["rootAlter"] !== undefined ||
                updates.rootAlter !== undefined, "rootAlter is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Root";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.rootStep = function (build) {
            if (typeof build === 'function') {
                delete updates["rootStep"];
                var builder = build(new RootStepBuilder(original && original["rootStep"]));
                if (!original)
                    updates["rootStep"] = builder.build();
                else
                    childBuilders["rootStep"] = builder;
            }
            else {
                updates.rootStep = build;
                delete childBuilders["rootStep;"];
            }
            modifiedKeys["rootStep"] = true;
            return _this;
        };
        this.rootAlter = function (build) {
            if (typeof build === 'function') {
                delete updates["rootAlter"];
                var builder = build(new RootAlterBuilder(original && original["rootAlter"]));
                if (!original)
                    updates["rootAlter"] = builder.build();
                else
                    childBuilders["rootAlter"] = builder;
            }
            else {
                updates.rootAlter = build;
                delete childBuilders["rootAlter;"];
            }
            modifiedKeys["rootAlter"] = true;
            return _this;
        };
    }
    return RootBuilder;
}());
function patchRoot(base, builder) { return builder(new RootBuilder(base)).patch(); }
exports.patchRoot = patchRoot;
function buildRoot(builder) { return builder(new RootBuilder()).build(); }
exports.buildRoot = buildRoot;
var RootStepBuilder = (function () {
    function RootStepBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "RootStep";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return RootStepBuilder;
}());
function patchRootStep(base, builder) { return builder(new RootStepBuilder(base)).patch(); }
exports.patchRootStep = patchRootStep;
function buildRootStep(builder) { return builder(new RootStepBuilder()).build(); }
exports.buildRootStep = buildRootStep;
var RootAlterBuilder = (function () {
    function RootAlterBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["location"]) ||
                childBuilders["location"] !== undefined ||
                updates.location !== undefined, "location is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "RootAlter";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.location = function (spec) {
            updates["location"] = spec;
            delete childBuilders["location;"];
            modifiedKeys["location"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return RootAlterBuilder;
}());
function patchRootAlter(base, builder) { return builder(new RootAlterBuilder(base)).patch(); }
exports.patchRootAlter = patchRootAlter;
function buildRootAlter(builder) { return builder(new RootAlterBuilder()).build(); }
exports.buildRootAlter = buildRootAlter;
var FunctionBuilder = (function () {
    function FunctionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Function";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return FunctionBuilder;
}());
function patchFunction(base, builder) { return builder(new FunctionBuilder(base)).patch(); }
exports.patchFunction = patchFunction;
function buildFunction(builder) { return builder(new FunctionBuilder()).build(); }
exports.buildFunction = buildFunction;
var KindBuilder = (function () {
    function KindBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["parenthesesDegrees"]) ||
                childBuilders["parenthesesDegrees"] !== undefined ||
                updates.parenthesesDegrees !== undefined, "parenthesesDegrees is a required field");
            console.assert((original && !modifiedKeys["useSymbols"]) ||
                childBuilders["useSymbols"] !== undefined ||
                updates.useSymbols !== undefined, "useSymbols is a required field");
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
            console.assert((original && !modifiedKeys["stackDegrees"]) ||
                childBuilders["stackDegrees"] !== undefined ||
                updates.stackDegrees !== undefined, "stackDegrees is a required field");
            console.assert((original && !modifiedKeys["bracketDegrees"]) ||
                childBuilders["bracketDegrees"] !== undefined ||
                updates.bracketDegrees !== undefined, "bracketDegrees is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Kind";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.parenthesesDegrees = function (spec) {
            updates["parenthesesDegrees"] = spec;
            delete childBuilders["parenthesesDegrees;"];
            modifiedKeys["parenthesesDegrees"] = true;
            return _this;
        };
        this.useSymbols = function (spec) {
            updates["useSymbols"] = spec;
            delete childBuilders["useSymbols;"];
            modifiedKeys["useSymbols"] = true;
            return _this;
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.stackDegrees = function (spec) {
            updates["stackDegrees"] = spec;
            delete childBuilders["stackDegrees;"];
            modifiedKeys["stackDegrees"] = true;
            return _this;
        };
        this.bracketDegrees = function (spec) {
            updates["bracketDegrees"] = spec;
            delete childBuilders["bracketDegrees;"];
            modifiedKeys["bracketDegrees"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return KindBuilder;
}());
function patchKind(base, builder) { return builder(new KindBuilder(base)).patch(); }
exports.patchKind = patchKind;
function buildKind(builder) { return builder(new KindBuilder()).build(); }
exports.buildKind = buildKind;
var InversionBuilder = (function () {
    function InversionBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Inversion";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return InversionBuilder;
}());
function patchInversion(base, builder) { return builder(new InversionBuilder(base)).patch(); }
exports.patchInversion = patchInversion;
function buildInversion(builder) { return builder(new InversionBuilder()).build(); }
exports.buildInversion = buildInversion;
var BassBuilder = (function () {
    function BassBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["bassStep"]) ||
                childBuilders["bassStep"] !== undefined ||
                updates.bassStep !== undefined, "bassStep is a required field");
            console.assert((original && !modifiedKeys["bassAlter"]) ||
                childBuilders["bassAlter"] !== undefined ||
                updates.bassAlter !== undefined, "bassAlter is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Bass";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.bassStep = function (build) {
            if (typeof build === 'function') {
                delete updates["bassStep"];
                var builder = build(new BassStepBuilder(original && original["bassStep"]));
                if (!original)
                    updates["bassStep"] = builder.build();
                else
                    childBuilders["bassStep"] = builder;
            }
            else {
                updates.bassStep = build;
                delete childBuilders["bassStep;"];
            }
            modifiedKeys["bassStep"] = true;
            return _this;
        };
        this.bassAlter = function (build) {
            if (typeof build === 'function') {
                delete updates["bassAlter"];
                var builder = build(new BassAlterBuilder(original && original["bassAlter"]));
                if (!original)
                    updates["bassAlter"] = builder.build();
                else
                    childBuilders["bassAlter"] = builder;
            }
            else {
                updates.bassAlter = build;
                delete childBuilders["bassAlter;"];
            }
            modifiedKeys["bassAlter"] = true;
            return _this;
        };
    }
    return BassBuilder;
}());
function patchBass(base, builder) { return builder(new BassBuilder(base)).patch(); }
exports.patchBass = patchBass;
function buildBass(builder) { return builder(new BassBuilder()).build(); }
exports.buildBass = buildBass;
var BassStepBuilder = (function () {
    function BassStepBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BassStep";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return BassStepBuilder;
}());
function patchBassStep(base, builder) { return builder(new BassStepBuilder(base)).patch(); }
exports.patchBassStep = patchBassStep;
function buildBassStep(builder) { return builder(new BassStepBuilder()).build(); }
exports.buildBassStep = buildBassStep;
var BassAlterBuilder = (function () {
    function BassAlterBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["location"]) ||
                childBuilders["location"] !== undefined ||
                updates.location !== undefined, "location is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "BassAlter";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.location = function (spec) {
            updates["location"] = spec;
            delete childBuilders["location;"];
            modifiedKeys["location"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return BassAlterBuilder;
}());
function patchBassAlter(base, builder) { return builder(new BassAlterBuilder(base)).patch(); }
exports.patchBassAlter = patchBassAlter;
function buildBassAlter(builder) { return builder(new BassAlterBuilder()).build(); }
exports.buildBassAlter = buildBassAlter;
var DegreeBuilder = (function () {
    function DegreeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["degreeAlter"]) ||
                childBuilders["degreeAlter"] !== undefined ||
                updates.degreeAlter !== undefined, "degreeAlter is a required field");
            console.assert((original && !modifiedKeys["degreeValue"]) ||
                childBuilders["degreeValue"] !== undefined ||
                updates.degreeValue !== undefined, "degreeValue is a required field");
            console.assert((original && !modifiedKeys["degreeType"]) ||
                childBuilders["degreeType"] !== undefined ||
                updates.degreeType !== undefined, "degreeType is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Degree";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.degreeAlter = function (build) {
            if (typeof build === 'function') {
                delete updates["degreeAlter"];
                var builder = build(new DegreeAlterBuilder(original && original["degreeAlter"]));
                if (!original)
                    updates["degreeAlter"] = builder.build();
                else
                    childBuilders["degreeAlter"] = builder;
            }
            else {
                updates.degreeAlter = build;
                delete childBuilders["degreeAlter;"];
            }
            modifiedKeys["degreeAlter"] = true;
            return _this;
        };
        this.degreeValue = function (build) {
            if (typeof build === 'function') {
                delete updates["degreeValue"];
                var builder = build(new DegreeValueBuilder(original && original["degreeValue"]));
                if (!original)
                    updates["degreeValue"] = builder.build();
                else
                    childBuilders["degreeValue"] = builder;
            }
            else {
                updates.degreeValue = build;
                delete childBuilders["degreeValue;"];
            }
            modifiedKeys["degreeValue"] = true;
            return _this;
        };
        this.degreeType = function (build) {
            if (typeof build === 'function') {
                delete updates["degreeType"];
                var builder = build(new DegreeTypeBuilder(original && original["degreeType"]));
                if (!original)
                    updates["degreeType"] = builder.build();
                else
                    childBuilders["degreeType"] = builder;
            }
            else {
                updates.degreeType = build;
                delete childBuilders["degreeType;"];
            }
            modifiedKeys["degreeType"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return DegreeBuilder;
}());
function patchDegree(base, builder) { return builder(new DegreeBuilder(base)).patch(); }
exports.patchDegree = patchDegree;
function buildDegree(builder) { return builder(new DegreeBuilder()).build(); }
exports.buildDegree = buildDegree;
var DegreeValueBuilder = (function () {
    function DegreeValueBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["symbol"]) ||
                childBuilders["symbol"] !== undefined ||
                updates.symbol !== undefined, "symbol is a required field");
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DegreeValue";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.symbol = function (spec) {
            updates["symbol"] = spec;
            delete childBuilders["symbol;"];
            modifiedKeys["symbol"] = true;
            return _this;
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return DegreeValueBuilder;
}());
function patchDegreeValue(base, builder) { return builder(new DegreeValueBuilder(base)).patch(); }
exports.patchDegreeValue = patchDegreeValue;
function buildDegreeValue(builder) { return builder(new DegreeValueBuilder()).build(); }
exports.buildDegreeValue = buildDegreeValue;
var DegreeAlterBuilder = (function () {
    function DegreeAlterBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["plusMinus"]) ||
                childBuilders["plusMinus"] !== undefined ||
                updates.plusMinus !== undefined, "plusMinus is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DegreeAlter";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.plusMinus = function (spec) {
            updates["plusMinus"] = spec;
            delete childBuilders["plusMinus;"];
            modifiedKeys["plusMinus"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return DegreeAlterBuilder;
}());
function patchDegreeAlter(base, builder) { return builder(new DegreeAlterBuilder(base)).patch(); }
exports.patchDegreeAlter = patchDegreeAlter;
function buildDegreeAlter(builder) { return builder(new DegreeAlterBuilder()).build(); }
exports.buildDegreeAlter = buildDegreeAlter;
var DegreeTypeBuilder = (function () {
    function DegreeTypeBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "DegreeType";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return DegreeTypeBuilder;
}());
function patchDegreeType(base, builder) { return builder(new DegreeTypeBuilder(base)).patch(); }
exports.patchDegreeType = patchDegreeType;
function buildDegreeType(builder) { return builder(new DegreeTypeBuilder()).build(); }
exports.buildDegreeType = buildDegreeType;
var FrameBuilder = (function () {
    function FrameBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["frameStrings"]) ||
                childBuilders["frameStrings"] !== undefined ||
                updates.frameStrings !== undefined, "frameStrings is a required field");
            console.assert((original && !modifiedKeys["frameNotes"]) ||
                childBuilders["frameNotes"] !== undefined ||
                updates.frameNotes !== undefined, "frameNotes is a required field");
            console.assert((original && !modifiedKeys["unplayed"]) ||
                childBuilders["unplayed"] !== undefined ||
                updates.unplayed !== undefined, "unplayed is a required field");
            console.assert((original && !modifiedKeys["frameFrets"]) ||
                childBuilders["frameFrets"] !== undefined ||
                updates.frameFrets !== undefined, "frameFrets is a required field");
            console.assert((original && !modifiedKeys["firstFret"]) ||
                childBuilders["firstFret"] !== undefined ||
                updates.firstFret !== undefined, "firstFret is a required field");
            console.assert((original && !modifiedKeys["width"]) ||
                childBuilders["width"] !== undefined ||
                updates.width !== undefined, "width is a required field");
            console.assert((original && !modifiedKeys["height"]) ||
                childBuilders["height"] !== undefined ||
                updates.height !== undefined, "height is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Frame";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.frameStrings = function (spec) {
            updates["frameStrings"] = spec;
            delete childBuilders["frameStrings;"];
            modifiedKeys["frameStrings"] = true;
            return _this;
        };
        this.frameNotes = function (spec) {
            updates["frameNotes"] = spec;
            delete childBuilders["frameNotes;"];
            modifiedKeys["frameNotes"] = true;
            return _this;
        };
        this.frameNotesAt = function (idx, build) {
            makeReference("frameNotes");
            if (frozen["frameNotes"][idx]) {
                throw new Error("Patching frameNotes." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["frameNotes"] && !original["frameNotes"]) {
                // Clone snapshot.
                patches.push({ p: ["frameNotes", idx], li: original._snapshot["frameNotes"] });
            }
            if (typeof build === 'function' && reference["frameNotes"][idx]) {
                var patch = build(new FrameNoteBuilder(reference["frameNotes"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["frameNotes", idx].concat(patch.p);
                    return patch;
                }));
                frozen["frameNotes"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new FrameNoteBuilder(reference["frameNotes"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["frameNotes", idx], li: update });
            }
            else {
                updates["frameNotes"] = reference["frameNotes"]; // TODO: Merge?
            }
            reference["frameNotes"][idx] = update;
            frozen["frameNotes"][idx] = true;
            return _this;
        };
        this.frameNotesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("frameNotes");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["frameNotes"][idx]) {
                        throw new Error("Replacing frameNotes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["frameNotes"][idx];
                    patches.push({ p: ["frameNotes", idx], ld: ld, li: items[idx - start] });
                    frozen["frameNotes"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["frameNotes"][idx]) {
                        throw new Error("Removing frameNotes." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["frameNotes"][idx];
                    patches.push({ p: ["frameNotes", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["frameNotes", idx], li: items[idx - start] });
                    frozen["frameNotes"][idx] = true;
                }
            }
            (_a = reference["frameNotes"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["frameNotes"] = reference["frameNotes"];
            (_b = frozen["frameNotes"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.unplayed = function (spec) {
            updates["unplayed"] = spec;
            delete childBuilders["unplayed;"];
            modifiedKeys["unplayed"] = true;
            return _this;
        };
        this.frameFrets = function (spec) {
            updates["frameFrets"] = spec;
            delete childBuilders["frameFrets;"];
            modifiedKeys["frameFrets"] = true;
            return _this;
        };
        this.firstFret = function (build) {
            if (typeof build === 'function') {
                delete updates["firstFret"];
                var builder = build(new FirstFretBuilder(original && original["firstFret"]));
                if (!original)
                    updates["firstFret"] = builder.build();
                else
                    childBuilders["firstFret"] = builder;
            }
            else {
                updates.firstFret = build;
                delete childBuilders["firstFret;"];
            }
            modifiedKeys["firstFret"] = true;
            return _this;
        };
        this.width = function (spec) {
            updates["width"] = spec;
            delete childBuilders["width;"];
            modifiedKeys["width"] = true;
            return _this;
        };
        this.height = function (spec) {
            updates["height"] = spec;
            delete childBuilders["height;"];
            modifiedKeys["height"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valignImage = function (spec) {
            updates["valignImage"] = spec;
            delete childBuilders["valignImage;"];
            modifiedKeys["valignImage"] = true;
            return _this;
        };
    }
    return FrameBuilder;
}());
function patchFrame(base, builder) { return builder(new FrameBuilder(base)).patch(); }
exports.patchFrame = patchFrame;
function buildFrame(builder) { return builder(new FrameBuilder()).build(); }
exports.buildFrame = buildFrame;
var FirstFretBuilder = (function () {
    function FirstFretBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
            console.assert((original && !modifiedKeys["location"]) ||
                childBuilders["location"] !== undefined ||
                updates.location !== undefined, "location is a required field");
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "FirstFret";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.location = function (spec) {
            updates["location"] = spec;
            delete childBuilders["location;"];
            modifiedKeys["location"] = true;
            return _this;
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
    }
    return FirstFretBuilder;
}());
function patchFirstFret(base, builder) { return builder(new FirstFretBuilder(base)).patch(); }
exports.patchFirstFret = patchFirstFret;
function buildFirstFret(builder) { return builder(new FirstFretBuilder()).build(); }
exports.buildFirstFret = buildFirstFret;
var FrameNoteBuilder = (function () {
    function FrameNoteBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["barre"]) ||
                childBuilders["barre"] !== undefined ||
                updates.barre !== undefined, "barre is a required field");
            console.assert((original && !modifiedKeys["string"]) ||
                childBuilders["string"] !== undefined ||
                updates.string !== undefined, "string is a required field");
            console.assert((original && !modifiedKeys["fingering"]) ||
                childBuilders["fingering"] !== undefined ||
                updates.fingering !== undefined, "fingering is a required field");
            console.assert((original && !modifiedKeys["fret"]) ||
                childBuilders["fret"] !== undefined ||
                updates.fret !== undefined, "fret is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "FrameNote";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.barre = function (build) {
            if (typeof build === 'function') {
                delete updates["barre"];
                var builder = build(new BarreBuilder(original && original["barre"]));
                if (!original)
                    updates["barre"] = builder.build();
                else
                    childBuilders["barre"] = builder;
            }
            else {
                updates.barre = build;
                delete childBuilders["barre;"];
            }
            modifiedKeys["barre"] = true;
            return _this;
        };
        this.string = function (build) {
            if (typeof build === 'function') {
                delete updates["string"];
                var builder = build(new StringBuilder(original && original["string"]));
                if (!original)
                    updates["string"] = builder.build();
                else
                    childBuilders["string"] = builder;
            }
            else {
                updates.string = build;
                delete childBuilders["string;"];
            }
            modifiedKeys["string"] = true;
            return _this;
        };
        this.fingering = function (build) {
            if (typeof build === 'function') {
                delete updates["fingering"];
                var builder = build(new FingeringBuilder(original && original["fingering"]));
                if (!original)
                    updates["fingering"] = builder.build();
                else
                    childBuilders["fingering"] = builder;
            }
            else {
                updates.fingering = build;
                delete childBuilders["fingering;"];
            }
            modifiedKeys["fingering"] = true;
            return _this;
        };
        this.fret = function (build) {
            if (typeof build === 'function') {
                delete updates["fret"];
                var builder = build(new FretBuilder(original && original["fret"]));
                if (!original)
                    updates["fret"] = builder.build();
                else
                    childBuilders["fret"] = builder;
            }
            else {
                updates.fret = build;
                delete childBuilders["fret;"];
            }
            modifiedKeys["fret"] = true;
            return _this;
        };
    }
    return FrameNoteBuilder;
}());
function patchFrameNote(base, builder) { return builder(new FrameNoteBuilder(base)).patch(); }
exports.patchFrameNote = patchFrameNote;
function buildFrameNote(builder) { return builder(new FrameNoteBuilder()).build(); }
exports.buildFrameNote = buildFrameNote;
var BarreBuilder = (function () {
    function BarreBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Barre";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return BarreBuilder;
}());
function patchBarre(base, builder) { return builder(new BarreBuilder(base)).patch(); }
exports.patchBarre = patchBarre;
function buildBarre(builder) { return builder(new BarreBuilder()).build(); }
exports.buildBarre = buildBarre;
var GroupingBuilder = (function () {
    function GroupingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["features"]) ||
                childBuilders["features"] !== undefined ||
                updates.features !== undefined, "features is a required field");
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["memberOf"]) ||
                childBuilders["memberOf"] !== undefined ||
                updates.memberOf !== undefined, "memberOf is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Grouping";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.features = function (spec) {
            updates["features"] = spec;
            delete childBuilders["features;"];
            modifiedKeys["features"] = true;
            return _this;
        };
        this.featuresAt = function (idx, build) {
            makeReference("features");
            if (frozen["features"][idx]) {
                throw new Error("Patching features." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["features"] && !original["features"]) {
                // Clone snapshot.
                patches.push({ p: ["features", idx], li: original._snapshot["features"] });
            }
            if (typeof build === 'function' && reference["features"][idx]) {
                var patch = build(new FeatureBuilder(reference["features"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["features", idx].concat(patch.p);
                    return patch;
                }));
                frozen["features"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new FeatureBuilder(reference["features"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["features", idx], li: update });
            }
            else {
                updates["features"] = reference["features"]; // TODO: Merge?
            }
            reference["features"][idx] = update;
            frozen["features"][idx] = true;
            return _this;
        };
        this.featuresSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("features");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["features"][idx]) {
                        throw new Error("Replacing features." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["features"][idx];
                    patches.push({ p: ["features", idx], ld: ld, li: items[idx - start] });
                    frozen["features"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["features"][idx]) {
                        throw new Error("Removing features." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["features"][idx];
                    patches.push({ p: ["features", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["features", idx], li: items[idx - start] });
                    frozen["features"][idx] = true;
                }
            }
            (_a = reference["features"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["features"] = reference["features"];
            (_b = frozen["features"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.memberOf = function (spec) {
            updates["memberOf"] = spec;
            delete childBuilders["memberOf;"];
            modifiedKeys["memberOf"] = true;
            return _this;
        };
    }
    return GroupingBuilder;
}());
function patchGrouping(base, builder) { return builder(new GroupingBuilder(base)).patch(); }
exports.patchGrouping = patchGrouping;
function buildGrouping(builder) { return builder(new GroupingBuilder()).build(); }
exports.buildGrouping = buildGrouping;
var FeatureBuilder = (function () {
    function FeatureBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Feature";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
    }
    return FeatureBuilder;
}());
function patchFeature(base, builder) { return builder(new FeatureBuilder(base)).patch(); }
exports.patchFeature = patchFeature;
function buildFeature(builder) { return builder(new FeatureBuilder()).build(); }
exports.buildFeature = buildFeature;
var PrintBuilder = (function () {
    function PrintBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["measureNumbering"]) ||
                childBuilders["measureNumbering"] !== undefined ||
                updates.measureNumbering !== undefined, "measureNumbering is a required field");
            console.assert((original && !modifiedKeys["partNameDisplay"]) ||
                childBuilders["partNameDisplay"] !== undefined ||
                updates.partNameDisplay !== undefined, "partNameDisplay is a required field");
            console.assert((original && !modifiedKeys["newSystem"]) ||
                childBuilders["newSystem"] !== undefined ||
                updates.newSystem !== undefined, "newSystem is a required field");
            console.assert((original && !modifiedKeys["newPage"]) ||
                childBuilders["newPage"] !== undefined ||
                updates.newPage !== undefined, "newPage is a required field");
            console.assert((original && !modifiedKeys["blankPage"]) ||
                childBuilders["blankPage"] !== undefined ||
                updates.blankPage !== undefined, "blankPage is a required field");
            console.assert((original && !modifiedKeys["measureLayout"]) ||
                childBuilders["measureLayout"] !== undefined ||
                updates.measureLayout !== undefined, "measureLayout is a required field");
            console.assert((original && !modifiedKeys["partAbbreviationDisplay"]) ||
                childBuilders["partAbbreviationDisplay"] !== undefined ||
                updates.partAbbreviationDisplay !== undefined, "partAbbreviationDisplay is a required field");
            console.assert((original && !modifiedKeys["pageLayout"]) ||
                childBuilders["pageLayout"] !== undefined ||
                updates.pageLayout !== undefined, "pageLayout is a required field");
            console.assert((original && !modifiedKeys["systemLayout"]) ||
                childBuilders["systemLayout"] !== undefined ||
                updates.systemLayout !== undefined, "systemLayout is a required field");
            console.assert((original && !modifiedKeys["staffSpacing"]) ||
                childBuilders["staffSpacing"] !== undefined ||
                updates.staffSpacing !== undefined, "staffSpacing is a required field");
            console.assert((original && !modifiedKeys["staffLayouts"]) ||
                childBuilders["staffLayouts"] !== undefined ||
                updates.staffLayouts !== undefined, "staffLayouts is a required field");
            console.assert((original && !modifiedKeys["pageNumber"]) ||
                childBuilders["pageNumber"] !== undefined ||
                updates.pageNumber !== undefined, "pageNumber is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Print";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.measureNumbering = function (build) {
            if (typeof build === 'function') {
                delete updates["measureNumbering"];
                var builder = build(new MeasureNumberingBuilder(original && original["measureNumbering"]));
                if (!original)
                    updates["measureNumbering"] = builder.build();
                else
                    childBuilders["measureNumbering"] = builder;
            }
            else {
                updates.measureNumbering = build;
                delete childBuilders["measureNumbering;"];
            }
            modifiedKeys["measureNumbering"] = true;
            return _this;
        };
        this.partNameDisplay = function (build) {
            if (typeof build === 'function') {
                delete updates["partNameDisplay"];
                var builder = build(new PartNameDisplayBuilder(original && original["partNameDisplay"]));
                if (!original)
                    updates["partNameDisplay"] = builder.build();
                else
                    childBuilders["partNameDisplay"] = builder;
            }
            else {
                updates.partNameDisplay = build;
                delete childBuilders["partNameDisplay;"];
            }
            modifiedKeys["partNameDisplay"] = true;
            return _this;
        };
        this.newSystem = function (spec) {
            updates["newSystem"] = spec;
            delete childBuilders["newSystem;"];
            modifiedKeys["newSystem"] = true;
            return _this;
        };
        this.newPage = function (spec) {
            updates["newPage"] = spec;
            delete childBuilders["newPage;"];
            modifiedKeys["newPage"] = true;
            return _this;
        };
        this.blankPage = function (spec) {
            updates["blankPage"] = spec;
            delete childBuilders["blankPage;"];
            modifiedKeys["blankPage"] = true;
            return _this;
        };
        this.measureLayout = function (build) {
            if (typeof build === 'function') {
                delete updates["measureLayout"];
                var builder = build(new MeasureLayoutBuilder(original && original["measureLayout"]));
                if (!original)
                    updates["measureLayout"] = builder.build();
                else
                    childBuilders["measureLayout"] = builder;
            }
            else {
                updates.measureLayout = build;
                delete childBuilders["measureLayout;"];
            }
            modifiedKeys["measureLayout"] = true;
            return _this;
        };
        this.partAbbreviationDisplay = function (build) {
            if (typeof build === 'function') {
                delete updates["partAbbreviationDisplay"];
                var builder = build(new PartAbbreviationDisplayBuilder(original && original["partAbbreviationDisplay"]));
                if (!original)
                    updates["partAbbreviationDisplay"] = builder.build();
                else
                    childBuilders["partAbbreviationDisplay"] = builder;
            }
            else {
                updates.partAbbreviationDisplay = build;
                delete childBuilders["partAbbreviationDisplay;"];
            }
            modifiedKeys["partAbbreviationDisplay"] = true;
            return _this;
        };
        this.pageLayout = function (build) {
            if (typeof build === 'function') {
                delete updates["pageLayout"];
                var builder = build(new PageLayoutBuilder(original && original["pageLayout"]));
                if (!original)
                    updates["pageLayout"] = builder.build();
                else
                    childBuilders["pageLayout"] = builder;
            }
            else {
                updates.pageLayout = build;
                delete childBuilders["pageLayout;"];
            }
            modifiedKeys["pageLayout"] = true;
            return _this;
        };
        this.systemLayout = function (build) {
            if (typeof build === 'function') {
                delete updates["systemLayout"];
                var builder = build(new SystemLayoutBuilder(original && original["systemLayout"]));
                if (!original)
                    updates["systemLayout"] = builder.build();
                else
                    childBuilders["systemLayout"] = builder;
            }
            else {
                updates.systemLayout = build;
                delete childBuilders["systemLayout;"];
            }
            modifiedKeys["systemLayout"] = true;
            return _this;
        };
        this.staffSpacing = function (spec) {
            updates["staffSpacing"] = spec;
            delete childBuilders["staffSpacing;"];
            modifiedKeys["staffSpacing"] = true;
            return _this;
        };
        this.staffLayouts = function (spec) {
            updates["staffLayouts"] = spec;
            delete childBuilders["staffLayouts;"];
            modifiedKeys["staffLayouts"] = true;
            return _this;
        };
        this.staffLayoutsAt = function (idx, build) {
            makeReference("staffLayouts");
            if (frozen["staffLayouts"][idx]) {
                throw new Error("Patching staffLayouts." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["staffLayouts"] && !original["staffLayouts"]) {
                // Clone snapshot.
                patches.push({ p: ["staffLayouts", idx], li: original._snapshot["staffLayouts"] });
            }
            if (typeof build === 'function' && reference["staffLayouts"][idx]) {
                var patch = build(new StaffLayoutBuilder(reference["staffLayouts"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["staffLayouts", idx].concat(patch.p);
                    return patch;
                }));
                frozen["staffLayouts"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new StaffLayoutBuilder(reference["staffLayouts"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["staffLayouts", idx], li: update });
            }
            else {
                updates["staffLayouts"] = reference["staffLayouts"]; // TODO: Merge?
            }
            reference["staffLayouts"][idx] = update;
            frozen["staffLayouts"][idx] = true;
            return _this;
        };
        this.staffLayoutsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("staffLayouts");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["staffLayouts"][idx]) {
                        throw new Error("Replacing staffLayouts." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffLayouts"][idx];
                    patches.push({ p: ["staffLayouts", idx], ld: ld, li: items[idx - start] });
                    frozen["staffLayouts"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["staffLayouts"][idx]) {
                        throw new Error("Removing staffLayouts." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffLayouts"][idx];
                    patches.push({ p: ["staffLayouts", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["staffLayouts", idx], li: items[idx - start] });
                    frozen["staffLayouts"][idx] = true;
                }
            }
            (_a = reference["staffLayouts"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["staffLayouts"] = reference["staffLayouts"];
            (_b = frozen["staffLayouts"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.pageNumber = function (spec) {
            updates["pageNumber"] = spec;
            delete childBuilders["pageNumber;"];
            modifiedKeys["pageNumber"] = true;
            return _this;
        };
    }
    return PrintBuilder;
}());
function patchPrint(base, builder) { return builder(new PrintBuilder(base)).patch(); }
exports.patchPrint = patchPrint;
function buildPrint(builder) { return builder(new PrintBuilder()).build(); }
exports.buildPrint = buildPrint;
var MeasureNumberingBuilder = (function () {
    function MeasureNumberingBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MeasureNumbering";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
    }
    return MeasureNumberingBuilder;
}());
function patchMeasureNumbering(base, builder) { return builder(new MeasureNumberingBuilder(base)).patch(); }
exports.patchMeasureNumbering = patchMeasureNumbering;
function buildMeasureNumbering(builder) { return builder(new MeasureNumberingBuilder()).build(); }
exports.buildMeasureNumbering = buildMeasureNumbering;
var SoundBuilder = (function () {
    function SoundBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["softPedal"]) ||
                childBuilders["softPedal"] !== undefined ||
                updates.softPedal !== undefined, "softPedal is a required field");
            console.assert((original && !modifiedKeys["midiInstruments"]) ||
                childBuilders["midiInstruments"] !== undefined ||
                updates.midiInstruments !== undefined, "midiInstruments is a required field");
            console.assert((original && !modifiedKeys["pan"]) ||
                childBuilders["pan"] !== undefined ||
                updates.pan !== undefined, "pan is a required field");
            console.assert((original && !modifiedKeys["tocoda"]) ||
                childBuilders["tocoda"] !== undefined ||
                updates.tocoda !== undefined, "tocoda is a required field");
            console.assert((original && !modifiedKeys["decapo"]) ||
                childBuilders["decapo"] !== undefined ||
                updates.decapo !== undefined, "decapo is a required field");
            console.assert((original && !modifiedKeys["divisions"]) ||
                childBuilders["divisions"] !== undefined ||
                updates.divisions !== undefined, "divisions is a required field");
            console.assert((original && !modifiedKeys["pizzicato"]) ||
                childBuilders["pizzicato"] !== undefined ||
                updates.pizzicato !== undefined, "pizzicato is a required field");
            console.assert((original && !modifiedKeys["coda"]) ||
                childBuilders["coda"] !== undefined ||
                updates.coda !== undefined, "coda is a required field");
            console.assert((original && !modifiedKeys["segno"]) ||
                childBuilders["segno"] !== undefined ||
                updates.segno !== undefined, "segno is a required field");
            console.assert((original && !modifiedKeys["elevation"]) ||
                childBuilders["elevation"] !== undefined ||
                updates.elevation !== undefined, "elevation is a required field");
            console.assert((original && !modifiedKeys["fine"]) ||
                childBuilders["fine"] !== undefined ||
                updates.fine !== undefined, "fine is a required field");
            console.assert((original && !modifiedKeys["damperPedal"]) ||
                childBuilders["damperPedal"] !== undefined ||
                updates.damperPedal !== undefined, "damperPedal is a required field");
            console.assert((original && !modifiedKeys["dynamics"]) ||
                childBuilders["dynamics"] !== undefined ||
                updates.dynamics !== undefined, "dynamics is a required field");
            console.assert((original && !modifiedKeys["plays"]) ||
                childBuilders["plays"] !== undefined ||
                updates.plays !== undefined, "plays is a required field");
            console.assert((original && !modifiedKeys["offset"]) ||
                childBuilders["offset"] !== undefined ||
                updates.offset !== undefined, "offset is a required field");
            console.assert((original && !modifiedKeys["sostenutoPedal"]) ||
                childBuilders["sostenutoPedal"] !== undefined ||
                updates.sostenutoPedal !== undefined, "sostenutoPedal is a required field");
            console.assert((original && !modifiedKeys["dalsegno"]) ||
                childBuilders["dalsegno"] !== undefined ||
                updates.dalsegno !== undefined, "dalsegno is a required field");
            console.assert((original && !modifiedKeys["midiDevices"]) ||
                childBuilders["midiDevices"] !== undefined ||
                updates.midiDevices !== undefined, "midiDevices is a required field");
            console.assert((original && !modifiedKeys["tempo"]) ||
                childBuilders["tempo"] !== undefined ||
                updates.tempo !== undefined, "tempo is a required field");
            console.assert((original && !modifiedKeys["forwardRepeat"]) ||
                childBuilders["forwardRepeat"] !== undefined ||
                updates.forwardRepeat !== undefined, "forwardRepeat is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Sound";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.softPedal = function (spec) {
            updates["softPedal"] = spec;
            delete childBuilders["softPedal;"];
            modifiedKeys["softPedal"] = true;
            return _this;
        };
        this.midiInstruments = function (spec) {
            updates["midiInstruments"] = spec;
            delete childBuilders["midiInstruments;"];
            modifiedKeys["midiInstruments"] = true;
            return _this;
        };
        this.midiInstrumentsAt = function (idx, build) {
            makeReference("midiInstruments");
            if (frozen["midiInstruments"][idx]) {
                throw new Error("Patching midiInstruments." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["midiInstruments"] && !original["midiInstruments"]) {
                // Clone snapshot.
                patches.push({ p: ["midiInstruments", idx], li: original._snapshot["midiInstruments"] });
            }
            if (typeof build === 'function' && reference["midiInstruments"][idx]) {
                var patch = build(new MidiInstrumentBuilder(reference["midiInstruments"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["midiInstruments", idx].concat(patch.p);
                    return patch;
                }));
                frozen["midiInstruments"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MidiInstrumentBuilder(reference["midiInstruments"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["midiInstruments", idx], li: update });
            }
            else {
                updates["midiInstruments"] = reference["midiInstruments"]; // TODO: Merge?
            }
            reference["midiInstruments"][idx] = update;
            frozen["midiInstruments"][idx] = true;
            return _this;
        };
        this.midiInstrumentsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("midiInstruments");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["midiInstruments"][idx]) {
                        throw new Error("Replacing midiInstruments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiInstruments"][idx];
                    patches.push({ p: ["midiInstruments", idx], ld: ld, li: items[idx - start] });
                    frozen["midiInstruments"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["midiInstruments"][idx]) {
                        throw new Error("Removing midiInstruments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiInstruments"][idx];
                    patches.push({ p: ["midiInstruments", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["midiInstruments", idx], li: items[idx - start] });
                    frozen["midiInstruments"][idx] = true;
                }
            }
            (_a = reference["midiInstruments"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["midiInstruments"] = reference["midiInstruments"];
            (_b = frozen["midiInstruments"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.pan = function (spec) {
            updates["pan"] = spec;
            delete childBuilders["pan;"];
            modifiedKeys["pan"] = true;
            return _this;
        };
        this.tocoda = function (spec) {
            updates["tocoda"] = spec;
            delete childBuilders["tocoda;"];
            modifiedKeys["tocoda"] = true;
            return _this;
        };
        this.decapo = function (spec) {
            updates["decapo"] = spec;
            delete childBuilders["decapo;"];
            modifiedKeys["decapo"] = true;
            return _this;
        };
        this.divisions = function (spec) {
            updates["divisions"] = spec;
            delete childBuilders["divisions;"];
            modifiedKeys["divisions"] = true;
            return _this;
        };
        this.pizzicato = function (spec) {
            updates["pizzicato"] = spec;
            delete childBuilders["pizzicato;"];
            modifiedKeys["pizzicato"] = true;
            return _this;
        };
        this.coda = function (spec) {
            updates["coda"] = spec;
            delete childBuilders["coda;"];
            modifiedKeys["coda"] = true;
            return _this;
        };
        this.segno = function (spec) {
            updates["segno"] = spec;
            delete childBuilders["segno;"];
            modifiedKeys["segno"] = true;
            return _this;
        };
        this.elevation = function (spec) {
            updates["elevation"] = spec;
            delete childBuilders["elevation;"];
            modifiedKeys["elevation"] = true;
            return _this;
        };
        this.fine = function (spec) {
            updates["fine"] = spec;
            delete childBuilders["fine;"];
            modifiedKeys["fine"] = true;
            return _this;
        };
        this.damperPedal = function (spec) {
            updates["damperPedal"] = spec;
            delete childBuilders["damperPedal;"];
            modifiedKeys["damperPedal"] = true;
            return _this;
        };
        this.dynamics = function (spec) {
            updates["dynamics"] = spec;
            delete childBuilders["dynamics;"];
            modifiedKeys["dynamics"] = true;
            return _this;
        };
        this.plays = function (spec) {
            updates["plays"] = spec;
            delete childBuilders["plays;"];
            modifiedKeys["plays"] = true;
            return _this;
        };
        this.playsAt = function (idx, build) {
            makeReference("plays");
            if (frozen["plays"][idx]) {
                throw new Error("Patching plays." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["plays"] && !original["plays"]) {
                // Clone snapshot.
                patches.push({ p: ["plays", idx], li: original._snapshot["plays"] });
            }
            if (typeof build === 'function' && reference["plays"][idx]) {
                var patch = build(new PlayBuilder(reference["plays"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["plays", idx].concat(patch.p);
                    return patch;
                }));
                frozen["plays"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new PlayBuilder(reference["plays"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["plays", idx], li: update });
            }
            else {
                updates["plays"] = reference["plays"]; // TODO: Merge?
            }
            reference["plays"][idx] = update;
            frozen["plays"][idx] = true;
            return _this;
        };
        this.playsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("plays");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["plays"][idx]) {
                        throw new Error("Replacing plays." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["plays"][idx];
                    patches.push({ p: ["plays", idx], ld: ld, li: items[idx - start] });
                    frozen["plays"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["plays"][idx]) {
                        throw new Error("Removing plays." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["plays"][idx];
                    patches.push({ p: ["plays", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["plays", idx], li: items[idx - start] });
                    frozen["plays"][idx] = true;
                }
            }
            (_a = reference["plays"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["plays"] = reference["plays"];
            (_b = frozen["plays"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.offset = function (build) {
            if (typeof build === 'function') {
                delete updates["offset"];
                var builder = build(new OffsetBuilder(original && original["offset"]));
                if (!original)
                    updates["offset"] = builder.build();
                else
                    childBuilders["offset"] = builder;
            }
            else {
                updates.offset = build;
                delete childBuilders["offset;"];
            }
            modifiedKeys["offset"] = true;
            return _this;
        };
        this.sostenutoPedal = function (spec) {
            updates["sostenutoPedal"] = spec;
            delete childBuilders["sostenutoPedal;"];
            modifiedKeys["sostenutoPedal"] = true;
            return _this;
        };
        this.dalsegno = function (spec) {
            updates["dalsegno"] = spec;
            delete childBuilders["dalsegno;"];
            modifiedKeys["dalsegno"] = true;
            return _this;
        };
        this.midiDevices = function (spec) {
            updates["midiDevices"] = spec;
            delete childBuilders["midiDevices;"];
            modifiedKeys["midiDevices"] = true;
            return _this;
        };
        this.midiDevicesAt = function (idx, build) {
            makeReference("midiDevices");
            if (frozen["midiDevices"][idx]) {
                throw new Error("Patching midiDevices." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["midiDevices"] && !original["midiDevices"]) {
                // Clone snapshot.
                patches.push({ p: ["midiDevices", idx], li: original._snapshot["midiDevices"] });
            }
            if (typeof build === 'function' && reference["midiDevices"][idx]) {
                var patch = build(new MidiDeviceBuilder(reference["midiDevices"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["midiDevices", idx].concat(patch.p);
                    return patch;
                }));
                frozen["midiDevices"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MidiDeviceBuilder(reference["midiDevices"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["midiDevices", idx], li: update });
            }
            else {
                updates["midiDevices"] = reference["midiDevices"]; // TODO: Merge?
            }
            reference["midiDevices"][idx] = update;
            frozen["midiDevices"][idx] = true;
            return _this;
        };
        this.midiDevicesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("midiDevices");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["midiDevices"][idx]) {
                        throw new Error("Replacing midiDevices." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiDevices"][idx];
                    patches.push({ p: ["midiDevices", idx], ld: ld, li: items[idx - start] });
                    frozen["midiDevices"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["midiDevices"][idx]) {
                        throw new Error("Removing midiDevices." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiDevices"][idx];
                    patches.push({ p: ["midiDevices", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["midiDevices", idx], li: items[idx - start] });
                    frozen["midiDevices"][idx] = true;
                }
            }
            (_a = reference["midiDevices"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["midiDevices"] = reference["midiDevices"];
            (_b = frozen["midiDevices"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.tempo = function (spec) {
            updates["tempo"] = spec;
            delete childBuilders["tempo;"];
            modifiedKeys["tempo"] = true;
            return _this;
        };
        this.forwardRepeat = function (spec) {
            updates["forwardRepeat"] = spec;
            delete childBuilders["forwardRepeat;"];
            modifiedKeys["forwardRepeat"] = true;
            return _this;
        };
        this.timeOnly = function (spec) {
            updates["timeOnly"] = spec;
            delete childBuilders["timeOnly;"];
            modifiedKeys["timeOnly"] = true;
            return _this;
        };
    }
    return SoundBuilder;
}());
function patchSound(base, builder) { return builder(new SoundBuilder(base)).patch(); }
exports.patchSound = patchSound;
function buildSound(builder) { return builder(new SoundBuilder()).build(); }
exports.buildSound = buildSound;
var WorkBuilder = (function () {
    function WorkBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["workNumber"]) ||
                childBuilders["workNumber"] !== undefined ||
                updates.workNumber !== undefined, "workNumber is a required field");
            console.assert((original && !modifiedKeys["workTitle"]) ||
                childBuilders["workTitle"] !== undefined ||
                updates.workTitle !== undefined, "workTitle is a required field");
            console.assert((original && !modifiedKeys["opus"]) ||
                childBuilders["opus"] !== undefined ||
                updates.opus !== undefined, "opus is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Work";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.workNumber = function (spec) {
            updates["workNumber"] = spec;
            delete childBuilders["workNumber;"];
            modifiedKeys["workNumber"] = true;
            return _this;
        };
        this.workTitle = function (spec) {
            updates["workTitle"] = spec;
            delete childBuilders["workTitle;"];
            modifiedKeys["workTitle"] = true;
            return _this;
        };
        this.opus = function (build) {
            if (typeof build === 'function') {
                delete updates["opus"];
                var builder = build(new OpusBuilder(original && original["opus"]));
                if (!original)
                    updates["opus"] = builder.build();
                else
                    childBuilders["opus"] = builder;
            }
            else {
                updates.opus = build;
                delete childBuilders["opus;"];
            }
            modifiedKeys["opus"] = true;
            return _this;
        };
    }
    return WorkBuilder;
}());
function patchWork(base, builder) { return builder(new WorkBuilder(base)).patch(); }
exports.patchWork = patchWork;
function buildWork(builder) { return builder(new WorkBuilder()).build(); }
exports.buildWork = buildWork;
var OpusBuilder = (function () {
    function OpusBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Opus";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return OpusBuilder;
}());
function patchOpus(base, builder) { return builder(new OpusBuilder(base)).patch(); }
exports.patchOpus = patchOpus;
function buildOpus(builder) { return builder(new OpusBuilder()).build(); }
exports.buildOpus = buildOpus;
var DefaultsBuilder = (function () {
    function DefaultsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["wordFont"]) ||
                childBuilders["wordFont"] !== undefined ||
                updates.wordFont !== undefined, "wordFont is a required field");
            console.assert((original && !modifiedKeys["lyricLanguages"]) ||
                childBuilders["lyricLanguages"] !== undefined ||
                updates.lyricLanguages !== undefined, "lyricLanguages is a required field");
            console.assert((original && !modifiedKeys["lyricFonts"]) ||
                childBuilders["lyricFonts"] !== undefined ||
                updates.lyricFonts !== undefined, "lyricFonts is a required field");
            console.assert((original && !modifiedKeys["pageLayout"]) ||
                childBuilders["pageLayout"] !== undefined ||
                updates.pageLayout !== undefined, "pageLayout is a required field");
            console.assert((original && !modifiedKeys["systemLayout"]) ||
                childBuilders["systemLayout"] !== undefined ||
                updates.systemLayout !== undefined, "systemLayout is a required field");
            console.assert((original && !modifiedKeys["appearance"]) ||
                childBuilders["appearance"] !== undefined ||
                updates.appearance !== undefined, "appearance is a required field");
            console.assert((original && !modifiedKeys["scaling"]) ||
                childBuilders["scaling"] !== undefined ||
                updates.scaling !== undefined, "scaling is a required field");
            console.assert((original && !modifiedKeys["staffLayouts"]) ||
                childBuilders["staffLayouts"] !== undefined ||
                updates.staffLayouts !== undefined, "staffLayouts is a required field");
            console.assert((original && !modifiedKeys["musicFont"]) ||
                childBuilders["musicFont"] !== undefined ||
                updates.musicFont !== undefined, "musicFont is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Defaults";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.wordFont = function (build) {
            if (typeof build === 'function') {
                delete updates["wordFont"];
                var builder = build(new WordFontBuilder(original && original["wordFont"]));
                if (!original)
                    updates["wordFont"] = builder.build();
                else
                    childBuilders["wordFont"] = builder;
            }
            else {
                updates.wordFont = build;
                delete childBuilders["wordFont;"];
            }
            modifiedKeys["wordFont"] = true;
            return _this;
        };
        this.lyricLanguages = function (spec) {
            updates["lyricLanguages"] = spec;
            delete childBuilders["lyricLanguages;"];
            modifiedKeys["lyricLanguages"] = true;
            return _this;
        };
        this.lyricLanguagesAt = function (idx, build) {
            makeReference("lyricLanguages");
            if (frozen["lyricLanguages"][idx]) {
                throw new Error("Patching lyricLanguages." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["lyricLanguages"] && !original["lyricLanguages"]) {
                // Clone snapshot.
                patches.push({ p: ["lyricLanguages", idx], li: original._snapshot["lyricLanguages"] });
            }
            if (typeof build === 'function' && reference["lyricLanguages"][idx]) {
                var patch = build(new LyricLanguageBuilder(reference["lyricLanguages"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["lyricLanguages", idx].concat(patch.p);
                    return patch;
                }));
                frozen["lyricLanguages"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new LyricLanguageBuilder(reference["lyricLanguages"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["lyricLanguages", idx], li: update });
            }
            else {
                updates["lyricLanguages"] = reference["lyricLanguages"]; // TODO: Merge?
            }
            reference["lyricLanguages"][idx] = update;
            frozen["lyricLanguages"][idx] = true;
            return _this;
        };
        this.lyricLanguagesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("lyricLanguages");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["lyricLanguages"][idx]) {
                        throw new Error("Replacing lyricLanguages." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["lyricLanguages"][idx];
                    patches.push({ p: ["lyricLanguages", idx], ld: ld, li: items[idx - start] });
                    frozen["lyricLanguages"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["lyricLanguages"][idx]) {
                        throw new Error("Removing lyricLanguages." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["lyricLanguages"][idx];
                    patches.push({ p: ["lyricLanguages", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["lyricLanguages", idx], li: items[idx - start] });
                    frozen["lyricLanguages"][idx] = true;
                }
            }
            (_a = reference["lyricLanguages"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["lyricLanguages"] = reference["lyricLanguages"];
            (_b = frozen["lyricLanguages"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.lyricFonts = function (spec) {
            updates["lyricFonts"] = spec;
            delete childBuilders["lyricFonts;"];
            modifiedKeys["lyricFonts"] = true;
            return _this;
        };
        this.lyricFontsAt = function (idx, build) {
            makeReference("lyricFonts");
            if (frozen["lyricFonts"][idx]) {
                throw new Error("Patching lyricFonts." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["lyricFonts"] && !original["lyricFonts"]) {
                // Clone snapshot.
                patches.push({ p: ["lyricFonts", idx], li: original._snapshot["lyricFonts"] });
            }
            if (typeof build === 'function' && reference["lyricFonts"][idx]) {
                var patch = build(new LyricFontBuilder(reference["lyricFonts"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["lyricFonts", idx].concat(patch.p);
                    return patch;
                }));
                frozen["lyricFonts"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new LyricFontBuilder(reference["lyricFonts"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["lyricFonts", idx], li: update });
            }
            else {
                updates["lyricFonts"] = reference["lyricFonts"]; // TODO: Merge?
            }
            reference["lyricFonts"][idx] = update;
            frozen["lyricFonts"][idx] = true;
            return _this;
        };
        this.lyricFontsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("lyricFonts");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["lyricFonts"][idx]) {
                        throw new Error("Replacing lyricFonts." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["lyricFonts"][idx];
                    patches.push({ p: ["lyricFonts", idx], ld: ld, li: items[idx - start] });
                    frozen["lyricFonts"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["lyricFonts"][idx]) {
                        throw new Error("Removing lyricFonts." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["lyricFonts"][idx];
                    patches.push({ p: ["lyricFonts", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["lyricFonts", idx], li: items[idx - start] });
                    frozen["lyricFonts"][idx] = true;
                }
            }
            (_a = reference["lyricFonts"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["lyricFonts"] = reference["lyricFonts"];
            (_b = frozen["lyricFonts"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.pageLayout = function (build) {
            if (typeof build === 'function') {
                delete updates["pageLayout"];
                var builder = build(new PageLayoutBuilder(original && original["pageLayout"]));
                if (!original)
                    updates["pageLayout"] = builder.build();
                else
                    childBuilders["pageLayout"] = builder;
            }
            else {
                updates.pageLayout = build;
                delete childBuilders["pageLayout;"];
            }
            modifiedKeys["pageLayout"] = true;
            return _this;
        };
        this.systemLayout = function (build) {
            if (typeof build === 'function') {
                delete updates["systemLayout"];
                var builder = build(new SystemLayoutBuilder(original && original["systemLayout"]));
                if (!original)
                    updates["systemLayout"] = builder.build();
                else
                    childBuilders["systemLayout"] = builder;
            }
            else {
                updates.systemLayout = build;
                delete childBuilders["systemLayout;"];
            }
            modifiedKeys["systemLayout"] = true;
            return _this;
        };
        this.appearance = function (build) {
            if (typeof build === 'function') {
                delete updates["appearance"];
                var builder = build(new AppearanceBuilder(original && original["appearance"]));
                if (!original)
                    updates["appearance"] = builder.build();
                else
                    childBuilders["appearance"] = builder;
            }
            else {
                updates.appearance = build;
                delete childBuilders["appearance;"];
            }
            modifiedKeys["appearance"] = true;
            return _this;
        };
        this.scaling = function (build) {
            if (typeof build === 'function') {
                delete updates["scaling"];
                var builder = build(new ScalingBuilder(original && original["scaling"]));
                if (!original)
                    updates["scaling"] = builder.build();
                else
                    childBuilders["scaling"] = builder;
            }
            else {
                updates.scaling = build;
                delete childBuilders["scaling;"];
            }
            modifiedKeys["scaling"] = true;
            return _this;
        };
        this.staffLayouts = function (spec) {
            updates["staffLayouts"] = spec;
            delete childBuilders["staffLayouts;"];
            modifiedKeys["staffLayouts"] = true;
            return _this;
        };
        this.staffLayoutsAt = function (idx, build) {
            makeReference("staffLayouts");
            if (frozen["staffLayouts"][idx]) {
                throw new Error("Patching staffLayouts." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["staffLayouts"] && !original["staffLayouts"]) {
                // Clone snapshot.
                patches.push({ p: ["staffLayouts", idx], li: original._snapshot["staffLayouts"] });
            }
            if (typeof build === 'function' && reference["staffLayouts"][idx]) {
                var patch = build(new StaffLayoutBuilder(reference["staffLayouts"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["staffLayouts", idx].concat(patch.p);
                    return patch;
                }));
                frozen["staffLayouts"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new StaffLayoutBuilder(reference["staffLayouts"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["staffLayouts", idx], li: update });
            }
            else {
                updates["staffLayouts"] = reference["staffLayouts"]; // TODO: Merge?
            }
            reference["staffLayouts"][idx] = update;
            frozen["staffLayouts"][idx] = true;
            return _this;
        };
        this.staffLayoutsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("staffLayouts");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["staffLayouts"][idx]) {
                        throw new Error("Replacing staffLayouts." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffLayouts"][idx];
                    patches.push({ p: ["staffLayouts", idx], ld: ld, li: items[idx - start] });
                    frozen["staffLayouts"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["staffLayouts"][idx]) {
                        throw new Error("Removing staffLayouts." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["staffLayouts"][idx];
                    patches.push({ p: ["staffLayouts", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["staffLayouts", idx], li: items[idx - start] });
                    frozen["staffLayouts"][idx] = true;
                }
            }
            (_a = reference["staffLayouts"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["staffLayouts"] = reference["staffLayouts"];
            (_b = frozen["staffLayouts"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.musicFont = function (build) {
            if (typeof build === 'function') {
                delete updates["musicFont"];
                var builder = build(new MusicFontBuilder(original && original["musicFont"]));
                if (!original)
                    updates["musicFont"] = builder.build();
                else
                    childBuilders["musicFont"] = builder;
            }
            else {
                updates.musicFont = build;
                delete childBuilders["musicFont;"];
            }
            modifiedKeys["musicFont"] = true;
            return _this;
        };
    }
    return DefaultsBuilder;
}());
function patchDefaults(base, builder) { return builder(new DefaultsBuilder(base)).patch(); }
exports.patchDefaults = patchDefaults;
function buildDefaults(builder) { return builder(new DefaultsBuilder()).build(); }
exports.buildDefaults = buildDefaults;
var MusicFontBuilder = (function () {
    function MusicFontBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "MusicFont";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
    }
    return MusicFontBuilder;
}());
function patchMusicFont(base, builder) { return builder(new MusicFontBuilder(base)).patch(); }
exports.patchMusicFont = patchMusicFont;
function buildMusicFont(builder) { return builder(new MusicFontBuilder()).build(); }
exports.buildMusicFont = buildMusicFont;
var WordFontBuilder = (function () {
    function WordFontBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "WordFont";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
    }
    return WordFontBuilder;
}());
function patchWordFont(base, builder) { return builder(new WordFontBuilder(base)).patch(); }
exports.patchWordFont = patchWordFont;
function buildWordFont(builder) { return builder(new WordFontBuilder()).build(); }
exports.buildWordFont = buildWordFont;
var LyricFontBuilder = (function () {
    function LyricFontBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LyricFont";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
    }
    return LyricFontBuilder;
}());
function patchLyricFont(base, builder) { return builder(new LyricFontBuilder(base)).patch(); }
exports.patchLyricFont = patchLyricFont;
function buildLyricFont(builder) { return builder(new LyricFontBuilder()).build(); }
exports.buildLyricFont = buildLyricFont;
var LyricLanguageBuilder = (function () {
    function LyricLanguageBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "LyricLanguage";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
    }
    return LyricLanguageBuilder;
}());
function patchLyricLanguage(base, builder) { return builder(new LyricLanguageBuilder(base)).patch(); }
exports.patchLyricLanguage = patchLyricLanguage;
function buildLyricLanguage(builder) { return builder(new LyricLanguageBuilder()).build(); }
exports.buildLyricLanguage = buildLyricLanguage;
var CreditBuilder = (function () {
    function CreditBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["creditTypes"]) ||
                childBuilders["creditTypes"] !== undefined ||
                updates.creditTypes !== undefined, "creditTypes is a required field");
            console.assert((original && !modifiedKeys["creditWords"]) ||
                childBuilders["creditWords"] !== undefined ||
                updates.creditWords !== undefined, "creditWords is a required field");
            console.assert((original && !modifiedKeys["creditImage"]) ||
                childBuilders["creditImage"] !== undefined ||
                updates.creditImage !== undefined, "creditImage is a required field");
            console.assert((original && !modifiedKeys["page"]) ||
                childBuilders["page"] !== undefined ||
                updates.page !== undefined, "page is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Credit";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.creditTypes = function (spec) {
            updates["creditTypes"] = spec;
            delete childBuilders["creditTypes;"];
            modifiedKeys["creditTypes"] = true;
            return _this;
        };
        this.creditWords = function (spec) {
            updates["creditWords"] = spec;
            delete childBuilders["creditWords;"];
            modifiedKeys["creditWords"] = true;
            return _this;
        };
        this.creditWordsAt = function (idx, build) {
            makeReference("creditWords");
            if (frozen["creditWords"][idx]) {
                throw new Error("Patching creditWords." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["creditWords"] && !original["creditWords"]) {
                // Clone snapshot.
                patches.push({ p: ["creditWords", idx], li: original._snapshot["creditWords"] });
            }
            if (typeof build === 'function' && reference["creditWords"][idx]) {
                var patch = build(new CreditWordsBuilder(reference["creditWords"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["creditWords", idx].concat(patch.p);
                    return patch;
                }));
                frozen["creditWords"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new CreditWordsBuilder(reference["creditWords"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["creditWords", idx], li: update });
            }
            else {
                updates["creditWords"] = reference["creditWords"]; // TODO: Merge?
            }
            reference["creditWords"][idx] = update;
            frozen["creditWords"][idx] = true;
            return _this;
        };
        this.creditWordsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("creditWords");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["creditWords"][idx]) {
                        throw new Error("Replacing creditWords." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["creditWords"][idx];
                    patches.push({ p: ["creditWords", idx], ld: ld, li: items[idx - start] });
                    frozen["creditWords"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["creditWords"][idx]) {
                        throw new Error("Removing creditWords." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["creditWords"][idx];
                    patches.push({ p: ["creditWords", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["creditWords", idx], li: items[idx - start] });
                    frozen["creditWords"][idx] = true;
                }
            }
            (_a = reference["creditWords"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["creditWords"] = reference["creditWords"];
            (_b = frozen["creditWords"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.creditImage = function (build) {
            if (typeof build === 'function') {
                delete updates["creditImage"];
                var builder = build(new CreditImageBuilder(original && original["creditImage"]));
                if (!original)
                    updates["creditImage"] = builder.build();
                else
                    childBuilders["creditImage"] = builder;
            }
            else {
                updates.creditImage = build;
                delete childBuilders["creditImage;"];
            }
            modifiedKeys["creditImage"] = true;
            return _this;
        };
        this.page = function (spec) {
            updates["page"] = spec;
            delete childBuilders["page;"];
            modifiedKeys["page"] = true;
            return _this;
        };
    }
    return CreditBuilder;
}());
function patchCredit(base, builder) { return builder(new CreditBuilder(base)).patch(); }
exports.patchCredit = patchCredit;
function buildCredit(builder) { return builder(new CreditBuilder()).build(); }
exports.buildCredit = buildCredit;
var CreditWordsBuilder = (function () {
    function CreditWordsBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["words"]) ||
                childBuilders["words"] !== undefined ||
                updates.words !== undefined, "words is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "CreditWords";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.words = function (spec) {
            updates["words"] = spec;
            delete childBuilders["words;"];
            modifiedKeys["words"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valign = function (spec) {
            updates["valign"] = spec;
            delete childBuilders["valign;"];
            modifiedKeys["valign"] = true;
            return _this;
        };
        this.underline = function (spec) {
            updates["underline"] = spec;
            delete childBuilders["underline;"];
            modifiedKeys["underline"] = true;
            return _this;
        };
        this.overline = function (spec) {
            updates["overline"] = spec;
            delete childBuilders["overline;"];
            modifiedKeys["overline"] = true;
            return _this;
        };
        this.lineThrough = function (spec) {
            updates["lineThrough"] = spec;
            delete childBuilders["lineThrough;"];
            modifiedKeys["lineThrough"] = true;
            return _this;
        };
        this.rotation = function (spec) {
            updates["rotation"] = spec;
            delete childBuilders["rotation;"];
            modifiedKeys["rotation"] = true;
            return _this;
        };
        this.letterSpacing = function (spec) {
            updates["letterSpacing"] = spec;
            delete childBuilders["letterSpacing;"];
            modifiedKeys["letterSpacing"] = true;
            return _this;
        };
        this.lineHeight = function (spec) {
            updates["lineHeight"] = spec;
            delete childBuilders["lineHeight;"];
            modifiedKeys["lineHeight"] = true;
            return _this;
        };
        this.dir = function (spec) {
            updates["dir"] = spec;
            delete childBuilders["dir;"];
            modifiedKeys["dir"] = true;
            return _this;
        };
        this.enclosure = function (spec) {
            updates["enclosure"] = spec;
            delete childBuilders["enclosure;"];
            modifiedKeys["enclosure"] = true;
            return _this;
        };
    }
    return CreditWordsBuilder;
}());
function patchCreditWords(base, builder) { return builder(new CreditWordsBuilder(base)).patch(); }
exports.patchCreditWords = patchCreditWords;
function buildCreditWords(builder) { return builder(new CreditWordsBuilder()).build(); }
exports.buildCreditWords = buildCreditWords;
var CreditImageBuilder = (function () {
    function CreditImageBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["source"]) ||
                childBuilders["source"] !== undefined ||
                updates.source !== undefined, "source is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "CreditImage";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.source = function (spec) {
            updates["source"] = spec;
            delete childBuilders["source;"];
            modifiedKeys["source"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.halign = function (spec) {
            updates["halign"] = spec;
            delete childBuilders["halign;"];
            modifiedKeys["halign"] = true;
            return _this;
        };
        this.valignImage = function (spec) {
            updates["valignImage"] = spec;
            delete childBuilders["valignImage;"];
            modifiedKeys["valignImage"] = true;
            return _this;
        };
    }
    return CreditImageBuilder;
}());
function patchCreditImage(base, builder) { return builder(new CreditImageBuilder(base)).patch(); }
exports.patchCreditImage = patchCreditImage;
function buildCreditImage(builder) { return builder(new CreditImageBuilder()).build(); }
exports.buildCreditImage = buildCreditImage;
var ScorePartBuilder = (function () {
    function ScorePartBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["partName"]) ||
                childBuilders["partName"] !== undefined ||
                updates.partName !== undefined, "partName is a required field");
            console.assert((original && !modifiedKeys["id"]) ||
                childBuilders["id"] !== undefined ||
                updates.id !== undefined, "id is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "ScorePart";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.identification = function (build) {
            if (typeof build === 'function') {
                delete updates["identification"];
                var builder = build(new IdentificationBuilder(original && original["identification"]));
                if (!original)
                    updates["identification"] = builder.build();
                else
                    childBuilders["identification"] = builder;
            }
            else {
                updates.identification = build;
                delete childBuilders["identification;"];
            }
            modifiedKeys["identification"] = true;
            return _this;
        };
        this.partNameDisplay = function (build) {
            if (typeof build === 'function') {
                delete updates["partNameDisplay"];
                var builder = build(new PartNameDisplayBuilder(original && original["partNameDisplay"]));
                if (!original)
                    updates["partNameDisplay"] = builder.build();
                else
                    childBuilders["partNameDisplay"] = builder;
            }
            else {
                updates.partNameDisplay = build;
                delete childBuilders["partNameDisplay;"];
            }
            modifiedKeys["partNameDisplay"] = true;
            return _this;
        };
        this.scoreInstruments = function (spec) {
            updates["scoreInstruments"] = spec;
            delete childBuilders["scoreInstruments;"];
            modifiedKeys["scoreInstruments"] = true;
            return _this;
        };
        this.scoreInstrumentsAt = function (idx, build) {
            makeReference("scoreInstruments");
            if (frozen["scoreInstruments"][idx]) {
                throw new Error("Patching scoreInstruments." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["scoreInstruments"] && !original["scoreInstruments"]) {
                // Clone snapshot.
                patches.push({ p: ["scoreInstruments", idx], li: original._snapshot["scoreInstruments"] });
            }
            if (typeof build === 'function' && reference["scoreInstruments"][idx]) {
                var patch = build(new ScoreInstrumentBuilder(reference["scoreInstruments"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["scoreInstruments", idx].concat(patch.p);
                    return patch;
                }));
                frozen["scoreInstruments"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new ScoreInstrumentBuilder(reference["scoreInstruments"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["scoreInstruments", idx], li: update });
            }
            else {
                updates["scoreInstruments"] = reference["scoreInstruments"]; // TODO: Merge?
            }
            reference["scoreInstruments"][idx] = update;
            frozen["scoreInstruments"][idx] = true;
            return _this;
        };
        this.scoreInstrumentsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("scoreInstruments");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["scoreInstruments"][idx]) {
                        throw new Error("Replacing scoreInstruments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["scoreInstruments"][idx];
                    patches.push({ p: ["scoreInstruments", idx], ld: ld, li: items[idx - start] });
                    frozen["scoreInstruments"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["scoreInstruments"][idx]) {
                        throw new Error("Removing scoreInstruments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["scoreInstruments"][idx];
                    patches.push({ p: ["scoreInstruments", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["scoreInstruments", idx], li: items[idx - start] });
                    frozen["scoreInstruments"][idx] = true;
                }
            }
            (_a = reference["scoreInstruments"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["scoreInstruments"] = reference["scoreInstruments"];
            (_b = frozen["scoreInstruments"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.midiDevices = function (spec) {
            updates["midiDevices"] = spec;
            delete childBuilders["midiDevices;"];
            modifiedKeys["midiDevices"] = true;
            return _this;
        };
        this.midiDevicesAt = function (idx, build) {
            makeReference("midiDevices");
            if (frozen["midiDevices"][idx]) {
                throw new Error("Patching midiDevices." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["midiDevices"] && !original["midiDevices"]) {
                // Clone snapshot.
                patches.push({ p: ["midiDevices", idx], li: original._snapshot["midiDevices"] });
            }
            if (typeof build === 'function' && reference["midiDevices"][idx]) {
                var patch = build(new MidiDeviceBuilder(reference["midiDevices"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["midiDevices", idx].concat(patch.p);
                    return patch;
                }));
                frozen["midiDevices"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MidiDeviceBuilder(reference["midiDevices"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["midiDevices", idx], li: update });
            }
            else {
                updates["midiDevices"] = reference["midiDevices"]; // TODO: Merge?
            }
            reference["midiDevices"][idx] = update;
            frozen["midiDevices"][idx] = true;
            return _this;
        };
        this.midiDevicesSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("midiDevices");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["midiDevices"][idx]) {
                        throw new Error("Replacing midiDevices." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiDevices"][idx];
                    patches.push({ p: ["midiDevices", idx], ld: ld, li: items[idx - start] });
                    frozen["midiDevices"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["midiDevices"][idx]) {
                        throw new Error("Removing midiDevices." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiDevices"][idx];
                    patches.push({ p: ["midiDevices", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["midiDevices", idx], li: items[idx - start] });
                    frozen["midiDevices"][idx] = true;
                }
            }
            (_a = reference["midiDevices"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["midiDevices"] = reference["midiDevices"];
            (_b = frozen["midiDevices"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.partName = function (build) {
            if (typeof build === 'function') {
                delete updates["partName"];
                var builder = build(new PartNameBuilder(original && original["partName"]));
                if (!original)
                    updates["partName"] = builder.build();
                else
                    childBuilders["partName"] = builder;
            }
            else {
                updates.partName = build;
                delete childBuilders["partName;"];
            }
            modifiedKeys["partName"] = true;
            return _this;
        };
        this.partAbbreviationDisplay = function (build) {
            if (typeof build === 'function') {
                delete updates["partAbbreviationDisplay"];
                var builder = build(new PartAbbreviationDisplayBuilder(original && original["partAbbreviationDisplay"]));
                if (!original)
                    updates["partAbbreviationDisplay"] = builder.build();
                else
                    childBuilders["partAbbreviationDisplay"] = builder;
            }
            else {
                updates.partAbbreviationDisplay = build;
                delete childBuilders["partAbbreviationDisplay;"];
            }
            modifiedKeys["partAbbreviationDisplay"] = true;
            return _this;
        };
        this.partAbbreviation = function (build) {
            if (typeof build === 'function') {
                delete updates["partAbbreviation"];
                var builder = build(new PartAbbreviationBuilder(original && original["partAbbreviation"]));
                if (!original)
                    updates["partAbbreviation"] = builder.build();
                else
                    childBuilders["partAbbreviation"] = builder;
            }
            else {
                updates.partAbbreviation = build;
                delete childBuilders["partAbbreviation;"];
            }
            modifiedKeys["partAbbreviation"] = true;
            return _this;
        };
        this.groups = function (spec) {
            updates["groups"] = spec;
            delete childBuilders["groups;"];
            modifiedKeys["groups"] = true;
            return _this;
        };
        this.midiInstruments = function (spec) {
            updates["midiInstruments"] = spec;
            delete childBuilders["midiInstruments;"];
            modifiedKeys["midiInstruments"] = true;
            return _this;
        };
        this.midiInstrumentsAt = function (idx, build) {
            makeReference("midiInstruments");
            if (frozen["midiInstruments"][idx]) {
                throw new Error("Patching midiInstruments." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["midiInstruments"] && !original["midiInstruments"]) {
                // Clone snapshot.
                patches.push({ p: ["midiInstruments", idx], li: original._snapshot["midiInstruments"] });
            }
            if (typeof build === 'function' && reference["midiInstruments"][idx]) {
                var patch = build(new MidiInstrumentBuilder(reference["midiInstruments"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["midiInstruments", idx].concat(patch.p);
                    return patch;
                }));
                frozen["midiInstruments"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MidiInstrumentBuilder(reference["midiInstruments"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["midiInstruments", idx], li: update });
            }
            else {
                updates["midiInstruments"] = reference["midiInstruments"]; // TODO: Merge?
            }
            reference["midiInstruments"][idx] = update;
            frozen["midiInstruments"][idx] = true;
            return _this;
        };
        this.midiInstrumentsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("midiInstruments");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["midiInstruments"][idx]) {
                        throw new Error("Replacing midiInstruments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiInstruments"][idx];
                    patches.push({ p: ["midiInstruments", idx], ld: ld, li: items[idx - start] });
                    frozen["midiInstruments"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["midiInstruments"][idx]) {
                        throw new Error("Removing midiInstruments." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["midiInstruments"][idx];
                    patches.push({ p: ["midiInstruments", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["midiInstruments", idx], li: items[idx - start] });
                    frozen["midiInstruments"][idx] = true;
                }
            }
            (_a = reference["midiInstruments"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["midiInstruments"] = reference["midiInstruments"];
            (_b = frozen["midiInstruments"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.id = function (spec) {
            updates["id"] = spec;
            delete childBuilders["id;"];
            modifiedKeys["id"] = true;
            return _this;
        };
    }
    return ScorePartBuilder;
}());
function patchScorePart(base, builder) { return builder(new ScorePartBuilder(base)).patch(); }
exports.patchScorePart = patchScorePart;
function buildScorePart(builder) { return builder(new ScorePartBuilder()).build(); }
exports.buildScorePart = buildScorePart;
var PartNameBuilder = (function () {
    function PartNameBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["partName"]) ||
                childBuilders["partName"] !== undefined ||
                updates.partName !== undefined, "partName is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PartName";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.partName = function (spec) {
            updates["partName"] = spec;
            delete childBuilders["partName;"];
            modifiedKeys["partName"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
    }
    return PartNameBuilder;
}());
function patchPartName(base, builder) { return builder(new PartNameBuilder(base)).patch(); }
exports.patchPartName = patchPartName;
function buildPartName(builder) { return builder(new PartNameBuilder()).build(); }
exports.buildPartName = buildPartName;
var PartAbbreviationBuilder = (function () {
    function PartAbbreviationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["abbreviation"]) ||
                childBuilders["abbreviation"] !== undefined ||
                updates.abbreviation !== undefined, "abbreviation is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PartAbbreviation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.abbreviation = function (spec) {
            updates["abbreviation"] = spec;
            delete childBuilders["abbreviation;"];
            modifiedKeys["abbreviation"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
    }
    return PartAbbreviationBuilder;
}());
function patchPartAbbreviation(base, builder) { return builder(new PartAbbreviationBuilder(base)).patch(); }
exports.patchPartAbbreviation = patchPartAbbreviation;
function buildPartAbbreviation(builder) { return builder(new PartAbbreviationBuilder()).build(); }
exports.buildPartAbbreviation = buildPartAbbreviation;
var PartGroupBuilder = (function () {
    function PartGroupBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["groupNameDisplay"]) ||
                childBuilders["groupNameDisplay"] !== undefined ||
                updates.groupNameDisplay !== undefined, "groupNameDisplay is a required field");
            console.assert((original && !modifiedKeys["groupSymbol"]) ||
                childBuilders["groupSymbol"] !== undefined ||
                updates.groupSymbol !== undefined, "groupSymbol is a required field");
            console.assert((original && !modifiedKeys["groupName"]) ||
                childBuilders["groupName"] !== undefined ||
                updates.groupName !== undefined, "groupName is a required field");
            console.assert((original && !modifiedKeys["groupAbbreviationDisplay"]) ||
                childBuilders["groupAbbreviationDisplay"] !== undefined ||
                updates.groupAbbreviationDisplay !== undefined, "groupAbbreviationDisplay is a required field");
            console.assert((original && !modifiedKeys["groupBarline"]) ||
                childBuilders["groupBarline"] !== undefined ||
                updates.groupBarline !== undefined, "groupBarline is a required field");
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
            console.assert((original && !modifiedKeys["groupAbbreviation"]) ||
                childBuilders["groupAbbreviation"] !== undefined ||
                updates.groupAbbreviation !== undefined, "groupAbbreviation is a required field");
            console.assert((original && !modifiedKeys["type"]) ||
                childBuilders["type"] !== undefined ||
                updates.type !== undefined, "type is a required field");
            console.assert((original && !modifiedKeys["groupTime"]) ||
                childBuilders["groupTime"] !== undefined ||
                updates.groupTime !== undefined, "groupTime is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "PartGroup";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.groupNameDisplay = function (build) {
            if (typeof build === 'function') {
                delete updates["groupNameDisplay"];
                var builder = build(new GroupNameDisplayBuilder(original && original["groupNameDisplay"]));
                if (!original)
                    updates["groupNameDisplay"] = builder.build();
                else
                    childBuilders["groupNameDisplay"] = builder;
            }
            else {
                updates.groupNameDisplay = build;
                delete childBuilders["groupNameDisplay;"];
            }
            modifiedKeys["groupNameDisplay"] = true;
            return _this;
        };
        this.groupSymbol = function (build) {
            if (typeof build === 'function') {
                delete updates["groupSymbol"];
                var builder = build(new GroupSymbolBuilder(original && original["groupSymbol"]));
                if (!original)
                    updates["groupSymbol"] = builder.build();
                else
                    childBuilders["groupSymbol"] = builder;
            }
            else {
                updates.groupSymbol = build;
                delete childBuilders["groupSymbol;"];
            }
            modifiedKeys["groupSymbol"] = true;
            return _this;
        };
        this.groupName = function (build) {
            if (typeof build === 'function') {
                delete updates["groupName"];
                var builder = build(new GroupNameBuilder(original && original["groupName"]));
                if (!original)
                    updates["groupName"] = builder.build();
                else
                    childBuilders["groupName"] = builder;
            }
            else {
                updates.groupName = build;
                delete childBuilders["groupName;"];
            }
            modifiedKeys["groupName"] = true;
            return _this;
        };
        this.groupAbbreviationDisplay = function (build) {
            if (typeof build === 'function') {
                delete updates["groupAbbreviationDisplay"];
                var builder = build(new GroupAbbreviationDisplayBuilder(original && original["groupAbbreviationDisplay"]));
                if (!original)
                    updates["groupAbbreviationDisplay"] = builder.build();
                else
                    childBuilders["groupAbbreviationDisplay"] = builder;
            }
            else {
                updates.groupAbbreviationDisplay = build;
                delete childBuilders["groupAbbreviationDisplay;"];
            }
            modifiedKeys["groupAbbreviationDisplay"] = true;
            return _this;
        };
        this.groupBarline = function (build) {
            if (typeof build === 'function') {
                delete updates["groupBarline"];
                var builder = build(new GroupBarlineBuilder(original && original["groupBarline"]));
                if (!original)
                    updates["groupBarline"] = builder.build();
                else
                    childBuilders["groupBarline"] = builder;
            }
            else {
                updates.groupBarline = build;
                delete childBuilders["groupBarline;"];
            }
            modifiedKeys["groupBarline"] = true;
            return _this;
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.groupAbbreviation = function (build) {
            if (typeof build === 'function') {
                delete updates["groupAbbreviation"];
                var builder = build(new GroupAbbreviationBuilder(original && original["groupAbbreviation"]));
                if (!original)
                    updates["groupAbbreviation"] = builder.build();
                else
                    childBuilders["groupAbbreviation"] = builder;
            }
            else {
                updates.groupAbbreviation = build;
                delete childBuilders["groupAbbreviation;"];
            }
            modifiedKeys["groupAbbreviation"] = true;
            return _this;
        };
        this.type = function (spec) {
            updates["type"] = spec;
            delete childBuilders["type;"];
            modifiedKeys["type"] = true;
            return _this;
        };
        this.groupTime = function (build) {
            if (typeof build === 'function') {
                delete updates["groupTime"];
                var builder = build(new GroupTimeBuilder(original && original["groupTime"]));
                if (!original)
                    updates["groupTime"] = builder.build();
                else
                    childBuilders["groupTime"] = builder;
            }
            else {
                updates.groupTime = build;
                delete childBuilders["groupTime;"];
            }
            modifiedKeys["groupTime"] = true;
            return _this;
        };
        this.footnote = function (build) {
            if (typeof build === 'function') {
                delete updates["footnote"];
                var builder = build(new FootnoteBuilder(original && original["footnote"]));
                if (!original)
                    updates["footnote"] = builder.build();
                else
                    childBuilders["footnote"] = builder;
            }
            else {
                updates.footnote = build;
                delete childBuilders["footnote;"];
            }
            modifiedKeys["footnote"] = true;
            return _this;
        };
        this.level = function (build) {
            if (typeof build === 'function') {
                delete updates["level"];
                var builder = build(new LevelBuilder(original && original["level"]));
                if (!original)
                    updates["level"] = builder.build();
                else
                    childBuilders["level"] = builder;
            }
            else {
                updates.level = build;
                delete childBuilders["level;"];
            }
            modifiedKeys["level"] = true;
            return _this;
        };
    }
    return PartGroupBuilder;
}());
function patchPartGroup(base, builder) { return builder(new PartGroupBuilder(base)).patch(); }
exports.patchPartGroup = patchPartGroup;
function buildPartGroup(builder) { return builder(new PartGroupBuilder()).build(); }
exports.buildPartGroup = buildPartGroup;
var GroupNameBuilder = (function () {
    function GroupNameBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupName";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
    }
    return GroupNameBuilder;
}());
function patchGroupName(base, builder) { return builder(new GroupNameBuilder(base)).patch(); }
exports.patchGroupName = patchGroupName;
function buildGroupName(builder) { return builder(new GroupNameBuilder()).build(); }
exports.buildGroupName = buildGroupName;
var GroupNameDisplayBuilder = (function () {
    function GroupNameDisplayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupNameDisplay";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.nameAt = function (idx, build) {
            makeReference("name");
            if (frozen["name"][idx]) {
                throw new Error("Patching name." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["name"] && !original["name"]) {
                // Clone snapshot.
                patches.push({ p: ["name", idx], li: original._snapshot["name"] });
            }
            if (typeof build === 'function' && reference["name"][idx]) {
                var patch = build(new TextSegmentBuilder(reference["name"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["name", idx].concat(patch.p);
                    return patch;
                }));
                frozen["name"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TextSegmentBuilder(reference["name"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["name", idx], li: update });
            }
            else {
                updates["name"] = reference["name"]; // TODO: Merge?
            }
            reference["name"][idx] = update;
            frozen["name"][idx] = true;
            return _this;
        };
        this.nameSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("name");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Replacing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld, li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Removing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["name", idx], li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
            }
            (_a = reference["name"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["name"] = reference["name"];
            (_b = frozen["name"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return GroupNameDisplayBuilder;
}());
function patchGroupNameDisplay(base, builder) { return builder(new GroupNameDisplayBuilder(base)).patch(); }
exports.patchGroupNameDisplay = patchGroupNameDisplay;
function buildGroupNameDisplay(builder) { return builder(new GroupNameDisplayBuilder()).build(); }
exports.buildGroupNameDisplay = buildGroupNameDisplay;
var GroupAbbreviationBuilder = (function () {
    function GroupAbbreviationBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["text"]) ||
                childBuilders["text"] !== undefined ||
                updates.text !== undefined, "text is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupAbbreviation";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.text = function (spec) {
            updates["text"] = spec;
            delete childBuilders["text;"];
            modifiedKeys["text"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.fontFamily = function (spec) {
            updates["fontFamily"] = spec;
            delete childBuilders["fontFamily;"];
            modifiedKeys["fontFamily"] = true;
            return _this;
        };
        this.fontWeight = function (spec) {
            updates["fontWeight"] = spec;
            delete childBuilders["fontWeight;"];
            modifiedKeys["fontWeight"] = true;
            return _this;
        };
        this.fontStyle = function (spec) {
            updates["fontStyle"] = spec;
            delete childBuilders["fontStyle;"];
            modifiedKeys["fontStyle"] = true;
            return _this;
        };
        this.fontSize = function (spec) {
            updates["fontSize"] = spec;
            delete childBuilders["fontSize;"];
            modifiedKeys["fontSize"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
        this.justify = function (spec) {
            updates["justify"] = spec;
            delete childBuilders["justify;"];
            modifiedKeys["justify"] = true;
            return _this;
        };
    }
    return GroupAbbreviationBuilder;
}());
function patchGroupAbbreviation(base, builder) { return builder(new GroupAbbreviationBuilder(base)).patch(); }
exports.patchGroupAbbreviation = patchGroupAbbreviation;
function buildGroupAbbreviation(builder) { return builder(new GroupAbbreviationBuilder()).build(); }
exports.buildGroupAbbreviation = buildGroupAbbreviation;
var GroupAbbreviationDisplayBuilder = (function () {
    function GroupAbbreviationDisplayBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["name"]) ||
                childBuilders["name"] !== undefined ||
                updates.name !== undefined, "name is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupAbbreviationDisplay";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.name = function (spec) {
            updates["name"] = spec;
            delete childBuilders["name;"];
            modifiedKeys["name"] = true;
            return _this;
        };
        this.nameAt = function (idx, build) {
            makeReference("name");
            if (frozen["name"][idx]) {
                throw new Error("Patching name." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["name"] && !original["name"]) {
                // Clone snapshot.
                patches.push({ p: ["name", idx], li: original._snapshot["name"] });
            }
            if (typeof build === 'function' && reference["name"][idx]) {
                var patch = build(new TextSegmentBuilder(reference["name"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["name", idx].concat(patch.p);
                    return patch;
                }));
                frozen["name"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new TextSegmentBuilder(reference["name"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["name", idx], li: update });
            }
            else {
                updates["name"] = reference["name"]; // TODO: Merge?
            }
            reference["name"][idx] = update;
            frozen["name"][idx] = true;
            return _this;
        };
        this.nameSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("name");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Replacing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld, li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["name"][idx]) {
                        throw new Error("Removing name." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["name"][idx];
                    patches.push({ p: ["name", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["name", idx], li: items[idx - start] });
                    frozen["name"][idx] = true;
                }
            }
            (_a = reference["name"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["name"] = reference["name"];
            (_b = frozen["name"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.printObject = function (spec) {
            updates["printObject"] = spec;
            delete childBuilders["printObject;"];
            modifiedKeys["printObject"] = true;
            return _this;
        };
    }
    return GroupAbbreviationDisplayBuilder;
}());
function patchGroupAbbreviationDisplay(base, builder) { return builder(new GroupAbbreviationDisplayBuilder(base)).patch(); }
exports.patchGroupAbbreviationDisplay = patchGroupAbbreviationDisplay;
function buildGroupAbbreviationDisplay(builder) { return builder(new GroupAbbreviationDisplayBuilder()).build(); }
exports.buildGroupAbbreviationDisplay = buildGroupAbbreviationDisplay;
var GroupSymbolBuilder = (function () {
    function GroupSymbolBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupSymbol";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.defaultX = function (spec) {
            updates["defaultX"] = spec;
            delete childBuilders["defaultX;"];
            modifiedKeys["defaultX"] = true;
            return _this;
        };
        this.relativeY = function (spec) {
            updates["relativeY"] = spec;
            delete childBuilders["relativeY;"];
            modifiedKeys["relativeY"] = true;
            return _this;
        };
        this.defaultY = function (spec) {
            updates["defaultY"] = spec;
            delete childBuilders["defaultY;"];
            modifiedKeys["defaultY"] = true;
            return _this;
        };
        this.relativeX = function (spec) {
            updates["relativeX"] = spec;
            delete childBuilders["relativeX;"];
            modifiedKeys["relativeX"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return GroupSymbolBuilder;
}());
function patchGroupSymbol(base, builder) { return builder(new GroupSymbolBuilder(base)).patch(); }
exports.patchGroupSymbol = patchGroupSymbol;
function buildGroupSymbol(builder) { return builder(new GroupSymbolBuilder()).build(); }
exports.buildGroupSymbol = buildGroupSymbol;
var GroupBarlineBuilder = (function () {
    function GroupBarlineBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["data"]) ||
                childBuilders["data"] !== undefined ||
                updates.data !== undefined, "data is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupBarline";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.data = function (spec) {
            updates["data"] = spec;
            delete childBuilders["data;"];
            modifiedKeys["data"] = true;
            return _this;
        };
        this.color = function (spec) {
            updates["color"] = spec;
            delete childBuilders["color;"];
            modifiedKeys["color"] = true;
            return _this;
        };
    }
    return GroupBarlineBuilder;
}());
function patchGroupBarline(base, builder) { return builder(new GroupBarlineBuilder(base)).patch(); }
exports.patchGroupBarline = patchGroupBarline;
function buildGroupBarline(builder) { return builder(new GroupBarlineBuilder()).build(); }
exports.buildGroupBarline = buildGroupBarline;
var GroupTimeBuilder = (function () {
    function GroupTimeBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "GroupTime";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return GroupTimeBuilder;
}());
function patchGroupTime(base, builder) { return builder(new GroupTimeBuilder(base)).patch(); }
exports.patchGroupTime = patchGroupTime;
function buildGroupTime(builder) { return builder(new GroupTimeBuilder()).build(); }
exports.buildGroupTime = buildGroupTime;
var ScoreInstrumentBuilder = (function () {
    function ScoreInstrumentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["instrumentName"]) ||
                childBuilders["instrumentName"] !== undefined ||
                updates.instrumentName !== undefined, "instrumentName is a required field");
            console.assert((original && !modifiedKeys["id"]) ||
                childBuilders["id"] !== undefined ||
                updates.id !== undefined, "id is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "ScoreInstrument";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.instrumentName = function (spec) {
            updates["instrumentName"] = spec;
            delete childBuilders["instrumentName;"];
            modifiedKeys["instrumentName"] = true;
            return _this;
        };
        this.instrumentSound = function (spec) {
            updates["instrumentSound"] = spec;
            delete childBuilders["instrumentSound;"];
            modifiedKeys["instrumentSound"] = true;
            return _this;
        };
        this.ensemble = function (spec) {
            updates["ensemble"] = spec;
            delete childBuilders["ensemble;"];
            modifiedKeys["ensemble"] = true;
            return _this;
        };
        this.virtualInstrument = function (build) {
            if (typeof build === 'function') {
                delete updates["virtualInstrument"];
                var builder = build(new VirtualInstrumentBuilder(original && original["virtualInstrument"]));
                if (!original)
                    updates["virtualInstrument"] = builder.build();
                else
                    childBuilders["virtualInstrument"] = builder;
            }
            else {
                updates.virtualInstrument = build;
                delete childBuilders["virtualInstrument;"];
            }
            modifiedKeys["virtualInstrument"] = true;
            return _this;
        };
        this.instrumentAbbreviation = function (spec) {
            updates["instrumentAbbreviation"] = spec;
            delete childBuilders["instrumentAbbreviation;"];
            modifiedKeys["instrumentAbbreviation"] = true;
            return _this;
        };
        this.solo = function (build) {
            if (typeof build === 'function') {
                delete updates["solo"];
                var builder = build(new SoloBuilder(original && original["solo"]));
                if (!original)
                    updates["solo"] = builder.build();
                else
                    childBuilders["solo"] = builder;
            }
            else {
                updates.solo = build;
                delete childBuilders["solo;"];
            }
            modifiedKeys["solo"] = true;
            return _this;
        };
        this.id = function (spec) {
            updates["id"] = spec;
            delete childBuilders["id;"];
            modifiedKeys["id"] = true;
            return _this;
        };
    }
    return ScoreInstrumentBuilder;
}());
function patchScoreInstrument(base, builder) { return builder(new ScoreInstrumentBuilder(base)).patch(); }
exports.patchScoreInstrument = patchScoreInstrument;
function buildScoreInstrument(builder) { return builder(new ScoreInstrumentBuilder()).build(); }
exports.buildScoreInstrument = buildScoreInstrument;
var SoloBuilder = (function () {
    function SoloBuilder(original) {
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Solo";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
    }
    return SoloBuilder;
}());
function patchSolo(base, builder) { return builder(new SoloBuilder(base)).patch(); }
exports.patchSolo = patchSolo;
function buildSolo(builder) { return builder(new SoloBuilder()).build(); }
exports.buildSolo = buildSolo;
var VirtualInstrumentBuilder = (function () {
    function VirtualInstrumentBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["virtualLibrary"]) ||
                childBuilders["virtualLibrary"] !== undefined ||
                updates.virtualLibrary !== undefined, "virtualLibrary is a required field");
            console.assert((original && !modifiedKeys["virtualName"]) ||
                childBuilders["virtualName"] !== undefined ||
                updates.virtualName !== undefined, "virtualName is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "VirtualInstrument";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.virtualLibrary = function (spec) {
            updates["virtualLibrary"] = spec;
            delete childBuilders["virtualLibrary;"];
            modifiedKeys["virtualLibrary"] = true;
            return _this;
        };
        this.virtualName = function (spec) {
            updates["virtualName"] = spec;
            delete childBuilders["virtualName;"];
            modifiedKeys["virtualName"] = true;
            return _this;
        };
    }
    return VirtualInstrumentBuilder;
}());
function patchVirtualInstrument(base, builder) { return builder(new VirtualInstrumentBuilder(base)).patch(); }
exports.patchVirtualInstrument = patchVirtualInstrument;
function buildVirtualInstrument(builder) { return builder(new VirtualInstrumentBuilder()).build(); }
exports.buildVirtualInstrument = buildVirtualInstrument;
var ScoreHeaderBuilder = (function () {
    function ScoreHeaderBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["movementTitle"]) ||
                childBuilders["movementTitle"] !== undefined ||
                updates.movementTitle !== undefined, "movementTitle is a required field");
            console.assert((original && !modifiedKeys["identification"]) ||
                childBuilders["identification"] !== undefined ||
                updates.identification !== undefined, "identification is a required field");
            console.assert((original && !modifiedKeys["defaults"]) ||
                childBuilders["defaults"] !== undefined ||
                updates.defaults !== undefined, "defaults is a required field");
            console.assert((original && !modifiedKeys["work"]) ||
                childBuilders["work"] !== undefined ||
                updates.work !== undefined, "work is a required field");
            console.assert((original && !modifiedKeys["credits"]) ||
                childBuilders["credits"] !== undefined ||
                updates.credits !== undefined, "credits is a required field");
            console.assert((original && !modifiedKeys["partList"]) ||
                childBuilders["partList"] !== undefined ||
                updates.partList !== undefined, "partList is a required field");
            console.assert((original && !modifiedKeys["movementNumber"]) ||
                childBuilders["movementNumber"] !== undefined ||
                updates.movementNumber !== undefined, "movementNumber is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "ScoreHeader";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.movementTitle = function (spec) {
            updates["movementTitle"] = spec;
            delete childBuilders["movementTitle;"];
            modifiedKeys["movementTitle"] = true;
            return _this;
        };
        this.identification = function (build) {
            if (typeof build === 'function') {
                delete updates["identification"];
                var builder = build(new IdentificationBuilder(original && original["identification"]));
                if (!original)
                    updates["identification"] = builder.build();
                else
                    childBuilders["identification"] = builder;
            }
            else {
                updates.identification = build;
                delete childBuilders["identification;"];
            }
            modifiedKeys["identification"] = true;
            return _this;
        };
        this.defaults = function (build) {
            if (typeof build === 'function') {
                delete updates["defaults"];
                var builder = build(new DefaultsBuilder(original && original["defaults"]));
                if (!original)
                    updates["defaults"] = builder.build();
                else
                    childBuilders["defaults"] = builder;
            }
            else {
                updates.defaults = build;
                delete childBuilders["defaults;"];
            }
            modifiedKeys["defaults"] = true;
            return _this;
        };
        this.work = function (build) {
            if (typeof build === 'function') {
                delete updates["work"];
                var builder = build(new WorkBuilder(original && original["work"]));
                if (!original)
                    updates["work"] = builder.build();
                else
                    childBuilders["work"] = builder;
            }
            else {
                updates.work = build;
                delete childBuilders["work;"];
            }
            modifiedKeys["work"] = true;
            return _this;
        };
        this.credits = function (spec) {
            updates["credits"] = spec;
            delete childBuilders["credits;"];
            modifiedKeys["credits"] = true;
            return _this;
        };
        this.creditsAt = function (idx, build) {
            makeReference("credits");
            if (frozen["credits"][idx]) {
                throw new Error("Patching credits." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["credits"] && !original["credits"]) {
                // Clone snapshot.
                patches.push({ p: ["credits", idx], li: original._snapshot["credits"] });
            }
            if (typeof build === 'function' && reference["credits"][idx]) {
                var patch = build(new CreditBuilder(reference["credits"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["credits", idx].concat(patch.p);
                    return patch;
                }));
                frozen["credits"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new CreditBuilder(reference["credits"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["credits", idx], li: update });
            }
            else {
                updates["credits"] = reference["credits"]; // TODO: Merge?
            }
            reference["credits"][idx] = update;
            frozen["credits"][idx] = true;
            return _this;
        };
        this.creditsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("credits");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["credits"][idx]) {
                        throw new Error("Replacing credits." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["credits"][idx];
                    patches.push({ p: ["credits", idx], ld: ld, li: items[idx - start] });
                    frozen["credits"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["credits"][idx]) {
                        throw new Error("Removing credits." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["credits"][idx];
                    patches.push({ p: ["credits", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["credits", idx], li: items[idx - start] });
                    frozen["credits"][idx] = true;
                }
            }
            (_a = reference["credits"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["credits"] = reference["credits"];
            (_b = frozen["credits"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.partList = function (spec) {
            updates["partList"] = spec;
            delete childBuilders["partList;"];
            modifiedKeys["partList"] = true;
            return _this;
        };
        this.movementNumber = function (spec) {
            updates["movementNumber"] = spec;
            delete childBuilders["movementNumber;"];
            modifiedKeys["movementNumber"] = true;
            return _this;
        };
    }
    return ScoreHeaderBuilder;
}());
function patchScoreHeader(base, builder) { return builder(new ScoreHeaderBuilder(base)).patch(); }
exports.patchScoreHeader = patchScoreHeader;
function buildScoreHeader(builder) { return builder(new ScoreHeaderBuilder()).build(); }
exports.buildScoreHeader = buildScoreHeader;
var ScoreTimewiseBuilder = (function () {
    function ScoreTimewiseBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["measures"]) ||
                childBuilders["measures"] !== undefined ||
                updates.measures !== undefined, "measures is a required field");
            console.assert((original && !modifiedKeys["version"]) ||
                childBuilders["version"] !== undefined ||
                updates.version !== undefined, "version is a required field");
            console.assert((original && !modifiedKeys["movementTitle"]) ||
                childBuilders["movementTitle"] !== undefined ||
                updates.movementTitle !== undefined, "movementTitle is a required field");
            console.assert((original && !modifiedKeys["identification"]) ||
                childBuilders["identification"] !== undefined ||
                updates.identification !== undefined, "identification is a required field");
            console.assert((original && !modifiedKeys["defaults"]) ||
                childBuilders["defaults"] !== undefined ||
                updates.defaults !== undefined, "defaults is a required field");
            console.assert((original && !modifiedKeys["work"]) ||
                childBuilders["work"] !== undefined ||
                updates.work !== undefined, "work is a required field");
            console.assert((original && !modifiedKeys["credits"]) ||
                childBuilders["credits"] !== undefined ||
                updates.credits !== undefined, "credits is a required field");
            console.assert((original && !modifiedKeys["partList"]) ||
                childBuilders["partList"] !== undefined ||
                updates.partList !== undefined, "partList is a required field");
            console.assert((original && !modifiedKeys["movementNumber"]) ||
                childBuilders["movementNumber"] !== undefined ||
                updates.movementNumber !== undefined, "movementNumber is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "ScoreTimewise";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.measures = function (spec) {
            updates["measures"] = spec;
            delete childBuilders["measures;"];
            modifiedKeys["measures"] = true;
            return _this;
        };
        this.measuresAt = function (idx, build) {
            makeReference("measures");
            if (frozen["measures"][idx]) {
                throw new Error("Patching measures." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["measures"] && !original["measures"]) {
                // Clone snapshot.
                patches.push({ p: ["measures", idx], li: original._snapshot["measures"] });
            }
            if (typeof build === 'function' && reference["measures"][idx]) {
                var patch = build(new MeasureBuilder(reference["measures"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["measures", idx].concat(patch.p);
                    return patch;
                }));
                frozen["measures"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new MeasureBuilder(reference["measures"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["measures", idx], li: update });
            }
            else {
                updates["measures"] = reference["measures"]; // TODO: Merge?
            }
            reference["measures"][idx] = update;
            frozen["measures"][idx] = true;
            return _this;
        };
        this.measuresSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("measures");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["measures"][idx]) {
                        throw new Error("Replacing measures." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["measures"][idx];
                    patches.push({ p: ["measures", idx], ld: ld, li: items[idx - start] });
                    frozen["measures"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["measures"][idx]) {
                        throw new Error("Removing measures." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["measures"][idx];
                    patches.push({ p: ["measures", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["measures", idx], li: items[idx - start] });
                    frozen["measures"][idx] = true;
                }
            }
            (_a = reference["measures"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["measures"] = reference["measures"];
            (_b = frozen["measures"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.version = function (spec) {
            updates["version"] = spec;
            delete childBuilders["version;"];
            modifiedKeys["version"] = true;
            return _this;
        };
        this.movementTitle = function (spec) {
            updates["movementTitle"] = spec;
            delete childBuilders["movementTitle;"];
            modifiedKeys["movementTitle"] = true;
            return _this;
        };
        this.identification = function (build) {
            if (typeof build === 'function') {
                delete updates["identification"];
                var builder = build(new IdentificationBuilder(original && original["identification"]));
                if (!original)
                    updates["identification"] = builder.build();
                else
                    childBuilders["identification"] = builder;
            }
            else {
                updates.identification = build;
                delete childBuilders["identification;"];
            }
            modifiedKeys["identification"] = true;
            return _this;
        };
        this.defaults = function (build) {
            if (typeof build === 'function') {
                delete updates["defaults"];
                var builder = build(new DefaultsBuilder(original && original["defaults"]));
                if (!original)
                    updates["defaults"] = builder.build();
                else
                    childBuilders["defaults"] = builder;
            }
            else {
                updates.defaults = build;
                delete childBuilders["defaults;"];
            }
            modifiedKeys["defaults"] = true;
            return _this;
        };
        this.work = function (build) {
            if (typeof build === 'function') {
                delete updates["work"];
                var builder = build(new WorkBuilder(original && original["work"]));
                if (!original)
                    updates["work"] = builder.build();
                else
                    childBuilders["work"] = builder;
            }
            else {
                updates.work = build;
                delete childBuilders["work;"];
            }
            modifiedKeys["work"] = true;
            return _this;
        };
        this.credits = function (spec) {
            updates["credits"] = spec;
            delete childBuilders["credits;"];
            modifiedKeys["credits"] = true;
            return _this;
        };
        this.creditsAt = function (idx, build) {
            makeReference("credits");
            if (frozen["credits"][idx]) {
                throw new Error("Patching credits." + idx + " twice in a builder is unsupported.");
            }
            if (original && original._snapshot && original._snapshot["credits"] && !original["credits"]) {
                // Clone snapshot.
                patches.push({ p: ["credits", idx], li: original._snapshot["credits"] });
            }
            if (typeof build === 'function' && reference["credits"][idx]) {
                var patch = build(new CreditBuilder(reference["credits"][idx])).patch();
                patches = patches.concat(patch.map(function (patch) {
                    // TODO: detach?
                    patch.p = ["credits", idx].concat(patch.p);
                    return patch;
                }));
                frozen["credits"][idx] = true;
                return _this;
            }
            var update = typeof build === 'function' ? build(new CreditBuilder(reference["credits"][idx])).build() : build;
            if (original) {
                patches.push({ p: ["credits", idx], li: update });
            }
            else {
                updates["credits"] = reference["credits"]; // TODO: Merge?
            }
            reference["credits"][idx] = update;
            frozen["credits"][idx] = true;
            return _this;
        };
        this.creditsSplice = function (start, deleteCount) {
            var items = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                items[_i - 2] = arguments[_i];
            }
            makeReference("credits");
            var idx = start;
            if (original) {
                for (; idx < start + deleteCount && idx < start + items.length; ++idx) {
                    if (frozen["credits"][idx]) {
                        throw new Error("Replacing credits." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["credits"][idx];
                    patches.push({ p: ["credits", idx], ld: ld, li: items[idx - start] });
                    frozen["credits"][idx] = true;
                }
                for (; idx < start + deleteCount; ++idx) {
                    if (frozen["credits"][idx]) {
                        throw new Error("Removing credits." + idx + " after patching in a builder is unsupported.");
                    }
                    var ld = reference["credits"][idx];
                    patches.push({ p: ["credits", idx], ld: ld });
                }
                for (; idx < start + items.length; ++idx) {
                    patches.push({ p: ["credits", idx], li: items[idx - start] });
                    frozen["credits"][idx] = true;
                }
            }
            (_a = reference["credits"]).splice.apply(_a, [start, deleteCount].concat(items));
            updates["credits"] = reference["credits"];
            (_b = frozen["credits"]).splice.apply(_b, [start, deleteCount].concat(items.map(function (i) { return true; })));
            return _this;
            var _a, _b;
        };
        this.partList = function (spec) {
            updates["partList"] = spec;
            delete childBuilders["partList;"];
            modifiedKeys["partList"] = true;
            return _this;
        };
        this.movementNumber = function (spec) {
            updates["movementNumber"] = spec;
            delete childBuilders["movementNumber;"];
            modifiedKeys["movementNumber"] = true;
            return _this;
        };
    }
    return ScoreTimewiseBuilder;
}());
function patchScoreTimewise(base, builder) { return builder(new ScoreTimewiseBuilder(base)).patch(); }
exports.patchScoreTimewise = patchScoreTimewise;
function buildScoreTimewise(builder) { return builder(new ScoreTimewiseBuilder()).build(); }
exports.buildScoreTimewise = buildScoreTimewise;
var MeasureBuilder = (function () {
    function MeasureBuilder(original) {
        var _this = this;
        var updates = {};
        var childBuilders = {};
        var modifiedKeys = {};
        var reference = {};
        var frozen = {};
        var patches = [];
        function makeReference(fieldName) {
            if (!reference[fieldName]) {
                if (original) {
                    reference[fieldName] = ((original._snapshot || original)[fieldName] || []).slice();
                }
                else {
                    reference[fieldName] = [];
                }
                frozen[fieldName] = reference[fieldName].map(function (a) { return false; });
            }
        }
        function checkInvariants() {
            console.assert((original && !modifiedKeys["number"]) ||
                childBuilders["number"] !== undefined ||
                updates.number !== undefined, "number is a required field");
        }
        if (!original) {
            this.build = function () {
                checkInvariants();
                updates._class = "Measure";
                return updates;
            };
        }
        this.patch = function () {
            checkInvariants();
            return makePatch(original, updates, childBuilders, patches, modifiedKeys);
        };
        this.number = function (spec) {
            updates["number"] = spec;
            delete childBuilders["number;"];
            modifiedKeys["number"] = true;
            return _this;
        };
        this.implicit = function (spec) {
            updates["implicit"] = spec;
            delete childBuilders["implicit;"];
            modifiedKeys["implicit"] = true;
            return _this;
        };
        this.width = function (spec) {
            updates["width"] = spec;
            delete childBuilders["width;"];
            modifiedKeys["width"] = true;
            return _this;
        };
        this.set = function (key, val) {
            updates[key] = val;
            modifiedKeys[key] = true;
            return _this;
        };
        this.nonControlling = function (spec) {
            updates["nonControlling"] = spec;
            delete childBuilders["nonControlling;"];
            modifiedKeys["nonControlling"] = true;
            return _this;
        };
    }
    return MeasureBuilder;
}());
function patchMeasure(base, builder) { return builder(new MeasureBuilder(base)).patch(); }
exports.patchMeasure = patchMeasure;
function buildMeasure(builder) { return builder(new MeasureBuilder()).build(); }
exports.buildMeasure = buildMeasure;
